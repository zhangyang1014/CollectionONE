# CCO催收系统 - 接口文档总览

## 📋 文档概述

本目录包含CCO催收系统的完整接口文档，涵盖三个不同的接口体系：

1. **管理控台API** - 用于系统管理和配置
2. **甲方应提供的接口** - 甲方核心系统需要实现的接口规范
3. **IM端催员APP接口** - 催员移动端和工作台使用的接口

---

## 📚 文档列表

### 1. [管理控台API文档](./1-管理控台API文档.md)

**适用对象**: SuperAdmin、TenantAdmin、AgencyAdmin

**主要功能模块**:
- 🔐 认证授权（登录、登出、权限管理）
- 🏢 甲方管理（创建、编辑、查询甲方）
- 🏛️ 机构管理（催收机构增删改查）
- 👥 小组群管理（小组群和SPV管理）
- 🎯 小组管理（催收小组和组长管理）
- 👤 催员管理（催员账号、权限、绩效）
- 📋 案件队列管理（队列配置和规则）
- 📦 案件管理（导入、分配、查询、转移）
- 🎨 字段管理（标准字段、甲方字段配置）
- 🔔 通知系统（模板、推送、公告）
- 📊 数据看板（统计、分析、监控）
- 📈 报表导出（Excel导出）
- ⚙️ 系统配置（工作时间、业务规则）

**接口数量**: ~80个核心接口

**Base URL**: `http://localhost:8000/api/v1`

**认证方式**: JWT Token

---

### 2. [甲方应提供的接口文档](./2-甲方应提供的接口文档.md)

**适用对象**: 甲方技术团队、第三方集成商

**接口类型**:

#### 📤 推送接口（甲方→CCO）
- 批量推送逾期案件（每日定时）
- 案件状态更新推送（实时）
- 还款记录推送（实时）

#### 📥 查询接口（CCO→甲方）
- 查询客户详细信息
- 查询贷款详情
- 查询还款记录
- 批量查询案件状态

#### 📝 回写接口（CCO→甲方）
- 回写沟通记录
- 回写PTP承诺
- 回写催收结果
- 回写案件状态变更

#### 🔔 通知接口（甲方→CCO Webhook）
- 还款成功通知
- 案件结清通知
- 案件召回通知

**接口优先级**:
- P0（必须）: 6个核心接口
- P1（建议）: 5个增强接口
- P2（可选）: 3个扩展接口

**认证方式**: API Key + HMAC-SHA256签名

---

### 3. [IM端催员APP接口文档](./3-IM端催员APP接口文档.md)

**适用对象**: 催员、组长、前端开发团队

**主要功能模块**:
- 🔐 认证模块（登录、人脸识别、Token刷新）
- 📱 工作台首页（统计、待办、排行榜）
- 📋 案件管理（我的案件、详情、搜索、筛选）
- 📞 沟通管理（记录、拨打电话、WhatsApp、SMS）
- 🤝 PTP管理（承诺记录、状态跟踪、到期提醒）
- 💰 还款管理（记录查询、生成链接、确认还款）
- 🔔 通知消息（未读通知、历史、公告）
- 📊 统计报表（绩效、日报、案件分析）
- 👤 个人中心（资料、头像、人脸绑定、工作状态）
- 📚 知识库（话术模板、FAQ、搜索）
- 🛠️ 工具功能（计算器、工作时间、号码验证）
- 🔧 系统功能（版本检查、反馈、帮助）

**接口数量**: ~60个接口

**Base URL**: `http://localhost:8000/api/v1/im`

**认证方式**: JWT Token

**特性**:
- ✅ 离线支持（缓存、离线记录）
- ✅ 实时推送（WebSocket）
- ✅ 数据脱敏（隐私保护）
- ✅ 设备管理（多设备登录控制）

---

## 🔄 接口关系图

```
┌─────────────────────────────────────────────────────────────┐
│                      CCO 催收系统                            │
│                                                              │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐  │
│  │  管理控台    │    │  IM催员端    │    │  数据库      │  │
│  │   (Admin)    │    │  (Collector) │    │  (MySQL)     │  │
│  └──────┬───────┘    └──────┬───────┘    └──────────────┘  │
│         │                   │                                │
│         └───────┬───────────┘                                │
│                 │                                            │
└─────────────────┼────────────────────────────────────────────┘
                  │
                  │ REST API
                  │
┌─────────────────┼────────────────────────────────────────────┐
│                 │                                            │
│         ┌───────▼───────┐                                    │
│         │               │                                    │
│         │  甲方核心系统  │                                    │
│         │  (贷款系统)   │                                    │
│         │               │                                    │
│         └───────────────┘                                    │
│                                                              │
│  功能：                                                       │
│  - 推送逾期案件                                              │
│  - 推送还款记录                                              │
│  - 提供客户/贷款查询                                         │
│  - 接收催收结果回写                                          │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

---

## 🔐 认证体系

### 管理控台认证
```
用户登录 → 验证账号密码 → 签发JWT Token → 后续请求携带Token
         ↓
      验证权限（SuperAdmin/TenantAdmin/AgencyAdmin）
```

### IM端认证
```
催员登录 → 密码/人脸识别 → 签发JWT Token → 后续请求携带Token
         ↓
      验证催员身份和案件访问权限
```

### 甲方接口认证
```
请求签名 = HMAC-SHA256(api_secret, api_key + timestamp + body)
         ↓
      CCO验证签名 → 允许访问
```

---

## 📊 数据流转

### 案件导入流程
```
甲方核心系统 
    ↓ (推送逾期案件)
CCO系统（案件导入）
    ↓ (自动分配队列)
案件队列
    ↓ (自动/手动分案)
催员（IM端）
```

### 催收流程
```
催员查看案件（IM端）
    ↓
联系客户（电话/WhatsApp/SMS）
    ↓
记录沟通
    ↓ (同步到甲方)
甲方系统（保存沟通记录）
    ↓
客户还款（甲方系统）
    ↓ (实时通知)
CCO系统（更新案件状态）
    ↓ (推送通知)
催员（IM端收到还款通知）
```

### 数据同步
```
实时同步:
- 还款记录（甲方→CCO，实时）
- 案件状态变更（甲方→CCO，实时）
- 沟通记录（CCO→甲方，实时）

定时同步:
- 逾期案件批量推送（甲方→CCO，每日1-2次）
- 案件状态批量查询（CCO→甲方，按需）
```

---

## 🚀 快速开始

### 1. 管理控台使用流程

#### Step 1: SuperAdmin登录
```bash
curl -X POST http://localhost:8000/api/v1/admin/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "loginId": "superadmin",
    "password": "123456"
  }'
```

#### Step 2: 创建甲方
```bash
curl -X POST http://localhost:8000/api/v1/tenants \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "tenant_code": "TENANT_A",
    "tenant_name": "甲方A公司"
  }'
```

#### Step 3: 创建机构、小组、催员
（参考完整文档）

### 2. 甲方对接流程

#### Step 1: 获取API认证信息
联系CCO技术团队获取：
- API Key
- API Secret
- CCO服务器IP（配置白名单）

#### Step 2: 实现核心接口（P0）
1. 批量推送逾期案件
2. 实时推送还款记录
3. 提供客户/贷款查询接口

#### Step 3: 联调测试
使用测试环境进行接口联调

### 3. IM端使用流程

#### Step 1: 催员登录
```bash
curl -X POST http://localhost:8000/api/v1/im/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "loginId": "collector001",
    "password": "123456"
  }'
```

#### Step 2: 查看我的案件
```bash
curl http://localhost:8000/api/v1/im/cases/my \
  -H "Authorization: Bearer {token}"
```

#### Step 3: 记录沟通、添加PTP
（参考完整文档）

---

## 📋 接口规范

### 通用响应格式

**成功响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": { ... }
}
```

**错误响应**:
```json
{
  "code": 400,
  "message": "参数错误：mobile格式不正确",
  "data": null
}
```

### 状态码规范

| Code | 说明 |
|------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权（未登录或token失效） |
| 403 | 禁止访问（权限不足） |
| 404 | 资源不存在 |
| 429 | 请求频率超限 |
| 500 | 服务器内部错误 |

### 时间格式

- **日期时间**: `YYYY-MM-DD HH:mm:ss` (例: `2025-11-20 15:30:00`)
- **日期**: `YYYY-MM-DD` (例: `2025-11-20`)
- **时间**: `HH:mm:ss` (例: `15:30:00`)
- **ISO 8601**: `YYYY-MM-DDTHH:mm:ss` (例: `2025-11-20T15:30:00`)

### 分页参数

所有列表接口统一分页参数：
- `page`: 页码，从1开始（默认1）
- `size`: 每页数量（默认10-20，最大100）

分页响应格式：
```json
{
  "code": 200,
  "data": {
    "total": 100,
    "page": 1,
    "size": 20,
    "items": [ ... ]
  }
}
```

### 排序参数

支持排序的接口：
- `sort`: 排序字段（如 `created_at`、`overdue_days`）
- `order`: 排序方向（`asc`升序、`desc`降序）

---

## 🔧 环境配置

### 开发环境
- **Base URL**: `http://localhost:8000`
- **数据库**: SQLite（开发测试）
- **Redis**: `localhost:6379`

### 测试环境
- **Base URL**: `https://test-api.cco.example.com`
- **数据库**: MySQL（测试数据）

### 生产环境
- **Base URL**: `https://api.cco.example.com`
- **数据库**: MySQL（生产数据）
- **高可用**: 负载均衡 + 数据库主从

---

## 📞 技术支持

### 对接支持
- **对接联系人**: 技术对接负责人
- **工作时间**: 工作日 9:00-18:00
- **联系方式**: 
  - 邮箱: tech@cco.example.com
  - 微信群: CCO技术对接群
  - 电话: +86-xxx-xxxx-xxxx

### 紧急支持
- **7x24小时**: 生产环境故障
- **响应时间**: 30分钟内响应
- **处理时间**: 2小时内处理

---

## 📝 版本历史

### v1.0.0 (2025-11-20)
- ✅ 完成管理控台API设计（80+接口）
- ✅ 完成甲方接口规范定义（14个接口）
- ✅ 完成IM端API设计（60+接口）
- ✅ 完成完整功能测试用例

### 未来计划
- v1.1.0: 增加GraphQL支持
- v1.2.0: 增加WebSocket实时推送
- v1.3.0: 增加批量操作优化

---

## 📖 相关文档

### 测试文档
- [完整功能测试用例](../测试/完整功能测试用例.md) - 从基础数据创建到完整业务流程的测试

### 系统文档
- [项目README](../README.md) - 项目总体介绍
- [数据库设计](../backend-java/src/main/resources/db/migration/schema.sql) - MySQL数据库结构
- [部署指南](../说明文档/部署/) - 系统部署说明

### PRD文档
- [字段配置功能PRD](../CCO管理控台/字段配置功能PRD.md)
- [数据看板PRD](../PRD需求文档/CCO管理控台/数据看板/)

---

## ⚠️ 重要说明

### 数据安全
1. **敏感信息加密**: 身份证号、手机号、银行卡号必须加密传输
2. **数据脱敏**: 非必要场景返回脱敏数据
3. **IP白名单**: 生产环境必须配置IP白名单
4. **HTTPS**: 生产环境必须使用HTTPS

### 性能优化
1. **请求频率限制**: 
   - 查询接口: 100次/分钟
   - 推送接口: 1000次/小时
2. **批量操作**: 优先使用批量接口，减少请求次数
3. **缓存策略**: 合理使用Redis缓存

### 兼容性
1. **向下兼容**: 新版本至少向下兼容1个大版本
2. **废弃通知**: 废弃接口提前3个月通知
3. **版本管理**: URL包含版本号 `/api/v1/...`

---

**文档维护**: CCO技术团队  
**最后更新**: 2025-11-20  
**文档版本**: v1.0.0

---

## 📮 问题反馈

如有任何问题或建议，请通过以下方式反馈：
1. 提交Issue到项目仓库
2. 发送邮件到 tech@cco.example.com
3. 联系技术对接负责人

