# 机构管理 - 数字点击跳转功能说明

## 功能概述

在机构管理列表中，"小组群数量"、"小组数量"、"催员数"这三个数字列现在都可以点击，点击后会跳转到对应的管理页面并自动筛选该机构的数据。

## 功能详情

### 1. 小组群数量（点击跳转）

**显示效果**: 
- 蓝色可点击数字（有数据时）
- 灰色禁用数字（数量为0时）

**点击行为**:
- 跳转到：小组群管理页面 (`/organization/team-groups`)
- 自动筛选：显示该机构下的所有小组群
- URL参数：`?agencyId=1`

**示例**:
```
机构: 百腾企业-机构1 (AG101)
小组群数量: 2 ← 点击
↓
跳转到: 小组群管理
筛选: 只显示AG101的2个小组群
```

### 2. 小组数量（点击跳转）

**显示效果**:
- 蓝色可点击数字（有数据时）
- 灰色禁用数字（数量为0时）

**点击行为**:
- 跳转到：小组管理页面 (`/organization/teams`)
- 自动筛选：显示该机构下的所有小组
- URL参数：`?agencyId=1`

**示例**:
```
机构: 百腾企业-机构1 (AG101)
小组数量: 2 ← 点击
↓
跳转到: 小组管理
筛选: 只显示AG101的2个小组
```

### 3. 催员数（点击跳转）

**显示效果**:
- 蓝色可点击数字（有数据时）
- 灰色禁用数字（数量为0时）

**点击行为**:
- 跳转到：催员管理页面 (`/organization/collectors`)
- 自动筛选：显示该机构下的所有催员
- URL参数：`?agencyId=1`

**示例**:
```
机构: 百腾企业-机构1 (AG101)
催员数: 9 ← 点击
↓
跳转到: 催员管理
筛选: 只显示AG101的9个催员
```

## 实现细节

### 前端实现

#### 1. 机构管理页面 (`AgencyManagement.vue`)

**表格列定义** - 将数字显示为可点击的按钮：
```vue
<el-table-column prop="team_group_count" label="小组群数量" width="100" align="center">
  <template #default="{ row }">
    <el-button 
      link 
      type="primary" 
      @click="handleViewTeamGroups(row)"
      :disabled="!row.team_group_count || row.team_group_count === 0"
    >
      {{ row.team_group_count || 0 }}
    </el-button>
  </template>
</el-table-column>
```

**跳转函数**：
```typescript
// 查看小组群
const handleViewTeamGroups = (row: any) => {
  router.push({
    path: '/organization/team-groups',
    query: {
      agencyId: row.id
    }
  })
}

// 查看小组
const handleViewTeams = (row: any) => {
  router.push({
    path: '/organization/teams',
    query: {
      agencyId: row.id
    }
  })
}

// 查看催员
const handleViewCollectors = (row: any) => {
  router.push({
    path: '/organization/collectors',
    query: {
      agencyId: row.id
    }
  })
}
```

#### 2. 小组群管理页面 (`TeamGroupManagement.vue`)

**接收URL参数并自动筛选**：
```typescript
import { useRouter, useRoute } from 'vue-router'

const router = useRouter()
const route = useRoute()

onMounted(async () => {
  if (currentTenantId.value) {
    await loadAgencies()
    
    // 从URL参数中获取agencyId并设置筛选
    const agencyIdParam = route.query.agencyId
    if (agencyIdParam) {
      currentAgencyId.value = Number(agencyIdParam)
    }
    
    await loadTeamGroups()
  }
})
```

#### 3. 小组管理页面 (`TeamManagement.vue`)

**接收URL参数并自动筛选**（同上）

#### 4. 催员管理页面 (`CollectorManagement.vue`)

**已有实现**（无需修改，已支持URL参数筛选）

## 用户体验

### 操作流程示例

**场景1：查看某机构的小组群**
1. 在"机构管理"页面
2. 看到"百腾企业-机构1"的小组群数量是 **2**
3. 点击数字 **2**
4. 自动跳转到"小组群管理"页面
5. 机构下拉框自动选中"百腾企业-机构1"
6. 表格只显示该机构的2个小组群

**场景2：查看某机构的催员**
1. 在"机构管理"页面
2. 看到"百腾企业-机构1"的催员数是 **9**
3. 点击数字 **9**
4. 自动跳转到"催员管理"页面
5. 机构下拉框自动选中"百腾企业-机构1"
6. 表格只显示该机构的9个催员

### 视觉反馈

| 状态 | 样式 | 说明 |
|------|------|------|
| 有数据 | 蓝色链接 | 可点击，鼠标悬停显示下划线 |
| 无数据 | 灰色文字 | 禁用状态，不可点击 |
| 悬停 | 蓝色下划线 | 提示用户可以点击 |

## 技术要点

### 1. 路由传参
使用 Vue Router 的 query 参数传递机构ID：
```typescript
router.push({
  path: '/organization/teams',
  query: { agencyId: row.id }
})
```

### 2. 参数接收
目标页面使用 `useRoute()` 接收参数：
```typescript
const route = useRoute()
const agencyId = route.query.agencyId
```

### 3. 自动筛选
将获取到的 agencyId 赋值给页面的筛选变量：
```typescript
currentAgencyId.value = Number(agencyIdParam)
```

### 4. 禁用状态
当数量为0时，按钮自动禁用：
```typescript
:disabled="!row.team_group_count || row.team_group_count === 0"
```

## 相关文件

### 修改的文件
1. `frontend/src/views/organization/AgencyManagement.vue`
   - 添加小组群、小组数量的点击跳转
   - 已有催员数的点击跳转

2. `frontend/src/views/organization/TeamGroupManagement.vue`
   - 添加URL参数读取逻辑
   - 自动筛选指定机构

3. `frontend/src/views/organization/TeamManagement.vue`
   - 添加URL参数读取逻辑
   - 自动筛选指定机构

4. `frontend/src/views/organization/CollectorManagement.vue`
   - 已有URL参数读取逻辑（无需修改）

## 扩展性

### 未来可扩展的功能

1. **小组群的小组数量点击**
   - 跳转到小组管理页面
   - 同时筛选机构和小组群

2. **小组群的催员数点击**
   - 跳转到催员管理页面
   - 同时筛选机构和小组群

3. **小组的催员数点击**
   - 跳转到催员管理页面
   - 精确筛选到某个小组

### 实现模式
所有类似的数字点击跳转都遵循相同模式：
```typescript
// 1. 将数字渲染为可点击按钮
<el-button link @click="handleView(row)">
  {{ row.count }}
</el-button>

// 2. 实现跳转函数
const handleView = (row) => {
  router.push({
    path: '/target-page',
    query: { filterId: row.id }
  })
}

// 3. 目标页面接收参数
const route = useRoute()
const filterId = route.query.filterId
if (filterId) {
  currentFilter.value = Number(filterId)
}
```

## 测试验证

### 验证步骤

1. ✅ 访问机构管理页面
2. ✅ 点击任意机构的"小组群数量"
3. ✅ 确认跳转到小组群管理页面
4. ✅ 确认机构下拉框已自动选中
5. ✅ 确认表格只显示该机构的小组群
6. ✅ 重复测试"小组数量"和"催员数"

### 预期结果

- ✅ 点击后正确跳转
- ✅ URL包含正确的query参数
- ✅ 目标页面自动筛选数据
- ✅ 0值时按钮禁用不可点击
- ✅ 有值时按钮显示为蓝色可点击

## 注意事项

1. **权限控制**：如果用户没有目标页面的访问权限，跳转可能失败
2. **数据同步**：确保统计数字与实际数据保持一致
3. **返回导航**：用户可以使用浏览器后退按钮返回机构列表
4. **筛选保持**：跳转后的筛选状态会保持，直到用户手动清除

---

**完成日期**: 2025-11-20  
**涉及页面**: 机构管理、小组群管理、小组管理、催员管理  
**功能状态**: ✅ 已完成并测试通过

