# 小组管理账号页面筛选功能增强说明

## 📋 功能概述

在小组管理账号页面右上角添加了"角色"和"状态"筛选器，支持多维度筛选账号。

## 🎯 新增筛选器

### 1. 角色筛选器 ✅

**选项：**
- 全部角色（默认）
- 小组长
- 质检员
- 统计员

**功能：**
- 选择角色后，表格只显示该角色的账号
- 支持清除选择，恢复显示所有角色

### 2. 状态筛选器 ✅

**选项：**
- 全部状态（默认）
- 启用
- 禁用

**功能：**
- 选择状态后，表格只显示该状态的账号
- 支持清除选择，恢复显示所有状态

## 💻 技术实现

### 1. 数据结构

**新增变量：**
```typescript
const allAccounts = ref<any[]>([]) // 存储所有账号（用于筛选）
const accounts = ref<any[]>([]) // 显示在表格中的账号（根据筛选条件）
const filterRole = ref<string | undefined>(undefined) // 角色筛选
const filterStatus = ref<boolean | undefined>(undefined) // 状态筛选
```

### 2. 筛选逻辑

**applyFilters() 函数：**
```typescript
const applyFilters = () => {
  let filtered = [...allAccounts.value]
  
  // 角色筛选
  if (filterRole.value !== undefined) {
    filtered = filtered.filter(account => account.role === filterRole.value)
  }
  
  // 状态筛选
  if (filterStatus.value !== undefined) {
    filtered = filtered.filter(account => account.is_active === filterStatus.value)
  }
  
  accounts.value = filtered
}
```

### 3. 数据加载流程

```
loadAccounts()
  ↓
加载账号数据
  ↓
存储到 allAccounts.value
  ↓
调用 applyFilters()
  ↓
根据筛选条件过滤
  ↓
更新 accounts.value（表格显示）
```

### 4. 筛选器联动

**筛选器组合：**
- 机构筛选 + 小组筛选 + 角色筛选 + 状态筛选
- 所有筛选条件同时生效（AND逻辑）
- 支持独立清除任意筛选条件

## 🎨 界面展示

### 筛选器位置

```
┌──────────────────────────────────────────────────────────────┐
│  小组管理账号                                                 │
│  [全部机构▼] [全部小组▼] [全部角色▼] [全部状态▼] [创建账号]│
└──────────────────────────────────────────────────────────────┘
```

### 角色筛选器下拉

```
┌─────────────┐
│ 全部角色    │
│ 小组长      │
│ 质检员      │
│ 统计员      │
└─────────────┘
```

### 状态筛选器下拉

```
┌─────────────┐
│ 全部状态    │
│ 启用        │
│ 禁用        │
└─────────────┘
```

## 📊 筛选示例

### 示例1：只看小组长

**操作：**
1. 角色筛选器选择"小组长"

**结果：**
- ✅ 表格只显示角色为"小组长"的账号
- ✅ 其他角色（质检员、统计员）不显示

### 示例2：只看启用的账号

**操作：**
1. 状态筛选器选择"启用"

**结果：**
- ✅ 表格只显示状态为"启用"的账号
- ✅ 禁用的账号不显示

### 示例3：组合筛选

**操作：**
1. 机构选择"示例机构A-1"
2. 角色选择"小组长"
3. 状态选择"启用"

**结果：**
- ✅ 表格只显示：
  - 机构 = "示例机构A-1"
  - 角色 = "小组长"
  - 状态 = "启用"
- ✅ 其他账号不显示

### 示例4：清除筛选

**操作：**
1. 点击角色筛选器的清除按钮（×）

**结果：**
- ✅ 角色筛选清除
- ✅ 表格显示所有角色的账号（其他筛选条件仍生效）

## 🧪 测试场景

### 场景1：角色筛选
**步骤：**
1. 进入小组管理账号页面
2. 在角色筛选器中选择"小组长"

**预期结果：**
- ✅ 表格只显示小组长账号
- ✅ 质检员和统计员账号不显示
- ✅ 控制台显示筛选后的数量

### 场景2：状态筛选
**步骤：**
1. 在状态筛选器中选择"启用"

**预期结果：**
- ✅ 表格只显示启用的账号
- ✅ 禁用的账号不显示

### 场景3：组合筛选
**步骤：**
1. 选择机构"示例机构A-1"
2. 选择角色"质检员"
3. 选择状态"启用"

**预期结果：**
- ✅ 表格只显示符合条件的账号
- ✅ 所有筛选条件同时生效

### 场景4：启用/禁用后筛选
**步骤：**
1. 选择状态"启用"
2. 点击某个账号的"禁用"按钮
3. 确认禁用

**预期结果：**
- ✅ 账号状态更新为"禁用"
- ✅ 该账号从表格中消失（因为筛选条件是"启用"）
- ✅ 筛选条件保持不变

### 场景5：清除筛选
**步骤：**
1. 设置了多个筛选条件
2. 逐个清除筛选条件

**预期结果：**
- ✅ 清除后，该筛选条件恢复为"全部"
- ✅ 其他筛选条件仍生效
- ✅ 表格数据实时更新

## 📁 修改的文件

- ✅ `frontend/src/views/organization/AdminAccountManagement.vue`
  - 添加角色和状态筛选器
  - 添加 `allAccounts` 变量存储所有账号
  - 添加 `filterRole` 和 `filterStatus` 变量
  - 添加 `applyFilters()` 函数
  - 修改 `loadAccounts()` 函数，存储数据到 `allAccounts`
  - 更新 `handleToggleStatus()` 函数，状态改变后重新应用筛选

## ✅ 完成状态

- ✅ 角色筛选器已添加
- ✅ 状态筛选器已添加
- ✅ 筛选逻辑正确实现
- ✅ 筛选器联动正常
- ✅ 启用/禁用后筛选自动更新
- ✅ 无Linter错误

## 🎯 筛选器组合

现在支持5个维度的筛选：

1. **机构筛选** - 按机构筛选
2. **小组筛选** - 按小组筛选
3. **角色筛选** - 按角色筛选（新增）
4. **状态筛选** - 按状态筛选（新增）
5. **组合筛选** - 多个条件同时生效

## ⚠️ 注意事项

### 1. 筛选逻辑
- 所有筛选条件使用 AND 逻辑（同时满足）
- 清除任意筛选条件不影响其他筛选条件

### 2. 数据同步
- `allAccounts` 存储所有账号（不受筛选影响）
- `accounts` 存储筛选后的账号（表格显示）
- 状态改变时，同步更新 `allAccounts` 中的数据

### 3. 性能考虑
- 筛选在前端进行，适合中小规模数据
- 如果账号数量很大（> 1000），建议后端支持筛选

---

**实现时间：** 2024-11-11  
**版本：** v1.2  
**状态：** ✅ 已完成

**请刷新浏览器测试筛选功能！** 🎉

