# å¼€å‘ç¯å¢ƒè¿è¡ŒæŒ‡å—

> ğŸ“Œ **å¿«é€Ÿå‚è€ƒ**ï¼šåŒ…å«æ‰€æœ‰å¸¸ç”¨å‘½ä»¤å’Œè®¿é—®åœ°å€

---

## ğŸŒ è®¿é—®åœ°å€é€ŸæŸ¥

### å‰ç«¯åœ°å€
```
http://localhost:5173          # å‰ç«¯ä¸»åº”ç”¨
http://localhost:5173/login    # ç™»å½•é¡µé¢
http://localhost:5173/dashboard # ä»ªè¡¨ç›˜
```

### åç«¯åœ°å€
```
http://localhost:8000              # åç«¯APIæ ¹åœ°å€
http://localhost:8000/docs         # Swagger APIæ–‡æ¡£ï¼ˆæ¨èï¼‰
http://localhost:8000/redoc        # ReDoc APIæ–‡æ¡£
http://localhost:8000/api/v1       # API v1ç‰ˆæœ¬æ ¹è·¯å¾„
```

### æ•°æ®åº“ç®¡ç†
```
# PostgreSQL
postgresql://localhost:5432

# MySQL
mysql://localhost:3306

# Redis
redis://localhost:6379
```

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨å‘½ä»¤

### 1. å¯åŠ¨åç«¯ï¼ˆæ¨èï¼šMock Serverï¼‰

**æœ€ç®€å•çš„æ–¹å¼ï¼ˆæ— éœ€ä»»ä½•é…ç½®ï¼‰ï¼š**

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# å¯åŠ¨MockæœåŠ¡å™¨ï¼ˆæ— éœ€å®‰è£…ä¾èµ–ï¼‰
python3 simple_server.py

# æˆ–è€…ä½¿ç”¨å¯åŠ¨è„šæœ¬
./start_mock.sh
```

**å¯åŠ¨æˆåŠŸæ ‡å¿—ï¼š**
```
âœ… Mock API æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼
ğŸ“¡ ç›‘å¬åœ°å€: http://localhost:8000
ğŸ“ APIæ–‡æ¡£: http://localhost:8000/api/v1/
ğŸ”„ å‰ç«¯åœ°å€: http://localhost:5173
```

**ç‰¹ç‚¹ï¼š**
- âœ… æ— éœ€å®‰è£…ä»»ä½•ä¾èµ–
- âœ… æ— éœ€é…ç½®æ•°æ®åº“
- âœ… æä¾›Mockæ•°æ®ç”¨äºå‰ç«¯å¼€å‘
- âš ï¸ æ•°æ®æ— æ³•ä¿å­˜ï¼ˆé‡å¯åé‡ç½®ï¼‰

---

### 1b. å¯åŠ¨åç«¯ï¼ˆå®Œæ•´ç‰ˆFastAPI - å¯é€‰ï¼‰

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆå¦‚æœä½¿ç”¨ï¼‰
source venv/bin/activate  # macOS/Linux
# æˆ–
venv\Scripts\activate     # Windows

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn app.main:app --reload --port 8000

# æˆ–è€…æŒ‡å®šhostï¼ˆå…è®¸å±€åŸŸç½‘è®¿é—®ï¼‰
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**å¯åŠ¨æˆåŠŸæ ‡å¿—ï¼š**
```
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

### 2. å¯åŠ¨å‰ç«¯ï¼ˆVue 3 + Viteï¼‰

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æˆ–è€…ä½¿ç”¨yarn
yarn dev

# æˆ–è€…ä½¿ç”¨pnpm
pnpm dev
```

**å¯åŠ¨æˆåŠŸæ ‡å¿—ï¼š**
```
  VITE v5.x.x  ready in xxx ms

  âœ  Local:   http://localhost:5173/
  âœ  Network: http://192.168.x.x:5173/
  âœ  press h + enter to show help
```

### 3. æ•°æ®åº“è¿ç§»

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# åˆ›å»ºè¿ç§»ï¼ˆè‡ªåŠ¨æ£€æµ‹æ¨¡å‹å˜åŒ–ï¼‰
alembic revision --autogenerate -m "æè¿°å˜æ›´å†…å®¹"

# æ‰§è¡Œè¿ç§»ï¼ˆå‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼‰
alembic upgrade head

# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
alembic current

# æŸ¥çœ‹è¿ç§»å†å²
alembic history

# å›æ»šä¸€ä¸ªç‰ˆæœ¬
alembic downgrade -1

# å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
alembic downgrade <revision_id>
```

---

## ğŸ“¦ å®‰è£…ä¾èµ–

### åç«¯ä¾èµ–

```bash
cd backend

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# æˆ–è€…ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿ
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### å‰ç«¯ä¾èµ–

```bash
cd frontend

# ä½¿ç”¨npm
npm install

# ä½¿ç”¨yarn
yarn install

# ä½¿ç”¨pnpmï¼ˆæ¨èï¼Œæ›´å¿«ï¼‰
pnpm install

# ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿ
npm install --registry=https://registry.npmmirror.com
```

---

## ğŸ—„ï¸ æ•°æ®åº“æ“ä½œ

### PostgreSQL

```bash
# å¯åŠ¨PostgreSQL
pg_ctl -D /usr/local/var/postgres start

# åœæ­¢PostgreSQL
pg_ctl -D /usr/local/var/postgres stop

# é‡å¯PostgreSQL
pg_ctl -D /usr/local/var/postgres restart

# è¿æ¥æ•°æ®åº“
psql -U postgres -d cco_db

# åˆ›å»ºæ•°æ®åº“
createdb cco_db

# åˆ é™¤æ•°æ®åº“
dropdb cco_db
```

### MySQL

```bash
# å¯åŠ¨MySQL
mysql.server start

# åœæ­¢MySQL
mysql.server stop

# é‡å¯MySQL
mysql.server restart

# è¿æ¥æ•°æ®åº“
mysql -u root -p

# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE cco_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### Redis

```bash
# å¯åŠ¨Redis
redis-server

# å¯åŠ¨Redisï¼ˆåå°è¿è¡Œï¼‰
redis-server --daemonize yes

# åœæ­¢Redis
redis-cli shutdown

# è¿æ¥Redis
redis-cli

# æµ‹è¯•è¿æ¥
redis-cli ping
# è¿”å› PONG è¡¨ç¤ºæˆåŠŸ
```

---

## ğŸ§ª æµ‹è¯•å‘½ä»¤

### åç«¯æµ‹è¯•

```bash
cd backend

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡ŒæŒ‡å®šæµ‹è¯•æ–‡ä»¶
pytest tests/test_agencies.py

# è¿è¡Œå¹¶æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
pytest -v

# è¿è¡Œå¹¶æ˜¾ç¤ºprintè¾“å‡º
pytest -s

# ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=app --cov-report=html
```

### å‰ç«¯æµ‹è¯•

```bash
cd frontend

# è¿è¡Œå•å…ƒæµ‹è¯•
npm run test:unit

# è¿è¡ŒE2Eæµ‹è¯•
npm run test:e2e

# è¿è¡Œæµ‹è¯•ï¼ˆwatchæ¨¡å¼ï¼‰
npm run test:watch
```

---

## ğŸ”§ å¼€å‘å·¥å…·

### ä»£ç æ ¼å¼åŒ–

```bash
# åç«¯ï¼ˆPythonï¼‰
cd backend

# ä½¿ç”¨blackæ ¼å¼åŒ–
black app/

# ä½¿ç”¨isortæ•´ç†å¯¼å…¥
isort app/

# ä½¿ç”¨flake8æ£€æŸ¥ä»£ç 
flake8 app/

# å‰ç«¯ï¼ˆJavaScript/TypeScriptï¼‰
cd frontend

# æ ¼å¼åŒ–ä»£ç 
npm run format

# æ£€æŸ¥ä»£ç 
npm run lint

# è‡ªåŠ¨ä¿®å¤
npm run lint:fix
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# åç«¯æ—¥å¿—ï¼ˆå¦‚æœä½¿ç”¨æ–‡ä»¶æ—¥å¿—ï¼‰
tail -f backend/logs/app.log

# å‰ç«¯å¼€å‘æœåŠ¡å™¨æ—¥å¿—
# ç›´æ¥åœ¨å¯åŠ¨ç»ˆç«¯æŸ¥çœ‹

# Nginxæ—¥å¿—ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log
```

---

## ğŸ“ å¸¸ç”¨æ“ä½œ

### ç”Ÿæˆæµ‹è¯•æ•°æ®

```bash
cd backend

# è¿è¡Œmockæ•°æ®ç”Ÿæˆè„šæœ¬
python generate_mock_data.py

# æˆ–è€…å¯åŠ¨mockæœåŠ¡å™¨
python mock_server.py
```

### æ¸…ç†ç¼“å­˜

```bash
# æ¸…ç†Pythonç¼“å­˜
find . -type d -name "__pycache__" -exec rm -rf {} +
find . -type f -name "*.pyc" -delete

# æ¸…ç†å‰ç«¯ç¼“å­˜
cd frontend
rm -rf node_modules
rm -rf dist
rm -rf .vite

# æ¸…ç†Redisç¼“å­˜
redis-cli FLUSHALL
```

### é‡ç½®æ•°æ®åº“

```bash
cd backend

# å›æ»šæ‰€æœ‰è¿ç§»
alembic downgrade base

# é‡æ–°æ‰§è¡Œè¿ç§»
alembic upgrade head

# æˆ–è€…ç›´æ¥åˆ é™¤å¹¶é‡å»º
python create_tables.py
```

---

## ğŸ³ Dockerå‘½ä»¤ï¼ˆå¯é€‰ï¼‰

### å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰å®¹å™¨
docker-compose up

# åå°å¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f backend
docker-compose logs -f frontend
```

### åœæ­¢æœåŠ¡

```bash
# åœæ­¢æ‰€æœ‰å®¹å™¨
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·
docker-compose down -v

# åœæ­¢å¹¶åˆ é™¤é•œåƒ
docker-compose down --rmi all
```

### é‡å»ºæœåŠ¡

```bash
# é‡å»ºå¹¶å¯åŠ¨
docker-compose up --build

# é‡å»ºç‰¹å®šæœåŠ¡
docker-compose build backend
docker-compose up backend
```

---

## ğŸ” ç¯å¢ƒå˜é‡é…ç½®

### åç«¯ç¯å¢ƒå˜é‡ï¼ˆ.envï¼‰

```bash
# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
cd backend
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡
nano .env
```

**å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼š**
```env
# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://user:password@localhost:5432/cco_db
# æˆ– MySQL
# DATABASE_URL=mysql+pymysql://user:password@localhost:3306/cco_db

# Redisé…ç½®
REDIS_URL=redis://localhost:6379/0

# å®‰å…¨é…ç½®
SECRET_KEY=your-secret-key-here
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# åº”ç”¨é…ç½®
DEBUG=True
API_V1_PREFIX=/api/v1
```

### å‰ç«¯ç¯å¢ƒå˜é‡ï¼ˆ.envï¼‰

```bash
# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
cd frontend
cp .env.example .env.development

# ç¼–è¾‘ç¯å¢ƒå˜é‡
nano .env.development
```

**å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼š**
```env
# APIåœ°å€
VITE_API_BASE_URL=http://localhost:8000
VITE_API_TIMEOUT=30000

# WebSocketåœ°å€
VITE_WS_URL=ws://localhost:8000/ws

# åº”ç”¨é…ç½®
VITE_APP_TITLE=CCOå‚¬æ”¶ç³»ç»Ÿ
```

---

## ğŸš¨ å¸¸è§é—®é¢˜è§£å†³

### ç«¯å£è¢«å ç”¨

```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹ï¼ˆmacOS/Linuxï¼‰
lsof -i :8000  # åç«¯ç«¯å£
lsof -i :5173  # å‰ç«¯ç«¯å£

# æ€æ­»è¿›ç¨‹
kill -9 <PID>

# Windows
netstat -ano | findstr :8000
taskkill /PID <PID> /F
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦è¿è¡Œ
# PostgreSQL
pg_isready

# MySQL
mysqladmin ping

# æ£€æŸ¥è¿æ¥é…ç½®
# æŸ¥çœ‹backend/.envä¸­çš„DATABASE_URLæ˜¯å¦æ­£ç¡®
```

### æ¨¡å—å¯¼å…¥é”™è¯¯

```bash
# é‡æ–°å®‰è£…ä¾èµ–
cd backend
pip install -r requirements.txt --force-reinstall

cd frontend
rm -rf node_modules
npm install
```

### CORSé”™è¯¯

æ£€æŸ¥åç«¯ `app/main.py` çš„CORSé…ç½®ï¼š
```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5173"],  # å‰ç«¯åœ°å€
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

## ğŸ“± ç§»åŠ¨ç«¯è®¿é—®

### å±€åŸŸç½‘è®¿é—®

```bash
# 1. è·å–æœ¬æœºIPåœ°å€
# macOS
ifconfig | grep "inet " | grep -v 127.0.0.1

# Linux
ip addr show

# Windows
ipconfig

# 2. å¯åŠ¨æœåŠ¡ï¼ˆå…è®¸å±€åŸŸç½‘è®¿é—®ï¼‰
# åç«¯
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# å‰ç«¯ï¼ˆviteè‡ªåŠ¨ç»‘å®š0.0.0.0ï¼‰
npm run dev

# 3. åœ¨ç§»åŠ¨è®¾å¤‡è®¿é—®
# å‰ç«¯ï¼šhttp://192.168.x.x:5173
# åç«¯ï¼šhttp://192.168.x.x:8000
```

---

## ğŸ¯ å¼€å‘å·¥ä½œæµ

### å…¸å‹çš„å¼€å‘æµç¨‹

```bash
# 1. æ›´æ–°ä»£ç 
git pull

# 2. å®‰è£…/æ›´æ–°ä¾èµ–
cd backend && pip install -r requirements.txt
cd frontend && npm install

# 3. æ‰§è¡Œæ•°æ®åº“è¿ç§»
cd backend && alembic upgrade head

# 4. å¯åŠ¨åç«¯ï¼ˆæ–°ç»ˆç«¯çª—å£1ï¼‰
cd backend
uvicorn app.main:app --reload

# 5. å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯çª—å£2ï¼‰
cd frontend
npm run dev

# 6. æ‰“å¼€æµè§ˆå™¨è®¿é—®
# http://localhost:5173

# 7. å¼€å‘å®Œæˆåæäº¤ä»£ç 
git add .
git commit -m "æè¿°å˜æ›´"
git push
```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### æŸ¥çœ‹ç³»ç»Ÿèµ„æº

```bash
# CPUå’Œå†…å­˜ä½¿ç”¨
top

# æˆ–è€…ä½¿ç”¨htopï¼ˆæ›´å‹å¥½ï¼‰
htop

# æŸ¥çœ‹ç«¯å£ç›‘å¬
netstat -tuln | grep LISTEN

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep uvicorn
ps aux | grep node
```

### APIæ€§èƒ½æµ‹è¯•

```bash
# ä½¿ç”¨curlæµ‹è¯•API
curl http://localhost:8000/api/v1/agencies

# æµ‹è¯•å“åº”æ—¶é—´
time curl http://localhost:8000/api/v1/agencies

# ä½¿ç”¨httpieï¼ˆæ›´å‹å¥½ï¼‰
http http://localhost:8000/api/v1/agencies
```

---

## ğŸ”– å¿«æ·æ–¹å¼ï¼ˆå¯é€‰ï¼‰

åœ¨ `~/.bashrc` æˆ– `~/.zshrc` ä¸­æ·»åŠ åˆ«åï¼š

```bash
# CCOé¡¹ç›®å¿«æ·å‘½ä»¤
alias cco-backend="cd ~/path/to/backend && source venv/bin/activate && uvicorn app.main:app --reload"
alias cco-frontend="cd ~/path/to/frontend && npm run dev"
alias cco-db="alembic upgrade head"
alias cco-test="cd ~/path/to/backend && pytest"

# ä½¿é…ç½®ç”Ÿæ•ˆ
source ~/.bashrc  # æˆ– source ~/.zshrc
```

---

## ğŸ“ å¿«é€Ÿå¸®åŠ©

| é—®é¢˜ | å‘½ä»¤/è§£å†³æ–¹æ¡ˆ |
|-----|-------------|
| æŸ¥çœ‹åç«¯APIæ–‡æ¡£ | http://localhost:8000/docs |
| æŸ¥çœ‹å‰ç«¯é¡µé¢ | http://localhost:5173 |
| é‡å¯åç«¯ | `Ctrl+C` ç„¶å `uvicorn app.main:app --reload` |
| é‡å¯å‰ç«¯ | `Ctrl+C` ç„¶å `npm run dev` |
| æŸ¥çœ‹æ•°æ®åº“è¿ç§»çŠ¶æ€ | `alembic current` |
| æ‰§è¡Œæ•°æ®åº“è¿ç§» | `alembic upgrade head` |
| æ¸…ç†å¹¶é‡è£…å‰ç«¯ä¾èµ– | `rm -rf node_modules && npm install` |
| æŸ¥çœ‹ç«¯å£å ç”¨ | `lsof -i :8000` |

---

## ğŸ‰ å®Œæˆæ£€æŸ¥æ¸…å•

å¼€å‘ç¯å¢ƒå¯åŠ¨æˆåŠŸçš„æ ‡å¿—ï¼š

- âœ… åç«¯å¯åŠ¨æˆåŠŸï¼Œå¯è®¿é—® http://localhost:8000
- âœ… Swaggeræ–‡æ¡£å¯è®¿é—® http://localhost:8000/docs
- âœ… å‰ç«¯å¯åŠ¨æˆåŠŸï¼Œå¯è®¿é—® http://localhost:5173
- âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸
- âœ… Redisè¿æ¥æ­£å¸¸ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
- âœ… æ— CORSé”™è¯¯
- âœ… APIè°ƒç”¨æ­£å¸¸

---

**æœ€åæ›´æ–°ï¼š** 2024-11-11  
**ç»´æŠ¤äººå‘˜ï¼š** å¼€å‘å›¢é˜Ÿ

ğŸ’¡ **æç¤º**ï¼šå»ºè®®å°†æ­¤æ–‡ä»¶æ·»åŠ åˆ°æµè§ˆå™¨ä¹¦ç­¾æˆ–æ¡Œé¢å¿«æ·æ–¹å¼ï¼Œæ–¹ä¾¿éšæ—¶æŸ¥çœ‹ï¼

