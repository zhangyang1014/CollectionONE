# æ•°æ®çœ‹æ¿å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### æ­¥éª¤1ï¼šåˆ›å»ºæ•°æ®åº“è¡¨

```bash
cd backend
source venv/bin/activate  # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
python create_dashboard_tables.py
```

**é¢„æœŸè¾“å‡º**ï¼š
```
å¼€å§‹åˆ›å»ºæ•°æ®çœ‹æ¿ç›¸å…³è¡¨...
âœ… æ•°æ®çœ‹æ¿ç›¸å…³è¡¨åˆ›å»ºæˆåŠŸï¼

å·²åˆ›å»ºçš„è¡¨ï¼š
  1. case_contacts - æ¡ˆä»¶è”ç³»äººè¡¨
  2. communication_records - é€šä¿¡è®°å½•è¡¨
  3. ptp_records - PTPè®°å½•è¡¨
  4. quality_inspection_records - è´¨æ£€è®°å½•è¡¨
  5. collector_performance_stats - å‚¬å‘˜ç»©æ•ˆç»Ÿè®¡è¡¨
  6. custom_dimension_stats - è‡ªå®šä¹‰ç»´åº¦ç»Ÿè®¡è¡¨
```

### æ­¥éª¤2ï¼šç”Ÿæˆæµ‹è¯•æ•°æ®

```bash
python generate_dashboard_test_data.py
```

**é¢„æœŸè¾“å‡º**ï¼š
```
å¼€å§‹ç”Ÿæˆæ•°æ®çœ‹æ¿æµ‹è¯•æ•°æ®...
æ‰¾åˆ° 5 ä¸ªå‚¬å‘˜ï¼Œ50 ä¸ªæ¡ˆä»¶

1. ç”Ÿæˆè”ç³»äººæ•°æ®...
   âœ… ç”Ÿæˆäº† 60 æ¡è”ç³»äººè®°å½•

2. ç”Ÿæˆé€šä¿¡è®°å½•æ•°æ®...
   âœ… ç”Ÿæˆäº† 300 æ¡é€šä¿¡è®°å½•

3. ç”ŸæˆPTPè®°å½•æ•°æ®...
   âœ… ç”Ÿæˆäº† 25 æ¡PTPè®°å½•

4. ç”Ÿæˆè´¨æ£€è®°å½•æ•°æ®...
   âœ… ç”Ÿæˆäº† 90 æ¡è´¨æ£€è®°å½•

============================================================
âœ… æ•°æ®çœ‹æ¿æµ‹è¯•æ•°æ®ç”Ÿæˆå®Œæˆï¼
============================================================
```

### æ­¥éª¤3ï¼šæ³¨å†ŒAPIè·¯ç”±

åœ¨ `backend/app/main.py` ä¸­æ·»åŠ æ–°çš„APIè·¯ç”±ï¼š

```python
from app.api import (
    auth, tenants, agencies, cases, standard_fields,
    custom_fields, field_groups, field_dependencies,
    channel, agency_working_hours, notification_config,
    public_notification, queue,
    # æ–°å¢ï¼šæ•°æ®çœ‹æ¿API
    communications, ptp, quality_inspections,
    performance, analytics, alerts
)

# æ³¨å†Œè·¯ç”±
app.include_router(communications.router)
app.include_router(ptp.router)
app.include_router(quality_inspections.router)
app.include_router(performance.router)
app.include_router(analytics.router)
app.include_router(alerts.router)
```

### æ­¥éª¤4ï¼šå¯åŠ¨æœåŠ¡

```bash
# åç«¯
cd backend
python -m uvicorn app.main:app --reload

# å‰ç«¯ï¼ˆæ–°ç»ˆç«¯çª—å£ï¼‰
cd frontend
npm run dev
```

### æ­¥éª¤5ï¼šè®¿é—®çœ‹æ¿

æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:5173/performance/collector/1`

---

## ğŸ“Š ä¸»è¦åŠŸèƒ½è¯´æ˜

### 1. ä¸šç»©æ€»è§ˆ
æ˜¾ç¤ºå‚¬å‘˜çš„æ ¸å¿ƒKPIæŒ‡æ ‡ï¼š
- **åº”å‚¬æ¡ˆä»¶**ï¼šåˆ†é…ç»™å‚¬å‘˜çš„æ¡ˆä»¶æ€»æ•°
- **æ”¶å›æ¡ˆä»¶**ï¼šå·²ç»“æ¸…çš„æ¡ˆä»¶æ•°
- **æ¡ˆä»¶å‚¬å›ç‡**ï¼šæ”¶å›æ¡ˆä»¶ / åº”å‚¬æ¡ˆä»¶ Ã— 100%
- **åº”å‚¬é‡‘é¢**ï¼šæ‰€æœ‰æ¡ˆä»¶çš„é€¾æœŸé‡‘é¢æ€»å’Œ
- **æ”¶å›é‡‘é¢**ï¼šå·²æ”¶å›çš„é‡‘é¢æ€»å’Œ
- **é‡‘é¢å‚¬å›ç‡**ï¼šæ”¶å›é‡‘é¢ / åº”å‚¬é‡‘é¢ Ã— 100%

### 2. PTPæŒ‡æ ‡
æ˜¾ç¤ºæ‰¿è¯ºè¿˜æ¬¾ç›¸å…³æŒ‡æ ‡ï¼š
- **PTPæ•°é‡**ï¼šå‚¬å‘˜å»ºç«‹çš„æ‰¿è¯ºè¿˜æ¬¾æ€»æ•°
- **PTPé‡‘é¢**ï¼šæ‰¿è¯ºè¿˜æ¬¾çš„é‡‘é¢æ€»å’Œ
- **PTPå±¥çº¦æ•°**ï¼šå®é™…å±¥çº¦çš„PTPæ•°é‡
- **PTPå±¥çº¦ç‡**ï¼šå±¥çº¦æ•° / PTPæ€»æ•° Ã— 100%

### 3. æ²Ÿé€šè¦†ç›–ä¸æ•ˆç‡
ä»¥å›¾è¡¨å½¢å¼å±•ç¤ºï¼š
- æœ¬äººæ²Ÿé€šç‡ vs æ€»è”ç³»äººæ²Ÿé€šç‡
- ç”µè¯æ¥é€šç‡
- WhatsAppå›å¤ç‡
- ä¸ç›®æ ‡çº¿å¯¹æ¯”

### 4. é¢„è­¦æé†’
è‡ªåŠ¨è¯†åˆ«å¹¶æç¤ºï¼š
- âš ï¸ æ¥é€šç‡è¿‡ä½ï¼ˆ< 60%ï¼‰
- âš ï¸ WhatsAppå›å¤ç‡è¿‡ä½ï¼ˆ< 40%ï¼‰
- âš ï¸ PTPå±¥çº¦ç‡è¿‡ä½ï¼ˆ< 50%ï¼‰
- âš ï¸ é¦–æ¬¡è§¦è¾¾æ—¶é•¿è¶…æ ‡ï¼ˆ> 24å°æ—¶ï¼‰
- âš ï¸ è´¨æ£€å¾—åˆ†è¿‡ä½ï¼ˆ< 70åˆ†ï¼‰
- ğŸ”´ è´¨æ£€é«˜å±è¿è§„é¡¹

### 5. æ¡ˆä»¶æ˜ç»†
å¯é’»å–æŸ¥çœ‹ï¼š
- æ¡ˆä»¶ç¼–å·ã€å®¢æˆ·å§“åã€DPD
- é€¾æœŸé‡‘é¢
- è§¦è¾¾æ¬¡æ•°
- æœ€è¿‘è§¦è¾¾ç»“æœ
- PTPçŠ¶æ€
- æ¡ˆä»¶çŠ¶æ€

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šå‚¬å‘˜è‡ªæˆ‘å¤ç›˜
å‚¬å‘˜æ¯å¤©æŸ¥çœ‹è‡ªå·±çš„ä¸šç»©çœ‹æ¿ï¼Œäº†è§£ï¼š
- ä»Šå¤©çš„å‚¬å›ç‡æ˜¯å¦è¾¾æ ‡
- å“ªäº›æ¡ˆä»¶è¿˜æ²¡è§¦è¾¾
- PTPå±¥çº¦æƒ…å†µå¦‚ä½•
- æœ‰å“ªäº›éœ€è¦æ”¹è¿›çš„åœ°æ–¹

### åœºæ™¯2ï¼šç»„é•¿ä¸€å¯¹ä¸€è¾…å¯¼
å°ç»„é•¿æŸ¥çœ‹ç»„å‘˜çœ‹æ¿ï¼Œè¿›è¡Œé’ˆå¯¹æ€§æŒ‡å¯¼ï¼š
- å‘ç°æ¥é€šç‡ä½çš„å‚¬å‘˜ï¼ŒæŒ‡å¯¼ä¼˜åŒ–æ‹¨æ‰“æ—¶æ®µ
- å‘ç°PTPå±¥çº¦ç‡ä½çš„å‚¬å‘˜ï¼ŒåŠ å¼ºè¿˜æ¬¾èƒ½åŠ›è¯„ä¼°åŸ¹è®­
- å‘ç°è´¨æ£€å¾—åˆ†ä½çš„å‚¬å‘˜ï¼Œå®‰æ’åˆè§„åŸ¹è®­

### åœºæ™¯3ï¼šæ•°æ®åˆ†æ
é€šè¿‡è‡ªå®šä¹‰ç»´åº¦åˆ†æï¼Œå‘ç°ï¼š
- é«˜ä¼˜å…ˆçº§æ¡ˆä»¶çš„å‚¬å›ç‡æ˜¯å¦æ›´é«˜
- ä¸åŒäº§å“ç±»å‹çš„è¿˜æ¬¾æ„æ„¿å·®å¼‚
- å“ªç§é£é™©ç­‰çº§æœ€å®¹æ˜“å‚¬æ”¶

---

## ğŸ”§ APIæµ‹è¯•

### æµ‹è¯•é€šä¿¡è®°å½•API

```bash
# åˆ›å»ºé€šä¿¡è®°å½•
curl -X POST "http://localhost:8000/api/v1/communications/" \
  -H "Content-Type: application/json" \
  -d '{
    "case_id": 1,
    "collector_id": 1,
    "channel": "phone",
    "direction": "outbound",
    "is_connected": true,
    "call_duration": 120,
    "contact_result": "connected",
    "contacted_at": "2025-01-12T10:00:00"
  }'

# æŸ¥è¯¢é€šä¿¡è®°å½•
curl "http://localhost:8000/api/v1/communications/?collector_id=1&limit=10"
```

### æµ‹è¯•PTP API

```bash
# åˆ›å»ºPTP
curl -X POST "http://localhost:8000/api/v1/ptp/" \
  -H "Content-Type: application/json" \
  -d '{
    "case_id": 1,
    "collector_id": 1,
    "ptp_amount": 5000.00,
    "ptp_date": "2025-01-20"
  }'

# æ›´æ–°PTPçŠ¶æ€ä¸ºå·²å±¥çº¦
curl -X PUT "http://localhost:8000/api/v1/ptp/1/status" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "fulfilled",
    "actual_payment_amount": 5000.00,
    "actual_payment_date": "2025-01-20"
  }'
```

### æµ‹è¯•ç»©æ•ˆAPI

```bash
# è·å–å‚¬å‘˜ç»©æ•ˆ
curl "http://localhost:8000/api/v1/performance/collector/1?start_date=2025-01-01&end_date=2025-01-12&period=daily"

# è·å–è¶‹åŠ¿æ•°æ®
curl "http://localhost:8000/api/v1/performance/collector/1/trend?days=7"

# è·å–é¢„è­¦ä¿¡æ¯
curl "http://localhost:8000/api/v1/alerts/collector/1"
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1ï¼šè®¿é—®APIæ—¶è¿”å›404
**åŸå› **ï¼šAPIè·¯ç”±æœªæ³¨å†Œ
**è§£å†³**ï¼šæ£€æŸ¥ `app/main.py` æ˜¯å¦æ­£ç¡®å¯¼å…¥å¹¶æ³¨å†Œäº†æ–°çš„APIè·¯ç”±

### Q2ï¼šé¡µé¢æ˜¾ç¤ºç©ºæ•°æ®
**åŸå› **ï¼šæ²¡æœ‰ç”Ÿæˆæµ‹è¯•æ•°æ®
**è§£å†³**ï¼šè¿è¡Œ `python generate_dashboard_test_data.py`

### Q3ï¼šEChartså›¾è¡¨ä¸æ˜¾ç¤º
**åŸå› **ï¼šEChartsæœªå®‰è£…æˆ–å¯¼å…¥é”™è¯¯
**è§£å†³**ï¼š
```bash
cd frontend
npm install echarts
```

### Q4ï¼šæ•°æ®åº“è¿æ¥é”™è¯¯
**åŸå› **ï¼šæ•°æ®åº“é…ç½®ä¸æ­£ç¡®
**è§£å†³**ï¼šæ£€æŸ¥ `backend/app/core/config.py` ä¸­çš„æ•°æ®åº“é…ç½®

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ä½¿ç”¨é¢„è®¡ç®—ç»Ÿè®¡è¡¨
å¯¹äºå†å²æ•°æ®ï¼Œå»ºè®®ä½¿ç”¨å®šæ—¶ä»»åŠ¡ï¼ˆå¦‚Celeryï¼‰æ¯å¤©è®¡ç®—å¹¶å­˜å…¥ `collector_performance_stats` è¡¨ï¼Œé¿å…å®æ—¶è®¡ç®—ã€‚

### 2. æ·»åŠ Redisç¼“å­˜
å¯¹äºé¢‘ç¹æŸ¥è¯¢çš„æ•°æ®ï¼ˆå¦‚å½“æ—¥ç»Ÿè®¡ï¼‰ï¼Œå¯ä½¿ç”¨Redisç¼“å­˜ï¼Œè®¾ç½®5-10åˆ†é’Ÿè¿‡æœŸæ—¶é—´ã€‚

### 3. æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
ç¡®ä¿ä»¥ä¸‹å­—æ®µæœ‰ç´¢å¼•ï¼š
- `communication_records.collector_id`
- `communication_records.contacted_at`
- `ptp_records.collector_id`
- `ptp_records.ptp_date`
- `collector_performance_stats.collector_id`
- `collector_performance_stats.stat_date`

### 4. åˆ†é¡µåŠ è½½
å‰ç«¯è¡¨æ ¼æ•°æ®ä½¿ç”¨åˆ†é¡µåŠ è½½ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®ã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ•°æ®çœ‹æ¿ç³»ç»Ÿå®æ–½è¯´æ˜](./æ•°æ®çœ‹æ¿ç³»ç»Ÿå®æ–½è¯´æ˜.md) - è¯¦ç»†çš„åŠŸèƒ½è¯´æ˜å’Œæ¶æ„è®¾è®¡
- [CCOå­—æ®µé…ç½®ç³»ç»Ÿè®¾è®¡](./CCOå­—æ®µé…ç½®ç³»ç»Ÿè®¾è®¡.md) - æ•´ä½“ç³»ç»Ÿè®¾è®¡
- [APIæ–‡æ¡£](http://localhost:8000/docs) - è‡ªåŠ¨ç”Ÿæˆçš„APIæ–‡æ¡£ï¼ˆå¯åŠ¨åç«¯åè®¿é—®ï¼‰

---

## âœ… æ£€æŸ¥æ¸…å•

å¯åŠ¨å‰ç¡®è®¤ï¼š
- [ ] æ•°æ®åº“è¡¨å·²åˆ›å»ºï¼ˆ6ä¸ªæ–°è¡¨ï¼‰
- [ ] æµ‹è¯•æ•°æ®å·²ç”Ÿæˆ
- [ ] APIè·¯ç”±å·²æ³¨å†Œåˆ°main.py
- [ ] åç«¯æœåŠ¡æ­£å¸¸å¯åŠ¨ï¼ˆç«¯å£8000ï¼‰
- [ ] å‰ç«¯æœåŠ¡æ­£å¸¸å¯åŠ¨ï¼ˆç«¯å£5173ï¼‰
- [ ] å¯ä»¥è®¿é—®å‚¬å‘˜ä¸šç»©çœ‹æ¿é¡µé¢

åŠŸèƒ½éªŒè¯ï¼š
- [ ] ä¸šç»©æ€»è§ˆå¡ç‰‡æ˜¾ç¤ºæ­£å¸¸
- [ ] PTPæŒ‡æ ‡æ˜¾ç¤ºæ­£å¸¸
- [ ] æ²Ÿé€šæ•ˆç‡å›¾è¡¨æ˜¾ç¤ºæ­£å¸¸
- [ ] æ¡ˆä»¶æ˜ç»†è¡¨æ˜¾ç¤ºæ­£å¸¸
- [ ] é¢„è­¦ä¿¡æ¯æ˜¾ç¤ºæ­£å¸¸ï¼ˆå¦‚æœæœ‰ï¼‰
- [ ] ç­›é€‰æ¡ä»¶å¯ä»¥æ­£å¸¸å·¥ä½œ

---

**ç¥ä½¿ç”¨æ„‰å¿«ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒå®æ–½è¯´æ˜æ–‡æ¡£æˆ–æŸ¥çœ‹APIæ–‡æ¡£ã€‚**

