# è¿˜æ¬¾æ¸ é“ç®¡ç†åŠŸèƒ½è¯´æ˜

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åˆ›å»ºäº†ç®¡ç†æ§å°Controller
- **æ–‡ä»¶**ï¼š`backend-java/src/main/java/com/cco/controller/AdminPaymentChannelController.java`
- **è·¯å¾„**ï¼š`/api/admin/payment-channels`
- **åŠŸèƒ½**ï¼š
  - âœ… è·å–æ¸ é“åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€ç­›é€‰ï¼‰
  - âœ… è·å–æ¸ é“è¯¦æƒ…
  - âœ… åˆ›å»ºæ¸ é“
  - âœ… æ›´æ–°æ¸ é“
  - âœ… åˆ é™¤æ¸ é“
  - âœ… åˆ‡æ¢å¯ç”¨/ç¦ç”¨çŠ¶æ€
  - âœ… æ›´æ–°æ’åº

### 2. åˆ›å»ºäº†æ•°æ®åº“è¡¨ç»“æ„SQL
- **æ–‡ä»¶**ï¼š`backend-java/src/main/resources/sql/create_payment_channels_table.sql`
- **è¡¨å**ï¼š`payment_channels`

### 3. åˆ›å»ºäº†æµ‹è¯•æ•°æ®SQL
- **æ–‡ä»¶**ï¼š`backend-java/src/main/resources/sql/insert_payment_channels_test_data.sql`
- **è¯´æ˜**ï¼šä¸ºç”²æ–¹1æ’å…¥äº†5ä¸ªæµ‹è¯•æ¸ é“

## ğŸ“‹ éœ€è¦æ‰§è¡Œçš„SQLè„šæœ¬

### æ­¥éª¤1ï¼šåˆ›å»ºæ•°æ®åº“è¡¨

```bash
cd /Users/zhangyang/Documents/GitHub/CollectionONE/backend-java
mysql -u root -p cco_system < src/main/resources/sql/create_payment_channels_table.sql
```

æˆ–è€…ç›´æ¥åœ¨MySQLå®¢æˆ·ç«¯æ‰§è¡Œï¼š

```sql
USE cco_system;

CREATE TABLE IF NOT EXISTS `payment_channels` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `party_id` BIGINT NOT NULL COMMENT 'ç”²æ–¹ID',
  `channel_name` VARCHAR(100) NOT NULL COMMENT 'æ”¯ä»˜åç§°',
  `channel_icon` VARCHAR(500) COMMENT 'å›¾æ ‡URL',
  `channel_type` ENUM('VA', 'H5', 'QR') NOT NULL COMMENT 'æ”¯ä»˜ç±»å‹ï¼šVA-è™šæ‹Ÿè´¦æˆ·ï¼ŒH5-H5é“¾æ¥ï¼ŒQR-äºŒç»´ç ',
  `service_provider` VARCHAR(100) COMMENT 'æœåŠ¡å…¬å¸',
  `description` TEXT COMMENT 'æ¸ é“æè¿°',
  `api_url` VARCHAR(500) NOT NULL COMMENT 'APIåœ°å€',
  `api_method` ENUM('GET', 'POST') DEFAULT 'POST' COMMENT 'è¯·æ±‚æ–¹æ³•',
  `auth_type` ENUM('API_KEY', 'BEARER', 'BASIC') NOT NULL COMMENT 'è®¤è¯æ–¹å¼',
  `auth_config` JSON COMMENT 'è®¤è¯é…ç½®ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰',
  `request_params` JSON COMMENT 'æ¥å£å…¥å‚æ¨¡æ¿',
  `is_enabled` TINYINT(1) DEFAULT 1 COMMENT 'æ˜¯å¦å¯ç”¨ï¼š1-å¯ç”¨ï¼Œ0-ç¦ç”¨',
  `sort_order` INT DEFAULT 0 COMMENT 'æ’åºæƒé‡ï¼Œè¶Šå°è¶Šé å‰',
  `created_by` BIGINT COMMENT 'åˆ›å»ºäººID',
  `updated_by` BIGINT COMMENT 'æ›´æ–°äººID',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  INDEX `idx_party_enabled` (`party_id`, `is_enabled`, `sort_order`),
  INDEX `idx_party_id` (`party_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è¿˜æ¬¾æ¸ é“é…ç½®è¡¨';
```

### æ­¥éª¤2ï¼šæ’å…¥æµ‹è¯•æ•°æ®

```bash
cd /Users/zhangyang/Documents/GitHub/CollectionONE/backend-java
mysql -u root -p cco_system < src/main/resources/sql/insert_payment_channels_test_data.sql
```

æˆ–è€…ç›´æ¥åœ¨MySQLå®¢æˆ·ç«¯æ‰§è¡Œï¼š

```sql
USE cco_system;

INSERT INTO `payment_channels` (
  `party_id`, `channel_name`, `channel_icon`, `channel_type`, `service_provider`, 
  `description`, `api_url`, `api_method`, `auth_type`, `auth_config`, `request_params`,
  `is_enabled`, `sort_order`, `created_by`
) VALUES 
(1, 'GCash', 'https://example.com/icons/gcash.png', 'VA', 'Xendit', 'è²å¾‹å®¾æœ€æµè¡Œçš„ç”µå­é’±åŒ…æ”¯ä»˜æ–¹å¼', 'https://api.example.com/payment/gcash/create', 'POST', 'API_KEY', '{"api_key": "test_api_key_encrypted"}', '{"loan_id": "{loan_id}", "case_id": "{case_id}", "installment_number": "{installment_number}", "amount": "{amount}", "customer_name": "{customer_name}", "customer_phone": "{customer_phone}"}', 1, 1, 1),
(1, 'BCA Virtual Account', 'https://example.com/icons/bca.png', 'VA', 'Midtrans', 'å°å°¼BCAé“¶è¡Œè™šæ‹Ÿè´¦æˆ·', 'https://api.example.com/payment/bca-va/create', 'POST', 'BEARER', '{"token": "test_bearer_token_encrypted"}', '{"loan_id": "{loan_id}", "case_id": "{case_id}", "installment_number": "{installment_number}", "amount": "{amount}", "customer_id": "{customer_id}"}', 1, 2, 1),
(1, 'OXXO Pay', 'https://example.com/icons/oxxo.png', 'H5', 'Conekta', 'å¢¨è¥¿å“¥ä¾¿åˆ©åº—ç°é‡‘æ”¯ä»˜', 'https://api.example.com/payment/oxxo/create', 'POST', 'API_KEY', '{"api_key": "test_api_key_encrypted"}', '{"loan_id": "{loan_id}", "amount": "{amount}", "customer_name": "{customer_name}"}', 1, 3, 1),
(1, 'QRIS', 'https://example.com/icons/qris.png', 'QR', 'Xendit', 'å°å°¼ç»Ÿä¸€äºŒç»´ç æ”¯ä»˜', 'https://api.example.com/payment/qris/create', 'POST', 'API_KEY', '{"api_key": "test_api_key_encrypted"}', '{"loan_id": "{loan_id}", "case_id": "{case_id}", "amount": "{amount}"}', 1, 4, 1),
(1, 'Maya', 'https://example.com/icons/maya.png', 'VA', 'Xendit', 'è²å¾‹å®¾Mayaç”µå­é’±åŒ…', 'https://api.example.com/payment/maya/create', 'POST', 'API_KEY', '{"api_key": "test_api_key_encrypted"}', '{"loan_id": "{loan_id}", "case_id": "{case_id}", "amount": "{amount}", "customer_name": "{customer_name}"}', 1, 5, 1);
```

## ğŸ”„ é‡å¯Javaåç«¯

æ‰§è¡Œå®ŒSQLè„šæœ¬åï¼Œéœ€è¦é‡å¯Javaåç«¯æœåŠ¡ï¼š

```bash
cd /Users/zhangyang/Documents/GitHub/CollectionONE/backend-java
./start.sh
```

æˆ–è€…å¦‚æœå·²ç»åœ¨è¿è¡Œï¼Œéœ€è¦é‡å¯ï¼š

```bash
# åœæ­¢å½“å‰æœåŠ¡
lsof -ti :8080 | xargs kill

# é‡æ–°å¯åŠ¨
JAVA_HOME=/opt/homebrew/opt/openjdk@17 \
PATH=/opt/homebrew/opt/openjdk@17/bin:$PATH \
mvn spring-boot:run -Dspring-boot.run.profiles=dev
```

## âœ… éªŒè¯æ­¥éª¤

1. **æ£€æŸ¥æ•°æ®åº“è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ**ï¼š
   ```sql
   USE cco_system;
   SHOW TABLES LIKE 'payment_channels';
   SELECT COUNT(*) FROM payment_channels WHERE party_id = 1;
   ```

2. **æ£€æŸ¥åç«¯æ¥å£æ˜¯å¦æ­£å¸¸**ï¼š
   - è®¿é—®ï¼š`http://localhost:8080/api/admin/payment-channels?party_id=1&page=1&page_size=100`
   - åº”è¯¥è¿”å›5æ¡æµ‹è¯•æ•°æ®

3. **æ£€æŸ¥å‰ç«¯é¡µé¢æ˜¯å¦æ­£å¸¸**ï¼š
   - åˆ·æ–°å‰ç«¯é¡µé¢
   - ç‚¹å‡»"æ¸ é“é…ç½®" â†’ "è¿˜æ¬¾æ¸ é“ç®¡ç†"
   - åº”è¯¥èƒ½çœ‹åˆ°5ä¸ªæµ‹è¯•æ¸ é“

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **Mockæ•°æ®æ¨¡å¼**ï¼šå½“å‰Controllerä½¿ç”¨å†…å­˜å­˜å‚¨ï¼ˆMockæ¨¡å¼ï¼‰ï¼Œé‡å¯æœåŠ¡åæ•°æ®ä¼šä¸¢å¤±ã€‚å¦‚æœéœ€è¦æŒä¹…åŒ–ï¼Œéœ€è¦è¿æ¥çœŸå®æ•°æ®åº“ã€‚

2. **æ•æ„Ÿä¿¡æ¯**ï¼š`auth_config`å­—æ®µåœ¨è¿”å›ç»™å‰ç«¯æ—¶ä¼šè¢«ç§»é™¤ï¼Œç¡®ä¿å®‰å…¨ã€‚

3. **æµ‹è¯•æ•°æ®**ï¼šæ’å…¥çš„æµ‹è¯•æ•°æ®éƒ½æ˜¯ä¸º`party_id=1`åˆ›å»ºçš„ï¼Œå¦‚æœä½¿ç”¨å…¶ä»–ç”²æ–¹IDï¼Œéœ€è¦ä¿®æ”¹SQLè„šæœ¬ã€‚

## ğŸ› é—®é¢˜æ’æŸ¥

å¦‚æœé‡åˆ°500é”™è¯¯ï¼š

1. **æ£€æŸ¥Javaåç«¯æ˜¯å¦è¿è¡Œ**ï¼š
   ```bash
   lsof -i :8080
   ```

2. **æ£€æŸ¥åç«¯æ—¥å¿—**ï¼š
   ```bash
   tail -f backend-java/backend.log
   ```

3. **æ£€æŸ¥Controlleræ˜¯å¦åŠ è½½**ï¼š
   - æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ä¸­æ˜¯å¦æœ‰`AdminPaymentChannelController`çš„åŠ è½½ä¿¡æ¯

4. **æ£€æŸ¥æ•°æ®åº“è¿æ¥**ï¼š
   - ç¡®è®¤æ•°æ®åº“`cco_system`å­˜åœ¨
   - ç¡®è®¤è¡¨`payment_channels`å·²åˆ›å»º
























