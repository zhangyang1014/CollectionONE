# CCO 系统测试文档

## 📋 概述

本目录包含CCO催收系统的完整测试用例和测试说明文档。

---

## 📚 文档列表

### [完整功能测试用例](./完整功能测试用例.md)

**测试范围**: 
- ✅ 认证授权测试（4个测试用例）
- ✅ 基础数据创建测试（7个测试用例）
- ✅ 字段配置测试（2个测试用例）
- ✅ 案件导入测试（2个测试用例）
- ✅ 案件分配测试（2个测试用例）
- ✅ IM端操作测试（6个测试用例）
- ✅ 通知系统测试（4个测试用例）
- ✅ 数据看板测试（4个测试用例）
- ✅ 完整性验证测试（2个测试用例）

**总计**: 33个完整测试用例

**测试覆盖率**: 100%核心功能覆盖

---

## 🚀 快速开始

### 前置条件

1. **后端服务已启动**:
```bash
cd backend
python run.py
```

2. **前端服务已启动**:
```bash
cd frontend
npm run dev
```

3. **数据库已初始化**:
- SQLite: 自动创建数据库文件
- MySQL: 已执行schema.sql

### 执行测试

#### 方式1: 使用curl命令（推荐）

按照测试用例文档中的步骤，依次执行curl命令：

```bash
# 1. SuperAdmin登录
curl -X POST http://localhost:8000/api/v1/admin/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "loginId": "superadmin",
    "password": "123456"
  }'

# 2. 保存返回的token
export TOKEN="返回的token值"

# 3. 继续后续测试...
```

#### 方式2: 使用Postman

1. 导入Postman Collection（如果有）
2. 设置环境变量（base_url, token等）
3. 按顺序执行请求

#### 方式3: 使用自动化测试脚本

```bash
# TODO: 创建自动化测试脚本
python tests/run_integration_tests.py
```

---

## 📊 测试流程

### 完整测试流程

```
1. 认证测试
   ↓
2. 创建基础数据
   - 创建甲方A、甲方B
   - 创建机构1、机构2
   - 创建案件队列（M1, M2, M3+, M4+, LEGAL）
   - 创建小组群
   - 创建小组
   - 创建催员
   ↓
3. 配置字段展示
   ↓
4. 导入案件数据
   - 验证自动分队列
   ↓
5. 案件分配
   - 手动分配
   - 自动分案
   ↓
6. IM端催员操作
   - 催员登录
   - 查看案件
   - 添加沟通记录
   - 添加PTP
   ↓
7. 通知系统验证
   ↓
8. 数据看板验证
   ↓
9. 完整性验证
```

---

## ✅ 测试检查清单

### 认证授权
- [ ] SuperAdmin可以登录
- [ ] TenantAdmin可以登录
- [ ] 催员可以登录IM端
- [ ] Token验证正确

### 基础数据
- [ ] 甲方创建成功
- [ ] 机构创建成功并关联到甲方
- [ ] 5个标准队列创建成功
- [ ] 小组群创建成功
- [ ] 小组创建成功并关联到队列
- [ ] 催员创建成功并关联到小组
- [ ] 组长设置成功

### 字段配置
- [ ] 标准字段列表可以查询
- [ ] 甲方字段展示配置保存成功
- [ ] 配置按排序显示

### 案件管理
- [ ] 10个案件导入成功
- [ ] 案件自动分配到正确队列
- [ ] M1队列包含1-30天的案件
- [ ] M2队列包含31-60天的案件
- [ ] M3+队列包含61-90天的案件

### 案件分配
- [ ] 手动分配成功
- [ ] 生成分配历史记录
- [ ] 催员案件数更新
- [ ] 自动分案均衡分配
- [ ] 不超过催员max_case_count

### IM端功能
- [ ] 催员可以查看自己的案件
- [ ] 案件详情显示完整
- [ ] 沟通记录保存成功
- [ ] PTP记录保存成功
- [ ] 案件状态更新成功

### 通知系统
- [ ] 通知模板创建成功
- [ ] 通知推送成功
- [ ] 催员可以接收通知
- [ ] 通知标记已读成功

### 数据看板
- [ ] 沟通记录统计正确
- [ ] PTP统计数据正确
- [ ] 催员绩效显示正确
- [ ] 空闲催员监控正常

### 完整性验证
- [ ] 所有甲方都有机构
- [ ] 所有机构都有小组
- [ ] 所有小组都有催员
- [ ] 所有案件都有队列
- [ ] 催员案件数不超限

---

## 📝 测试数据

### 测试账号

| 角色 | 登录ID | 密码 | 说明 |
|------|--------|------|------|
| SuperAdmin | superadmin | 123456 | 超级管理员 |
| TenantAdmin | tenantadmin | admin123 | 甲方管理员 |
| 催员1 | collector001 | 123456 | 王小明（M1组组长） |
| 催员2 | collector002 | 123456 | 李小红（M1组） |
| 催员3 | collector003 | 123456 | 张小刚（M1组） |

### 测试案件数据

测试用例中包含10个预设案件：
- CASE_001 ~ CASE_010
- 逾期天数: 5天 ~ 70天
- 逾期金额: 2,000 ~ 20,000 PHP

### 测试机构数据

- 甲方A（TENANT_A）
  - 机构1（AGENCY_001）
    - A组群（GROUP_A）
      - M1小组（TEAM_M1）
      - M2小组（TEAM_M2）
      - 综合小组（TEAM_GENERAL）

---

## 🐛 问题记录

### 已知问题

记录测试过程中发现的问题：

| 问题ID | 描述 | 严重程度 | 状态 | 备注 |
|--------|------|----------|------|------|
| - | - | - | - | - |

### 问题模板

发现问题时，请按以下格式记录：

```
## 问题ID: BUG_001

**问题描述**: 
案件导入时，mobile格式验证不正确

**复现步骤**:
1. 调用 POST /api/v1/cases/import
2. mobile使用非E.164格式
3. 系统未报错

**预期结果**: 
应该返回400错误，提示mobile格式不正确

**实际结果**: 
返回200，案件导入成功

**严重程度**: 中

**发现时间**: 2025-11-20

**发现人**: 张三
```

---

## 📈 测试报告

### 测试报告模板

执行完测试后，请填写测试报告：

#### 测试执行记录

| 测试模块 | 测试用例数 | 通过 | 失败 | 跳过 | 通过率 |
|---------|-----------|------|------|------|--------|
| 认证授权 | 4 | | | | |
| 基础数据创建 | 7 | | | | |
| 字段配置 | 2 | | | | |
| 案件导入 | 2 | | | | |
| 案件分配 | 2 | | | | |
| IM端操作 | 6 | | | | |
| 通知系统 | 4 | | | | |
| 数据看板 | 4 | | | | |
| 完整性验证 | 2 | | | | |
| **总计** | **33** | | | | |

#### 测试环境

- 测试日期: ____年__月__日
- 测试人员: _________
- 后端版本: v1.0.0
- 前端版本: v1.0.0
- 数据库: SQLite/MySQL
- 操作系统: macOS/Linux/Windows

#### 测试结论

- [ ] 所有核心功能测试通过
- [ ] 性能测试通过
- [ ] 安全测试通过
- [ ] 系统可以上线

---

## 🔧 自动化测试（计划）

### TODO: 创建自动化测试脚本

```python
# tests/run_integration_tests.py

import requests
import json

class CCOIntegrationTest:
    def __init__(self, base_url):
        self.base_url = base_url
        self.token = None
    
    def test_auth(self):
        """测试认证"""
        pass
    
    def test_create_tenant(self):
        """测试创建甲方"""
        pass
    
    # ... 其他测试方法
    
    def run_all_tests(self):
        """运行所有测试"""
        self.test_auth()
        self.test_create_tenant()
        # ...

if __name__ == '__main__':
    test = CCOIntegrationTest('http://localhost:8000')
    test.run_all_tests()
```

---

## 📞 支持

如有测试相关问题，请联系：
- 技术负责人: xxx@example.com
- 测试团队: test@example.com

---

**文档维护**: CCO测试团队  
**最后更新**: 2025-11-20  
**文档版本**: v1.0.0

