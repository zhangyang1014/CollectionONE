# CCO催收系统 - 项目实施说明

## 项目概述

基于 Vue 3 + Python FastAPI + MySQL 的催收操作系统，支持多甲方、自定义字段配置、字段联动等功能。

## 已完成功能模块

### 1. 后端API（FastAPI + SQLAlchemy + MySQL）

#### 1.1 数据库模型
- ✅ 字段分组表 (field_groups)
- ✅ 标准字段定义表 (standard_fields)
- ✅ 字段联动规则表 (field_dependencies)
- ✅ 甲方配置表 (tenants)
- ✅ 甲方字段启用配置表 (tenant_field_configs)
- ✅ 自定义字段定义表 (custom_fields)
- ✅ 案件主表 (cases)
- ✅ 标准字段值表 (case_standard_field_values)
- ✅ 自定义字段值表 (case_custom_field_values)
- ✅ 审计日志表 (audit_logs)
- ✅ 字段筛选配置表 (field_filter_configs)

#### 1.2 API接口
- ✅ 字段分组 CRUD API
- ✅ 标准字段 CRUD API
- ✅ 自定义字段 CRUD API
- ✅ 字段联动规则 CRUD API
- ✅ 甲方管理 API
- ✅ 甲方字段配置 API
- ✅ 案件管理 API
- ✅ 数据同步 API (`POST /api/v1/cases/sync`)

### 2. 前端界面（Vue 3 + TypeScript + Element Plus）

#### 2.1 基础设施
- ✅ Vue Router 路由配置
- ✅ Pinia 状态管理
- ✅ Axios 请求封装
- ✅ 国际化配置 (vue-i18n)
- ✅ TypeScript 类型定义
- ✅ 主布局组件

#### 2.2 功能页面
- ✅ 工作台
- ✅ 标准字段管理（含树形分组 + 表格 + 表单）
- ✅ 自定义字段管理
- ✅ 字段分组管理
- ✅ 字段联动配置
- ✅ 甲方列表
- ✅ 甲方字段配置
- ✅ 案件列表（含筛选）
- ✅ 案件详情（Tab展示不同字段分组）

## 项目启动步骤

### 1. 环境准备

#### 后端环境
```bash
# Python 3.10+
# MySQL 8.0+
# Redis (可选，用于缓存)
```

#### 前端环境
```bash
# Node.js 18+
# npm or yarn
```

### 2. 后端启动

```bash
cd backend

# 1. 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 2. 安装依赖
pip install -r requirements.txt

# 3. 配置环境变量
# 创建 .env 文件，参考 .env.example

# 4. 创建数据库
# 在 MySQL 中创建数据库: CREATE DATABASE cco_system;

# 5. 创建表结构
python create_tables.py

# 6. 启动服务
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

访问 API 文档：http://localhost:8000/docs

### 3. 前端启动

```bash
cd frontend

# 1. 安装依赖
npm install

# 2. 启动开发服务器
npm run dev
```

访问前端：http://localhost:5173

## 核心功能说明

### 1. 字段配置系统

#### 1.1 标准字段
- 系统预定义的字段，所有甲方共享
- 支持分组管理（树形结构）
- 支持字段启用/禁用、排序
- 支持软删除（历史数据保留）

#### 1.2 自定义字段
- 每个甲方可以创建自己的自定义字段
- 字段类型：文本、整数、小数、日期、枚举等
- 支持字段验证规则配置

#### 1.3 字段联动
- 支持字段之间的联动关系
- 联动类型：显示/隐藏、选项变化
- 示例：催记中的"沟通状态"联动"沟通结果"

### 2. 甲方管理

#### 2.1 甲方配置
- 支持多个甲方
- 每个甲方独立的字段配置
- 支持时区、货币等国际化设置

#### 2.2 字段权限配置
- 甲方可以启用/禁用标准字段
- 可以设置字段的必填、只读、可见属性
- 支持字段显示顺序调整

### 3. 案件管理

#### 3.1 案件列表
- 支持按甲方筛选
- 支持按案件状态筛选
- 动态显示标准字段和自定义字段

#### 3.2 案件详情
- Tab 标签页展示不同字段分组
- 基本信息、标准字段、自定义字段分离展示
- 支持字段联动（如催记字段）

#### 3.3 数据同步
- 提供统一的数据同步接口
- 支持批量同步案件数据
- 自动映射标准字段和自定义字段

## 数据同步接口使用示例

```bash
POST /api/v1/cases/sync
Content-Type: application/json

{
  "tenant_code": "TENANT001",
  "cases": [
    {
      "case_id": "CASE001",
      "loan_id": "LOAN001",
      "user_id": "USER001",
      "case_status": "进行中",
      "standard_fields": {
        "user_name": "张三",
        "mobile_number": "+86 13800138000",
        "outstanding_amount": 5000,
        "overdue_days": 15
      },
      "custom_fields": {
        "custom_field_001": "自定义值1",
        "custom_field_002": "自定义值2"
      }
    }
  ]
}
```

## 技术架构特点

### 1. 字段灵活性
- 标准字段 + 自定义字段的混合架构
- EAV 模式存储动态字段值
- 支持字段软删除，历史数据完整保留

### 2. 多甲方支持
- 数据隔离（tenant_id）
- 独立的字段配置
- 国际化支持（时区、货币、语言）

### 3. 性能优化
- Redis 缓存字段配置（已预留）
- 数据库索引优化
- 前端虚拟滚动（已预留）

### 4. 扩展性
- RESTful API 设计
- 模块化前端架构
- 易于添加新的字段类型和联动规则

## 后续可扩展功能

1. **权限管理**
   - 角色管理
   - 菜单权限
   - 字段级权限

2. **审计日志**
   - 操作日志记录
   - 字段变更追踪
   - 日志查询和导出

3. **性能优化**
   - Redis 缓存实施
   - 列表虚拟滚动
   - 详情页懒加载

4. **高级功能**
   - 批量操作
   - 数据导入导出
   - 报表统计
   - 工作流引擎

## 注意事项

1. **数据库配置**
   - 确保 MySQL 配置正确的字符集（utf8mb4）
   - 根据数据量调整连接池大小

2. **环境变量**
   - 生产环境务必修改 SECRET_KEY
   - 配置正确的 CORS 域名

3. **字段设计**
   - 字段标识（field_key）建议使用下划线命名
   - 枚举选项使用中文，方便展示

4. **数据同步**
   - 建议定期同步，避免大批量一次性同步
   - 注意处理同步失败的错误日志

## 联系方式

如有问题，请参考：
- 设计文档：`CCO字段配置系统设计.md`
- API 文档：http://localhost:8000/docs
- 实施计划：`cco.plan.md`

