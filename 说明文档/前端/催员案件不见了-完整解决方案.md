# 催员案件不见了 - 完整解决方案

## 🎯 问题现象

在催员工作台，案件列表突然变成空白，显示"请从左侧列表选择案件"或"暂无数据"。

**核心数据显示**:
- 排名: 2
- 应收: 28
- 未还: 15
- 回收率: 46.4%

**但是案件列表为空！**

---

## 🔍 问题原因

**Token过期了！**

您的登录凭证（Token）有效期为24小时，过期后：
1. 后端拒绝请求
2. 返回401错误
3. 前端自动清除Token
4. **自动跳转到登录页**（新修复）

---

## ✅ 立即解决方案

### 方法1: 清除Token重新登录（推荐）⭐

**步骤如下**:

1. **打开浏览器开发者工具**
   - Windows/Linux: 按 `F12`
   - Mac: 按 `Cmd + Option + I`
   - 或右键点击页面 → "检查" / "Inspect"

2. **找到并删除过期Token**
   - 点击顶部 `Application` 标签页
   - 左侧找到 `Storage` → `Local Storage`
   - 点击您的网站地址（如 `http://localhost:5173`）
   - 找到以下项目，右键删除：
     - `token` ⭐（管理员Token）
     - `im_token` ⭐（催员Token）
     - `userInfo`（可选）
     - `im_user`（可选）

3. **刷新页面**
   - 按 `F5` 刷新
   - 或者关闭浏览器重新打开

4. **重新登录**
   - 输入您的账号密码
   - 登录成功后案件就会恢复显示

---

### 方法2: 使用快捷清除（最快）⚡

在浏览器开发者工具（F12）→ `Console` 标签页中输入：

```javascript
// 清除所有登录信息
localStorage.clear()
// 刷新页面
location.reload()
```

然后重新登录即可。

---

### 方法3: 清除浏览器缓存（彻底清除）

**Chrome浏览器**:
1. 按 `Ctrl + Shift + Delete`（Mac: `Cmd + Shift + Delete`）
2. 时间范围选择"全部时间"
3. 勾选：
   - ✅ Cookie和其他网站数据
   - ✅ 缓存的图片和文件
4. 点击"清除数据"
5. 重新访问网站并登录

**Edge浏览器**:
1. 设置 → 隐私、搜索和服务
2. 清除浏览数据 → 选择要清除的内容
3. 勾选Cookie和缓存
4. 点击"立即清除"

**Firefox浏览器**:
1. 历史记录 → 清除最近的历史记录
2. 时间范围：全部
3. 勾选Cookie和缓存
4. 点击"立即清除"

---

## 🚀 自动解决方案（新功能）

### 现在系统会自动处理！

**修复后的行为**:
1. Token过期时
2. 自动弹出提示："未授权，请重新登录"
3. 自动清除过期Token
4. **自动跳转到登录页** ✨

**您只需要**:
- 重新输入账号密码登录
- 案件就会重新加载

---

## 📊 如何避免此问题

### 建议1: 定期重新登录

Token有效期为24小时，建议：
- ✅ 每天上班时重新登录
- ✅ 下班时退出登录
- ✅ 长时间不操作（超过1小时）后刷新页面

### 建议2: 不要在多个标签页同时登录

如果在多个标签页同时打开催员工作台：
- 一个标签页退出登录
- 其他标签页的Token也会失效
- **解决**: 只使用一个标签页工作

### 建议3: 使用"记住我"功能（待开发）

未来版本将支持：
- 自动刷新Token
- 延长登录有效期
- 保持登录状态

---

## 🔍 高级调试方法

### 检查Token是否过期

1. 打开浏览器开发者工具（F12）
2. 点击 `Application` → `Local Storage`
3. 查看 `token` 或 `im_token` 的值
4. 复制Token内容
5. 访问: https://jwt.io/
6. 粘贴Token到Debugger
7. 查看 `exp`（过期时间）字段

如果 `exp` 时间早于当前时间，Token已过期。

---

### 查看后端日志

如果您有服务器访问权限：

```bash
# 查看Token过期错误
tail -100 backend-java/backend-running.log | grep "JWT token is expired"

# 查看最近的认证错误
tail -100 backend-java/backend-running.log | grep -E "(ERROR|401)"
```

---

### 测试API是否正常

```bash
# 测试案件API（无Token）
curl "http://localhost:8080/api/v1/cases?tenantId=1&collectorId=37"

# 测试案件API（过期Token）
curl -H "Authorization: Bearer expired.token" \
  "http://localhost:8080/api/v1/cases?tenantId=1&collectorId=37"
```

如果第二个命令返回 `{"code":401,"message":"Token已过期，请重新登录"}`，说明后端工作正常。

---

## ❓ 常见问题

### Q1: 为什么经常遇到这个问题？

**A**: Token有效期为24小时。如果您：
- 长时间保持浏览器打开（超过24小时）
- 在多个设备或浏览器登录
- 系统时间不准确

都可能导致Token频繁过期。

**解决**: 每天重新登录一次。

---

### Q2: 清除Token后，之前的工作会丢失吗？

**A**: 不会！
- 催记、还款记录等数据都保存在服务器
- 清除Token只是清除登录凭证
- 重新登录后所有数据都会恢复

---

### Q3: 为什么有时候案件数量显示正常，但列表为空？

**A**: 这是因为：
- 页面顶部的统计数据（排名、应收等）是缓存的
- 案件列表需要实时从服务器加载
- Token过期时，列表加载失败，但缓存数据仍然显示

**解决**: 刷新页面后，统计数据也会更新。

---

### Q4: 使用隐私模式会有帮助吗？

**A**: 可以用于测试，但不适合日常使用：
- ✅ 隐私模式可以快速测试是否是Token问题
- ❌ 关闭隐私窗口后，登录状态会丢失
- ❌ 每次都需要重新登录，不方便

**建议**: 仅用于调试，日常工作使用正常模式。

---

### Q5: 系统说"已修复"，为什么我还是遇到问题？

**A**: 修复的是**自动处理机制**，不是延长Token有效期：

**修复前**:
- Token过期
- 案件列表为空
- ❌ 用户不知道为什么
- ❌ 需要手动清除缓存

**修复后**:
- Token过期
- 自动弹出提示
- ✅ 自动跳转登录页
- ✅ 用户知道需要重新登录

Token仍然会过期，但现在系统会**自动告诉您并处理**。

---

## 📞 联系技术支持

如果以上方法都无法解决问题，请联系技术支持并提供：

1. **错误截图**
   - 案件列表页面
   - 浏览器开发者工具 Console 标签页的错误信息

2. **操作步骤**
   - 何时登录的
   - 何时发现案件不见的
   - 中间做了什么操作

3. **环境信息**
   - 浏览器版本（Chrome、Edge、Firefox等）
   - 操作系统（Windows、Mac、Linux）
   - 是否使用VPN或代理

---

## 🎉 总结

### 快速3步解决

1. **F12** → Application → Local Storage
2. **删除** `token` 和 `im_token`
3. **F5刷新** → 重新登录

### 记住

- ✅ Token会过期（24小时）
- ✅ 系统现在会自动提示
- ✅ 只需重新登录即可
- ✅ 数据不会丢失

---

**文档创建时间**: 2025-11-22  
**最后更新**: 2025-11-22  
**适用版本**: CCO v1.0.0+  
**状态**: ✅ 已修复并测试


