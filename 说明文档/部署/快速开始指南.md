# CCOç³»ç»Ÿ v2.0 å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸš€ ç«‹å³å¼€å§‹

### æ­¥éª¤1ï¼šæ•°æ®åº“è¿ç§»ï¼ˆå¿…é¡»å…ˆæ‰§è¡Œï¼‰

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# åˆ›å»ºè¿ç§»è„šæœ¬
alembic revision --autogenerate -m "Add organization and queue models v2.0"

# æ‰§è¡Œè¿ç§»
alembic upgrade head
```

### æ­¥éª¤2ï¼šæ³¨å†Œåç«¯è·¯ç”±

ç¼–è¾‘ `backend/app/main.py`ï¼Œæ·»åŠ æ–°çš„è·¯ç”±ï¼š

```python
# å¯¼å…¥æ–°çš„APIè·¯ç”±
from app.api import agencies  # å·²å®ç°
# from app.api import teams, collectors, queues, case_assignment  # å¾…å®ç°

# æ³¨å†Œè·¯ç”±
app.include_router(agencies.router, prefix="/api/v1", tags=["ç»„ç»‡ç®¡ç†"])
# app.include_router(teams.router, prefix="/api/v1", tags=["ç»„ç»‡ç®¡ç†"])
# app.include_router(collectors.router, prefix="/api/v1", tags=["ç»„ç»‡ç®¡ç†"])
# app.include_router(queues.router, prefix="/api/v1", tags=["é˜Ÿåˆ—ç®¡ç†"])
# app.include_router(case_assignment.router, prefix="/api/v1", tags=["æ¡ˆä»¶ç®¡ç†"])
```

### æ­¥éª¤3ï¼šé…ç½®å‰ç«¯è·¯ç”±

ç¼–è¾‘ `frontend/src/router/index.ts`ï¼Œæ·»åŠ æ–°è·¯ç”±ï¼š

```typescript
import AgencyList from '@/views/organization/AgencyList.vue'

const routes = [
  {
    path: '/organization',
    name: 'Organization',
    meta: { title: 'ç»„ç»‡ç®¡ç†' },
    children: [
      {
        path: 'agencies',
        name: 'AgencyList',
        component: AgencyList,
        meta: { title: 'å‚¬æ”¶æœºæ„ç®¡ç†' }
      }
      // å…¶ä»–è·¯ç”±å¾…æ·»åŠ 
    ]
  }
]
```

### æ­¥éª¤4ï¼šå¯åŠ¨æœåŠ¡

```bash
# åç«¯
cd backend
uvicorn app.main:app --reload --port 8000

# å‰ç«¯
cd frontend
npm run dev
```

### æ­¥éª¤5ï¼šè®¿é—®æµ‹è¯•

- å‰ç«¯ï¼šhttp://localhost:5173
- åç«¯APIæ–‡æ¡£ï¼šhttp://localhost:8000/docs
- æµ‹è¯•æœºæ„ç®¡ç†ï¼šhttp://localhost:5173/organization/agencies

---

## ğŸ“¦ å·²å®ç°åŠŸèƒ½æ¸…å•

### âœ… å¯ä»¥ç«‹å³ä½¿ç”¨çš„åŠŸèƒ½ï¼š

1. **å‚¬æ”¶æœºæ„ç®¡ç†**
   - âœ… æœºæ„åˆ—è¡¨æŸ¥è¯¢
   - âœ… åˆ›å»ºæœºæ„
   - âœ… ç¼–è¾‘æœºæ„
   - âœ… åˆ é™¤æœºæ„
   - âœ… çŠ¶æ€åˆ‡æ¢
   - âœ… ç»Ÿè®¡æ•°æ®å±•ç¤º

2. **æ•°æ®åº“åŸºç¡€**
   - âœ… æ‰€æœ‰è¡¨ç»“æ„å·²å®šä¹‰
   - âœ… ORMæ¨¡å‹å®Œæ•´
   - âœ… å…³ç³»æ˜ å°„æ­£ç¡®

3. **ç±»å‹ç³»ç»Ÿ**
   - âœ… TypeScriptç±»å‹å®šä¹‰å®Œæ•´
   - âœ… åç«¯Pydantic Schemaså®Œæ•´

---

## ğŸ”¨ å¦‚ä½•æ‰©å±•åŠŸèƒ½

### æ·»åŠ æ–°çš„APIè·¯ç”±

å‚è€ƒ `backend/app/api/agencies.py`ï¼Œåˆ›å»ºå…¶ä»–APIï¼š

```python
# backend/app/api/teams.py
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from app.core.database import get_db
from app.models import CollectionTeam
from app.schemas.organization import CollectionTeam as TeamSchema

router = APIRouter(prefix="/teams", tags=["å‚¬æ”¶å°ç»„ç®¡ç†"])

@router.get("", response_model=List[TeamSchema])
async def list_teams(
    agency_id: Optional[int] = Query(None),
    db: Session = Depends(get_db)
):
    query = db.query(CollectionTeam)
    if agency_id:
        query = query.filter(CollectionTeam.agency_id == agency_id)
    return query.all()

# ... å…¶ä»–CRUDæ“ä½œ
```

### æ·»åŠ æ–°çš„å‰ç«¯é¡µé¢

å‚è€ƒ `frontend/src/views/organization/AgencyList.vue`ï¼š

```vue
<!-- frontend/src/views/organization/TeamList.vue -->
<template>
  <div class="team-list">
    <el-card>
      <template #header>
        <div class="card-header">
          <span>å‚¬æ”¶å°ç»„ç®¡ç†</span>
          <el-button type="primary" @click="handleCreate">æ·»åŠ å°ç»„</el-button>
        </div>
      </template>

      <!-- å¤åˆ¶AgencyList.vueçš„ç»“æ„ -->
      <!-- ä¿®æ”¹å¯¹åº”çš„APIè°ƒç”¨å’Œå­—æ®µ -->
    </el-card>
  </div>
</template>

<script setup lang="ts">
import { getTeams, createTeam, updateTeam, deleteTeam } from '@/api/organization'
// ... å¤åˆ¶AgencyList.vueçš„é€»è¾‘ï¼Œä¿®æ”¹å¯¹åº”éƒ¨åˆ†
</script>
```

---

## ğŸ¯ å¼€å‘é¡ºåºå»ºè®®

### ç¬¬ä¸€å¤©ï¼šå®Œæˆå°ç»„å’Œå‚¬å‘˜ç®¡ç†

1. **ä¸Šåˆ**
   - åˆ›å»º `backend/app/api/teams.py`ï¼ˆå‚è€ƒagencies.pyï¼‰
   - åˆ›å»º `backend/app/api/collectors.py`ï¼ˆå‚è€ƒagencies.pyï¼‰
   - åœ¨main.pyä¸­æ³¨å†Œè·¯ç”±

2. **ä¸‹åˆ**
   - åˆ›å»º `frontend/src/views/organization/TeamList.vue`ï¼ˆå‚è€ƒAgencyList.vueï¼‰
   - åˆ›å»º `frontend/src/views/organization/CollectorList.vue`ï¼ˆå‚è€ƒAgencyList.vueï¼‰
   - é…ç½®å‰ç«¯è·¯ç”±

3. **æ™šä¸Š**
   - æµ‹è¯•æœºæ„â†’å°ç»„â†’å‚¬å‘˜çš„å®Œæ•´æµç¨‹
   - ä¿®å¤bug

### ç¬¬äºŒå¤©ï¼šå®Œæˆé˜Ÿåˆ—ç®¡ç†

1. **ä¸Šåˆ**
   - åˆ›å»º `backend/app/api/queues.py`
   - å®ç°é˜Ÿåˆ—CRUDå’Œå­—æ®µé…ç½®æ¥å£

2. **ä¸‹åˆ**
   - åˆ›å»º `frontend/src/views/queue/QueueList.vue`
   - åˆ›å»º `frontend/src/views/queue/QueueFieldConfig.vue`ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

3. **æ™šä¸Š**
   - æµ‹è¯•é˜Ÿåˆ—å­—æ®µé…ç½®åŠŸèƒ½
   - æµ‹è¯•å­—æ®µæ˜¾ç¤º/éšè—/å¿…å¡«é€»è¾‘

### ç¬¬ä¸‰å¤©ï¼šå®Œæˆæ¡ˆä»¶åˆ†é…

1. **ä¸Šåˆ**
   - åˆ›å»º `backend/app/api/case_assignment.py`
   - å®ç°å„ç§åˆ†é…æ¥å£

2. **ä¸‹åˆ**
   - åœ¨æ¡ˆä»¶åˆ—è¡¨é¡µé¢æ·»åŠ åˆ†é…æŒ‰é’®
   - åˆ›å»ºåˆ†é…å¯¹è¯æ¡†ç»„ä»¶

3. **æ™šä¸Š**
   - æµ‹è¯•æ¡ˆä»¶åˆ†é…æµç¨‹
   - æµ‹è¯•åˆ†é…å†å²æŸ¥è¯¢

---

## ğŸ“ ä»£ç æ¨¡æ¿

### APIè·¯ç”±æ¨¡æ¿

```python
# backend/app/api/xxx.py
from fastapi import APIRouter, Depends, HTTPException, Query
from sqlalchemy.orm import Session
from typing import List, Optional

from app.core.database import get_db
from app.models import YourModel
from app.schemas.xxx import YourSchema, YourCreateSchema, YourUpdateSchema

router = APIRouter(prefix="/xxx", tags=["xxxç®¡ç†"])

@router.get("", response_model=List[YourSchema])
async def list_items(
    skip: int = Query(0, ge=0),
    limit: int = Query(100, ge=1, le=1000),
    db: Session = Depends(get_db)
):
    items = db.query(YourModel).offset(skip).limit(limit).all()
    return items

@router.post("", response_model=YourSchema)
async def create_item(
    item: YourCreateSchema,
    db: Session = Depends(get_db)
):
    db_item = YourModel(**item.dict())
    db.add(db_item)
    db.commit()
    db.refresh(db_item)
    return db_item

@router.get("/{id}", response_model=YourSchema)
async def get_item(id: int, db: Session = Depends(get_db)):
    item = db.query(YourModel).filter(YourModel.id == id).first()
    if not item:
        raise HTTPException(status_code=404, detail="Not found")
    return item

@router.put("/{id}", response_model=YourSchema)
async def update_item(
    id: int,
    item_update: YourUpdateSchema,
    db: Session = Depends(get_db)
):
    db_item = db.query(YourModel).filter(YourModel.id == id).first()
    if not db_item:
        raise HTTPException(status_code=404, detail="Not found")
    
    update_data = item_update.dict(exclude_unset=True)
    for field, value in update_data.items():
        setattr(db_item, field, value)
    
    db.commit()
    db.refresh(db_item)
    return db_item

@router.delete("/{id}")
async def delete_item(id: int, db: Session = Depends(get_db)):
    item = db.query(YourModel).filter(YourModel.id == id).first()
    if not item:
        raise HTTPException(status_code=404, detail="Not found")
    
    db.delete(item)
    db.commit()
    return {"message": "åˆ é™¤æˆåŠŸ"}
```

### å‰ç«¯é¡µé¢æ¨¡æ¿

```vue
<template>
  <div class="xxx-list">
    <el-card>
      <template #header>
        <div class="card-header">
          <span>XXXç®¡ç†</span>
          <el-button type="primary" @click="handleCreate">æ·»åŠ </el-button>
        </div>
      </template>

      <!-- æŸ¥è¯¢è¡¨å• -->
      <el-form :inline="true" :model="queryForm">
        <el-form-item label="ç­›é€‰æ¡ä»¶">
          <el-select v-model="queryForm.xxx">
            <el-option label="å…¨éƒ¨" value="" />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="loadData">æŸ¥è¯¢</el-button>
        </el-form-item>
      </el-form>

      <!-- è¡¨æ ¼ -->
      <el-table v-loading="loading" :data="tableData" border>
        <el-table-column prop="xxx" label="XXX" />
        <el-table-column label="æ“ä½œ" width="200" fixed="right">
          <template #default="{ row }">
            <el-button link type="primary" @click="handleEdit(row)">
              ç¼–è¾‘
            </el-button>
            <el-button link type="danger" @click="handleDelete(row)">
              åˆ é™¤
            </el-button>
          </template>
        </el-table-column>
      </el-table>
    </el-card>

    <!-- å¯¹è¯æ¡† -->
    <el-dialog v-model="dialogVisible" :title="dialogTitle">
      <el-form ref="formRef" :model="formData" :rules="formRules">
        <el-form-item label="XXX" prop="xxx">
          <el-input v-model="formData.xxx" />
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="dialogVisible = false">å–æ¶ˆ</el-button>
        <el-button type="primary" @click="handleSubmit">ç¡®å®š</el-button>
      </template>
    </el-dialog>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted } from 'vue'
import { ElMessage } from 'element-plus'
import { getXxx, createXxx, updateXxx, deleteXxx } from '@/api/xxx'

const loading = ref(false)
const tableData = ref([])
const dialogVisible = ref(false)
const dialogTitle = ref('')

const queryForm = reactive({
  xxx: ''
})

const formData = reactive({
  xxx: ''
})

onMounted(() => {
  loadData()
})

async function loadData() {
  loading.value = true
  try {
    const res = await getXxx(queryForm)
    tableData.value = res.data
  } finally {
    loading.value = false
  }
}

function handleCreate() {
  dialogTitle.value = 'æ·»åŠ '
  Object.assign(formData, { xxx: '' })
  dialogVisible.value = true
}

function handleEdit(row: any) {
  dialogTitle.value = 'ç¼–è¾‘'
  Object.assign(formData, row)
  dialogVisible.value = true
}

async function handleSubmit() {
  // å®ç°æäº¤é€»è¾‘
}

async function handleDelete(row: any) {
  // å®ç°åˆ é™¤é€»è¾‘
}
</script>
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“è¿ç§»å¿…é¡»å…ˆæ‰§è¡Œ**ï¼Œå¦åˆ™ä¼šæŠ¥è¡¨ä¸å­˜åœ¨é”™è¯¯
2. **è·¯ç”±æ³¨å†Œé¡ºåº**ï¼šå…ˆåç«¯åå‰ç«¯
3. **æµ‹è¯•æ–¹æ³•**ï¼šä½¿ç”¨Swaggeræ–‡æ¡£æµ‹è¯•åç«¯ï¼Œä½¿ç”¨æµè§ˆå™¨æµ‹è¯•å‰ç«¯
4. **é”™è¯¯å¤„ç†**ï¼šæ³¨æ„æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°å’Œåç«¯æ—¥å¿—
5. **ç±»å‹å®‰å…¨**ï¼šå……åˆ†åˆ©ç”¨TypeScriptçš„ç±»å‹æ£€æŸ¥

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è®¾è®¡æ–‡æ¡£](./CCOå­—æ®µé…ç½®ç³»ç»Ÿè®¾è®¡.md)
- [å®ç°è¿›åº¦](./å®ç°è¿›åº¦è¯´æ˜.md)
- [éƒ¨ç½²æŒ‡å—](./éƒ¨ç½²æŒ‡å—.md)

---

**ç¥å¼€å‘é¡ºåˆ©ï¼** ğŸ‰

