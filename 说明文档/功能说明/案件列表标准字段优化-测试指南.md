# 案件列表标准字段优化 - 快速测试指南

## 版本记录

| 版本号 | 日期 | 变更内容 | 变更人 |
|--------|------|------|--------|
| 1.0.0 | 2025-12-12 | 初始版本：案件列表标准字段优化测试指南 | 大象 |

---

## 1. 测试准备

### 1.1 环境要求
- Java 17
- Node.js 16+
- 浏览器（Chrome/Edge/Safari）

### 1.2 代码更新
```bash
# 确保代码已更新到最新版本
cd /Users/zhangyang/Documents/GitHub/CollectionONE
git status

# 查看修改的文件
# - backend-java/src/main/java/com/cco/support/CaseStandardFieldProvider.java
# - PRD需求文档/CCO管理控台/字段管理/案件列表字段管理/1-案件列表标准字段管理-PRD.md
```

---

## 2. 后端测试

### 2.1 启动Java后端

#### 方式1：使用启动脚本
```bash
cd backend-java
./start.sh
```

#### 方式2：使用Maven命令
```bash
cd backend-java
JAVA_HOME=/opt/homebrew/opt/openjdk@17 \
PATH=/opt/homebrew/opt/openjdk@17/bin:$PATH \
mvn spring-boot:run -Dspring-boot.run.profiles=dev
```

### 2.2 验证后端启动
```bash
# 检查服务是否启动（应该看到8080端口）
lsof -i :8080

# 访问健康检查接口
curl http://localhost:8080/actuator/health
```

**预期结果**:
```json
{
  "status": "UP"
}
```

### 2.3 测试标准字段API

#### 测试命令
```bash
curl http://localhost:8080/api/v1/case-standard-fields/list
```

#### 预期结果验证点

✅ **字段数量**: 应该返回 **23 个字段**

✅ **新增字段验证**:
```json
{
  "id": 11,
  "fieldKey": "overdue_installments",
  "fieldName": "逾期期数",
  "fieldDataType": "Integer",
  "required": true
}
```

✅ **重命名字段验证**:
```json
{
  "id": 12,
  "fieldKey": "expected_start_date",
  "fieldName": "预期开始日期",
  "fieldDataType": "Date",
  "required": true
}
```

```json
{
  "id": 13,
  "fieldKey": "total_installments",
  "fieldName": "总期数",
  "fieldDataType": "Integer",
  "required": true
}
```

✅ **案件类型字段验证** (ID 19-23):
```json
{
  "id": 19,
  "fieldKey": "case_type_1",
  "fieldName": "案件类型1",
  "fieldDataType": "Enum",
  "required": false
}
```

❌ **不应该包含的字段**:
- `term_days` (当期天数)
- `due_date` (到期日期 - 已改为expected_start_date)

---

## 3. 前端测试

### 3.1 启动前端服务
```bash
cd frontend
npm run dev
```

**启动成功提示**:
```
VITE v5.x.x  ready in xxx ms
➜  Local:   http://localhost:5173/
```

### 3.2 访问标准字段管理页面

#### 访问地址
```
http://localhost:5173/field-config/standard
```

#### 登录信息（如需要）
```
用户名: admin
密码: admin123
```

### 3.3 页面验证检查清单

#### ✅ 基础验证
- [ ] 页面正常加载，无报错
- [ ] 显示标题："案件列表标准字段管理（只读）"
- [ ] 显示提示："字段由CCO统一维护，所有甲方继承，仅支持查看"
- [ ] 表格显示 **23 条记录**

#### ✅ 字段内容验证

打开浏览器开发者工具（F12），查看表格内容：

**第11条记录**:
```
字段名称: 逾期期数
字段标识: overdue_installments
数据类型: Integer
必填: 是
来源: standard
说明: 当前逾期期数
```

**第12条记录**:
```
字段名称: 预期开始日期  ✅ (不是"到期日期")
字段标识: expected_start_date  ✅ (不是"due_date")
数据类型: Date
必填: 是
来源: standard
说明: 预期开始还款日期
```

**第13条记录**:
```
字段名称: 总期数  ✅ (不是"期数")
字段标识: total_installments
数据类型: Integer
必填: 是
来源: standard
说明: 贷款总期数
```

**第19-23条记录**: 案件类型1-5
```
19. 案件类型1 (case_type_1) - Enum - 否
20. 案件类型2 (case_type_2) - Enum - 否
21. 案件类型3 (case_type_3) - Enum - 否
22. 案件类型4 (case_type_4) - Enum - 否
23. 案件类型5 (case_type_5) - Enum - 否
```

#### ❌ 不应该出现的字段
- [ ] 不应该看到"当期天数" (`term_days`)
- [ ] 不应该看到"到期日期" (`due_date`)

---

## 4. 详细测试步骤

### 4.1 按序号逐条检查

在前端页面的表格中，按照序号逐条检查：

| # | 期望字段名称 | 期望字段标识 | 期望类型 | 期望必填 |
|---|-------------|-------------|---------|---------|
| 1 | 案件编号 | case_code | String | 是 |
| 2 | 用户id | user_id | String | 是 |
| 3 | 客户 | user_name | String | 是 |
| 4 | 手机号 | mobile_number | String | 是 |
| 5 | 首复借类型 | collection_type | Enum | 否 |
| 6 | 贷款金额 | loan_amount | Decimal | 是 |
| 7 | 未还金额 | outstanding_amount | Decimal | 是 |
| 8 | 减免金额 | waived_amount | Decimal | 否 |
| 9 | 逾期天数 | overdue_days | Integer | 是 |
| 10 | 案件状态 | case_status | Enum | 是 |
| **11** | **逾期期数** ⭐ | overdue_installments | Integer | 是 |
| **12** | **预期开始日期** ⭐ | expected_start_date | Date | 是 |
| **13** | **总期数** ⭐ | total_installments | Integer | 是 |
| 14 | 所属系统 | system_name | String | 是 |
| 15 | 产品 | product_name | String | 是 |
| 16 | APP | app_name | String | 是 |
| 17 | 商户 | merchant_name | String | 是 |
| 18 | 关联借款ID | loan_id | String | 是 |
| **19** | **案件类型1** ⭐ | case_type_1 | Enum | 否 |
| **20** | **案件类型2** ⭐ | case_type_2 | Enum | 否 |
| **21** | **案件类型3** ⭐ | case_type_3 | Enum | 否 |
| **22** | **案件类型4** ⭐ | case_type_4 | Enum | 否 |
| **23** | **案件类型5** ⭐ | case_type_5 | Enum | 否 |

⭐ 标记为本次更新的重点验证项

### 4.2 控制台日志检查

打开浏览器开发者工具（F12），切换到 Console 标签：

✅ **正常日志**:
```
[成功] 加载标准字段成功
[数据] 共23条记录
```

❌ **错误日志** (不应该出现):
```
加载标准字段失败
404 Not Found
500 Internal Server Error
```

### 4.3 网络请求检查

打开浏览器开发者工具（F12），切换到 Network 标签：

✅ **请求验证**:
```
请求URL: http://localhost:8080/api/v1/case-standard-fields/list
请求方法: GET
状态码: 200 OK
响应类型: application/json
```

✅ **响应数据验证**:
- 点击该请求
- 查看 Response 标签
- 确认返回数组包含 23 个元素
- 确认包含新增字段和重命名字段

---

## 5. 功能交互测试

### 5.1 页面操作测试
- [ ] 表格可以正常滚动
- [ ] 鼠标悬停在"说明"列可以看到完整内容（Tooltip）
- [ ] 页面无操作按钮（符合"只读"设计）

### 5.2 响应性测试
- [ ] 页面加载速度正常（< 2秒）
- [ ] 无白屏或闪烁
- [ ] 数据展示完整

---

## 6. 异常情况测试

### 6.1 后端服务未启动
**测试步骤**:
1. 停止后端服务
2. 刷新前端页面

**预期结果**:
- 显示错误提示："加载标准字段失败"
- 表格为空

### 6.2 网络请求超时
**测试步骤**:
1. 打开浏览器开发者工具
2. Network → Throttling → Slow 3G
3. 刷新页面

**预期结果**:
- 显示加载动画
- 最终加载成功或显示超时提示

---

## 7. 截图参考

### 7.1 正常页面截图位置
保存截图到以下路径以便归档：
```
/Users/zhangyang/Documents/GitHub/CollectionONE/assets/案件列表标准字段-优化后截图.png
```

### 7.2 截图要求
- 完整显示表格标题
- 至少显示前15条记录（包含新增的逾期期数、预期开始日期、总期数）
- 显示底部滚动条（证明有23条数据）

---

## 8. 问题排查

### 8.1 后端启动失败
**问题**: 端口8080已被占用

**解决方案**:
```bash
# 查找占用8080端口的进程
lsof -i :8080

# 停止该进程
kill <PID>

# 重新启动
./start.sh
```

### 8.2 前端无法访问后端
**问题**: CORS跨域错误或404错误

**解决方案**:
```bash
# 1. 确认后端已启动
lsof -i :8080

# 2. 确认前端配置正确
# 检查 frontend/src/config/api.ts 中的API_BASE_URL

# 3. 清除浏览器缓存
# Chrome: Ctrl+Shift+Delete → 清除缓存
```

### 8.3 数据不匹配
**问题**: 字段数量不对或字段名称错误

**解决方案**:
```bash
# 1. 确认代码已更新
git status
git diff backend-java/src/main/java/com/cco/support/CaseStandardFieldProvider.java

# 2. 重启后端服务
cd backend-java
./start.sh

# 3. 清除前端缓存并刷新
# Ctrl+Shift+R (硬刷新)
```

---

## 9. 测试完成标志

### 9.1 测试通过标准
- [x] 后端API返回23个字段
- [x] 前端页面显示23条记录
- [x] 新增字段正确显示（逾期期数、案件类型1-5）
- [x] 重命名字段正确显示（预期开始日期、总期数）
- [x] 删除字段不再显示（当期天数）
- [x] 无控制台错误
- [x] 页面响应正常

### 9.2 测试报告
测试完成后，填写以下表格：

```markdown
## 测试报告

- **测试人**: ___________
- **测试时间**: 2025-12-12
- **测试结果**: ✅ 通过 / ❌ 失败
- **字段数量**: 23 个（预期：23）
- **新增字段**: 全部显示 ✅
- **重命名字段**: 全部正确 ✅
- **删除字段**: 已移除 ✅
- **备注**: ___________
```

---

## 10. 测试后清理

### 10.1 停止服务
```bash
# 停止后端服务
# Ctrl+C (在运行 start.sh 的终端)

# 或强制停止
lsof -ti :8080 | xargs kill

# 停止前端服务
# Ctrl+C (在运行 npm run dev 的终端)
```

### 10.2 归档测试结果
- 保存测试截图
- 更新测试报告
- 提交代码变更

---

## 11. 参考链接

- [完成报告](./案件列表标准字段优化完成报告.md)
- [PRD文档](../../PRD需求文档/CCO管理控台/字段管理/案件列表字段管理/1-案件列表标准字段管理-PRD.md)
- [后端启动指南](../后端/Java后端Mock服务启动成功.md)

---

## 12. 快速测试命令汇总

```bash
# 1. 启动后端
cd backend-java && ./start.sh

# 2. 新开终端，测试API
curl http://localhost:8080/api/v1/case-standard-fields/list | jq '. | length'
# 预期输出: 23

# 3. 新开终端，启动前端
cd frontend && npm run dev

# 4. 浏览器访问
# http://localhost:5173/field-config/standard

# 5. 验证字段
# - 共23条记录
# - 包含：逾期期数、预期开始日期、总期数、案件类型1-5
# - 不包含：当期天数、到期日期
```

---

**测试愉快！如有问题，请参考问题排查章节。** ✅

