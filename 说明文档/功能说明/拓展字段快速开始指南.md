# 拓展字段快速开始指南

## 概述

本指南将帮助您快速了解和使用新添加的拓展字段功能。

## 新增的拓展字段

系统新增了3个拓展枚举字段，用于扩展客户行为和信用信息：

| 字段名称 | 字段Key | 枚举选项 | 用途 |
|---------|---------|---------|------|
| 通过政策 | approval_policy | 放松、收紧、正常 | 记录用户审批策略类型 |
| C卡标签 | c_card_label | A、B、C、D | 客户信用卡分类标签 |
| 是否投诉过 | complaint_status | 无、投诉过 | 记录客户投诉历史 |

## 快速验证

### 1. 验证数据库

```bash
cd backend
python3 verify_extended_fields.py
```

预期输出：
```
✅ 数据库: 通过
✅ API接口: 通过
🎉 所有验证通过！拓展字段功能正常工作！
```

### 2. 测试API接口

#### 获取拓展字段列表

```bash
curl http://localhost:8000/api/v1/tenants/1/extended-fields | python3 -m json.tool
```

#### 获取所有可用字段（包括拓展字段）

```bash
curl "http://localhost:8000/api/v1/field-display-configs/available-fields?tenant_id=1" | python3 -m json.tool
```

## 前端使用

### 1. 在字段展示配置中使用

#### 步骤 1: 进入配置页面

1. 登录管理控台
2. 在顶部选择器中选择甲方（如"甲方A"）
3. 点击左侧菜单 "字段配置" -> "字段展示配置"

#### 步骤 2: 选择场景

在页面顶部选择配置场景：
- 控台案件管理列表
- 催员案件列表
- 催员案件详情

#### 步骤 3: 添加拓展字段

1. 点击"添加字段"按钮
2. 在字段列表中，可以看到标记为 🟠 **扩展字段** 的选项
3. 选择需要的拓展字段：
   - 通过政策
   - C卡标签
   - 是否投诉过
4. 配置字段属性：
   - 排序顺序
   - 显示宽度
   - 颜色规则（可选）
   - 搜索/筛选设置
5. 点击"确定"保存

### 2. 查看拓展字段信息

#### 方式 1: 通过甲方自定义字段页面

1. 进入 "字段配置" -> "甲方自定义字段"
2. 点击"拓展字段"标签页
3. 查看所有拓展字段的详细信息

#### 方式 2: 通过字段展示配置

1. 在字段展示配置页面
2. 已添加的拓展字段会显示 🟠 标签
3. 点击编辑可查看和修改配置

## 字段识别

### 在前端界面中识别拓展字段

拓展字段具有以下特征：

1. **标签颜色**: 橙色（warning）
2. **标签文本**: "扩展字段"
3. **字段来源**: `field_source = "extended"`

### 与其他字段的区别

| 字段类型 | 标签颜色 | 标签文本 | 说明 |
|---------|---------|---------|------|
| 标准字段 | 绿色 | 标准字段 | 系统预定义的通用字段 |
| **拓展字段** | **橙色** | **扩展字段** | **系统提供的扩展功能字段** |
| 自定义字段 | 蓝色 | 自定义字段 | 甲方自行创建的字段 |
| 系统字段 | 红色 | 系统字段 | 系统内部使用的字段 |

## 使用场景示例

### 场景 1: 在催员案件列表中显示通过政策

1. 选择场景：催员案件列表
2. 添加字段：通过政策
3. 配置筛选：启用"是否可筛选"
4. 保存配置

催员在案件列表中可以：
- 看到每个案件的通过政策（放松/收紧/正常）
- 按通过政策进行筛选

### 场景 2: 在案件详情中显示C卡标签和投诉状态

1. 选择场景：催员案件详情
2. 添加字段：C卡标签、是否投诉过
3. 设置颜色规则（可选）：
   - C卡标签 = "D" 时显示红色
   - 是否投诉过 = "投诉过" 时显示黄色
4. 保存配置

催员在案件详情中可以：
- 查看客户的C卡分类
- 查看客户是否有投诉历史
- 根据颜色快速识别风险客户

### 场景 3: 在控台案件列表中设置范围检索

虽然这些是枚举字段，但可以配置筛选功能：

1. 选择场景：控台案件管理列表
2. 添加所有三个拓展字段
3. 启用"是否可筛选"
4. 保存配置

管理员可以：
- 按通过政策筛选案件
- 按C卡标签筛选客户
- 按投诉状态筛选案件

## API集成示例

### Python示例

```python
import requests

# 获取拓展字段
def get_extended_fields(tenant_id):
    url = f"http://localhost:8000/api/v1/tenants/{tenant_id}/extended-fields"
    response = requests.get(url)
    return response.json()

# 使用示例
extended_fields = get_extended_fields(1)
for field in extended_fields:
    print(f"{field['tenant_field_name']}: {field['field_type']}")
```

### JavaScript示例

```javascript
// 获取拓展字段
async function getExtendedFields(tenantId) {
  const response = await fetch(
    `http://localhost:8000/api/v1/tenants/${tenantId}/extended-fields`
  );
  return await response.json();
}

// 使用示例
const fields = await getExtendedFields(1);
fields.forEach(field => {
  console.log(`${field.tenant_field_name}: ${field.field_type}`);
});
```

## 数据格式说明

### 枚举值格式

拓展字段的枚举选项以字符串数组形式存储和返回：

```json
{
  "field_key": "approval_policy",
  "field_name": "通过政策",
  "field_type": "Enum",
  "enum_options": ["放松", "收紧", "正常"]
}
```

### 在案件数据中的使用

当在案件数据中使用这些字段时，值应该是枚举选项中的一个：

```json
{
  "case_id": "CASE001",
  "customer_name": "张三",
  "approval_policy": "正常",
  "c_card_label": "A",
  "complaint_status": "无"
}
```

## 常见问题

### Q1: 拓展字段和自定义字段有什么区别？

**A**: 
- **拓展字段**: 由系统提供，所有甲方共享，不可修改，只能启用/禁用
- **自定义字段**: 由甲方自己创建，只属于该甲方，可以完全自定义

### Q2: 如何添加更多的拓展字段？

**A**: 
1. 参考 `backend/add_extended_fields_direct.py` 脚本
2. 在脚本中定义新字段的属性
3. 运行脚本添加到数据库
4. 使用验证脚本确认

### Q3: 拓展字段的枚举选项可以修改吗？

**A**: 
可以，但需要通过数据库脚本修改。建议：
1. 备份数据库
2. 更新 `standard_fields` 表中的 `enum_options` 字段
3. 重启后端服务
4. 验证修改是否生效

### Q4: 拓展字段在所有场景都可用吗？

**A**: 
是的，拓展字段可以在以下所有场景中使用：
- 控台案件管理列表
- 催员案件列表
- 催员案件详情

## 相关文档

- [拓展字段添加完成报告](./拓展字段添加完成报告.md) - 详细的技术实现文档
- [字段配置功能PRD](../../CCO管理控台/字段配置功能PRD.md) - 字段配置系统完整文档

## 技术支持

如遇到问题，请：
1. 查看 [拓展字段添加完成报告](./拓展字段添加完成报告.md) 中的"注意事项"
2. 运行验证脚本检查系统状态
3. 查看后端服务日志

---

最后更新时间: 2024-11-20

