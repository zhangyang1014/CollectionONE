# åç«¯æœåŠ¡å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸš¨ å½“å‰é—®é¢˜æ€»ç»“

ç»è¿‡è¯¦ç»†æ’æŸ¥ï¼Œå‘ç°ä»¥ä¸‹é—®é¢˜ï¼š

### Pythonåç«¯é—®é¢˜
- âŒ ç¼ºå°‘ `python-jose` æ¨¡å—
- âŒ ä¾èµ–å®‰è£…ç¯å¢ƒé…ç½®å¤æ‚
- âŒ å¯åŠ¨å¤±è´¥ï¼ŒModuleNotFoundError

### Javaåç«¯é—®é¢˜
- âŒ CORSé…ç½®ä¾èµ–application.ymlå±æ€§
- âŒ MyBatisé…ç½®å¯¼è‡´å¯åŠ¨å¤±è´¥
- âŒ æ•°æ®åº“è¿æ¥é…ç½®ç¼ºå¤±
- âš ï¸ ç¼–è¯‘æˆåŠŸï¼Œä½†è¿è¡Œæ—¶é…ç½®é—®é¢˜å¯¼è‡´æ— æ³•å¯åŠ¨

## âœ… ä¸´æ—¶å¿«é€Ÿè§£å†³æ–¹æ¡ˆ

ç”±äºæ—¶é—´é™åˆ¶å’Œé…ç½®å¤æ‚åº¦ï¼Œæˆ‘å·²ç»ä¸ºä½ å‡†å¤‡äº†ä»¥ä¸‹æ–‡ä»¶ï¼š

### 1. Mockæƒé™æ§åˆ¶å™¨
ğŸ“„ `backend-java/src/main/java/com/cco/controller/MockPermissionController.java`
- æä¾›æ‰€æœ‰æƒé™ç®¡ç†APIçš„Mockæ•°æ®
- ä¸ä¾èµ–æ•°æ®åº“
- å®Œå…¨å…¼å®¹å‰ç«¯è¦æ±‚

### 2. Mockç”²æ–¹æ§åˆ¶å™¨  
ğŸ“„ `backend-java/src/main/java/com/cco/controller/MockTenantController.java`
- æä¾›ç”²æ–¹åˆ—è¡¨APIçš„Mockæ•°æ®
- æ”¯æŒ `/api/v1/tenants` æ¥å£
- æ”¯æŒé˜Ÿåˆ—ã€æœºæ„ç­‰å­æ¥å£

### 3. CORSé…ç½®ç®€åŒ–
ğŸ“„ `backend-java/src/main/java/com/cco/common/config/CorsConfig.java`
- ç§»é™¤äº†å¯¹é…ç½®æ–‡ä»¶çš„ä¾èµ–
- ä½¿ç”¨ç¡¬ç¼–ç å€¼

### 4. æ•°æ®åº“ä¾èµ–ç§»é™¤
ğŸ“„ `backend-java/src/main/java/com/cco/CcoApplication.java`
- å·²æ’é™¤DataSourceè‡ªåŠ¨é…ç½®
- å¯ä»¥æ— æ•°æ®åº“è¿è¡Œ

## ğŸ”§ æ‰‹åŠ¨å¯åŠ¨æ­¥éª¤

å¦‚æœä½ æƒ³æ‰‹åŠ¨å¯åŠ¨Javaåç«¯ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

### æ­¥éª¤1ï¼šç¡®è®¤Java 17ç¯å¢ƒ
```bash
export JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home
java -version  # åº”è¯¥æ˜¾ç¤º17.x.x
```

### æ­¥éª¤2ï¼šç¼–è¯‘é¡¹ç›®
```bash
cd /Users/zhangyang/Documents/GitHub/CollectionONE/backend-java
JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home \
mvn clean package -DskipTests
```

### æ­¥éª¤3ï¼šæ£€æŸ¥ç¼–è¯‘ç»“æœ
```bash
ls -lh target/cco-backend-1.0.0.jar
# åº”è¯¥çœ‹åˆ°çº¦30MBçš„jaræ–‡ä»¶
```

### æ­¥éª¤4ï¼šå¯åŠ¨æœåŠ¡ï¼ˆä½¿ç”¨8080ç«¯å£ï¼Œé¿å…å†²çªï¼‰
```bash
cd /Users/zhangyang/Documents/GitHub/CollectionONE/backend-java
JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home \
java -jar target/cco-backend-1.0.0.jar \
  --server.port=8080 \
  --logging.level.root=INFO \
  > backend-8080.log 2>&1 &

# è®°å½•PID
echo $! > backend.pid
```

### æ­¥éª¤5ï¼šç­‰å¾…å¯åŠ¨ï¼ˆçº¦15ç§’ï¼‰
```bash
sleep 15
tail -50 backend-8080.log
```

### æ­¥éª¤6ï¼šæµ‹è¯•API
```bash
# æµ‹è¯•ç”²æ–¹åˆ—è¡¨
curl http://localhost:8080/api/v1/tenants

# æµ‹è¯•æƒé™æ¨¡å—
curl http://localhost:8080/api/v1/permissions/modules

# æµ‹è¯•å¥åº·æ£€æŸ¥ï¼ˆå¦‚æœæœ‰ï¼‰
curl http://localhost:8080/actuator/health
```

### æ­¥éª¤7ï¼šä¿®æ”¹å‰ç«¯é…ç½®ï¼ˆå¦‚æœä½¿ç”¨8080ç«¯å£ï¼‰
ç¼–è¾‘ `frontend/src/utils/request.ts`ï¼š
```typescript
const service: AxiosInstance = axios.create({
  baseURL: 'http://localhost:8080',  // æ”¹ä¸º8080
  timeout: 15000,
  ...
})
```

## ğŸ› è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹å®Œæ•´å¯åŠ¨æ—¥å¿—
```bash
cat /Users/zhangyang/Documents/GitHub/CollectionONE/backend-java/backend-8080.log
```

### æ£€æŸ¥ç«¯å£å ç”¨
```bash
lsof -i:8080
lsof -i:8000
```

### æ€æ‰å ç”¨ç«¯å£çš„è¿›ç¨‹
```bash
# æ€æ‰8080ç«¯å£è¿›ç¨‹
kill -9 $(lsof -ti:8080)

# æ€æ‰8000ç«¯å£è¿›ç¨‹  
kill -9 $(lsof -ti:8000)
```

### æŸ¥çœ‹Javaè¿›ç¨‹
```bash
ps aux | grep "cco-backend"
```

### åœæ­¢Javaåç«¯
```bash
# ä½¿ç”¨ä¿å­˜çš„PID
kill $(cat /Users/zhangyang/Documents/GitHub/CollectionONE/backend-java/backend.pid)

# æˆ–å¼ºåˆ¶æ€æ‰æ‰€æœ‰
pkill -f "cco-backend"
```

## âš ï¸ å·²çŸ¥é—®é¢˜

1. **CORSé…ç½®**ï¼šå¦‚æœè¿˜æœ‰CORSé”™è¯¯ï¼Œæ£€æŸ¥CorsConfig.javaä¸­çš„allowedOriginsæ˜¯å¦åŒ…å«å‰ç«¯åœ°å€
2. **MyBatisé”™è¯¯**ï¼šå·²é€šè¿‡æ’é™¤DataSourceè§£å†³ï¼Œä½†å¦‚æœè¿˜æœ‰é”™è¯¯ï¼Œéœ€è¦å®Œå…¨ç§»é™¤MyBatisä¾èµ–
3. **Spring Security**ï¼šå¯èƒ½éœ€è¦ç¦ç”¨æˆ–é…ç½®permitAll

## ğŸ“ ä¸‹ä¸€æ­¥è®¡åˆ’

è¦å®Œæ•´æ¢å¤åç«¯åŠŸèƒ½ï¼Œéœ€è¦ï¼š

1. **é…ç½®MySQLæ•°æ®åº“**
   ```sql
   CREATE DATABASE cco_system CHARACTER SET utf8mb4;
   ```

2. **æ‰§è¡Œå»ºè¡¨è„šæœ¬**
   ```bash
   mysql -uroot -p cco_system < backend-java/src/main/resources/db/migration/schema.sql
   ```

3. **æ›´æ–°æ•°æ®åº“å¯†ç **
   ç¼–è¾‘ `backend-java/src/main/resources/application-dev.yml`

4. **é‡æ–°å¯ç”¨MyBatis**
   ç§»é™¤CcoApplicationä¸­çš„DataSourceæ’é™¤é…ç½®

5. **æ›¿æ¢Mockæ§åˆ¶å™¨ä¸ºçœŸå®æ§åˆ¶å™¨**
   å¯ç”¨PermissionControllerå’ŒTenantController

## ğŸ¯ æ¨èæ–¹æ¡ˆ

è€ƒè™‘åˆ°å½“å‰çš„å¤æ‚åº¦ï¼Œæˆ‘å»ºè®®ï¼š

### çŸ­æœŸï¼ˆç«‹å³å¯ç”¨ï¼‰
ä½¿ç”¨å·²åˆ›å»ºçš„Mockæ§åˆ¶å™¨ï¼Œæ— éœ€æ•°æ®åº“ï¼Œæä¾›åŸºæœ¬çš„å‰ç«¯å¼€å‘æ”¯æŒ

### ä¸­æœŸï¼ˆ1-2å¤©ï¼‰  
é…ç½®MySQLæ•°æ®åº“ï¼Œå¯¼å…¥æµ‹è¯•æ•°æ®ï¼Œå¯ç”¨çœŸå®çš„æ•°æ®æŸ¥è¯¢

### é•¿æœŸï¼ˆ1å‘¨ï¼‰
å®Œæ•´è¿ç§»æ‰€æœ‰åŠŸèƒ½åˆ°Javaåç«¯ï¼ŒåŒ…æ‹¬ï¼š
- æƒé™ç®¡ç†
- ç”²æ–¹ç®¡ç†
- æ¡ˆä»¶ç®¡ç†
- å‚¬æ”¶åŠŸèƒ½
- ç­‰ç­‰...

---

**åˆ›å»ºæ—¶é—´**ï¼š2025-11-22
**çŠ¶æ€**ï¼šå¾…æ‰‹åŠ¨å¯åŠ¨éªŒè¯

