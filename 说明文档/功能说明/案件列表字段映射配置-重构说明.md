# 案件列表字段映射配置 - 重构说明

## 📋 重构概述

基于PRD需求文档，完成了"案件列表字段映射配置"页面的全面重构，实现了版本管理、智能匹配、枚举值映射等核心功能。

## 🎯 重构内容

### 1. 主页面重构 (`FieldMappingConfig.vue`)

#### ✅ 新增功能
- **版本信息显示栏**：展示当前甲方字段版本号、上传时间、字段数、上传人
- **版本管理按钮**：快速进入版本管理面板
- **未映射字段警告**：顶部红色警告提示未处理的甲方字段数量
- **筛选和搜索**：支持按匹配状态筛选、关键词搜索
- **改进的字段映射表格**：更清晰的状态标识、操作按钮

#### 🎨 UI优化
- 更现代化的卡片式布局
- 清晰的颜色标识（绿色=已自动映射，蓝色=已手动映射，灰色=未映射）
- 响应式设计，支持移动端

### 2. 新增子组件

#### 2.1 自动匹配建议弹窗 (`AutoMatchSuggestDialog.vue`)

**功能**：
- 显示智能匹配结果，包含相似度、匹配方式、置信度
- 分级展示：高置信度（≥80%）、中置信度（60-80%）
- 支持批量确认或选择性确认
- 显示未匹配的必填字段

**特色**：
- 可视化的映射关系展示（左右箭头对比）
- 进度条显示相似度
- 智能建议标识

#### 2.2 枚举值映射配置弹窗 (`EnumMappingDialog.vue`)

**功能**：
- 枚举类型字段的值映射配置
- 智能匹配枚举值（按value和label）
- 一对一映射验证
- 显示未使用的甲方枚举值

**特色**：
- 网格式布局，清晰的对应关系
- 实时验证是否所有标准枚举值都已映射
- 防止重复映射

#### 2.3 拓展字段编辑弹窗 (`ExtendedFieldDialog.vue`)

**功能**：
- 添加/编辑拓展字段
- 字段别名规范验证（小写字母、数字、下划线）
- 隐私标签配置（PII/敏感/公开）
- 字段分组选择

**特色**：
- 表单验证规则
- 隐私级别提示
- 用户友好的输入提示

#### 2.4 匹配到目标字段弹窗 (`MatchToTargetDialog.vue`)

**功能**：
- 将未使用的甲方字段匹配到标准字段
- 显示甲方字段完整信息
- 类型兼容性检查
- 智能提示类型匹配情况

**特色**：
- 类型匹配/不匹配的视觉提示
- 仅显示未映射的标准字段
- 防止类型不兼容的映射

#### 2.5 版本管理抽屉 (`VersionManagerDrawer.vue`)

**功能**：
- 查看所有历史版本
- 版本详情查看
- 版本切换（设为当前版本）
- 版本对比（显示新增/删除/修改字段）
- 下载任意版本的JSON文件

**特色**：
- 大屏抽屉式设计
- 完整的版本对比功能
- 变更摘要统计
- 可视化的差异展示

### 3. API接口文件 (`field-mapping.ts`)

新增完整的API接口定义：
- 字段映射配置接口（获取、保存、删除、自动匹配、批量确认）
- 拓展字段管理接口（增删改查）
- 未使用字段接口
- 甲方字段版本管理接口（上传、历史记录、版本详情、版本对比、版本切换、下载）

## 📁 文件结构

```
frontend/src/
├── views/field-config/
│   ├── FieldMappingConfig.vue              # 主页面（新）
│   ├── CustomFields.vue                    # 旧页面（保留）
│   └── components/                         # 子组件目录（新）
│       ├── AutoMatchSuggestDialog.vue      # 自动匹配建议弹窗
│       ├── EnumMappingDialog.vue           # 枚举值映射配置弹窗
│       ├── ExtendedFieldDialog.vue         # 拓展字段编辑弹窗
│       ├── MatchToTargetDialog.vue         # 匹配到目标字段弹窗
│       └── VersionManagerDrawer.vue        # 版本管理抽屉
└── api/
    └── field-mapping.ts                    # API接口（新）
```

## 🔄 数据流程

### 字段映射配置流程

```
1. 页面加载
   ↓
2. 加载甲方字段版本信息（当前生效版本）
   ↓
3. 加载标准字段列表（15个）
   ↓
4. 加载未映射字段列表
   ↓
5. 用户操作：
   - 手动选择甲方字段映射
   - 一键智能匹配
   - 配置枚举值映射
   - 处理未使用字段
   ↓
6. 保存映射关系
   ↓
7. 刷新数据
```

### 版本管理流程

```
1. 点击"版本管理"按钮
   ↓
2. 打开版本管理抽屉
   ↓
3. 显示版本历史列表
   ↓
4. 用户操作：
   - 查看版本详情
   - 下载历史版本
   - 版本对比
   - 切换到历史版本
   ↓
5. 版本切换后刷新页面数据
```

## 🚀 使用方法

### 1. 查看当前版本信息

页面顶部蓝色区域显示当前使用的甲方字段版本信息。

### 2. 配置字段映射

**方式一：手动映射**
1. 在表格中找到未映射的标准字段（灰色标签）
2. 点击"甲方字段"下拉选择框
3. 选择对应的甲方字段
4. 自动保存

**方式二：智能匹配**
1. 点击"一键建议映射未匹配字段"按钮
2. 查看匹配建议弹窗
3. 勾选要应用的映射
4. 点击"确认选中项"或"确认全部"

### 3. 配置枚举值映射

1. 找到Enum类型的已映射字段
2. 点击"枚举值"列的"配置枚举映射"按钮
3. 在弹窗中选择每个标准枚举值对应的甲方枚举值
4. 可点击"智能匹配"按钮自动匹配
5. 确保所有标准枚举值都已映射
6. 点击"保存"

### 4. 处理未使用的甲方字段

切换到"未使用的甲方字段"Tab：

**方式一：匹配到标准字段**
1. 点击"匹配到目标字段"按钮
2. 选择对应的标准字段
3. 确认类型兼容性
4. 点击"确定"

**方式二：创建拓展字段**
1. 点击"设为拓展字段"按钮
2. 填写拓展字段信息
3. 选择隐私标签
4. 点击"保存"

### 5. 版本管理

1. 点击页面右上角"版本管理"按钮
2. 在抽屉中查看历史版本列表
3. 可进行以下操作：
   - **查看详情**：查看该版本的字段列表
   - **下载JSON**：下载该版本的JSON文件
   - **设为当前版本**：切换到该版本（需二次确认）
   - **版本对比**：与当前版本对比，查看差异

### 6. 版本对比

1. 在版本管理抽屉中点击"版本对比"
2. 查看变更摘要（新增/删除/修改数量）
3. 查看详细对比：
   - 绿色：新增字段
   - 红色：删除字段
   - 橙色：修改字段（显示具体变更内容）
4. 可导出对比报告

## ⚙️ 配置说明

### 环境变量

确保 `.env` 文件中配置了正确的API地址：

```bash
VITE_API_BASE_URL=http://localhost:8080
```

### 路由配置

已更新路由配置，访问路径：
```
/field-config/custom
```

菜单名称：**案件列表字段映射配置**

## 🐛 已知问题

1. **API接口未实现**：后端API接口需要按照 `field-mapping.ts` 的定义实现
2. **Mock数据**：部分功能使用Mock数据，待后端接口完成后替换
3. **权限控制**：待集成用户权限系统

## 📝 TODO

- [ ] 后端实现所有API接口
- [ ] 集成用户权限系统
- [ ] 添加单元测试
- [ ] 添加E2E测试
- [ ] 性能优化（大数据量场景）
- [ ] 国际化支持

## 🔗 相关文档

- [PRD需求文档](../../../PRD需求文档/CCO管理控台/字段管理/3-案件列表字段映射配置-PRD.md)
- [API接口文档](./API接口文档-字段映射配置.md)
- [组件使用文档](./组件使用文档-字段映射配置.md)

## 📞 联系方式

如有问题，请联系开发团队。

---

**文档版本**：v1.0.0  
**创建日期**：2025-12-08  
**最后更新**：2025-12-08  
**维护人**：前端开发团队
