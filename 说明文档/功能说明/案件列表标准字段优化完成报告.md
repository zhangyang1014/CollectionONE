# 案件列表标准字段优化完成报告

## 版本记录

| 版本号 | 日期 | 变更内容 | 变更人 |
|--------|------|----------|--------|
| 1.0.0 | 2025-12-12 | 完成案件列表标准字段优化：重命名2个字段、删除1个字段、新增6个字段 | 大象 |

---

## 1. 更新概述

根据PRD需求文档 `1-案件列表标准字段管理-PRD.md` v1.1.0 版本，对案件列表标准字段进行了以下优化：

### 1.1 字段重命名（2个）
- **到期日期** → **预期开始日期**
  - 字段标识：`due_date` → `expected_start_date`
  - 字段描述：应还款日期 → 预期开始还款日期
  
- **期数** → **总期数**
  - 字段标识保持：`total_installments`
  - 字段描述：期数 → 贷款总期数

### 1.2 删除字段（1个）
- ❌ **当期天数** (`term_days`) - 已移除

### 1.3 新增字段（6个）

#### 1) 逾期期数（必填）
- **字段标识**: `overdue_installments`
- **字段名称**: 逾期期数
- **数据类型**: Integer
- **是否必填**: 是
- **排序位置**: 11（在"案件状态"后面）
- **说明**: 当前逾期期数

#### 2-6) 案件类型1-5（选填）
- **字段标识**: `case_type_1` ~ `case_type_5`
- **字段名称**: 案件类型1 ~ 案件类型5
- **数据类型**: Enum（枚举）
- **是否必填**: 否
- **排序位置**: 19-23（在"关联借款ID"后面）
- **说明**: 案件分类类型1-5

---

## 2. 代码修改明细

### 2.1 后端Java代码

#### 文件路径
```
/backend-java/src/main/java/com/cco/support/CaseStandardFieldProvider.java
```

#### 修改内容

##### ✅ buildCaseListFields() 方法
- **删除**: `term_days` 字段（ID 13）
- **重命名**: 
  - `due_date` → `expected_start_date` (ID 12)
  - `total_installments` 字段名称更新为 "总期数" (ID 13)
- **新增**:
  - `overdue_installments` (ID 11) - 逾期期数
  - `loan_id` (ID 18) - 关联借款ID
  - `case_type_1` (ID 19) - 案件类型1
  - `case_type_2` (ID 20) - 案件类型2
  - `case_type_3` (ID 21) - 案件类型3
  - `case_type_4` (ID 22) - 案件类型4
  - `case_type_5` (ID 23) - 案件类型5

##### ✅ buildCaseDetailFields() 方法
同步更新案件详情字段数组，保持与案件列表字段的一致性。

---

## 3. 字段清单对比

### 3.1 优化前（v1.0.0 - 15个字段）

| # | 字段标识 | 字段名称 | 类型 | 必填 |
|---|----------|----------|------|------|
| 1 | case_code | 案件编号 | String | 是 |
| 2 | user_id | 用户id | String | 是 |
| 3 | user_name | 客户 | String | 是 |
| 4 | mobile_number | 手机号 | String | 是 |
| 5 | collection_type | 首复借类型 | Enum | 否 |
| 6 | loan_amount | 贷款金额 | Decimal | 是 |
| 7 | outstanding_amount | 未还金额 | Decimal | 是 |
| 8 | waived_amount | 减免金额 | Decimal | 否 |
| 9 | overdue_days | 逾期天数 | Integer | 是 |
| 10 | case_status | 案件状态 | Enum | 是 |
| 11 | ~~due_date~~ | ~~到期日期~~ | Date | 是 |
| 12 | total_installments | ~~期数~~ | Integer | 是 |
| 13 | ~~term_days~~ | ~~当期天数~~ | Integer | 是 |
| 14 | system_name | 所属系统 | String | 是 |
| 15 | product_name | 产品 | String | 是 |

### 3.2 优化后（v1.1.0 - 23个字段）

| # | 字段标识 | 字段名称 | 类型 | 必填 | 变更 |
|---|----------|----------|------|------|------|
| 1 | case_code | 案件编号 | String | 是 | - |
| 2 | user_id | 用户id | String | 是 | - |
| 3 | user_name | 客户 | String | 是 | - |
| 4 | mobile_number | 手机号 | String | 是 | - |
| 5 | collection_type | 首复借类型 | Enum | 否 | - |
| 6 | loan_amount | 贷款金额 | Decimal | 是 | - |
| 7 | outstanding_amount | 未还金额 | Decimal | 是 | - |
| 8 | waived_amount | 减免金额 | Decimal | 否 | - |
| 9 | overdue_days | 逾期天数 | Integer | 是 | - |
| 10 | case_status | 案件状态 | Enum | 是 | - |
| 11 | **overdue_installments** | **逾期期数** | Integer | 是 | **新增** |
| 12 | **expected_start_date** | **预期开始日期** | Date | 是 | **重命名** |
| 13 | total_installments | **总期数** | Integer | 是 | **重命名** |
| 14 | system_name | 所属系统 | String | 是 | - |
| 15 | product_name | 产品 | String | 是 | - |
| 16 | app_name | APP | String | 是 | - |
| 17 | merchant_name | 商户 | String | 是 | - |
| 18 | loan_id | 关联借款ID | String | 是 | - |
| 19 | **case_type_1** | **案件类型1** | Enum | 否 | **新增** |
| 20 | **case_type_2** | **案件类型2** | Enum | 否 | **新增** |
| 21 | **case_type_3** | **案件类型3** | Enum | 否 | **新增** |
| 22 | **case_type_4** | **案件类型4** | Enum | 否 | **新增** |
| 23 | **case_type_5** | **案件类型5** | Enum | 否 | **新增** |

---

## 4. 前端展示

### 4.1 访问路径
```
控台管理 → 字段配置 → 案件列表标准字段管理
路由: /field-config/standard
```

### 4.2 前端组件
- **文件**: `/frontend/src/views/field-config/StandardFields.vue`
- **接口**: `getCaseListStandardFields()` - 从后端获取标准字段列表

### 4.3 展示效果
前端页面会自动展示最新的 23 个标准字段，包括：
- ✅ 逾期期数（新增）
- ✅ 预期开始日期（重命名）
- ✅ 总期数（重命名）
- ✅ 案件类型1-5（新增）
- ❌ 当期天数（已移除）

---

## 5. 测试验证

### 5.1 后端测试
```bash
# 启动Java后端
cd backend-java
./start.sh

# 访问API接口
curl http://localhost:8080/api/v1/case-standard-fields/list
```

**预期结果**:
- 返回 23 个标准字段
- 包含 `overdue_installments`, `expected_start_date`, `case_type_1-5`
- 不包含 `term_days`, `due_date`

### 5.2 前端测试
1. 启动前端服务
   ```bash
   cd frontend
   npm run dev
   ```

2. 访问页面
   ```
   http://localhost:5173/field-config/standard
   ```

3. 验证点
   - ✅ 显示 23 条记录
   - ✅ 第11条: 逾期期数 (overdue_installments)
   - ✅ 第12条: 预期开始日期 (expected_start_date)
   - ✅ 第13条: 总期数 (total_installments)
   - ✅ 第19-23条: 案件类型1-5 (case_type_1-5)
   - ✅ 无"当期天数"字段
   - ✅ 无"到期日期"字段（已改为"预期开始日期"）

---

## 6. 数据库说明

### 6.1 当前Mock模式
- 当前系统运行在 **Mock模式**，不使用数据库
- 标准字段数据由 `CaseStandardFieldProvider.java` 直接提供
- 数据持久化在代码中，重启后保持一致

### 6.2 未来数据库集成
如需将字段数据存储到数据库，可执行以下步骤：
1. 将 `CaseStandardFieldProvider` 的数据导出为SQL
2. 更新 `init_standard_fields.sql` 文件
3. 修改 Controller 从数据库读取数据

---

## 7. 影响范围

### 7.1 直接影响
- ✅ 控台"案件列表标准字段管理"页面
- ✅ 字段映射配置相关功能
- ✅ 案件列表字段展示配置

### 7.2 无影响
- ✅ 案件详情字段管理（独立配置）
- ✅ 甲方自定义字段
- ✅ 历史数据（仅影响新数据展示）

---

## 8. 注意事项

### 8.1 字段重命名影响
- 前端已有代码如使用 `due_date` 需更新为 `expected_start_date`
- API响应中字段标识已变更

### 8.2 删除字段影响
- `term_days` 字段已完全移除
- 依赖该字段的逻辑需要调整或删除

### 8.3 新增字段
- 案件类型1-5为 **选填字段**，可为空
- 建议甲方根据业务需求配置枚举值

---

## 9. 后续优化建议

### 9.1 功能增强
1. **案件类型枚举配置**: 为案件类型1-5提供可配置的枚举值管理
2. **字段关联规则**: 建立字段之间的关联关系（如逾期期数 = 总期数 - 已还期数）
3. **字段验证规则**: 添加字段值的合法性校验

### 9.2 性能优化
1. 标准字段数据缓存（当前已在静态变量中缓存）
2. 字段变更通知机制

---

## 10. 参考文档

- [PRD需求文档 v1.1.0](../../PRD需求文档/CCO管理控台/字段管理/案件列表字段管理/1-案件列表标准字段管理-PRD.md)
- [后端架构说明](../后端/Java后端Mock服务启动成功.md)
- [字段管理手册](../../文档/功能说明/字段管理/案件列表字段管理手册.md)

---

## 11. 完成检查清单

- [x] PRD文档更新（v1.1.0）
- [x] Java后端代码修改（CaseStandardFieldProvider.java）
- [x] 字段重命名（2个）
- [x] 字段删除（1个）
- [x] 字段新增（6个）
- [x] 案件详情字段同步更新
- [x] 完成报告文档编写
- [ ] 后端服务重启测试
- [ ] 前端页面展示测试
- [ ] 字段映射功能测试
- [ ] 文档归档

---

## 12. 更新时间
- **代码修改时间**: 2025-12-12
- **文档编写时间**: 2025-12-12
- **更新人**: 大象

---

**本次优化完成，案件列表标准字段从 15 个增加到 23 个，满足业务需求！** ✅

