# æ¡ˆä»¶åˆ—è¡¨æ ‡å‡†å­—æ®µæ–°å¢ - æµ‹è¯•æŒ‡å—

## å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | å˜æ›´äºº |
|------|------|----------|--------|
| 1.0.0 | 2025-12-11 | åˆ›å»ºæµ‹è¯•æŒ‡å— | å¤§è±¡ |

## æµ‹è¯•å‡†å¤‡

### 1. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd /Users/zhangyang/Documents/GitHub/CollectionONE/backend-java

# ä½¿ç”¨ Java 17 å¯åŠ¨
JAVA_HOME=/opt/homebrew/opt/openjdk@17 \
PATH=/opt/homebrew/opt/openjdk@17/bin:$PATH \
mvn spring-boot:run -Dspring-boot.run.profiles=dev
```

æˆ–è€…ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼š

```bash
cd /Users/zhangyang/Documents/GitHub/CollectionONE/backend-java
./start.sh
```

### 2. å¯åŠ¨å‰ç«¯æœåŠ¡

```bash
cd /Users/zhangyang/Documents/GitHub/CollectionONE/frontend
npm run dev
```

## æµ‹è¯•æ­¥éª¤

### æµ‹è¯•1ï¼šAPIæ¥å£æµ‹è¯•

#### 1.1 æµ‹è¯•æ¡ˆä»¶åˆ—è¡¨æ ‡å‡†å­—æ®µæ¥å£

```bash
# æ–¹æ³•1: ä½¿ç”¨ curl
curl http://localhost:8080/api/v1/standard-fields/case-list | jq

# æ–¹æ³•2: ä½¿ç”¨æµè§ˆå™¨è®¿é—®
# æ‰“å¼€: http://localhost:8080/api/v1/standard-fields/case-list
```

#### 1.2 é¢„æœŸè¿”å›ç»“æœ

è¿”å›çš„ JSON åº”åŒ…å« 19 ä¸ªå­—æ®µï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºï¼š

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "fieldKey": "case_code",
      "fieldName": "æ¡ˆä»¶ç¼–å·",
      "fieldDataType": "String",
      "required": true,
      "sortOrder": 1
    },
    {
      "id": 2,
      "fieldKey": "user_id",
      "fieldName": "ç”¨æˆ·id",
      "fieldDataType": "String",
      "required": true,
      "sortOrder": 2
    },
    {
      "id": 3,
      "fieldKey": "user_name",
      "fieldName": "å®¢æˆ·",
      "fieldDataType": "String",
      "required": true,
      "sortOrder": 3
    },
    // ... æ›´å¤šå­—æ®µ ...
    {
      "id": 18,
      "fieldKey": "settlement_time",
      "fieldName": "ç»“æ¸…æ—¶é—´",
      "fieldDataType": "Datetime",
      "required": false,
      "sortOrder": 18
    },
    {
      "id": 19,
      "fieldKey": "settlement_method",
      "fieldName": "ç»“æ¸…æ–¹å¼",
      "fieldDataType": "Enum",
      "required": false,
      "sortOrder": 19
    }
  ]
}
```

#### 1.3 éªŒè¯è¦ç‚¹

- [ ] è¿”å›çŠ¶æ€ç ä¸º 200
- [ ] data æ•°ç»„åŒ…å« 19 ä¸ªå…ƒç´ 
- [ ] æ–°å¢å­—æ®µçš„ fieldKey æ­£ç¡®ï¼š
  - `user_id` (id=2)
  - `collection_type` (id=5)
  - `waived_amount` (id=8)
  - `settlement_time` (id=18)
  - `settlement_method` (id=19)
- [ ] æ–°å¢å­—æ®µçš„ required å±æ€§æ­£ç¡®ï¼š
  - `user_id`: true (å¿…å¡«)
  - `collection_type`: false (é€‰å¡«)
  - `waived_amount`: false (é€‰å¡«)
  - `settlement_time`: false (é€‰å¡«)
  - `settlement_method`: false (é€‰å¡«)
- [ ] sortOrder é¡ºåºæ­£ç¡®ï¼ˆ1-19ï¼‰

### æµ‹è¯•2ï¼šå‰ç«¯é¡µé¢æµ‹è¯•

#### 2.1 è®¿é—®æ ‡å‡†å­—æ®µç®¡ç†é¡µé¢

1. æ‰“å¼€æµè§ˆå™¨è®¿é—®: `http://localhost:5173`
2. ç™»å½•ç³»ç»Ÿï¼ˆå¦‚éœ€è¦ï¼‰
3. å¯¼èˆªåˆ°ï¼š**å­—æ®µé…ç½®ç®¡ç† -> æ¡ˆä»¶åˆ—è¡¨å­—æ®µ -> æ ‡å‡†å­—æ®µç®¡ç†**
4. æˆ–ç›´æ¥è®¿é—®: `http://localhost:5173/field-config/standard`

#### 2.2 éªŒè¯è¡¨æ ¼æ˜¾ç¤º

æ£€æŸ¥é¡µé¢è¡¨æ ¼ä¸­çš„å­—æ®µï¼š

- [ ] è¡¨æ ¼å…±æ˜¾ç¤º 19 è¡Œæ•°æ®
- [ ] ç¬¬2è¡Œæ˜¾ç¤º"ç”¨æˆ·id"ï¼ˆå¿…å¡«ï¼šæ˜¯ï¼‰
- [ ] ç¬¬5è¡Œæ˜¾ç¤º"é¦–å¤å€Ÿç±»å‹"ï¼ˆå¿…å¡«ï¼šå¦ï¼‰
- [ ] ç¬¬8è¡Œæ˜¾ç¤º"å‡å…é‡‘é¢"ï¼ˆå¿…å¡«ï¼šå¦ï¼‰
- [ ] ç¬¬18è¡Œæ˜¾ç¤º"ç»“æ¸…æ—¶é—´"ï¼ˆå¿…å¡«ï¼šå¦ï¼‰
- [ ] ç¬¬19è¡Œæ˜¾ç¤º"ç»“æ¸…æ–¹å¼"ï¼ˆå¿…å¡«ï¼šå¦ï¼‰

#### 2.3 éªŒè¯å­—æ®µè¯¦æƒ…

ç‚¹å‡»æŸ¥çœ‹æ¯ä¸ªæ–°å¢å­—æ®µçš„è¯¦ç»†ä¿¡æ¯ï¼š

**ç”¨æˆ·id:**
- å­—æ®µæ ‡è¯†: `user_id`
- æ•°æ®ç±»å‹: `String`
- æ¥æº: `standard`
- è¯´æ˜: `ç³»ç»Ÿå†…éƒ¨å”¯ä¸€ç”¨æˆ·æ ‡è¯†`

**é¦–å¤å€Ÿç±»å‹:**
- å­—æ®µæ ‡è¯†: `collection_type`
- æ•°æ®ç±»å‹: `Enum`
- æ¥æº: `standard`
- è¯´æ˜: `æ ‡è®°æ¡ˆä»¶æ˜¯å¦ä¸ºé¦–æ¬¡æˆ–å†æ¬¡å‚¬æ”¶`

**å‡å…é‡‘é¢:**
- å­—æ®µæ ‡è¯†: `waived_amount`
- æ•°æ®ç±»å‹: `Decimal`
- æ¥æº: `standard`
- è¯´æ˜: `è´¹ç”¨å‡å…é‡‘é¢`

**ç»“æ¸…æ—¶é—´:**
- å­—æ®µæ ‡è¯†: `settlement_time`
- æ•°æ®ç±»å‹: `Datetime`
- æ¥æº: `standard`
- è¯´æ˜: `æœ€åä¸€æ¬¡ç»“æ¸…æ“ä½œæ—¶é—´`

**ç»“æ¸…æ–¹å¼:**
- å­—æ®µæ ‡è¯†: `settlement_method`
- æ•°æ®ç±»å‹: `Enum`
- æ¥æº: `standard`
- è¯´æ˜: `æœ€ç»ˆè¿˜æ¬¾æ–¹å¼`

### æµ‹è¯•3ï¼šCSVæŸ¥çœ‹åŠŸèƒ½æµ‹è¯•

#### 3.1 è®¿é—®CSVæŸ¥çœ‹é¡µé¢

1. å¯¼èˆªåˆ°ï¼š**å­—æ®µé…ç½®ç®¡ç† -> æ¡ˆä»¶è¯¦æƒ…å­—æ®µ -> æ ‡å‡†å­—æ®µæŸ¥çœ‹ï¼ˆCSVï¼‰**
2. æˆ–ç›´æ¥è®¿é—®: `http://localhost:5173/field-config/detail/standard-csv`

#### 3.2 éªŒè¯å­—æ®µå­˜åœ¨

- [ ] åœ¨"å…¨éƒ¨"æˆ–ç›¸å…³åˆ†ç»„ä¸­èƒ½æœç´¢åˆ°"ç”¨æˆ·id"
- [ ] åœ¨"å†å²å€Ÿæ¬¾è®°å½•"åˆ†ç»„ä¸­èƒ½æ‰¾åˆ°"é¦–å¤å€Ÿç±»å‹"
- [ ] åœ¨ç›¸å…³åˆ†ç»„ä¸­èƒ½æ‰¾åˆ°"å‡å…é‡‘é¢"
- [ ] åœ¨"å†å²å€Ÿæ¬¾è®°å½•"åˆ†ç»„ä¸­èƒ½æ‰¾åˆ°"ç»“æ¸…æ—¶é—´"
- [ ] åœ¨"å†å²å€Ÿæ¬¾è®°å½•"åˆ†ç»„ä¸­èƒ½æ‰¾åˆ°"ç»“æ¸…æ–¹å¼"

#### 3.3 æœç´¢æµ‹è¯•

ä½¿ç”¨æœç´¢æ¡†æµ‹è¯•ï¼š

1. è¾“å…¥"ç”¨æˆ·id" - åº”æ˜¾ç¤ºç›¸å…³å­—æ®µ
2. è¾“å…¥"user_id" - åº”æ˜¾ç¤ºç›¸å…³å­—æ®µ
3. è¾“å…¥"é¦–å¤å€Ÿ" - åº”æ˜¾ç¤º"é¦–å¤å€Ÿç±»å‹"å­—æ®µ
4. è¾“å…¥"å‡å…" - åº”æ˜¾ç¤º"å‡å…é‡‘é¢"å­—æ®µ
5. è¾“å…¥"ç»“æ¸…" - åº”æ˜¾ç¤º"ç»“æ¸…æ—¶é—´"å’Œ"ç»“æ¸…æ–¹å¼"å­—æ®µ

### æµ‹è¯•4ï¼šæ¡ˆä»¶è¯¦æƒ…æ ‡å‡†å­—æ®µæµ‹è¯•

#### 4.1 æµ‹è¯•API

```bash
curl http://localhost:8080/api/v1/standard-fields/case-detail | jq
```

#### 4.2 éªŒè¯è¿”å›ç»“æœ

- [ ] data æ•°ç»„åŒ…å« 19 ä¸ªå…ƒç´ 
- [ ] æ¯ä¸ªå­—æ®µçš„ fieldKey éƒ½æœ‰ `detail_` å‰ç¼€
- [ ] æ–°å¢å­—æ®µéƒ½åŒ…å«åœ¨å†…ï¼š
  - `detail_user_id`
  - `detail_collection_type`
  - `detail_waived_amount`
  - `detail_settlement_time`
  - `detail_settlement_method`

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: APIè¿”å›404

**åŸå› **: åç«¯æœåŠ¡æœªå¯åŠ¨æˆ–ç«¯å£é”™è¯¯

**è§£å†³**:
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8080

# é‡æ–°å¯åŠ¨åç«¯
cd backend-java && ./start.sh
```

### é—®é¢˜2: å‰ç«¯æ˜¾ç¤ºå­—æ®µæ•°é‡ä¸å¯¹

**åŸå› **: æµè§ˆå™¨ç¼“å­˜æˆ–å‰ç«¯æœåŠ¡æœªé‡å¯

**è§£å†³**:
```bash
# æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
# Chrome: Ctrl/Cmd + Shift + R

# é‡å¯å‰ç«¯æœåŠ¡
cd frontend
npm run dev
```

### é—®é¢˜3: ç¼–è¯‘é”™è¯¯

**åŸå› **: Javaç‰ˆæœ¬ä¸å¯¹

**è§£å†³**:
```bash
# ç¡®è®¤ä½¿ç”¨ Java 17
java -version

# è®¾ç½®æ­£ç¡®çš„ JAVA_HOME
export JAVA_HOME=/opt/homebrew/opt/openjdk@17
export PATH=$JAVA_HOME/bin:$PATH
```

### é—®é¢˜4: å­—æ®µé¡ºåºä¸å¯¹

**åŸå› **: sortOrder è®¾ç½®é”™è¯¯

**è§£å†³**: æ£€æŸ¥ `CaseStandardFieldProvider.java` ä¸­çš„ sortOrder å€¼æ˜¯å¦è¿ç»­ä¸”æ­£ç¡®

## æ€§èƒ½æµ‹è¯•

### å“åº”æ—¶é—´æµ‹è¯•

```bash
# æµ‹è¯•APIå“åº”æ—¶é—´
time curl http://localhost:8080/api/v1/standard-fields/case-list

# é¢„æœŸå“åº”æ—¶é—´: < 100ms
```

### å¹¶å‘æµ‹è¯•

ä½¿ç”¨ Apache Bench è¿›è¡Œå¹¶å‘æµ‹è¯•ï¼š

```bash
# å®‰è£… ab (å¦‚æœæ²¡æœ‰)
brew install apache-bench

# 100ä¸ªå¹¶å‘ï¼Œå…±1000æ¬¡è¯·æ±‚
ab -n 1000 -c 100 http://localhost:8080/api/v1/standard-fields/case-list
```

## è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

åˆ›å»ºæµ‹è¯•è„šæœ¬ `test-fields.sh`:

```bash
#!/bin/bash

echo "ğŸ§ª å¼€å§‹æµ‹è¯•æ¡ˆä»¶åˆ—è¡¨æ ‡å‡†å­—æ®µ..."

# æµ‹è¯•åç«¯API
echo ""
echo "ğŸ“¡ æµ‹è¯•åç«¯API..."
response=$(curl -s http://localhost:8080/api/v1/standard-fields/case-list)
count=$(echo $response | jq '.data | length')

if [ "$count" -eq 19 ]; then
    echo "âœ… å­—æ®µæ•°é‡æ­£ç¡®: $count"
else
    echo "âŒ å­—æ®µæ•°é‡é”™è¯¯: é¢„æœŸ19ï¼Œå®é™…$count"
    exit 1
fi

# æ£€æŸ¥æ–°å¢å­—æ®µ
echo ""
echo "ğŸ” æ£€æŸ¥æ–°å¢å­—æ®µ..."
fields=("user_id" "collection_type" "waived_amount" "settlement_time" "settlement_method")

for field in "${fields[@]}"; do
    exists=$(echo $response | jq ".data[] | select(.fieldKey==\"$field\") | .fieldKey" -r)
    if [ "$exists" == "$field" ]; then
        echo "âœ… å­—æ®µå­˜åœ¨: $field"
    else
        echo "âŒ å­—æ®µç¼ºå¤±: $field"
        exit 1
    fi
done

echo ""
echo "ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼"
```

è¿è¡Œæµ‹è¯•ï¼š

```bash
chmod +x test-fields.sh
./test-fields.sh
```

## å›å½’æµ‹è¯•

### æ£€æŸ¥åŸæœ‰åŠŸèƒ½

- [ ] åŸæœ‰14ä¸ªå­—æ®µä»ç„¶å­˜åœ¨
- [ ] åŸæœ‰å­—æ®µçš„å±æ€§æœªæ”¹å˜
- [ ] å­—æ®µé¡ºåºç¬¦åˆé¢„æœŸ
- [ ] å…¶ä»–APIæ¥å£æ­£å¸¸å·¥ä½œ

### æ•°æ®å…¼å®¹æ€§

- [ ] ä¸å½±å“ç°æœ‰æ•°æ®çš„è¯»å–
- [ ] æ–°å­—æ®µå…è®¸ä¸ºç©ºï¼ˆé€‰å¡«å­—æ®µï¼‰
- [ ] å¿…å¡«å­—æ®µæœ‰åˆç†çš„é»˜è®¤å€¼æˆ–éªŒè¯

## æµ‹è¯•æ€»ç»“

å®Œæˆä»¥ä¸Šæ‰€æœ‰æµ‹è¯•åï¼Œè¯·å¡«å†™æµ‹è¯•æŠ¥å‘Šï¼š

### æµ‹è¯•ç¯å¢ƒ
- Javaç‰ˆæœ¬: ___________
- Mavenç‰ˆæœ¬: ___________
- Nodeç‰ˆæœ¬: ___________
- æµè§ˆå™¨: ___________

### æµ‹è¯•ç»“æœ
- [ ] APIæ¥å£æµ‹è¯•é€šè¿‡
- [ ] å‰ç«¯é¡µé¢æµ‹è¯•é€šè¿‡
- [ ] CSVæŸ¥çœ‹åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ¡ˆä»¶è¯¦æƒ…å­—æ®µæµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] å›å½’æµ‹è¯•é€šè¿‡

### å‘ç°çš„é—®é¢˜
_ï¼ˆå¦‚æœ‰é—®é¢˜ï¼Œè¯·åœ¨æ­¤è®°å½•ï¼‰_

### æµ‹è¯•äººå‘˜
- å§“å: ___________
- æ—¥æœŸ: ___________

## ç›¸å…³æ–‡æ¡£

- [æ¡ˆä»¶åˆ—è¡¨æ ‡å‡†å­—æ®µæ–°å¢è¯´æ˜](./æ¡ˆä»¶åˆ—è¡¨æ ‡å‡†å­—æ®µæ–°å¢è¯´æ˜.md)
- [å¿«é€Ÿå¯åŠ¨Javaåç«¯](../../å¿«é€Ÿå¯åŠ¨Javaåç«¯.md)
- [å‰ç«¯APIè°ƒç”¨è§„åˆ™](.cursor/rules/frontend-api.mdc)
