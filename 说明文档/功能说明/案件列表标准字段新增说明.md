# 案件列表标准字段新增说明

## 变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|----------|--------|
| 1.0.0 | 2025-12-11 | 案件列表标准字段新增5个字段 | 大象 |

## 概述

在"标准字段管理"的案件列表标准字段中新增了5个字段，以满足业务需求。这些字段包括必填字段和选填字段，按照业务逻辑合理排序。

## 新增字段详情

### 1. 用户id（必填）

- **字段标识**: `user_id`
- **字段名称**: 用户id
- **数据类型**: String
- **是否必填**: 是
- **位置**: 放在"客户"字段前（第2位）
- **说明**: 系统内部唯一用户标识
- **显示宽度**: 120px

### 2. 首复借类型（选填）

- **字段标识**: `collection_type`
- **字段名称**: 首复借类型
- **数据类型**: Enum
- **是否必填**: 否
- **位置**: 放在"贷款金额"字段前（第5位）
- **说明**: 标记案件是否为首次或再次催收
- **枚举值**: ['首催', '复催']
- **显示宽度**: 120px

### 3. 减免金额（选填）

- **字段标识**: `waived_amount`
- **字段名称**: 减免金额
- **数据类型**: Decimal
- **是否必填**: 否
- **位置**: 放在"未还金额"字段后（第8位）
- **说明**: 费用减免金额
- **显示宽度**: 120px

### 4. 结清时间（选填）

- **字段标识**: `settlement_time`
- **字段名称**: 结清时间
- **数据类型**: Datetime
- **是否必填**: 否
- **位置**: 在最后（第18位）
- **说明**: 最后一次结清操作时间
- **显示宽度**: 160px

### 5. 结清方式（选填）

- **字段标识**: `settlement_method`
- **字段名称**: 结清方式
- **数据类型**: Enum
- **是否必填**: 否
- **位置**: 放在"结清时间"后（第19位）
- **说明**: 最终还款方式
- **枚举值**: ['自动扣款', '手动转账', '第三方收款']
- **显示宽度**: 140px

## 完整字段顺序

更新后的案件列表标准字段顺序如下：

1. 案件编号 (case_code) - 必填
2. **用户id (user_id) - 必填** ⭐新增
3. 客户 (user_name) - 必填
4. 手机号 (mobile_number) - 必填
5. **首复借类型 (collection_type) - 选填** ⭐新增
6. 贷款金额 (loan_amount) - 必填
7. 未还金额 (outstanding_amount) - 必填
8. **减免金额 (waived_amount) - 选填** ⭐新增
9. 逾期天数 (overdue_days) - 必填
10. 案件状态 (case_status) - 必填
11. 到期日期 (due_date) - 必填
12. 期数 (total_installments) - 必填
13. 当期天数 (term_days) - 必填
14. 所属系统 (system_name) - 必填
15. 产品 (product_name) - 必填
16. APP (app_name) - 必填
17. 商户 (merchant_name) - 必填
18. **结清时间 (settlement_time) - 选填** ⭐新增
19. **结清方式 (settlement_method) - 选填** ⭐新增

## 修改的文件

### 后端文件

#### 1. `CaseStandardFieldProvider.java`

**文件路径**: `/backend-java/src/main/java/com/cco/support/CaseStandardFieldProvider.java`

**修改内容**:
- 在 `buildCaseListFields()` 方法中新增5个字段定义
- 在 `buildCaseDetailFields()` 方法中同步更新字段数组，包含新增字段

### 前端文件

#### 2. `standardFieldsFromCSV.ts`

**文件路径**: `/frontend/src/data/standardFieldsFromCSV.ts`

**修改内容**:
- 将"首复催类型"字段名修改为"首复借类型"，保持与后端一致

## 技术说明

### 数据类型说明

- **String**: 字符串类型，用于存储文本信息
- **Decimal**: 小数类型，用于存储金额等需要精确计算的数值
- **Enum**: 枚举类型，有固定的选项值
- **Datetime**: 日期时间类型，包含年月日时分秒

### 必填与选填

- **必填字段**: `required: true` - 数据导入时必须提供该字段值
- **选填字段**: `required: false` - 数据导入时该字段可以为空

### 字段来源

所有新增字段的 `fieldSource` 均为 `"standard"`，表示这是系统标准字段，由CCO统一维护。

## 业务影响

1. **数据完整性**: 新增的"用户id"作为必填字段，确保每个案件都能关联到具体用户
2. **业务分类**: "首复借类型"字段帮助区分首次催收和复借催收案件
3. **财务管理**: "减免金额"字段用于记录优惠和减免信息
4. **案件状态**: "结清时间"和"结清方式"字段完善了案件的结清信息追踪

## 数据迁移

### 现有数据处理

对于已存在的案件数据：

1. **用户id (user_id)**: 必填字段，需要从现有用户信息中填充
2. **首复借类型 (collection_type)**: 选填字段，可为空，后续根据业务规则填充
3. **减免金额 (waived_amount)**: 选填字段，可为空或填充为 0
4. **结清时间 (settlement_time)**: 选填字段，对于已结清案件需要填充实际结清时间
5. **结清方式 (settlement_method)**: 选填字段，对于已结清案件需要填充结清方式

### 新增数据要求

新导入的案件数据必须包含：
- 必填字段: `user_id` - 不能为空
- 其他必填字段: 保持原有要求

## 测试建议

### 功能测试

1. **字段显示测试**
   - 访问"标准字段管理"页面
   - 验证新增字段是否按正确顺序显示
   - 验证必填/选填标识是否正确

2. **数据类型测试**
   - 验证字段数据类型显示是否正确
   - 验证枚举类型的选项值是否正确

3. **字段说明测试**
   - 验证每个字段的说明文字是否准确
   - 验证字段宽度是否合适

### API测试

```bash
# 获取案件列表标准字段
curl http://localhost:8080/api/v1/standard-fields/case-list

# 预期返回包含19个字段的JSON数组
```

### 前端测试

1. 访问路由: `/field-config/standard`
2. 检查表格中字段数量是否为19个
3. 检查新增字段的位置、名称、类型是否正确

## 注意事项

1. **只读模式**: 标准字段为统一定义，前端和后端均为只读模式，不支持编辑
2. **字段顺序**: 字段顺序由 `sortOrder` 控制，修改时需要重新调整后续字段的序号
3. **版本同步**: 前端和后端的字段定义必须保持一致
4. **文档更新**: 修改标准字段后需要同步更新相关文档

## 相关文档

- [标准字段查看功能说明](./标准字段CSV查看功能说明.md)
- [案件列表标准字段管理说明](./案件列表标准字段管理说明.md)
- [字段配置管理说明](./字段配置管理说明.md)

## FAQ

### Q1: 为什么"用户id"是必填字段？
A: 用户id是关联用户信息的关键字段，每个案件必须有对应的用户，因此设置为必填。

### Q2: "首复借类型"和"是否复借"有什么区别？
A: "首复借类型"用于标记催收类型（首催/复催），"是否复借"标记用户是否为老客复借，两者关注点不同。

### Q3: "减免金额"字段为什么是选填？
A: 不是所有案件都有减免，因此设置为选填。未减免的案件该字段可以为空或为0。

### Q4: 如何修改字段顺序？
A: 标准字段为只读模式，需要修改后端代码中的 `sortOrder` 值，然后重新部署。

## 总结

本次更新为案件列表标准字段新增了5个字段，其中1个必填字段（用户id）和4个选填字段（首复借类型、减免金额、结清时间、结清方式）。这些字段的新增使得案件信息更加完整，有助于更好地进行案件管理和数据分析。

所有修改已完成，可以启动后端服务进行测试。
