# Cursor 浏览器摄像头权限解决方案

## 📋 问题描述

在 Cursor 的浏览器工具中访问前端登录页面时，无法获得摄像头权限，导致人脸识别功能无法使用。

**错误提示**: "无法访问摄像头，请检查权限设置"

---

## 🎯 解决方案

### 方案1: 浏览器权限设置（推荐）⭐

#### Chrome/Edge 浏览器

1. **在地址栏左侧点击锁图标**（或信息图标）
2. 找到 **"摄像头"** 权限设置
3. 选择 **"允许"**
4. 刷新页面

#### Safari 浏览器

1. **Safari** → **偏好设置** → **网站**
2. 选择 **"摄像头"**
3. 找到 `localhost:5173`
4. 设置为 **"允许"**

#### Firefox 浏览器

1. 在地址栏左侧点击 **"权限"** 图标
2. 找到 **"使用摄像头"**
3. 选择 **"允许"**

---

### 方案2: 使用系统默认浏览器（最简单）⭐

Cursor 的浏览器工具可能对权限有限制，建议使用系统默认浏览器：

```bash
# 在终端中打开
open http://localhost:5173
```

或使用脚本：

```bash
./scripts/open-frontend.sh
```

**优势**:
- ✅ 完整的浏览器权限支持
- ✅ 更好的摄像头兼容性
- ✅ 可以使用 BrowserTools MCP 进行调试

---

### 方案3: 代码增强 - 上传图片替代摄像头

代码已支持开发测试模式，允许跳过人脸识别。我们还可以添加图片上传功能作为备选方案。

**当前状态**: 代码已支持跳过人脸识别，可以直接登录。

---

### 方案4: 使用模拟登录（开发测试）

在 URL 中添加参数，自动填充并登录：

```
http://localhost:5173/im/login?simulate=true&tenantId=1&collectorId=BTQ001
```

**测试账号**:
- **机构ID**: 1
- **催员ID**: BTQ001
- **密码**: 123456

---

## 🔧 代码层面的优化

### 当前代码已支持的功能

1. ✅ **开发测试模式**: 人脸识别失败不影响登录
2. ✅ **错误处理**: 优雅降级，允许跳过人脸识别
3. ✅ **模拟登录**: 支持 URL 参数自动登录

### 建议的增强

#### 1. 添加图片上传功能

允许用户上传图片而不是使用摄像头：

```vue
<!-- 添加图片上传选项 -->
<el-upload
  v-if="!showCamera && !capturedImage"
  :auto-upload="false"
  :on-change="handleImageUpload"
  accept="image/*"
>
  <el-button type="primary">上传照片</el-button>
</el-upload>
```

#### 2. 检测浏览器环境

检测是否在 Cursor 浏览器工具中，自动切换到图片上传模式：

```typescript
// 检测是否在受限环境中
const isRestrictedEnvironment = () => {
  // 检测 BrowserTools 或其他受限环境
  return navigator.userAgent.includes('Cursor') || 
         !navigator.mediaDevices?.getUserMedia
}
```

#### 3. 提供降级方案

如果无法访问摄像头，自动显示图片上传选项。

---

## 🚀 快速解决步骤

### 立即解决（推荐）

1. **使用系统默认浏览器**:
   ```bash
   open http://localhost:5173
   ```

2. **在浏览器中设置权限**:
   - 点击地址栏左侧的锁图标
   - 允许摄像头权限
   - 刷新页面

3. **如果仍然无法使用摄像头**:
   - 代码已支持跳过人脸识别
   - 直接填写表单并登录即可
   - 人脸识别是可选的（开发测试模式）

---

## 📝 浏览器权限检查清单

### Chrome/Edge

- [ ] 地址栏显示锁图标或信息图标
- [ ] 点击后看到"摄像头"权限
- [ ] 设置为"允许"
- [ ] 刷新页面

### Safari

- [ ] Safari → 偏好设置 → 网站 → 摄像头
- [ ] 找到 `localhost:5173`
- [ ] 设置为"允许"

### Firefox

- [ ] 地址栏左侧点击权限图标
- [ ] 找到"使用摄像头"
- [ ] 设置为"允许"

---

## 🔍 故障排查

### 问题1: 浏览器提示"无法访问摄像头"

**可能原因**:
1. 权限被拒绝
2. 浏览器不支持 `getUserMedia`
3. 不在 HTTPS 或 localhost 环境中

**解决**:
1. 检查浏览器权限设置
2. 确认访问的是 `localhost:5173`（不是 IP 地址）
3. 使用系统默认浏览器而不是 Cursor 内置浏览器

### 问题2: 权限已允许但仍无法使用

**可能原因**:
1. 摄像头被其他应用占用
2. 系统权限未授予

**解决**:
1. 关闭其他使用摄像头的应用
2. 检查系统设置中的摄像头权限（macOS: 系统偏好设置 → 安全性与隐私 → 摄像头）

### 问题3: Cursor 浏览器工具限制

**解决**:
- 使用系统默认浏览器（推荐）
- 或使用代码中的降级方案（跳过人脸识别）

---

## 💡 最佳实践

### 开发环境

1. **使用系统默认浏览器**进行测试
2. **允许浏览器权限**以便测试完整功能
3. **使用模拟登录**快速测试其他功能

### 生产环境

1. **确保 HTTPS**（摄像头 API 要求）
2. **提供清晰的权限提示**
3. **提供降级方案**（图片上传）

---

## 📚 相关文档

- [前端服务启动说明](../说明文档/部署/开发环境运行指南.md)
- [在Cursor中打开浏览器调试](./在Cursor中打开浏览器调试.md)
- [催员登录人脸识别功能说明](../说明文档/前端/CCO-IM端登录系统实现说明.md)

---

## ✅ 快速检查

运行以下命令检查前端服务：

```bash
# 检查前端服务
lsof -i :5173

# 打开浏览器
open http://localhost:5173
```

---

**创建时间**: 2025-11-22  
**状态**: ✅ 已提供多种解决方案

---

**推荐方案**: 使用系统默认浏览器 + 允许摄像头权限 🚀

