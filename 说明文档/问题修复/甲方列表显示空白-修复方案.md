# 甲方列表显示空白 - 修复方案

## 问题描述

甲方管理页面打开后，列表中的字段显示为空白，包括：
- 甲方名称
- 甲方编码
- 国家代码
- 其他字段

## 问题原因

后端正在从MySQL数据库读取真实数据，但数据库中 `tenants` 表是空的或者缺少 `default_language` 字段。

## 解决方案

### 方案一：执行快速初始化脚本（推荐）

1. **进入后端目录**：
   ```bash
   cd backend-java
   ```

2. **执行初始化脚本**：
   ```bash
   ./quick-init-tenants.sh
   ```

3. **如果遇到权限问题**：
   ```bash
   chmod +x quick-init-tenants.sh
   ./quick-init-tenants.sh
   ```

4. **刷新浏览器**查看甲方列表

### 方案二：手动执行SQL（如果脚本执行失败）

1. **连接MySQL数据库**：
   ```bash
   mysql -u root -p cco_dev
   ```

2. **执行以下SQL**：

```sql
-- 1. 添加 default_language 字段（如果不存在）
ALTER TABLE tenants 
ADD COLUMN IF NOT EXISTS default_language VARCHAR(10) COMMENT '默认语言（Locale）';

-- 2. 插入Mock甲方数据
INSERT INTO tenants (
    id, 
    tenant_code, 
    tenant_name, 
    tenant_name_en, 
    country_code, 
    timezone, 
    currency_code, 
    default_language,
    is_active, 
    created_at, 
    updated_at
) VALUES
(1, 'BTQ', '百腾企业', 'Baiteng Enterprise', 'MX', 'America/Mexico_City', 'MXN', 'es-MX', 1, NOW(), NOW()),
(2, 'BTSK', 'BTSK机构', 'BTSK Organization', 'CN', 'Asia/Shanghai', 'CNY', 'zh-CN', 1, NOW(), NOW()),
(3, 'DEMO', '演示甲方', 'Demo Tenant', 'US', 'America/New_York', 'USD', 'en-US', 1, NOW(), NOW())
ON DUPLICATE KEY UPDATE 
    tenant_name = VALUES(tenant_name),
    tenant_name_en = VALUES(tenant_name_en),
    country_code = VALUES(country_code),
    timezone = VALUES(timezone),
    currency_code = VALUES(currency_code),
    default_language = VALUES(default_language),
    is_active = VALUES(is_active),
    updated_at = NOW();

-- 3. 查看结果
SELECT * FROM tenants;
```

3. **退出MySQL并刷新浏览器**

### 方案三：临时使用Mock数据（开发环境）

如果你在开发环境中不想依赖数据库，可以修改后端代码临时返回Mock数据。

## 初始化后的数据

执行初始化后，你将看到以下3个Mock甲方：

| ID | 甲方编码 | 甲方名称 | 国家 | 时区 | 货币 | 默认语言 |
|----|---------|---------|------|------|------|----------|
| 1  | BTQ     | 百腾企业 | MX   | America/Mexico_City | MXN  | es-MX    |
| 2  | BTSK    | BTSK机构 | CN   | Asia/Shanghai | CNY  | zh-CN    |
| 3  | DEMO    | 演示甲方 | US   | America/New_York | USD  | en-US    |

## 验证步骤

1. 打开浏览器，访问控台
2. 点击左侧菜单 "甲方管理" → "甲方列表"
3. 应该看到3条Mock甲方数据
4. 点击"添加甲方"测试创建功能

## 相关文件

- 初始化脚本：`backend-java/quick-init-tenants.sh`
- SQL文件：`backend-java/src/main/resources/db/data/init_tenants_mock_data.sql`
- 数据库迁移：`backend-java/src/main/resources/db/migration/V20251204_001__add_tenant_default_language.sql`

## 常见问题

### Q1: 执行脚本时提示"数据库不存在"

**A**: 请先创建数据库：
```bash
mysql -u root -p -e "CREATE DATABASE IF NOT EXISTS cco_dev CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
```

### Q2: 提示"表 tenants 不存在"

**A**: 请先运行数据库迁移脚本创建表结构：
```bash
cd backend-java
# 使用Flyway或手动执行建表SQL
```

### Q3: 数据插入成功但前端还是显示空白

**A**: 请检查：
1. 后端服务是否正常运行（端口8080）
2. 浏览器控制台是否有错误
3. 清除浏览器缓存并刷新

### Q4: 字段名不匹配问题

**A**: 检查 `tenants` 表的字段名是否使用下划线命名（snake_case）：
- ✅ `tenant_code`, `tenant_name`, `country_code`
- ❌ `tenantCode`, `tenantName`, `countryCode`

## 下一步

数据初始化完成后，你可以：
1. 测试创建新甲方
2. 测试编辑甲方信息
3. 测试默认语言选择功能
4. 为甲方添加更多配置

---

**创建时间**：2025-12-04  
**问题状态**：✅ 有解决方案  
**优先级**：P0（影响核心功能）

