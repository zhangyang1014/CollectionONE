# 权利账号管理功能实现说明

## 📋 功能概述

权利账号管理用于管理小组内的特殊权限账号，包括小组长、质检员、统计员等角色。这些账号拥有比普通催员更高的权限，用于管理和监督催收工作。

## 🎯 功能特点

### 1. 字段信息

| 字段名 | 说明 | 是否必填 |
|-------|------|---------|
| **账号ID** | 账号的唯一标识 | 是 |
| **账号名** | 账号的显示名称 | 是 |
| **登录ID** | 用于登录系统的账号 | 是 |
| **所属甲方** | 该账号隶属的甲方 | 是（继承全局） |
| **所属机构** | 该账号隶属的机构 | 是 |
| **所属小组** | 该账号隶属的小组 | 是 |
| **角色** | 账号角色类型 | 是 |
| **创建时间** | 账号创建时间 | 自动 |
| **最近修改时间** | 最后修改时间 | 自动 |
| **状态** | 启用/禁用状态 | - |

### 2. 角色类型

| 角色 | 说明 | 权限范围 |
|-----|------|---------|
| **小组长** | 管理整个小组的催收工作 | 小组管理、案件分配、催员监督 |
| **质检员** | 负责催收质量检查 | 质量检查、通话录音审核、投诉处理 |
| **统计员** | 负责数据统计和分析 | 数据报表、业绩统计、指标分析 |

### 3. 交互功能

- ✅ **创建账号**：填写所有必填字段，选择角色
- ✅ **编辑账号**：修改账号信息（登录ID不可改）
- ✅ **删除账号**：删除权利账号（需确认）
- ✅ **启用/禁用**：控制账号的可用状态
- ✅ **修改密码**：单独修改登录密码

## 💻 技术实现

### 前端页面

**文件：** `frontend/src/views/organization/AdminAccountManagement.vue`

**特点：**
- 三级联动筛选（甲方→机构→小组）
- 角色标签可视化（不同角色不同颜色）
- 密码管理（创建时设置，后续可修改）
- 完整的CRUD操作

**关键代码：**

```vue
<!-- 角色选择 -->
<el-form-item label="角色" prop="role">
  <el-select v-model="form.role" placeholder="选择角色">
    <el-option label="小组长" value="team_leader" />
    <el-option label="质检员" value="quality_inspector" />
    <el-option label="统计员" value="statistician" />
  </el-select>
</el-form-item>

<!-- 角色标签显示 -->
<el-table-column prop="role" label="角色" width="100">
  <template #default="{ row }">
    <el-tag :type="getRoleType(row.role)">
      {{ getRoleName(row.role) }}
    </el-tag>
  </template>
</el-table-column>
```

**角色映射函数：**
```typescript
// 角色名称映射
const getRoleName = (role: string) => {
  const roleMap: Record<string, string> = {
    'team_leader': '小组长',
    'quality_inspector': '质检员',
    'statistician': '统计员'
  }
  return roleMap[role] || role
}

// 角色标签类型
const getRoleType = (role: string) => {
  const typeMap: Record<string, string> = {
    'team_leader': 'warning',      // 橙色
    'quality_inspector': 'success', // 绿色
    'statistician': 'info'          // 蓝色
  }
  return typeMap[role] || ''
}
```

### 后端Mock API

**文件：** `backend/simple_server.py`

**API端点：** `GET /api/v1/teams/{team_id}/admin-accounts`

**Mock数据：**
```python
def get_default_admin_accounts(team_id):
    """获取小组的默认权利账号配置"""
    return [
        {
            "account_code": f"ADMIN{team_id:05d}_001",
            "account_name": "小组长001",
            "login_id": f"teamleader{team_id}_001",
            "role": "team_leader",
            # ...
        },
        {
            "account_code": f"ADMIN{team_id:05d}_002",
            "account_name": "质检员001",
            "login_id": f"qc{team_id}_001",
            "role": "quality_inspector",
            # ...
        },
        {
            "account_code": f"ADMIN{team_id:05d}_003",
            "account_name": "统计员001",
            "login_id": f"stat{team_id}_001",
            "role": "statistician",
            # ...
        }
    ]
```

### 路由配置

**文件：** `frontend/src/router/index.ts`

```typescript
{
  path: 'organization/admin-accounts',
  name: 'AdminAccountManagement',
  component: () => import('@/views/organization/AdminAccountManagement.vue'),
  meta: { title: '权利账号管理' },
}
```

### 菜单配置

**文件：** `frontend/src/layouts/MainLayout.vue`

```vue
<el-menu-item index="/organization/admin-accounts">
  {{ $t('menu.adminAccountManagement') }}
</el-menu-item>
```

**位置：** 在小组管理和催员管理之间

## 📍 菜单位置

```
🏢 甲方管理
  ├── 甲方列表
  ├── 案件队列管理
  ├── 机构管理
  ├── 小组管理
  ├── 权利账号管理       ← ✅ 新增（在催员管理上面）
  └── 催员管理
```

## 🎨 界面展示

### 列表页面

```
┌────────────────────────────────────────────────────────────────────┐
│  权利账号管理  [选择机构▼] [选择小组▼]  [创建账号]                │
├────────────────────────────────────────────────────────────────────┤
│ 账号ID│账号名 │登录ID │所属甲方│所属机构│所属小组│角色│状态│操作│
├───────┼──────┼───────┼───────┼───────┼───────┼────┼────┼──────┤
│ A001  │小组长001│teamleader│甲方A│机构A│一组│[小组长]│启用│编辑 改密 禁用 删除│
│ A002  │质检员001│qc001    │甲方A│机构A│一组│[质检员]│启用│编辑 改密 禁用 删除│
│ A003  │统计员001│stat001  │甲方A│机构A│一组│[统计员]│启用│编辑 改密 禁用 删除│
└────────────────────────────────────────────────────────────────────┘
```

### 创建对话框

```
┌─────────────────────────────────────────┐
│  创建账号                                │
├─────────────────────────────────────────┤
│  账号编码：  [ADMIN001______________]   │
│  账号名：    [小组长张三____________]   │
│  登录ID：    [teamleader001_________]   │
│  登录密码：  [••••••••______________]   │
│  所属机构：  [机构A ▼]                  │
│  所属小组：  [催收一组 ▼]              │
│  角色：      [小组长 ▼]                 │
│              ├─ 小组长                   │
│              ├─ 质检员                   │
│              └─ 统计员                   │
│  手机号：    [13800138000__________]    │
│  邮箱：      [leader@example.com___]    │
│  备注：      [__________________]        │
│  是否启用：  [√]                        │
│                                         │
│                   [取消]  [保存]        │
└─────────────────────────────────────────┘
```

## 🧪 使用流程

### 场景1：创建小组长账号

**步骤：**
1. 在右上角选择甲方
2. 进入"权利账号管理"
3. 选择机构和小组
4. 点击"创建账号"
5. 填写信息：
   - 账号编码：LEADER001
   - 账号名：张三
   - 登录ID：zhangsan_leader
   - 密码：123456（最少6位）
   - 角色：选择"小组长"
6. 保存

**结果：** 创建成功，角色标签显示为橙色"小组长"

### 场景2：修改质检员密码

**步骤：**
1. 找到质检员账号
2. 点击"修改密码"
3. 输入新密码：newpass123
4. 确认密码：newpass123
5. 保存

**结果：** 密码修改成功

### 场景3：禁用统计员账号

**步骤：**
1. 找到统计员账号
2. 点击"禁用"
3. 确认操作

**结果：** 账号状态变为"禁用"，该账号无法登录

## 📊 与催员管理的区别

| 特性 | 权利账号管理 | 催员管理 |
|-----|------------|---------|
| **角色** | 小组长、质检员、统计员 | 催员 |
| **权限** | 管理、监督、分析 | 催收执行 |
| **数量** | 每小组2-5个 | 每小组10-50个 |
| **职责** | 管理层 | 执行层 |
| **功能** | 监督、审核、统计 | 案件催收、客户联系 |

## 📁 文件清单

### 前端
- ✅ `frontend/src/views/organization/AdminAccountManagement.vue` - 权利账号管理页面
- ✅ `frontend/src/router/index.ts` - 路由配置
- ✅ `frontend/src/layouts/MainLayout.vue` - 菜单配置
- ✅ `frontend/src/i18n/locales/zh-CN.ts` - 中文翻译
- ✅ `frontend/src/i18n/locales/en.ts` - 英文翻译

### 后端
- ✅ `backend/simple_server.py` - Mock API

### 文档
- ✅ `权利账号管理功能实现说明.md` - 本文档

## 🔍 API测试

### 测试命令
```bash
curl http://localhost:8000/api/v1/teams/100101/admin-accounts
```

### 预期结果
```json
{
  "data": [
    {
      "account_name": "小组长001",
      "role": "team_leader",
      "login_id": "teamleader100101_001"
    },
    {
      "account_name": "质检员001",
      "role": "quality_inspector",
      "login_id": "qc100101_001"
    },
    {
      "account_name": "统计员001",
      "role": "statistician",
      "login_id": "stat100101_001"
    }
  ]
}
```

**实际测试结果：** ✅ 通过

```
权利账号数量: 3
  - 小组长001 (team_leader, teamleader100101_001)
  - 质检员001 (quality_inspector, qc100101_001)
  - 统计员001 (statistician, stat100101_001)
```

## ✅ 验证清单

功能测试完成后，请确认：

**基本功能：**
- [ ] 能选择机构和小组
- [ ] 能创建权利账号
- [ ] 能编辑账号信息
- [ ] 能修改密码
- [ ] 能启用/禁用账号
- [ ] 能删除账号

**角色功能：**
- [ ] 角色选择正常（小组长、质检员、统计员）
- [ ] 角色标签颜色正确显示
- [ ] 角色名称正确映射

**联动功能：**
- [ ] 全局甲方选择生效
- [ ] 机构切换后小组自动更新
- [ ] 甲方切换后数据自动清空

**数据验证：**
- [ ] 登录ID不可重复
- [ ] 密码最少6位
- [ ] 所有必填字段验证正确

**全部通过 ✅ = 功能实现成功！**

## ⚠️ 注意事项

### 1. 账号唯一性
- 登录ID在全系统范围内必须唯一
- 创建后登录ID不可修改

### 2. 权限控制
- 权利账号拥有比普通催员更高的权限
- 应严格控制权利账号的数量

### 3. 密码安全
- 密码必须至少6位
- 建议定期修改密码
- 支持单独修改密码功能

### 4. 角色区分
- 每个小组建议配置：1个小组长 + 1-2个质检员 + 1个统计员
- 角色明确，职责清晰

## 🎯 后续扩展

1. **权限细分**：为每个角色配置具体的功能权限
2. **操作日志**：记录权利账号的关键操作
3. **批量操作**：支持批量创建、启用/禁用
4. **角色继承**：小组长可以管理本小组的其他权利账号
5. **数据统计**：统计各角色的工作量和业绩

---

**实现日期：** 2024-11-11  
**版本：** v1.0  
**状态：** ✅ 已完成

**访问地址：** `http://localhost:5173/organization/admin-accounts`

**菜单路径：** 甲方管理 → 权利账号管理

