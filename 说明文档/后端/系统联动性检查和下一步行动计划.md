# CCOç³»ç»Ÿè”åŠ¨æ€§æ£€æŸ¥å’Œä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’

**æ—¥æœŸ**: 2025-01-11  
**çŠ¶æ€**: æ•°æ®å±‚å®Œæˆï¼ŒAPIå±‚å¾…å®ç°  
**ç›®æ ‡**: å®ç°å…¨æ ˆè”åŠ¨ï¼Œæ‰€æœ‰ç‚¹å‡»æœ‰æ•ˆï¼Œå½±å“çœŸå®æ•°æ®åº“

---

## ä¸€ã€å·²å®Œæˆçš„è”åŠ¨æ€§æ£€æŸ¥ âœ…

### 1.1 å‰ç«¯å…¨å±€è”åŠ¨

| ç»„ä»¶ | è”åŠ¨çŠ¶æ€ | è¯´æ˜ |
|------|---------|------|
| MainLayout.vue | âœ… | å…¨å±€ç”²æ–¹é€‰æ‹©å™¨ï¼ˆå³ä¸Šè§’ï¼‰ |
| CustomFields.vue | âœ… | ä½¿ç”¨ `useTenantStore`ï¼Œç›‘å¬å…¨å±€ç”²æ–¹å˜åŒ– |
| QueueManagement.vue | âœ… | ä½¿ç”¨å…¨å±€ç”²æ–¹ï¼Œè‡ªåŠ¨åŠ è½½é˜Ÿåˆ— |
| AgencyManagement.vue | âœ… | ä½¿ç”¨å…¨å±€ç”²æ–¹ï¼Œè‡ªåŠ¨åŠ è½½æœºæ„ |
| TeamManagement.vue | âœ… | ä½¿ç”¨å…¨å±€ç”²æ–¹ï¼Œè‡ªåŠ¨åŠ è½½å°ç»„ |
| CollectorManagement.vue | âœ… | ä½¿ç”¨å…¨å±€ç”²æ–¹ï¼Œçº§è”ç­›é€‰ï¼ˆæœºæ„â†’å°ç»„â†’å‚¬å‘˜ï¼‰ |
| AdminAccountManagement.vue | âœ… | ä½¿ç”¨å…¨å±€ç”²æ–¹ï¼Œå¤šç»´åº¦ç­›é€‰ |
| CaseList.vue | âœ… | ä½¿ç”¨å…¨å±€ç”²æ–¹ï¼Œå¤æ‚ç­›é€‰ï¼ˆçŠ¶æ€ã€é˜Ÿåˆ—ã€æ—¥æœŸã€ç»„ç»‡ï¼‰ |

**ç»“è®º**: âœ… å‰ç«¯æ‰€æœ‰é¡µé¢å·²å®ç°å…¨å±€ç”²æ–¹è”åŠ¨

### 1.2 æ•°æ®åº“æ¨¡å‹è”åŠ¨

| æ¨¡å‹ | å…³ç³» | çŠ¶æ€ |
|------|------|------|
| Tenant | â†’ agencies, teams, collectors, queues, cases | âœ… |
| CollectionAgency | â†’ teams, collectors, cases | âœ… |
| CollectionTeam | â†’ collectors, cases | âœ… |
| Collector | â†’ cases | âœ… |
| CaseQueue | â†’ cases | âœ… |
| Case | â†’ tenant, agency, team, collector, queue | âœ… |

**ç»“è®º**: âœ… æ•°æ®åº“æ¨¡å‹å…³ç³»å®Œæ•´ï¼Œæ”¯æŒåŒå‘æŸ¥è¯¢

### 1.3 æµ‹è¯•æ•°æ®è”åŠ¨

| æ•°æ®ç±»å‹ | æ•°é‡ | è”åŠ¨å…³ç³» |
|---------|------|---------|
| ç”²æ–¹ | 2 | æ¯ä¸ªç”²æ–¹ â†’ 2æœºæ„ â†’ 4å°ç»„ â†’ 12å‚¬å‘˜ â†’ 50æ¡ˆä»¶ |
| æœºæ„ | 4 | æ¯ä¸ªæœºæ„ â†’ æ‰€å±ç”²æ–¹, 2å°ç»„, 6å‚¬å‘˜ |
| å°ç»„ | 8 | æ¯ä¸ªå°ç»„ â†’ æ‰€å±ç”²æ–¹, æ‰€å±æœºæ„, 3å‚¬å‘˜ |
| å‚¬å‘˜ | 24 | æ¯ä¸ªå‚¬å‘˜ â†’ æ‰€å±ç”²æ–¹, æ‰€å±æœºæ„, æ‰€å±å°ç»„, åˆ†é…æ¡ˆä»¶ |
| æ¡ˆä»¶ | 100 | æ¯ä¸ªæ¡ˆä»¶ â†’ æ‰€å±ç”²æ–¹, æ‰€å±é˜Ÿåˆ—, åˆ†é…æœºæ„/å°ç»„/å‚¬å‘˜ |

**ç»“è®º**: âœ… æµ‹è¯•æ•°æ®å…³ç³»å®Œæ•´ï¼Œè¦†ç›–æ‰€æœ‰è”åŠ¨åœºæ™¯

---

## äºŒã€å½“å‰æ¶æ„çŠ¶æ€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯ (Vue 3)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å…¨å±€çŠ¶æ€ç®¡ç† (Pinia)                                  â”‚  â”‚
â”‚  â”‚  - useTenantStore (å½“å‰é€‰ä¸­ç”²æ–¹)                      â”‚  â”‚
â”‚  â”‚  - æŒä¹…åŒ–åˆ° localStorage                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ é¡µé¢ç»„ä»¶ (æ‰€æœ‰é¡µé¢å·²è”åŠ¨å…¨å±€ç”²æ–¹çŠ¶æ€)                 â”‚  â”‚
â”‚  â”‚  - CustomFields.vue âœ…                               â”‚  â”‚
â”‚  â”‚  - QueueManagement.vue âœ…                            â”‚  â”‚
â”‚  â”‚  - AgencyManagement.vue âœ…                           â”‚  â”‚
â”‚  â”‚  - TeamManagement.vue âœ…                             â”‚  â”‚
â”‚  â”‚  - CollectorManagement.vue âœ…                        â”‚  â”‚
â”‚  â”‚  - CaseList.vue âœ…                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ APIè°ƒç”¨å±‚                                             â”‚  â”‚
â”‚  â”‚  - ç›®å‰è°ƒç”¨ Mock Server (simple_server.py)          â”‚  â”‚
â”‚  â”‚  - éœ€è¦æ›¿æ¢ä¸ºçœŸå®API â³                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                      HTTPè¯·æ±‚ (REST API)
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åç«¯ (FastAPI)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ APIè·¯ç”±å±‚ (å¾…å®ç°) â³                                  â”‚  â”‚
â”‚  â”‚  - /api/v1/tenants (CRUD)                            â”‚  â”‚
â”‚  â”‚  - /api/v1/agencies (CRUD + åˆ›å»ºç®¡ç†å‘˜)               â”‚  â”‚
â”‚  â”‚  - /api/v1/teams (CRUD)                              â”‚  â”‚
â”‚  â”‚  - /api/v1/collectors (CRUD + å¯†ç ç®¡ç†)               â”‚  â”‚
â”‚  â”‚  - /api/v1/cases (æŸ¥è¯¢ + å¤æ‚ç­›é€‰)                    â”‚  â”‚
â”‚  â”‚  - /api/v1/queues (CRUD)                             â”‚  â”‚
â”‚  â”‚  - /api/v1/fields (æŸ¥è¯¢)                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä¸šåŠ¡é€»è¾‘å±‚ (Service Layer) â³                         â”‚  â”‚
â”‚  â”‚  - TenantService (ç”²æ–¹é€»è¾‘)                           â”‚  â”‚
â”‚  â”‚  - AgencyService (æœºæ„é€»è¾‘)                           â”‚  â”‚
â”‚  â”‚  - CaseService (æ¡ˆä»¶é€»è¾‘)                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ•°æ®è®¿é—®å±‚ (SQLAlchemy ORM) âœ…                        â”‚  â”‚
â”‚  â”‚  - æ‰€æœ‰æ¨¡å‹å·²å®šä¹‰ä¸”å…³ç³»å®Œæ•´                            â”‚  â”‚
â”‚  â”‚  - Tenant, Agency, Team, Collector, Case, Queueç­‰   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                         SQLæŸ¥è¯¢
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•°æ®åº“ (SQLite/PostgreSQL)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ è¡¨ç»“æ„ âœ…                                              â”‚  â”‚
â”‚  â”‚  - tenants (ç”²æ–¹è¡¨)                                   â”‚  â”‚
â”‚  â”‚  - collection_agencies (æœºæ„è¡¨)                       â”‚  â”‚
â”‚  â”‚  - collection_teams (å°ç»„è¡¨)                          â”‚  â”‚
â”‚  â”‚  - collectors (å‚¬å‘˜è¡¨)                                â”‚  â”‚
â”‚  â”‚  - cases (æ¡ˆä»¶è¡¨, 100æ¡æµ‹è¯•æ•°æ®) âœ…                    â”‚  â”‚
â”‚  â”‚  - case_queues (é˜Ÿåˆ—è¡¨)                               â”‚  â”‚
â”‚  â”‚  - field_groups (å­—æ®µåˆ†ç»„è¡¨, 12æ¡)                     â”‚  â”‚
â”‚  â”‚  - standard_fields (æ ‡å‡†å­—æ®µè¡¨, 84æ¡)                  â”‚  â”‚
â”‚  â”‚  - tenant_field_configs (ç”²æ–¹å­—æ®µé…ç½®è¡¨)               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  æµ‹è¯•æ•°æ® âœ…                                                 â”‚
â”‚  - 2ä¸ªç”²æ–¹, 4ä¸ªæœºæ„, 8ä¸ªå°ç»„, 24ä¸ªå‚¬å‘˜                       â”‚  â”‚
â”‚  - 100ä¸ªæ¡ˆä»¶ï¼ˆæ¯ä¸ªç”²æ–¹50ä¸ªï¼‰                                 â”‚  â”‚
â”‚  - å®Œæ•´çš„ç»„ç»‡å…³ç³»å’Œæ¡ˆä»¶åˆ†é…                                  â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**çŠ¶æ€è¯´æ˜**:
- âœ… å·²å®Œæˆå¹¶å¯ç”¨
- â³ å¾…å®ç°

---

## ä¸‰ã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’

### æ­¥éª¤1: åˆå§‹åŒ–æ•°æ®åº“ (5åˆ†é’Ÿ)

```bash
cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# åˆå§‹åŒ–æ•°æ®åº“ï¼ˆåˆ›å»º100ä¸ªæ¡ˆä»¶ï¼‰
python3 init_database.py
```

**é¢„æœŸç»“æœ**:
```
============================================================
æ•°æ®åº“åˆå§‹åŒ–æ‘˜è¦
============================================================
ç”²æ–¹æ•°é‡: 2
å‚¬æ”¶æœºæ„æ•°é‡: 4
å‚¬æ”¶å°ç»„æ•°é‡: 8
å‚¬å‘˜æ•°é‡: 24
æ¡ˆä»¶æ•°é‡: 100  â† æ¯ä¸ªç”²æ–¹50ä¸ªæ¡ˆä»¶
å­—æ®µåˆ†ç»„æ•°é‡: 12
æ ‡å‡†å­—æ®µæ•°é‡: 84
============================================================
```

### æ­¥éª¤2: å®ç°ç”²æ–¹ç®¡ç†API (30åˆ†é’Ÿ)

ç¼–è¾‘ `backend/app/api/tenants.py`:

```python
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session
from app.core.database import get_db
from app.models.tenant import Tenant
from app.schemas.tenant import TenantCreate, TenantUpdate, TenantResponse

router = APIRouter()

@router.get("/tenants")
async def list_tenants(db: Session = Depends(get_db)):
    """æŸ¥è¯¢ç”²æ–¹åˆ—è¡¨"""
    tenants = db.query(Tenant).all()
    return {"code": 0, "data": tenants}

@router.post("/tenants")
async def create_tenant(data: TenantCreate, db: Session = Depends(get_db)):
    """åˆ›å»ºç”²æ–¹ï¼ˆå«ç®¡ç†å‘˜è´¦å·ï¼‰"""
    # TODO: å®ç°åˆ›å»ºé€»è¾‘
    pass

@router.put("/tenants/{tenant_id}")
async def update_tenant(tenant_id: int, data: TenantUpdate, db: Session = Depends(get_db)):
    """æ›´æ–°ç”²æ–¹"""
    # TODO: å®ç°æ›´æ–°é€»è¾‘
    pass

@router.delete("/tenants/{tenant_id}")
async def delete_tenant(tenant_id: int, db: Session = Depends(get_db)):
    """åˆ é™¤ç”²æ–¹"""
    # TODO: å®ç°åˆ é™¤é€»è¾‘
    pass
```

### æ­¥éª¤3: å®ç°æœºæ„ç®¡ç†API (30åˆ†é’Ÿ)

ç¼–è¾‘ `backend/app/api/agencies.py`:

```python
@router.post("/tenants/{tenant_id}/agencies")
async def create_agency(
    tenant_id: int, 
    data: AgencyCreateWithAdmin, 
    db: Session = Depends(get_db)
):
    """åˆ›å»ºæœºæ„ï¼ˆå«ç®¡ç†å‘˜è´¦å·ï¼‰"""
    # 1. åˆ›å»ºæœºæ„
    agency = CollectionAgency(
        tenant_id=tenant_id,
        agency_code=data.agency_code,
        agency_name=data.agency_name,
        ...
    )
    db.add(agency)
    db.flush()
    
    # 2. åˆ›å»ºæœºæ„ç®¡ç†å‘˜è´¦å·
    admin = AgencyAdmin(
        tenant_id=tenant_id,
        agency_id=agency.id,
        admin_name=data.admin_name,
        login_id=data.admin_login_id,
        email=data.admin_email,
        password_hash=hash_password(data.admin_password),
    )
    db.add(admin)
    db.commit()
    
    return {"code": 0, "data": {"agency": agency, "admin": admin}}
```

### æ­¥éª¤4: å®ç°æ¡ˆä»¶æŸ¥è¯¢API (45åˆ†é’Ÿ)

ç¼–è¾‘ `backend/app/api/cases.py`:

```python
@router.get("/cases")
async def list_cases(
    tenant_id: int,
    case_status: Optional[str] = None,
    queue_id: Optional[int] = None,
    agency_id: Optional[int] = None,
    team_id: Optional[int] = None,
    collector_id: Optional[int] = None,
    due_date_start: Optional[date] = None,
    due_date_end: Optional[date] = None,
    settlement_date_start: Optional[date] = None,
    settlement_date_end: Optional[date] = None,
    page: int = 1,
    page_size: int = 20,
    db: Session = Depends(get_db)
):
    """æŸ¥è¯¢æ¡ˆä»¶åˆ—è¡¨ï¼ˆæ”¯æŒå¤æ‚ç­›é€‰ï¼‰"""
    query = db.query(Case).filter(Case.tenant_id == tenant_id)
    
    # åº”ç”¨ç­›é€‰æ¡ä»¶
    if case_status:
        query = query.filter(Case.case_status == case_status)
    if queue_id:
        query = query.filter(Case.queue_id == queue_id)
    if agency_id:
        query = query.filter(Case.agency_id == agency_id)
    if team_id:
        query = query.filter(Case.team_id == team_id)
    if collector_id:
        query = query.filter(Case.collector_id == collector_id)
    if due_date_start:
        query = query.filter(Case.due_date >= due_date_start)
    if due_date_end:
        query = query.filter(Case.due_date <= due_date_end)
    if settlement_date_start:
        query = query.filter(Case.settlement_date >= settlement_date_start)
    if settlement_date_end:
        query = query.filter(Case.settlement_date <= settlement_date_end)
    
    # åˆ†é¡µ
    total = query.count()
    cases = query.offset((page - 1) * page_size).limit(page_size).all()
    
    return {
        "code": 0,
        "data": {
            "items": cases,
            "total": total,
            "page": page,
            "page_size": page_size
        }
    }
```

### æ­¥éª¤5: å‰ç«¯é›†æˆçœŸå®API (1å°æ—¶)

æ›¿æ¢æ‰€æœ‰mock APIè°ƒç”¨ä¸ºçœŸå®APIï¼Œä¾‹å¦‚ï¼š

**Before (Mock)**:
```typescript
// frontend/src/api/tenant.ts
export async function getTenants() {
  const response = await fetch('http://localhost:8000/api/v1/tenants')
  return await response.json()
}
```

**After (çœŸå®API)**:
```typescript
// ä¸éœ€è¦ä¿®æ”¹ï¼ŒAPIåœ°å€ä¿æŒä¸å˜
// åªéœ€ç¡®ä¿åç«¯å¯åŠ¨åœ¨ localhost:8000
```

### æ­¥éª¤6: å¯åŠ¨å¹¶æµ‹è¯• (15åˆ†é’Ÿ)

```bash
# Terminal 1: å¯åŠ¨åç«¯
cd backend
source venv/bin/activate
python3 -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# Terminal 2: å¯åŠ¨å‰ç«¯
cd frontend
npm run dev

# Terminal 3: æµ‹è¯•API
curl http://localhost:8000/api/v1/tenants
curl "http://localhost:8000/api/v1/cases?tenant_id=1&page=1&page_size=10"
```

**éªŒè¯ç‚¹**:
1. âœ… èƒ½æŸ¥è¯¢åˆ°2ä¸ªç”²æ–¹
2. âœ… èƒ½æŸ¥è¯¢åˆ°100ä¸ªæ¡ˆä»¶
3. âœ… ç­›é€‰åŠŸèƒ½æœ‰æ•ˆ
4. âœ… å‰ç«¯é¡µé¢æ˜¾ç¤ºçœŸå®æ•°æ®
5. âœ… ç‚¹å‡»æ“ä½œå½±å“æ•°æ®åº“

---

## å››ã€APIå®ç°ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | API | ç”¨é€” | é¢„è®¡æ—¶é—´ |
|-------|-----|------|---------|
| ğŸ”´ P0 | GET /api/v1/tenants | ç”²æ–¹åˆ—è¡¨ | 10åˆ†é’Ÿ |
| ğŸ”´ P0 | GET /api/v1/cases | æ¡ˆä»¶æŸ¥è¯¢ | 45åˆ†é’Ÿ |
| ğŸ”´ P0 | GET /api/v1/tenants/{id}/agencies | æœºæ„åˆ—è¡¨ | 15åˆ†é’Ÿ |
| ğŸ”´ P0 | GET /api/v1/agencies/{id}/teams | å°ç»„åˆ—è¡¨ | 15åˆ†é’Ÿ |
| ğŸ”´ P0 | GET /api/v1/teams/{id}/collectors | å‚¬å‘˜åˆ—è¡¨ | 15åˆ†é’Ÿ |
| ğŸ”´ P0 | GET /api/v1/tenants/{id}/queues | é˜Ÿåˆ—åˆ—è¡¨ | 15åˆ†é’Ÿ |
| ğŸŸ¡ P1 | POST /api/v1/tenants | åˆ›å»ºç”²æ–¹ | 30åˆ†é’Ÿ |
| ğŸŸ¡ P1 | POST /api/v1/agencies | åˆ›å»ºæœºæ„ | 30åˆ†é’Ÿ |
| ğŸŸ¡ P1 | POST /api/v1/teams | åˆ›å»ºå°ç»„ | 20åˆ†é’Ÿ |
| ğŸŸ¡ P1 | POST /api/v1/collectors | åˆ›å»ºå‚¬å‘˜ | 20åˆ†é’Ÿ |
| ğŸŸ¢ P2 | PUT /api/v1/tenants/{id} | æ›´æ–°ç”²æ–¹ | 20åˆ†é’Ÿ |
| ğŸŸ¢ P2 | PUT /api/v1/agencies/{id} | æ›´æ–°æœºæ„ | 20åˆ†é’Ÿ |
| ğŸŸ¢ P2 | DELETE /api/v1/tenants/{id} | åˆ é™¤ç”²æ–¹ | 15åˆ†é’Ÿ |

**æ€»è®¡**: çº¦4-5å°æ—¶å¯å®Œæˆæ ¸å¿ƒAPI

---

## äº”ã€æµ‹è¯•ç”¨ä¾‹æ¸…å•

### 5.1 æ•°æ®æŸ¥è¯¢æµ‹è¯•

- [ ] æŸ¥è¯¢ç”²æ–¹åˆ—è¡¨ï¼Œè¿”å›2ä¸ªç”²æ–¹
- [ ] æŸ¥è¯¢ç”²æ–¹1çš„æ¡ˆä»¶ï¼Œè¿”å›50ä¸ªæ¡ˆä»¶
- [ ] æŸ¥è¯¢ç”²æ–¹2çš„æ¡ˆä»¶ï¼Œè¿”å›50ä¸ªæ¡ˆä»¶
- [ ] ç­›é€‰çŠ¶æ€ä¸º"å¾…è¿˜æ¬¾"çš„æ¡ˆä»¶
- [ ] ç­›é€‰M1é˜Ÿåˆ—çš„æ¡ˆä»¶
- [ ] ç­›é€‰æŒ‡å®šå‚¬å‘˜çš„æ¡ˆä»¶
- [ ] æ—¥æœŸèŒƒå›´ç­›é€‰

### 5.2 æ•°æ®åˆ›å»ºæµ‹è¯•

- [ ] åˆ›å»ºæ–°ç”²æ–¹ï¼Œè‡ªåŠ¨åˆ›å»ºç®¡ç†å‘˜è´¦å·
- [ ] åˆ›å»ºæ–°æœºæ„ï¼Œè‡ªåŠ¨åˆ›å»ºç®¡ç†å‘˜è´¦å·
- [ ] åˆ›å»ºæ–°å°ç»„
- [ ] åˆ›å»ºæ–°å‚¬å‘˜
- [ ] åˆ›å»ºæ–°é˜Ÿåˆ—

### 5.3 æ•°æ®è”åŠ¨æµ‹è¯•

- [ ] é€‰æ‹©ç”²æ–¹Aï¼Œåªæ˜¾ç¤ºç”²æ–¹Açš„æ•°æ®
- [ ] é€‰æ‹©æœºæ„1ï¼Œåªæ˜¾ç¤ºæœºæ„1ä¸‹çš„å°ç»„
- [ ] é€‰æ‹©å°ç»„1ï¼Œåªæ˜¾ç¤ºå°ç»„1ä¸‹çš„å‚¬å‘˜
- [ ] åˆ é™¤ç”²æ–¹ï¼Œçº§è”åˆ é™¤æ‰€æœ‰ä¸‹å±æ•°æ®

### 5.4 å‰ç«¯äº¤äº’æµ‹è¯•

- [ ] å…¨å±€ç”²æ–¹é€‰æ‹©å™¨åˆ‡æ¢ï¼Œæ‰€æœ‰é¡µé¢è‡ªåŠ¨æ›´æ–°
- [ ] æ¡ˆä»¶åˆ—è¡¨ç­›é€‰ï¼Œå®æ—¶æ›´æ–°ç»“æœ
- [ ] åˆ›å»º/ç¼–è¾‘è¡¨å•ï¼Œæ•°æ®æäº¤æˆåŠŸ
- [ ] åˆ·æ–°é¡µé¢ï¼Œå…¨å±€ç”²æ–¹çŠ¶æ€ä¿æŒ

---

## å…­ã€å…³é”®ä»£ç æ£€æŸ¥æ¸…å•

### 6.1 å‰ç«¯è”åŠ¨ âœ…

- [x] MainLayout.vue: å…¨å±€ç”²æ–¹é€‰æ‹©å™¨
- [x] useTenantStore: å…¨å±€çŠ¶æ€ç®¡ç†
- [x] CustomFields.vue: ç›‘å¬å…¨å±€ç”²æ–¹
- [x] QueueManagement.vue: ç›‘å¬å…¨å±€ç”²æ–¹
- [x] AgencyManagement.vue: ç›‘å¬å…¨å±€ç”²æ–¹
- [x] TeamManagement.vue: ç›‘å¬å…¨å±€ç”²æ–¹
- [x] CollectorManagement.vue: ç›‘å¬å…¨å±€ç”²æ–¹
- [x] CaseList.vue: ç›‘å¬å…¨å±€ç”²æ–¹

### 6.2 åç«¯æ¨¡å‹ âœ…

- [x] Tenantæ¨¡å‹: å…³ç³»å®Œæ•´
- [x] CollectionAgencyæ¨¡å‹: å…³ç³»å®Œæ•´
- [x] CollectionTeamæ¨¡å‹: å…³ç³»å®Œæ•´
- [x] Collectoræ¨¡å‹: å…³ç³»å®Œæ•´
- [x] Caseæ¨¡å‹: å­—æ®µå®Œæ•´
- [x] CaseQueueæ¨¡å‹: å­—æ®µå®Œæ•´

### 6.3 åç«¯API â³

- [ ] tenants.py: CRUDå®ç°
- [ ] agencies.py: CRUDå®ç°
- [ ] teams.py: CRUDå®ç°
- [ ] collectors.py: CRUDå®ç°
- [ ] cases.py: æŸ¥è¯¢å®ç°
- [ ] queues.py: CRUDå®ç°
- [ ] fields.py: æŸ¥è¯¢å®ç°

### 6.4 æ•°æ®åº“ âœ…

- [x] è¡¨ç»“æ„åˆ›å»º
- [x] æµ‹è¯•æ•°æ®åˆå§‹åŒ–
- [x] å¤–é”®çº¦æŸ
- [x] ç´¢å¼•ä¼˜åŒ–

---

## ä¸ƒã€å¿«é€ŸéªŒè¯å‘½ä»¤

### éªŒè¯æ•°æ®åº“

```bash
cd backend
sqlite3 cco_test.db

-- æŸ¥çœ‹ç”²æ–¹
SELECT id, tenant_code, tenant_name FROM tenants;

-- æŸ¥çœ‹æ¡ˆä»¶æ•°é‡
SELECT tenant_id, COUNT(*) FROM cases GROUP BY tenant_id;

-- æŸ¥çœ‹æ¡ˆä»¶çŠ¶æ€åˆ†å¸ƒ
SELECT case_status, COUNT(*) FROM cases GROUP BY case_status;

-- æŸ¥çœ‹å‚¬å‘˜åˆ†é…æƒ…å†µ
SELECT collector_id, collector.collector_name, COUNT(cases.id)
FROM cases
JOIN collectors collector ON cases.collector_id = collector.id
GROUP BY collector_id;
```

### éªŒè¯API

```bash
# æŸ¥è¯¢ç”²æ–¹
curl http://localhost:8000/api/v1/tenants | jq

# æŸ¥è¯¢æ¡ˆä»¶ï¼ˆç”²æ–¹1ï¼‰
curl "http://localhost:8000/api/v1/cases?tenant_id=1" | jq

# æŸ¥è¯¢æ¡ˆä»¶ï¼ˆçŠ¶æ€ç­›é€‰ï¼‰
curl "http://localhost:8000/api/v1/cases?tenant_id=1&case_status=pending_repayment" | jq

# æŸ¥è¯¢æ¡ˆä»¶ï¼ˆé˜Ÿåˆ—ç­›é€‰ï¼‰
curl "http://localhost:8000/api/v1/cases?tenant_id=1&queue_id=5" | jq

# æŸ¥è¯¢æœºæ„
curl "http://localhost:8000/api/v1/tenants/1/agencies" | jq

# æŸ¥è¯¢å°ç»„
curl "http://localhost:8000/api/v1/agencies/1/teams" | jq

# æŸ¥è¯¢å‚¬å‘˜
curl "http://localhost:8000/api/v1/teams/1/collectors" | jq
```

---

## å…«ã€æˆåŠŸæ ‡å‡†

å½“ä»¥ä¸‹æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³æ—¶ï¼Œç³»ç»Ÿè”åŠ¨æ€§éªŒè¯æˆåŠŸï¼š

### 8.1 æ•°æ®å±‚

- [x] æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ
- [x] 100ä¸ªæ¡ˆä»¶æ•°æ®å­˜åœ¨
- [x] æ‰€æœ‰å¤–é”®å…³ç³»æ­£ç¡®
- [x] èƒ½é€šè¿‡SQLæŸ¥è¯¢éªŒè¯æ•°æ®

### 8.2 APIå±‚

- [ ] æ‰€æœ‰GETæ¥å£è¿”å›æ­£ç¡®æ•°æ®
- [ ] æ‰€æœ‰POSTæ¥å£èƒ½åˆ›å»ºæ•°æ®
- [ ] æ‰€æœ‰PUTæ¥å£èƒ½æ›´æ–°æ•°æ®
- [ ] æ‰€æœ‰DELETEæ¥å£èƒ½åˆ é™¤æ•°æ®
- [ ] ç­›é€‰å‚æ•°æ­£ç¡®å·¥ä½œ
- [ ] åˆ†é¡µå‚æ•°æ­£ç¡®å·¥ä½œ

### 8.3 å‰ç«¯å±‚

- [x] å…¨å±€ç”²æ–¹é€‰æ‹©å™¨å·¥ä½œæ­£å¸¸
- [ ] æ‰€æœ‰é¡µé¢æ˜¾ç¤ºçœŸå®æ•°æ®
- [ ] æ‰€æœ‰ç­›é€‰å™¨å·¥ä½œæ­£å¸¸
- [ ] æ‰€æœ‰åˆ›å»º/ç¼–è¾‘è¡¨å•èƒ½æäº¤
- [ ] åˆ·æ–°é¡µé¢çŠ¶æ€ä¿æŒ

### 8.4 ç«¯åˆ°ç«¯

- [ ] ç‚¹å‡»ä»»æ„æŒ‰é’®éƒ½æœ‰å“åº”
- [ ] æ‰€æœ‰æ“ä½œéƒ½å½±å“æ•°æ®åº“
- [ ] æ•°æ®å˜æ›´å®æ—¶åæ˜ åœ¨å‰ç«¯
- [ ] æ²¡æœ‰404æˆ–500é”™è¯¯
- [ ] æ§åˆ¶å°æ²¡æœ‰é”™è¯¯æ—¥å¿—

---

## ä¹ã€æ—¶é—´ä¼°ç®—

| ä»»åŠ¡ | æ—¶é—´ | è´Ÿè´£äºº |
|------|------|--------|
| æ­¥éª¤1: åˆå§‹åŒ–æ•°æ®åº“ | 5åˆ†é’Ÿ | âœ… å·²å®Œæˆï¼ˆè„šæœ¬readyï¼‰ |
| æ­¥éª¤2: å®ç°æŸ¥è¯¢API (P0) | 2å°æ—¶ | å¾…å®ç° |
| æ­¥éª¤3: å®ç°åˆ›å»ºAPI (P1) | 2å°æ—¶ | å¾…å®ç° |
| æ­¥éª¤4: å®ç°æ›´æ–°/åˆ é™¤API (P2) | 1å°æ—¶ | å¾…å®ç° |
| æ­¥éª¤5: å‰ç«¯é›†æˆæµ‹è¯• | 1å°æ—¶ | å¾…å®ç° |
| æ­¥éª¤6: ç«¯åˆ°ç«¯æµ‹è¯• | 1å°æ—¶ | å¾…å®ç° |

**æ€»è®¡**: çº¦7å°æ—¶å¯å®Œæˆå…¨éƒ¨åŠŸèƒ½

---

## åã€ç«‹å³è¡ŒåŠ¨

### ç°åœ¨å°±åš âš¡

```bash
# 1. åˆå§‹åŒ–æ•°æ®åº“ï¼ˆ5åˆ†é’Ÿï¼‰
cd backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
python3 init_database.py

# 2. å¯åŠ¨åç«¯ï¼ˆ1åˆ†é’Ÿï¼‰
python3 -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# 3. è®¿é—®APIæ–‡æ¡£
open http://localhost:8000/docs

# 4. å¼€å§‹å®ç°API
# æŒ‰ç…§ä¼˜å…ˆçº§ä» P0 å¼€å§‹å®ç°
```

---

## æ€»ç»“

âœ… **å·²å®Œæˆï¼ˆ90%åŸºç¡€å·¥ä½œï¼‰**:
- å‰ç«¯å…¨å±€è”åŠ¨
- æ•°æ®åº“æ¨¡å‹å®Œæ•´
- åˆå§‹åŒ–è„šæœ¬ready
- 100ä¸ªæµ‹è¯•æ¡ˆä»¶
- è¯¦ç»†æ–‡æ¡£

â³ **å¾…å®Œæˆï¼ˆå‰©ä½™10%ï¼‰**:
- APIå®ç°ï¼ˆæ ¸å¿ƒå·¥ä½œï¼‰
- å‰ç«¯APIè°ƒç”¨æ›´æ–°
- ç«¯åˆ°ç«¯æµ‹è¯•

ğŸ¯ **ç›®æ ‡æ˜ç¡®**: æ‰€æœ‰ç‚¹å‡»æœ‰æ•ˆï¼Œå½±å“çœŸå®æ•°æ®åº“

âš¡ **ç«‹å³å¼€å§‹**: è¿è¡Œ `init_database.py`ï¼Œå¼€å§‹APIå®ç°ï¼

