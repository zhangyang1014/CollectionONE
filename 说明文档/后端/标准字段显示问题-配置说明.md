# 标准字段显示问题 - 配置说明

## ⚠️ 重要：不要修改这个配置！

### 问题现象

**症状**: 标准字段管理页面显示"暂无数据"
- 昨天正常显示
- 今天突然变成空白
- 表格显示"暂无数据"

### 根本原因

**配置文件**: `backend-java/src/main/resources/application.yml`

**关键配置**:
```yaml
jackson:
  property-naming-strategy: SNAKE_CASE  # ⚠️ 这个配置必须保留！
```

**如果注释掉这个配置会发生什么**:

1. **后端返回格式变化**:
   ```json
   // ❌ 注释掉后（驼峰式）
   {
     "fieldKey": "user_id",
     "fieldName": "用户编号",
     "fieldType": "String"
   }
   
   // ✅ 启用后（下划线式）
   {
     "field_key": "user_id",
     "field_name": "用户编号",
     "field_type": "String"
   }
   ```

2. **前端无法识别**:
   - 前端代码期望 `field_name`（下划线式）
   - 后端返回 `fieldName`（驼峰式）
   - Vue无法绑定数据 → 显示"暂无数据"

### 为什么需要这个配置？

**前后端命名约定不同**:
- **Java后端**: 使用驼峰式命名（`fieldName`）
- **前端Vue**: 使用下划线式命名（`field_name`）

**解决方案**: 使用Jackson自动转换
- 后端Java实体保持驼峰式（符合Java规范）
- JSON输出自动转换为下划线式（符合前端期望）
- 无需修改任何代码

### 配置说明

```yaml
jackson:
  property-naming-strategy: SNAKE_CASE
```

**作用**:
- `SNAKE_CASE` = 下划线命名（snake_case）
- 自动将 `fieldName` → `field_name`
- 自动将 `enumOptions` → `enum_options`
- 自动将 `isRequired` → `is_required`

### 字段名映射表

| Java实体（驼峰式） | JSON输出（下划线式） | 前端期望（下划线式） |
|-------------------|---------------------|---------------------|
| fieldKey | field_key ✅ | field_key ✅ |
| fieldName | field_name ✅ | field_name ✅ |
| fieldType | field_type ✅ | field_type ✅ |
| fieldGroupId | field_group_id ✅ | field_group_id ✅ |
| isRequired | is_required ✅ | is_required ✅ |
| enumOptions | enum_options ✅ | enum_options ✅ |

### 如何验证配置是否正确？

#### 方法1: 检查配置文件

```bash
grep "property-naming-strategy" backend-java/src/main/resources/application.yml
```

**应该看到**:
```yaml
property-naming-strategy: SNAKE_CASE  # ✅ 已启用
```

**不应该看到**:
```yaml
# property-naming-strategy: SNAKE_CASE  # ❌ 被注释了
```

#### 方法2: 测试API返回格式

```bash
curl 'http://localhost:8080/api/v1/standard-fields?field_group_id=11' | python3 -m json.tool | head -20
```

**正确的输出**（下划线式）:
```json
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "field_key": "user_id",      // ✅ 下划线
      "field_name": "用户编号",     // ✅ 下划线
      "field_type": "String",       // ✅ 下划线
      "field_group_id": 11,         // ✅ 下划线
      "is_required": true           // ✅ 下划线
    }
  ]
}
```

**错误的输出**（驼峰式）:
```json
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "fieldKey": "user_id",        // ❌ 驼峰式
      "fieldName": "用户编号",       // ❌ 驼峰式
      "fieldType": "String",         // ❌ 驼峰式
      "fieldGroupId": 11,           // ❌ 驼峰式
      "isRequired": true            // ❌ 驼峰式
    }
  ]
}
```

### 修复步骤

如果发现配置被注释了：

1. **恢复配置**:
   ```yaml
   jackson:
     property-naming-strategy: SNAKE_CASE  # 取消注释
   ```

2. **重新编译后端**:
   ```bash
   cd backend-java
   JAVA_HOME=/opt/homebrew/opt/openjdk@17 \
   PATH=/opt/homebrew/opt/openjdk@17/bin:$PATH \
   mvn clean package -DskipTests
   ```

3. **重启后端服务**:
   ```bash
   # 停止旧进程
   lsof -ti :8080 | xargs kill -9
   
   # 启动新版本
   cd backend-java
   JAVA_HOME=/opt/homebrew/opt/openjdk@17 \
   PATH=/opt/homebrew/opt/openjdk@17/bin:$PATH \
   nohup java -jar target/cco-backend-1.0.0.jar --spring.profiles.active=dev &
   ```

4. **验证修复**:
   - 刷新前端页面（Ctrl+Shift+R 硬刷新）
   - 检查表格是否显示数据

### 常见问题

#### Q1: 为什么不能使用驼峰式？

**A**: 前端代码已经统一使用下划线式命名。如果改为驼峰式，需要修改：
- 所有Vue组件的字段引用
- TypeScript接口定义
- 表格列定义
- 表单数据绑定

工作量巨大，且容易出错。

#### Q2: 可以修改前端使用驼峰式吗？

**A**: 理论上可以，但不推荐：
- 需要修改大量前端代码
- 与现有代码风格不一致
- 容易引入新的bug

**推荐方案**: 保持后端配置，使用Jackson自动转换。

#### Q3: 这个配置会影响其他API吗？

**A**: 会影响所有API的JSON输出格式。但这是**统一的命名规范**：
- 所有API都使用下划线式
- 前端统一使用下划线式
- 保持一致性，避免混乱

#### Q4: 如何避免误删这个配置？

**A**: 
1. 在配置上方添加注释说明重要性
2. 在团队文档中明确说明
3. 在代码审查时检查此配置

### 配置位置

**文件**: `backend-java/src/main/resources/application.yml`

**行号**: 约第36行

**完整配置**:
```yaml
# Jackson 配置
jackson:
  time-zone: GMT+8
  date-format: yyyy-MM-dd HH:mm:ss
  serialization:
    write-dates-as-timestamps: false
  default-property-inclusion: non_null
  property-naming-strategy: SNAKE_CASE  # ⚠️ 必须保留，不要注释！
```

### 相关文档

- [标准字段显示问题修复说明](../前端/标准字段显示问题修复说明.md)
- [标准字段数据库集成完成报告](./标准字段数据库集成完成报告.md)

---

**重要提醒**: 
- ⚠️ **不要注释掉** `property-naming-strategy: SNAKE_CASE`
- ⚠️ **不要修改** 为其他命名策略
- ✅ **保持配置启用**，确保前后端字段名一致

**最后更新**: 2025-12-05
