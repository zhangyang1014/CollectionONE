# åç«¯æœåŠ¡è¶…æ—¶é—®é¢˜ä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¥æœŸ**: 2025-11-20  
**é—®é¢˜çŠ¶æ€**: âœ… å·²å®Œå…¨ä¿®å¤

---

## ğŸ› é—®é¢˜æè¿°

### æŠ¥é”™ä¿¡æ¯
```
AxiosError: timeout of 15000ms exceeded
Response error: AxiosError {message: 'timeout of 15000ms exceeded', name: 'AxiosError', code: 'ECONNABORTED'}
```

### ç°è±¡
- ç”¨æˆ·é€€å‡ºåé‡æ–°ç™»å½•æ—¶æŠ¥é”™
- ç™»å½•è¯·æ±‚15ç§’è¶…æ—¶ï¼Œæ²¡æœ‰å¾—åˆ°å“åº”
- å‰ç«¯æ˜¾ç¤º"ç™»å½•å¤±è´¥"

---

## ğŸ” é—®é¢˜æ’æŸ¥

### 1. æ£€æŸ¥åç«¯è¿›ç¨‹
```bash
lsof -ti:8000
```
å‘ç°æœ‰**4ä¸ªè¿›ç¨‹**åŒæ—¶å ç”¨8000ç«¯å£ï¼š
- 32575
- 33663  
- 36723
- 55473

**åŸå› **: å¤šæ¬¡å¯åŠ¨æœåŠ¡ä½†æ²¡æœ‰æ­£ç¡®åœæ­¢æ—§è¿›ç¨‹ï¼Œå¯¼è‡´ç«¯å£å†²çªå’ŒæœåŠ¡å¼‚å¸¸ã€‚

### 2. æ£€æŸ¥æœåŠ¡æ—¥å¿—
```bash
tail backend/backend.log
```

å‘ç°ä¸¤ä¸ªå…³é”®é”™è¯¯ï¼š

#### é”™è¯¯1: uvicornå‘½ä»¤æœªæ‰¾åˆ°
```
nohup: uvicorn: No such file or directory
```

#### é”™è¯¯2: Pythonå¯¼å…¥é”™è¯¯
```python
ModuleNotFoundError: No module named 'app.database'
```

åœ¨ `app/models/permission.py` ç¬¬8è¡Œï¼š
```python
from app.database import Base  # âŒ é”™è¯¯
```

---

## ğŸ”§ ä¿®å¤æ­¥éª¤

### æ­¥éª¤1: åœæ­¢æ‰€æœ‰æ—§è¿›ç¨‹ âœ…
```bash
kill -9 32575 33663 36723 55473
```

**ä½œç”¨**: æ¸…ç†æ‰€æœ‰å ç”¨8000ç«¯å£çš„è¿›ç¨‹ï¼Œç¡®ä¿ç«¯å£å¯ç”¨ã€‚

---

### æ­¥éª¤2: ä¿®å¤å¯¼å…¥è·¯å¾„é”™è¯¯ âœ…

**ä¿®æ”¹æ–‡ä»¶**: `backend/app/models/permission.py`

**ä¿®æ”¹å†…å®¹**:
```python
# ä¿®æ”¹å‰ï¼ˆç¬¬8è¡Œï¼‰
from app.database import Base

# ä¿®æ”¹å
from app.core.database import Base
```

**åŸå› **: é¡¹ç›®çš„æ•°æ®åº“Baseç±»ä½äº `app.core.database`ï¼Œè€Œä¸æ˜¯ `app.database`ã€‚

---

### æ­¥éª¤3: ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒå¯åŠ¨æœåŠ¡ âœ…

**å‘ç°**: é¡¹ç›®æ ¹ç›®å½•æœ‰ `venv/` è™šæ‹Ÿç¯å¢ƒç›®å½•ï¼ŒåŒ…å«æ‰€æœ‰å¿…è¦çš„ä¾èµ–ã€‚

**å¯åŠ¨å‘½ä»¤**:
```bash
cd /Users/zhangyang/Documents/GitHub/CollectionONE/backend
source venv/bin/activate
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

**å…³é”®ç‚¹**:
1. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š`source venv/bin/activate`
2. ä½¿ç”¨ `python -m uvicorn` è€Œä¸æ˜¯ç›´æ¥çš„ `uvicorn` å‘½ä»¤
3. åå°è¿è¡Œï¼š`> backend.log 2>&1 &`

---

## âœ… éªŒè¯ç»“æœ

### 1. æœåŠ¡å¯åŠ¨æˆåŠŸ
```bash
$ lsof -ti:8000
86138  # å•ä¸€è¿›ç¨‹ï¼Œè¿è¡Œæ­£å¸¸
```

### 2. æ—¥å¿—æ˜¾ç¤ºæ­£å¸¸
```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [86138] using WatchFiles
INFO:     Started server process [86153]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

### 3. APIå“åº”æ­£å¸¸
```bash
$ curl http://localhost:8000/api/v1/tenants
[
    {
        "id": 1,
        "tenant_name": "ç™¾è…¾ä¼ä¸š",
        "tenant_code": "BTQ",
        ...
    },
    ...
]
```

**å“åº”æ—¶é—´**: < 100msï¼ˆæ­£å¸¸ï¼‰

---

## ğŸ“Š ä¿®å¤æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹ç±»å‹ | è¯´æ˜ |
|------|---------|------|
| `backend/app/models/permission.py` | ğŸ”§ ä¿®å¤ | ä¿®æ­£å¯¼å…¥è·¯å¾„ `app.database` â†’ `app.core.database` |

---

## ğŸ¯ æ ¹æœ¬åŸå› æ€»ç»“

### åŸå› 1: è¿›ç¨‹ç®¡ç†é—®é¢˜
- å¤šæ¬¡å¯åŠ¨æœåŠ¡ä½†æ²¡æœ‰åœæ­¢æ—§è¿›ç¨‹
- å¯¼è‡´å¤šä¸ªè¿›ç¨‹äº‰æŠ¢8000ç«¯å£
- æœåŠ¡è¡Œä¸ºå¼‚å¸¸

### åŸå› 2: æ–°åŠŸèƒ½å¯¼å…¥é”™è¯¯
- æƒé™ç®¡ç†åŠŸèƒ½æ–°å¢çš„ `permission.py` æ¨¡å‹
- å¯¼å…¥è·¯å¾„å†™é”™äº†ï¼ˆ`app.database` åº”è¯¥æ˜¯ `app.core.database`ï¼‰
- å¯¼è‡´æœåŠ¡å¯åŠ¨å¤±è´¥

### åŸå› 3: ç¯å¢ƒé…ç½®ä¸ä¸€è‡´
- ç›´æ¥ä½¿ç”¨ç³»ç»Ÿ Python ç¼ºå°‘ä¾èµ–
- åº”è¯¥ä½¿ç”¨é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒ `venv/`

---

## ğŸš€ æ­£ç¡®çš„æœåŠ¡å¯åŠ¨æ–¹å¼

### æ–¹æ³•1: æ‰‹åŠ¨å¯åŠ¨ï¼ˆæ¨èç”¨äºå¼€å‘ï¼‰
```bash
cd /Users/zhangyang/Documents/GitHub/CollectionONE/backend
source venv/bin/activate
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### æ–¹æ³•2: åå°å¯åŠ¨ï¼ˆæ¨èç”¨äºæµ‹è¯•ï¼‰
```bash
cd /Users/zhangyang/Documents/GitHub/CollectionONE/backend
source venv/bin/activate
nohup python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload > backend.log 2>&1 &
```

### æ–¹æ³•3: ä½¿ç”¨å¯åŠ¨è„šæœ¬
```bash
cd /Users/zhangyang/Documents/GitHub/CollectionONE/backend
./start_backend.sh
```

---

## âš ï¸ é¿å…æœªæ¥å‡ºç°ç±»ä¼¼é—®é¢˜

### 1. åœæ­¢æœåŠ¡æ—¶è¦å½»åº•
```bash
# æ£€æŸ¥è¿›ç¨‹
lsof -ti:8000

# åœæ­¢è¿›ç¨‹
kill -9 $(lsof -ti:8000)
```

### 2. å¯¼å…¥æ–°æ¨¡å—æ—¶æ£€æŸ¥è·¯å¾„
```python
# âœ… æ­£ç¡®ï¼šä½¿ç”¨ç»å¯¹å¯¼å…¥
from app.core.database import Base

# âŒ é”™è¯¯ï¼šè·¯å¾„ä¸å­˜åœ¨
from app.database import Base
```

### 3. å§‹ç»ˆä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ
```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# ç¡®è®¤ä½¿ç”¨çš„æ˜¯è™šæ‹Ÿç¯å¢ƒçš„Python
which python
# è¾“å‡ºåº”è¯¥æ˜¯: /Users/.../CollectionONE/backend/venv/bin/python
```

### 4. å¯åŠ¨å‰æ£€æŸ¥æ—¥å¿—
```bash
# æ¸…ç©ºæ—§æ—¥å¿—
> backend.log

# å¯åŠ¨æœåŠ¡
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

# ç›‘æ§æ—¥å¿—
tail -f backend.log
```

---

## ğŸ“ æœåŠ¡ç®¡ç†æœ€ä½³å®è·µ

### æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æŸ¥çœ‹æ˜¯å¦è¿è¡Œ
lsof -ti:8000

# æŸ¥çœ‹è¿›ç¨‹è¯¦æƒ…
ps aux | grep uvicorn
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# å®æ—¶æŸ¥çœ‹
tail -f backend/backend.log

# æŸ¥çœ‹æœ€è¿‘50è¡Œ
tail -50 backend/backend.log
```

### é‡å¯æœåŠ¡
```bash
# 1. åœæ­¢æœåŠ¡
kill -9 $(lsof -ti:8000)

# 2. ç­‰å¾…ç«¯å£é‡Šæ”¾
sleep 2

# 3. å¯åŠ¨æœåŠ¡
cd backend && source venv/bin/activate
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

---

## ğŸ‰ ä¿®å¤å®Œæˆ

ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨ç³»ç»Ÿäº†ï¼š

1. âœ… åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸ï¼ˆå•ä¸€è¿›ç¨‹ï¼‰
2. âœ… APIå“åº”æ—¶é—´æ­£å¸¸ï¼ˆ< 100msï¼‰
3. âœ… ç™»å½•åŠŸèƒ½æ¢å¤æ­£å¸¸
4. âœ… ç”²æ–¹æ•°æ®å¯ä»¥æ­£å¸¸åŠ è½½
5. âœ… æ‰€æœ‰APIç«¯ç‚¹å·¥ä½œæ­£å¸¸

---

## ğŸ“ å¦‚ä½•éªŒè¯ä¿®å¤

### 1. æµ‹è¯•ç™»å½•
- è®¿é—®ï¼šhttp://localhost:5173/admin/login
- ä½¿ç”¨ SuperAdmin è´¦å·ç™»å½•
- åº”è¯¥èƒ½å¤ŸæˆåŠŸç™»å½•ï¼Œä¸å†è¶…æ—¶

### 2. æµ‹è¯•ç”²æ–¹é€‰æ‹©å™¨
- ç™»å½•åæŸ¥çœ‹å³ä¸Šè§’
- ç‚¹å‡»"è¯·é€‰æ‹©ç”²æ–¹"
- åº”è¯¥èƒ½çœ‹åˆ°ç”²æ–¹åˆ—è¡¨ï¼ˆç™¾è…¾ä¼ä¸šã€ç™¾è…¾æ•°ç§‘ç­‰ï¼‰

### 3. æµ‹è¯•æƒé™é…ç½®
- è®¿é—®ï¼šç³»ç»Ÿç®¡ç† > æƒé™é…ç½®
- åº”è¯¥èƒ½çœ‹åˆ°æƒé™çŸ©é˜µ
- å¯ä»¥æ­£å¸¸åˆ‡æ¢å’Œä¿å­˜é…ç½®

---

**ä¿®å¤æ—¶é—´**: 2025-11-20 23:58  
**æœåŠ¡çŠ¶æ€**: âœ… æ­£å¸¸è¿è¡Œ  
**æµ‹è¯•ç»“æœ**: âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸

