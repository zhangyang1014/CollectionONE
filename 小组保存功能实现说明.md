# å°ç»„ä¿å­˜åŠŸèƒ½å®ç°è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

åœ¨å°ç»„ç®¡ç†é¡µé¢çš„ç¼–è¾‘å¯¹è¯æ¡†ä¸­ï¼Œä¿®æ”¹å‚¬æ”¶é˜Ÿåˆ—ç­‰é…ç½®åç‚¹å‡»"ä¿å­˜"æŒ‰é’®ï¼Œæ•°æ®æ²¡æœ‰å®é™…ä¿å­˜åˆ°æ•°æ®åº“ã€‚

## ğŸ” é—®é¢˜åŸå› 

1. **å‰ç«¯ä»£ç é—®é¢˜**ï¼š
   - `handleSave` å‡½æ•°ä¸­æœ‰æ³¨é‡Š `// TODO: è°ƒç”¨APIä¿å­˜`
   - åªæ˜¯æ˜¾ç¤ºäº†"ä¿å­˜æˆåŠŸ"æ¶ˆæ¯ï¼Œä½†æ²¡æœ‰å®é™…è°ƒç”¨åç«¯API

2. **åç«¯APIç¼ºå¤±**ï¼š
   - `backend/app/api/teams.py` æ–‡ä»¶ä¸­åªæœ‰ä¸¤ä¸ªGETç«¯ç‚¹
   - ç¼ºå°‘åˆ›å»ºï¼ˆPOSTï¼‰å’Œæ›´æ–°ï¼ˆPUTï¼‰å°ç»„çš„APIç«¯ç‚¹

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. æ·»åŠ åç«¯APIç«¯ç‚¹

**æ–‡ä»¶**: `backend/app/api/teams.py`

#### æ–°å¢çš„APIç«¯ç‚¹

1. **åˆ›å»ºå°ç»„** - `POST /api/v1/teams`
```python
@router.post("", response_model=CollectionTeamSchema)
async def create_team(team: CollectionTeamCreate, db: Session = Depends(get_db)):
    """åˆ›å»ºå‚¬æ”¶å°ç»„"""
    # æ£€æŸ¥å°ç»„ç¼–ç æ˜¯å¦å·²å­˜åœ¨
    # åˆ›å»ºå°ç»„å¹¶è¿”å›å®Œæ•´ä¿¡æ¯
```

2. **æ›´æ–°å°ç»„** - `PUT /api/v1/teams/{team_id}`
```python
@router.put("/{team_id}", response_model=CollectionTeamSchema)
async def update_team(team_id: int, team_update: CollectionTeamUpdate, db: Session = Depends(get_db)):
    """æ›´æ–°å‚¬æ”¶å°ç»„"""
    # æŸ¥æ‰¾å°ç»„
    # æ›´æ–°å­—æ®µå¹¶è¿”å›å®Œæ•´ä¿¡æ¯
```

3. **è·å–å°ç»„è¯¦æƒ…** - `GET /api/v1/teams/{team_id}`
```python
@router.get("/{team_id}", response_model=CollectionTeamSchema)
async def get_team(team_id: int, db: Session = Depends(get_db)):
    """è·å–å•ä¸ªå‚¬æ”¶å°ç»„è¯¦æƒ…"""
```

4. **è¾…åŠ©å‡½æ•°** - `_build_team_response`
```python
def _build_team_response(team: CollectionTeam, db: Session) -> dict:
    """æ„é€ å°ç»„å“åº”æ•°æ®ï¼ŒåŒ…å«æ‰€æœ‰å…³è”ä¿¡æ¯"""
    # è·å–ç”²æ–¹åç§°ã€æœºæ„åç§°ã€å°ç»„ç¾¤åç§°ã€é˜Ÿåˆ—åç§°
    # è®¡ç®—å‚¬å‘˜æ•°é‡
```

#### æ”¯æŒçš„æ›´æ–°å­—æ®µ

- `team_group_id` - æ‰€å±å°ç»„ç¾¤
- `queue_id` - å‚¬æ”¶é˜Ÿåˆ—ï¼ˆå¿…å¡«ï¼‰
- `team_name` - å°ç»„åç§°
- `team_leader_id` - ç»„é•¿ID
- `description` - å¤‡æ³¨
- `is_active` - æ˜¯å¦å¯ç”¨
- å…¶ä»–å­—æ®µ...

### 2. å®ç°å‰ç«¯ä¿å­˜é€»è¾‘

**æ–‡ä»¶**: `frontend/src/views/organization/TeamManagement.vue`

#### ä¿®æ”¹çš„å‡½æ•°ï¼š`handleSave`

```javascript
const handleSave = async () => {
  try {
    await formRef.value.validate()
    saving.value = true
    
    // æ„é€ è¯·æ±‚æ•°æ®
    const requestData = {
      agency_id: form.value.agency_id,
      team_group_id: form.value.team_group_id || null,
      queue_id: form.value.queue_id,  // å‚¬æ”¶é˜Ÿåˆ—
      team_code: form.value.team_code,
      team_name: form.value.team_name,
      team_leader_id: form.value.leader_id || null,
      description: form.value.remark || null,
      max_case_count: form.value.target_performance || 0,
      sort_order: 0,
      is_active: form.value.is_active
    }
    
    if (isEdit.value && form.value.id) {
      // æ›´æ–°å°ç»„
      const response = await fetch(`http://localhost:8000/api/v1/teams/${form.value.id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestData)
      })
      
      if (!response.ok) throw new Error('æ›´æ–°å¤±è´¥')
      ElMessage.success('æ›´æ–°æˆåŠŸ')
    } else {
      // åˆ›å»ºå°ç»„
      const response = await fetch(`http://localhost:8000/api/v1/teams`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestData)
      })
      
      if (!response.ok) throw new Error('åˆ›å»ºå¤±è´¥')
      ElMessage.success('åˆ›å»ºæˆåŠŸ')
    }
    
    dialogVisible.value = false
    await loadAllTeams()
    await loadTeams()
  } catch (error) {
    ElMessage.error(error.message || 'ä¿å­˜å¤±è´¥')
  } finally {
    saving.value = false
  }
}
```

## ğŸ“Š APIæµ‹è¯•

### æµ‹è¯•æ›´æ–°å°ç»„

```bash
curl -X PUT 'http://localhost:8000/api/v1/teams/1' \
  -H 'Content-Type: application/json' \
  -d '{
    "queue_id": 1,
    "team_name": "ç™¾è…¾ä¼ä¸š-æœºæ„1-å°ç»„1"
  }'
```

### å“åº”ç¤ºä¾‹

```json
{
  "id": 1,
  "tenant_id": 1,
  "tenant_name": "ç™¾è…¾ä¼ä¸š",
  "agency_id": 1,
  "agency_name": "ç™¾è…¾ä¼ä¸š-æœºæ„1",
  "team_group_id": 1,
  "team_group_name": "é«˜é¢æ¡ˆä»¶ç»„",
  "queue_id": 1,
  "queue_name": "Cé˜Ÿåˆ—",
  "team_code": "AG101T1",
  "team_name": "ç™¾è…¾ä¼ä¸š-æœºæ„1-å°ç»„1",
  "collector_count": 6,
  "is_active": true,
  "created_at": "2025-11-19T17:36:39",
  "updated_at": "2025-11-20T09:37:23"
}
```

## ğŸ¯ ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
- âŒ ç‚¹å‡»"ä¿å­˜"æŒ‰é’®åæ˜¾ç¤º"ä¿å­˜æˆåŠŸ"
- âŒ ä½†æ•°æ®æ²¡æœ‰å®é™…ä¿å­˜åˆ°æ•°æ®åº“
- âŒ åˆ·æ–°é¡µé¢åä¿®æ”¹ä¸¢å¤±

### ä¿®å¤å
- âœ… ç‚¹å‡»"ä¿å­˜"æŒ‰é’®åè°ƒç”¨åç«¯API
- âœ… æ•°æ®æˆåŠŸä¿å­˜åˆ°æ•°æ®åº“
- âœ… åˆ·æ–°é¡µé¢åä¿®æ”¹ä»ç„¶å­˜åœ¨
- âœ… æ”¯æŒæ›´æ–°å‚¬æ”¶é˜Ÿåˆ—é…ç½®
- âœ… æ”¯æŒæ›´æ–°å°ç»„ç¾¤å…³è”
- âœ… æ”¯æŒæ›´æ–°æ‰€æœ‰å°ç»„å­—æ®µ

## ğŸ“ åŠŸèƒ½æ¸…å•

### åˆ›å»ºå°ç»„
- [x] è¾“å…¥å°ç»„ç¼–ç ï¼ˆå”¯ä¸€æ€§æ£€æŸ¥ï¼‰
- [x] è¾“å…¥å°ç»„åç§°
- [x] é€‰æ‹©æ‰€å±æœºæ„ï¼ˆå¿…é€‰ï¼‰
- [x] é€‰æ‹©æ‰€å±å°ç»„ç¾¤ï¼ˆå¯é€‰ï¼‰
- [x] é€‰æ‹©å‚¬æ”¶é˜Ÿåˆ—ï¼ˆå¿…é€‰ï¼‰
- [x] è¾“å…¥å¤‡æ³¨ä¿¡æ¯
- [x] è®¾ç½®æ˜¯å¦å¯ç”¨

### ç¼–è¾‘å°ç»„
- [x] å°ç»„ç¼–ç ä¸å¯ä¿®æ”¹
- [x] æ›´æ–°å°ç»„åç§°
- [x] æ›´æ”¹æ‰€å±å°ç»„ç¾¤
- [x] æ›´æ”¹å‚¬æ”¶é˜Ÿåˆ— â­ï¼ˆæœ¬æ¬¡ä¿®å¤é‡ç‚¹ï¼‰
- [x] æ›´æ–°å¤‡æ³¨ä¿¡æ¯
- [x] åˆ‡æ¢å¯ç”¨/ç¦ç”¨çŠ¶æ€

### æ•°æ®éªŒè¯
- [x] å°ç»„ç¼–ç å”¯ä¸€æ€§æ£€æŸ¥
- [x] å¿…å¡«å­—æ®µéªŒè¯
- [x] å…³è”æ•°æ®æœ‰æ•ˆæ€§æ£€æŸ¥

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å‚¬æ”¶é˜Ÿåˆ—ä¸ºå¿…å¡«é¡¹**ï¼š
   - æ¯ä¸ªå°ç»„å¿…é¡»å…³è”ä¸€ä¸ªå‚¬æ”¶é˜Ÿåˆ—
   - æ›´æ–°æ—¶å¦‚æœä¸ä¼  `queue_id`ï¼Œä¼šä¿æŒåŸæœ‰å€¼

2. **å°ç»„ç¾¤ä¸ºå¯é€‰é¡¹**ï¼š
   - å°ç»„å¯ä»¥ä¸å…³è”å°ç»„ç¾¤
   - ä¼  `null` æˆ–ä¸ä¼ è¯¥å­—æ®µè¡¨ç¤ºä¸å…³è”

3. **å­—æ®µæ˜ å°„**ï¼š
   - å‰ç«¯çš„ `remark` å­—æ®µå¯¹åº”åç«¯çš„ `description`
   - å‰ç«¯çš„ `target_performance` å¯¹åº”åç«¯çš„ `max_case_count`

4. **é”™è¯¯å¤„ç†**ï¼š
   - APIè°ƒç”¨å¤±è´¥æ—¶ä¼šæ˜¾ç¤ºé”™è¯¯æç¤º
   - ä¿å­˜æŒ‰é’®æœ‰loadingçŠ¶æ€é˜²æ­¢é‡å¤æäº¤

## ğŸ”„ éƒ¨ç½²æ­¥éª¤

1. âœ… æ·»åŠ åç«¯APIç«¯ç‚¹
2. âœ… ä¿®æ”¹å‰ç«¯ä¿å­˜é€»è¾‘
3. âœ… é‡å¯åç«¯æœåŠ¡
4. âœ… å‰ç«¯åˆ·æ–°é¡µé¢å³å¯ä½¿ç”¨

## ğŸ“… ä¿®å¤æ—¥æœŸ
2025å¹´11æœˆ20æ—¥

## ğŸ”— ç›¸å…³æ–‡æ¡£
- [å°ç»„åˆ—è¡¨æ˜¾ç¤ºä¿®å¤è¯´æ˜.md](./å°ç»„åˆ—è¡¨æ˜¾ç¤ºä¿®å¤è¯´æ˜.md)
- [å°ç»„ç¾¤Mockæ•°æ®è¯´æ˜.md](./å°ç»„ç¾¤Mockæ•°æ®è¯´æ˜.md)
- [å°ç»„ç®¡ç†å‘˜Mockæ•°æ®è¯´æ˜.md](./å°ç»„ç®¡ç†å‘˜Mockæ•°æ®è¯´æ˜.md)

## ğŸ‰ æµ‹è¯•å»ºè®®

1. âœ… æµ‹è¯•åˆ›å»ºæ–°å°ç»„
2. âœ… æµ‹è¯•ç¼–è¾‘ç°æœ‰å°ç»„
3. âœ… æµ‹è¯•æ›´æ”¹å‚¬æ”¶é˜Ÿåˆ—
4. âœ… æµ‹è¯•æ›´æ”¹å°ç»„ç¾¤
5. âœ… æµ‹è¯•å­—æ®µéªŒè¯
6. âœ… æµ‹è¯•é”™è¯¯å¤„ç†
7. âœ… åˆ·æ–°é¡µé¢éªŒè¯æ•°æ®æŒä¹…åŒ–

