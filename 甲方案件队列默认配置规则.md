# ç”²æ–¹æ¡ˆä»¶é˜Ÿåˆ—é»˜è®¤é…ç½®è§„åˆ™

## ğŸ“‹ æ¦‚è¿°

æ¯ä¸ªç”²æ–¹åˆ›å»ºæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºé»˜è®¤çš„æ¡ˆä»¶é˜Ÿåˆ—é…ç½®ã€‚é˜Ÿåˆ—ç”¨äºæ ¹æ®é€¾æœŸå¤©æ•°è‡ªåŠ¨åˆ†ç±»æ¡ˆä»¶ï¼Œä¾¿äºå‚¬æ”¶å›¢é˜Ÿåˆ†çº§ç®¡ç†ã€‚

## ğŸ¯ é»˜è®¤é˜Ÿåˆ—é…ç½®

æ–°å»ºç”²æ–¹æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹5ä¸ªæ ‡å‡†é˜Ÿåˆ—ï¼š

| é˜Ÿåˆ—ç¼–ç  | é˜Ÿåˆ—åç§° | é€¾æœŸå¤©æ•°èŒƒå›´ | è¯´æ˜ |
|---------|---------|------------|------|
| **C** | Cé˜Ÿåˆ— | **-âˆ ~ -1** | æœªé€¾æœŸï¼Œæå‰è¿˜æ¬¾å®¢æˆ· |
| **S0** | S0é˜Ÿåˆ— | **0 ~ 0** | å½“æ—¥åˆ°æœŸï¼Œéœ€é‡ç‚¹å…³æ³¨ |
| **S1** | S1é˜Ÿåˆ— | **1 ~ 5** | è½»åº¦é€¾æœŸï¼Œå‹å¥½æé†’ |
| **L1** | L1é˜Ÿåˆ— | **6 ~ 90** | ä¸­åº¦é€¾æœŸï¼ŒåŠ å¼ºå‚¬æ”¶ |
| **M1** | M1é˜Ÿåˆ— | **91 ~ +âˆ** | é‡åº¦é€¾æœŸï¼Œä¸“é¡¹å¤„ç† |

## ğŸ“ é€¾æœŸå¤©æ•°èŒƒå›´è¯´æ˜

### 1. è´Ÿæ•°èŒƒå›´ï¼ˆæå‰è¿˜æ¬¾ï¼‰

```
Cé˜Ÿåˆ—ï¼š-âˆ ~ -1
```

**å«ä¹‰ï¼š**
- é€¾æœŸå¤©æ•°ä¸ºè´Ÿæ•°ï¼Œè¡¨ç¤ºè¿˜æ¬¾æ—¥æœŸåœ¨åˆ°æœŸæ—¥ä¹‹å‰
- `-1` è¡¨ç¤ºæå‰1å¤©è¿˜æ¬¾
- `-âˆ` è¡¨ç¤ºæ— ä¸‹é™ï¼ŒåŒ…å«æ‰€æœ‰æå‰è¿˜æ¬¾çš„æƒ…å†µ

**ä¸šåŠ¡åœºæ™¯ï¼š**
- ç”¨æˆ·ä¸»åŠ¨æå‰è¿˜æ¬¾
- è‡ªåŠ¨æ‰£æ¬¾æå‰æˆåŠŸ
- ä¼˜è´¨å®¢æˆ·ç»´æŠ¤

### 2. é›¶å€¼ï¼ˆå½“æ—¥åˆ°æœŸï¼‰

```
S0é˜Ÿåˆ—ï¼š0 ~ 0
```

**å«ä¹‰ï¼š**
- é€¾æœŸå¤©æ•°ä¸º0ï¼Œè¡¨ç¤ºä»Šå¤©æ˜¯è¿˜æ¬¾æ—¥
- éœ€è¦é‡ç‚¹å…³æ³¨çš„ä¸´ç•Œå®¢æˆ·

**ä¸šåŠ¡åœºæ™¯ï¼š**
- å½“æ—¥åˆ°æœŸæé†’
- ç´§æ€¥å‚¬æ”¶
- é˜²æ­¢é€¾æœŸå‘ç”Ÿ

### 3. æ­£æ•°èŒƒå›´ï¼ˆå·²é€¾æœŸï¼‰

```
S1é˜Ÿåˆ—ï¼š1 ~ 5      // è½»åº¦é€¾æœŸ
L1é˜Ÿåˆ—ï¼š6 ~ 90     // ä¸­åº¦é€¾æœŸ
M1é˜Ÿåˆ—ï¼š91 ~ +âˆ    // é‡åº¦é€¾æœŸ
```

**å«ä¹‰ï¼š**
- é€¾æœŸå¤©æ•°ä¸ºæ­£æ•°ï¼Œè¡¨ç¤ºå·²ç»è¶…è¿‡è¿˜æ¬¾æ—¥
- `+âˆ` è¡¨ç¤ºæ— ä¸Šé™

**ä¸šåŠ¡åœºæ™¯ï¼š**
- åˆ†çº§å‚¬æ”¶ç­–ç•¥
- ä¸åŒçš„å‚¬æ”¶æ–¹å¼å’Œè¯æœ¯
- é£é™©ç­‰çº§è¯„ä¼°

## ğŸ”§ æŠ€æœ¯å®ç°

### æ•°æ®åº“å­˜å‚¨

```sql
CREATE TABLE case_queues (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tenant_id BIGINT NOT NULL COMMENT 'æ‰€å±ç”²æ–¹ID',
    queue_code VARCHAR(50) NOT NULL COMMENT 'é˜Ÿåˆ—ç¼–ç ',
    queue_name VARCHAR(100) NOT NULL COMMENT 'é˜Ÿåˆ—åç§°',
    overdue_days_start INT COMMENT 'é€¾æœŸå¤©æ•°å¼€å§‹ï¼ˆNULLè¡¨ç¤ºè´Ÿæ— ç©·ï¼‰',
    overdue_days_end INT COMMENT 'é€¾æœŸå¤©æ•°ç»“æŸï¼ˆNULLè¡¨ç¤ºæ­£æ— ç©·ï¼‰',
    sort_order INT DEFAULT 0 COMMENT 'æ’åº',
    is_active BOOLEAN DEFAULT TRUE COMMENT 'æ˜¯å¦å¯ç”¨',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_tenant_code (tenant_id, queue_code),
    FOREIGN KEY (tenant_id) REFERENCES tenants(id)
);
```

### é»˜è®¤æ•°æ®æ’å…¥é€»è¾‘

```python
def create_default_queues_for_tenant(db, tenant_id):
    """ä¸ºæ–°å»ºç”²æ–¹åˆ›å»ºé»˜è®¤é˜Ÿåˆ—é…ç½®"""
    
    default_queues = [
        {
            'queue_code': 'C',
            'queue_name': 'Cé˜Ÿåˆ—',
            'overdue_days_start': None,  # -âˆ
            'overdue_days_end': -1,
            'sort_order': 1
        },
        {
            'queue_code': 'S0',
            'queue_name': 'S0é˜Ÿåˆ—',
            'overdue_days_start': 0,
            'overdue_days_end': 0,
            'sort_order': 2
        },
        {
            'queue_code': 'S1',
            'queue_name': 'S1é˜Ÿåˆ—',
            'overdue_days_start': 1,
            'overdue_days_end': 5,
            'sort_order': 3
        },
        {
            'queue_code': 'L1',
            'queue_name': 'L1é˜Ÿåˆ—',
            'overdue_days_start': 6,
            'overdue_days_end': 90,
            'sort_order': 4
        },
        {
            'queue_code': 'M1',
            'queue_name': 'M1é˜Ÿåˆ—',
            'overdue_days_start': 91,
            'overdue_days_end': None,  # +âˆ
            'sort_order': 5
        }
    ]
    
    for queue_data in default_queues:
        queue = CaseQueue(
            tenant_id=tenant_id,
            **queue_data,
            is_active=True
        )
        db.add(queue)
    
    db.commit()
```

## âœ… éªŒè¯è§„åˆ™

### 1. èŒƒå›´ä¸å¯é‡åˆ

åˆ›å»ºæˆ–ç¼–è¾‘é˜Ÿåˆ—æ—¶ï¼Œéœ€è¦éªŒè¯é€¾æœŸå¤©æ•°èŒƒå›´ä¸ä¸ç°æœ‰é˜Ÿåˆ—é‡åˆï¼š

```python
def validate_queue_range(db, tenant_id, start, end, exclude_queue_id=None):
    """éªŒè¯é˜Ÿåˆ—èŒƒå›´ä¸é‡åˆ"""
    
    # æŸ¥è¯¢è¯¥ç”²æ–¹çš„æ‰€æœ‰å…¶ä»–é˜Ÿåˆ—
    existing_queues = db.query(CaseQueue).filter(
        CaseQueue.tenant_id == tenant_id,
        CaseQueue.is_active == True
    )
    
    if exclude_queue_id:
        existing_queues = existing_queues.filter(
            CaseQueue.id != exclude_queue_id
        )
    
    for queue in existing_queues.all():
        # æ£€æŸ¥èŒƒå›´æ˜¯å¦é‡åˆ
        if ranges_overlap(
            start, end,
            queue.overdue_days_start, queue.overdue_days_end
        ):
            raise ValueError(
                f"é€¾æœŸå¤©æ•°èŒƒå›´ä¸é˜Ÿåˆ— {queue.queue_name} é‡åˆ"
            )
```

### 2. èŒƒå›´åˆæ³•æ€§

```python
def validate_range_values(start, end):
    """éªŒè¯èŒƒå›´å€¼åˆæ³•æ€§"""
    
    # å¦‚æœéƒ½ä¸ä¸ºNULLï¼Œåˆ™å¼€å§‹å¿…é¡»å°äºç­‰äºç»“æŸ
    if start is not None and end is not None:
        if start > end:
            raise ValueError("å¼€å§‹å¤©æ•°ä¸èƒ½å¤§äºç»“æŸå¤©æ•°")
    
    # è‡³å°‘æœ‰ä¸€ä¸ªè¾¹ç•Œ
    if start is None and end is None:
        raise ValueError("å¼€å§‹å¤©æ•°å’Œç»“æŸå¤©æ•°ä¸èƒ½éƒ½ä¸ºç©º")
```

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šåˆ¤æ–­æ¡ˆä»¶å±äºå“ªä¸ªé˜Ÿåˆ—

```python
def get_queue_for_case(overdue_days, queues):
    """æ ¹æ®é€¾æœŸå¤©æ•°ç¡®å®šæ¡ˆä»¶æ‰€å±é˜Ÿåˆ—"""
    
    for queue in queues:
        start = queue.overdue_days_start or float('-inf')
        end = queue.overdue_days_end or float('inf')
        
        if start <= overdue_days <= end:
            return queue
    
    return None

# ä½¿ç”¨ç¤ºä¾‹
overdue_days = -2  # æå‰2å¤©è¿˜æ¬¾
queue = get_queue_for_case(overdue_days, queues)
# è¿”å›ï¼šCé˜Ÿåˆ—

overdue_days = 0   # å½“æ—¥åˆ°æœŸ
queue = get_queue_for_case(overdue_days, queues)
# è¿”å›ï¼šS0é˜Ÿåˆ—

overdue_days = 3   # é€¾æœŸ3å¤©
queue = get_queue_for_case(overdue_days, queues)
# è¿”å›ï¼šS1é˜Ÿåˆ—

overdue_days = 100 # é€¾æœŸ100å¤©
queue = get_queue_for_case(overdue_days, queues)
# è¿”å›ï¼šM1é˜Ÿåˆ—
```

### ç¤ºä¾‹2ï¼šåˆ›å»ºè‡ªå®šä¹‰é˜Ÿåˆ—

ç”²æ–¹å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¿®æ”¹æˆ–æ–°å¢é˜Ÿåˆ—ï¼š

```
åœºæ™¯ï¼šæŸç”²æ–¹éœ€è¦æ›´ç»†ç²’åº¦çš„é€¾æœŸç®¡ç†

C   : -âˆ ~ -1    (æå‰è¿˜æ¬¾)
S0  : 0 ~ 0      (å½“æ—¥åˆ°æœŸ)
S1  : 1 ~ 3      (è½»åº¦é€¾æœŸ1-3å¤©) âœï¸ ä¿®æ”¹
S2  : 4 ~ 7      (è½»åº¦é€¾æœŸ4-7å¤©) â• æ–°å¢
M1  : 8 ~ 30     (ä¸­åº¦é€¾æœŸ) âœï¸ ä¿®æ”¹
M2  : 31 ~ 60    (ä¸­é‡åº¦é€¾æœŸ) â• æ–°å¢
M3+ : 61 ~ +âˆ    (é‡åº¦é€¾æœŸ) âœï¸ ä¿®æ”¹
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. NULLå€¼çš„å«ä¹‰

- `overdue_days_start = NULL`: è¡¨ç¤º **è´Ÿæ— ç©·**ï¼ˆ-âˆï¼‰
- `overdue_days_end = NULL`: è¡¨ç¤º **æ­£æ— ç©·**ï¼ˆ+âˆï¼‰
- ä¸å…è®¸ä¸¤ä¸ªéƒ½ä¸ºNULL

### 2. è¾¹ç•ŒåŒ…å«æ€§

- èŒƒå›´æ˜¯**é—­åŒºé—´**ï¼ŒåŒ…å«èµ·å§‹å’Œç»“æŸå€¼
- ä¾‹å¦‚ï¼š`1 ~ 5` åŒ…å« 1, 2, 3, 4, 5

### 3. é˜Ÿåˆ—è¦†ç›–å®Œæ•´æ€§

- å»ºè®®æ‰€æœ‰é˜Ÿåˆ—åˆèµ·æ¥èƒ½è¦†ç›– `-âˆ` åˆ° `+âˆ` çš„æ‰€æœ‰æƒ…å†µ
- é¿å…å‡ºç°æŸä¸ªé€¾æœŸå¤©æ•°æ— æ³•åŒ¹é…åˆ°ä»»ä½•é˜Ÿåˆ—

### 4. æ’åºå»ºè®®

- æŒ‰ç…§ `overdue_days_start` ä»å°åˆ°å¤§æ’åº
- è´Ÿæ•°é˜Ÿåˆ—åœ¨å‰ï¼Œæ­£æ•°é˜Ÿåˆ—åœ¨å

## ğŸ“ å‰ç«¯å±•ç¤º

### é˜Ÿåˆ—åˆ—è¡¨æ˜¾ç¤ºæ ¼å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜Ÿåˆ—ç¼–ç   â”‚  é˜Ÿåˆ—åç§°  â”‚  é€¾æœŸå¤©æ•°èŒƒå›´        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  C        â”‚  Cé˜Ÿåˆ—    â”‚  -âˆ ~ -1å¤©           â”‚
â”‚  S0       â”‚  S0é˜Ÿåˆ—   â”‚  0 ~ 0å¤©             â”‚
â”‚  S1       â”‚  S1é˜Ÿåˆ—   â”‚  1 ~ 5å¤©             â”‚
â”‚  L1       â”‚  L1é˜Ÿåˆ—   â”‚  6 ~ 90å¤©            â”‚
â”‚  M1       â”‚  M1é˜Ÿåˆ—   â”‚  91 ~ +âˆå¤©           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ·»åŠ /ç¼–è¾‘è¡¨å•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ·»åŠ é˜Ÿåˆ—                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é˜Ÿåˆ—ç¼–ç ï¼š[_______]               â”‚
â”‚  é˜Ÿåˆ—åç§°ï¼š[_______]               â”‚
â”‚                                     â”‚
â”‚  é€¾æœŸå¤©æ•°èŒƒå›´ï¼š                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ å¼€å§‹å¤©æ•°    â”‚ ç»“æŸå¤©æ•°    â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚ [___] å¤©    â”‚ [___] å¤©    â”‚     â”‚
â”‚  â”‚ â–¡ è´Ÿæ— ç©·    â”‚ â–¡ æ­£æ— ç©·    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                     â”‚
â”‚  æç¤ºï¼šä¸å¡«å†™ä»£è¡¨æ— ç©·å¤§              â”‚
â”‚                                     â”‚
â”‚         [å–æ¶ˆ]  [ä¿å­˜]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” ç›¸å…³æ–‡æ¡£

- `CCOå­—æ®µé…ç½®ç³»ç»Ÿè®¾è®¡.md` - ç³»ç»Ÿæ•´ä½“è®¾è®¡
- `frontend/src/views/tenant-management/QueueManagement.vue` - é˜Ÿåˆ—ç®¡ç†é¡µé¢
- `backend/app/models/case_queue.py` - é˜Ÿåˆ—æ•°æ®æ¨¡å‹

## âœ… å®æ–½æ¸…å•

åˆ›å»ºæ–°ç”²æ–¹æ—¶çš„æ­¥éª¤ï¼š

- [ ] åˆ›å»ºç”²æ–¹åŸºæœ¬ä¿¡æ¯
- [ ] è‡ªåŠ¨åˆ›å»º5ä¸ªé»˜è®¤é˜Ÿåˆ—ï¼ˆC, S0, S1, L1, M1ï¼‰
- [ ] ä¸ºç”²æ–¹åˆ›å»ºæ‰€æœ‰æ ‡å‡†å­—æ®µé…ç½®
- [ ] ä¸ºæ¯ä¸ªé˜Ÿåˆ—é…ç½®å­—æ®µæ˜¾ç¤ºè§„åˆ™ï¼ˆå¯é€‰ï¼‰
- [ ] åˆå§‹åŒ–ç»„ç»‡æ¶æ„ï¼ˆå¯é€‰ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2024-11-11  
**çŠ¶æ€ï¼š** âœ… å·²å®šç¨¿

