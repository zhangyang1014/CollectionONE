# 通知模板显示10条数据 - 操作指南

## 🎯 目标

在通知模板页面显示10条Mock数据

## ⚠️ 当前问题

- 页面显示"暂无数据"
- 后端API返回404错误
- 原因：数据库表未创建 + 后端服务未重启

## 🚀 解决方案（三选一）

### 方案A：使用一键脚本（最简单）

```bash
cd /Users/zhangyang/Documents/GitHub/CollectionONE/backend
./setup_notification_templates.sh
```

按提示输入MySQL密码，脚本会自动完成所有操作。

---

### 方案B：手动执行SQL（推荐）

#### 1. 打开终端，执行SQL

```bash
cd /Users/zhangyang/Documents/GitHub/CollectionONE/backend
mysql -u root -p cco_system < mock_notification_templates.sql
```

输入MySQL密码后回车。

#### 2. 验证数据

```bash
mysql -u root -p cco_system -e "SELECT COUNT(*) FROM notification_templates;"
```

应该显示10条数据。

---

### 方案C：使用MySQL客户端工具

#### 1. 打开Navicat/MySQL Workbench

#### 2. 连接到数据库

- 数据库：`cco_system`

#### 3. 执行SQL文件

- 打开文件：`backend/mock_notification_templates.sql`
- 点击"运行"或"执行"

#### 4. 验证

运行查询：
```sql
SELECT * FROM notification_templates;
```

应该看到10条数据。

---

## 🔄 重启后端服务（必须！）

**非常重要**：执行完SQL后，必须重启后端服务！

### 1. 停止当前后端服务

在运行后端的终端窗口按 `Ctrl + C`

### 2. 重新启动后端

```bash
cd /Users/zhangyang/Documents/GitHub/CollectionONE/backend
python3 -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 3. 等待启动完成

看到以下信息表示启动成功：
```
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000
```

---

## ✅ 验证修复

### 1. 测试后端API

打开新终端窗口：

```bash
curl http://localhost:8000/api/v1/notification-templates
```

应该返回JSON数据（10条模板），而不是404。

### 2. 刷新前端页面

1. 在浏览器中按 `Cmd + Shift + R` (Mac) 或 `Ctrl + Shift + R` (Windows)
2. 或者关闭标签页重新打开
3. 访问：系统管理 -> 通知配置 -> **通知模板**

### 3. 查看结果

应该看到10条模板数据：

| # | 模板名称 | 优先级 | 发送对象 |
|---|---------|--------|---------|
| 1 | 案件标签变化通知 | 中 | 机构 |
| 2 | 案件还款到账通知 | 高 | 催员 |
| 3 | 用户APP访问提醒 | 中 | 催员 |
| 4 | 用户还款页访问通知 | 高 | 催员 |
| 5 | 新案件分配通知 | 高 | 催员 |
| 6 | PTP承诺到期提醒 | 高 | 催员 |
| 7 | 案件逾期升级警告 | 高 | 小组 |
| 8 | 小组业绩达成通知 | 中 | 小组 |
| 9 | 催员日报提交提醒 | 低 | 催员 |
| 10 | 系统维护公告 | 高 | 机构 |

---

## 🔍 故障排查

### 问题1：SQL执行失败

**错误**: `Table 'notification_templates' already exists`

**解决**: 
```sql
-- 先删除表
DROP TABLE IF EXISTS notification_templates;
-- 然后重新执行 mock_notification_templates.sql
```

---

**错误**: `Unknown database 'cco_system'`

**解决**:
```sql
CREATE DATABASE cco_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

---

### 问题2：后端仍然返回404

**检查清单**:
- [ ] SQL已成功执行
- [ ] 数据库中有10条数据
- [ ] 后端服务已**完全重启**（不是热重载）
- [ ] 后端运行在正确的目录

**验证后端目录**:
```bash
# 查看后端进程
ps aux | grep uvicorn

# 应该看到路径包含：
# /Users/zhangyang/Documents/GitHub/CollectionONE/backend
```

如果路径不对，需要：
1. 停止错误路径的服务
2. 在正确路径启动服务

---

### 问题3：前端仍然显示"暂无数据"

**解决步骤**:

1. **清除浏览器缓存**
   - `Cmd/Ctrl + Shift + R` 强制刷新

2. **清除Vite缓存**
   ```bash
   cd frontend
   rm -rf node_modules/.vite
   ```

3. **重启前端服务**
   ```bash
   npm run dev
   ```

4. **检查浏览器控制台**
   - 按F12打开开发者工具
   - 查看Console标签是否有错误
   - 查看Network标签，检查API请求状态

---

## 📝 完整操作流程

### 第一步：执行SQL（3种方式任选其一）

```bash
# 方式1：命令行
cd backend
mysql -u root -p cco_system < mock_notification_templates.sql

# 方式2：一键脚本
./setup_notification_templates.sh

# 方式3：使用MySQL客户端工具执行SQL文件
```

### 第二步：重启后端服务

```bash
# 1. 停止当前服务（Ctrl+C）
# 2. 重新启动
cd backend
python3 -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 第三步：验证

```bash
# 测试API
curl http://localhost:8000/api/v1/notification-templates
```

### 第四步：刷新前端

- 强制刷新：`Cmd + Shift + R` 或 `Ctrl + Shift + R`
- 查看通知模板页面

---

## 🎉 成功标志

✅ 后端API返回JSON数据（不是404）  
✅ 前端页面显示10条模板  
✅ 可以查看每条模板的详细信息  
✅ 可以看到统计数据（发送次数、阅读次数）  

---

## 📞 需要帮助？

如果按照以上步骤操作后仍有问题，请提供：

1. SQL执行的输出结果
2. 后端服务启动的日志
3. 浏览器控制台的错误信息
4. API测试的返回结果

---

**操作指南** | 版本 v1.0 | 更新时间：2025-11-19

