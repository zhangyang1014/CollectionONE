# 空闲催员监控看板 - 快速启动指南

## ✅ 当前状态

- ✅ 后端服务：**正在运行** (端口 8000)
- ✅ 前端代码：已完成
- ✅ 路由配置：已添加
- ✅ 菜单入口：已添加
- ⚠️ 数据库表：需要确认

---

## 🚀 快速启动步骤

### 1. 确认后端服务运行

后端服务已经在运行：
```bash
# 查看后端服务状态
ps aux | grep uvicorn
# 应该看到：uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

如果没有运行，启动后端：
```bash
cd backend
source venv/bin/activate  # Mac/Linux
# 或
venv\Scripts\activate     # Windows

python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 2. 确认前端服务运行

```bash
cd frontend
npm run dev
```

前端应该运行在：`http://localhost:5173`

### 3. 清除浏览器缓存

**重要！** 新功能需要清除缓存：

**Chrome/Edge：**
1. 按 `Ctrl+Shift+Delete` (Windows) 或 `Cmd+Shift+Delete` (Mac)
2. 选择"缓存的图片和文件"
3. 点击"清除数据"
4. 或者按 `Ctrl+Shift+R` (Windows) / `Cmd+Shift+R` (Mac) 强制刷新

**Firefox：**
1. 按 `Ctrl+Shift+Delete`
2. 选择"缓存"
3. 点击"立即清除"

### 4. 访问功能

有两种方式访问：

**方式1：通过菜单（推荐）**
1. 登录 CCO 管理控台
2. 点击左侧菜单 **"数据看板"**
3. 点击子菜单 **"空闲催员监控"**

**方式2：直接访问**
```
http://localhost:5173/dashboard/idle-monitor
```

---

## 🔍 问题排查

### 问题1：菜单项不能点击或无反应

**可能原因**：
1. 浏览器缓存未清除
2. 前端服务未重启
3. 路由配置未生效

**解决方案**：
```bash
# 1. 停止前端服务 (Ctrl+C)
# 2. 清除缓存和重新安装依赖
cd frontend
rm -rf node_modules/.vite
npm run dev

# 3. 强制刷新浏览器 (Ctrl+Shift+R 或 Cmd+Shift+R)
```

### 问题2：点击后显示404或空白页

**检查前端控制台**：
1. 按 F12 打开开发者工具
2. 查看 Console 标签是否有错误
3. 查看 Network 标签的请求状态

**检查路由**：
```bash
# 查看路由文件
cat frontend/src/router/index.ts | grep -A 5 "idle-monitor"
```

应该看到：
```javascript
{
  path: 'dashboard/idle-monitor',
  name: 'IdleMonitor',
  component: () => import('@/views/dashboard/IdleMonitor.vue'),
  meta: { title: '空闲催员监控', requiresAuth: true },
}
```

### 问题3：页面加载但显示错误

**检查后端API**：
```bash
# 测试API是否可用
curl http://localhost:8000/api/v1/idle-monitor/config?tenant_id=1
```

应该返回配置数据或错误信息。

**检查数据库表**：
```bash
cd backend
source venv/bin/activate
python3 create_idle_monitor_tables.py
```

应该看到：
```
✅ 空闲监控数据表创建成功！

创建的表:
  - idle_monitor_configs (空闲监控配置表)
  - collector_idle_records (催员空闲记录表)
  - collector_idle_stats (催员空闲统计表)
```

---

## 📊 功能验证

### 1. 验证页面加载

访问页面后应该看到：
- ✅ 页面标题："空闲催员监控看板"
- ✅ 筛选区域（机构、小组、催员、日期）
- ✅ 4个数据卡片（全部显示0，这是正常的，因为还没有数据）
- ✅ 趋势图表区域
- ✅ 详情列表（空表格）

### 2. 验证配置功能

1. 点击右上角 **"空闲配置"** 按钮
2. 应该弹出配置对话框
3. 包含以下内容：
   - 配置名称输入框
   - 上班时间段配置
   - 空闲阈值设置
   - 监控行为复选框（7个选项）
   - 节假日排除选项

### 3. 验证API连接

打开浏览器开发者工具 (F12)：
1. 切换到 Network 标签
2. 刷新页面
3. 应该看到以下请求：
   - `/api/v1/idle-monitor/config?tenant_id=...`
   - `/api/v1/idle-monitor/summary?...`
   - `/api/v1/idle-monitor/details?...`

如果这些请求返回 404 或 500 错误，检查后端服务。

---

## 🛠️ 完整重启流程

如果以上都不行，执行完整重启：

```bash
# 1. 停止所有服务
# 前端：Ctrl+C
# 后端：找到进程并停止
ps aux | grep uvicorn
kill -9 <进程ID>

# 2. 重启后端
cd backend
source venv/bin/activate
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# 3. 等待几秒，然后在新终端重启前端
cd frontend
rm -rf node_modules/.vite
npm run dev

# 4. 清除浏览器缓存并强制刷新 (Ctrl+Shift+R)
```

---

## 📝 文件位置确认

确认所有文件都存在：

```bash
# 前端文件
ls -la frontend/src/views/dashboard/IdleMonitor.vue
ls -la frontend/src/api/dashboard.ts
ls -la frontend/src/router/index.ts
ls -la frontend/src/layouts/MainLayout.vue

# 后端文件
ls -la backend/app/api/idle_monitor.py
ls -la backend/app/models/idle_monitor_config.py
ls -la backend/app/models/collector_idle_record.py
```

所有文件都应该存在。

---

## 🎯 当前功能状态

### ✅ 已实现（可以使用）
- 页面UI完整
- 筛选功能
- 配置功能界面
- 详情查看界面
- API接口（全部8个）
- 路由和菜单

### ⚠️ 需要数据（显示为空）
- 总览数据（会显示0，因为没有实际数据）
- 趋势图表（会显示空）
- 详情列表（会显示"暂无数据"）

**这是正常的！** 因为还没有实现数据计算引擎，数据库表中没有数据。

### ❌ 待实现功能
- 空闲识别算法
- 定时数据计算任务
- 行为数据采集
- Excel导出功能

---

## 💡 预期效果

**当前状态（正常）：**
- ✅ 页面可以正常打开
- ✅ UI显示完整
- ✅ 筛选器可以操作
- ✅ 配置弹窗可以打开
- ✅ 所有按钮可以点击
- ⚠️ 数据显示为0或空（因为没有实际数据）

**完成数据计算后：**
- ✅ 所有功能同上
- ✅ 显示真实的空闲数据
- ✅ 图表显示趋势
- ✅ 列表显示催员空闲记录

---

## 📞 需要帮助？

### 查看详细日志

**后端日志**：
```bash
# 查看uvicorn服务的输出
# 应该在运行uvicorn的终端看到
```

**前端日志**：
```bash
# 查看vite dev server的输出
# 应该在运行npm run dev的终端看到
```

**浏览器日志**：
按 F12 打开开发者工具，查看 Console 标签

### 常见错误和解决方案

| 错误信息 | 原因 | 解决方案 |
|---------|------|---------|
| 404 Not Found | 路由未找到 | 检查路由配置，重启前端 |
| 500 Internal Server Error | 后端错误 | 查看后端日志，检查数据库连接 |
| Network Error | 服务未运行 | 确认前后端服务都在运行 |
| 页面空白 | 组件加载失败 | 清除缓存，强制刷新 |
| 菜单不能点击 | 缓存问题 | 清除浏览器缓存 |

---

## ✨ 快速验证命令

运行这个命令快速验证所有服务状态：

```bash
echo "=== 检查后端服务 ==="
ps aux | grep uvicorn | grep -v grep && echo "✅ 后端服务运行中" || echo "❌ 后端服务未运行"

echo ""
echo "=== 检查前端文件 ==="
test -f frontend/src/views/dashboard/IdleMonitor.vue && echo "✅ IdleMonitor.vue 存在" || echo "❌ 文件不存在"

echo ""
echo "=== 检查后端文件 ==="
test -f backend/app/api/idle_monitor.py && echo "✅ idle_monitor.py 存在" || echo "❌ 文件不存在"

echo ""
echo "=== 测试后端API ==="
curl -s http://localhost:8000/api/v1/idle-monitor/config?tenant_id=1 | head -c 100 && echo "" && echo "✅ API响应正常" || echo "❌ API无响应"

echo ""
echo "=== 检查完成 ==="
```

---

## 🎉 成功标志

当您看到以下内容时，说明功能正常：

1. ✅ 菜单中的"空闲催员监控"可以点击
2. ✅ 点击后页面跳转到空闲监控看板
3. ✅ 页面显示完整的UI（即使数据为空）
4. ✅ 筛选器可以操作
5. ✅ "空闲配置"按钮可以点击并弹出对话框
6. ✅ 浏览器控制台没有红色错误

---

**最后更新**：2025-11-20  
**状态**：前后端框架完成，等待数据计算引擎实现

