# MySQL è¿ç§»é—®é¢˜è¯´æ˜

## ğŸš¨ å‘ç°çš„é—®é¢˜

åœ¨è¿ç§»åˆ° MySQL çš„è¿‡ç¨‹ä¸­,å‘ç°äº†ä¸€ä¸ªä¸¥é‡çš„æ•°æ®åº“è®¾è®¡é—®é¢˜:

### å¤–é”®ç±»å‹ä¸åŒ¹é…

**é—®é¢˜æè¿°**:
ç³»ç»Ÿä¸­çš„æ¨¡å‹æ··ç”¨äº† `Integer` å’Œ `BigInteger` ç±»å‹,å¯¼è‡´å¤–é”®çº¦æŸæ— æ³•åˆ›å»ºã€‚

**å…·ä½“ä¾‹å­**:
```python
# field_group.py
id = Column(Integer, primary_key=True)  # Integer ç±»å‹

# standard_field.py
field_group_id = Column(BigInteger, ForeignKey('field_groups.id'))  # BigInteger ç±»å‹
```

MySQL è¦æ±‚å¤–é”®çš„ç±»å‹å¿…é¡»ä¸å¼•ç”¨çš„ä¸»é”®ç±»å‹å®Œå…¨åŒ¹é…,ä½† SQLite å¯¹æ­¤è¦æ±‚è¾ƒå®½æ¾ã€‚

### å½±å“èŒƒå›´

æ£€æŸ¥å‘ç°è‡³å°‘ä»¥ä¸‹è¡¨å­˜åœ¨æ­¤é—®é¢˜:
- `field_groups` â† `standard_fields`
- `field_groups` â† `custom_fields`  
- `tenants` â† `cases`
- `collection_agencies` â† `cases`
- `collection_teams` â† `cases`
- `collectors` â† `cases`
- ç­‰ç­‰...

## ğŸ“Š è§£å†³æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ A: ä¿®å¤æ‰€æœ‰å¤–é”®ç±»å‹ (ä¸æ¨è)

**ä¼˜ç‚¹**:
- å½»åº•è§£å†³é—®é¢˜
- ç¬¦åˆ MySQL è§„èŒƒ

**ç¼ºç‚¹**:
- éœ€è¦ä¿®æ”¹å¤§é‡æ¨¡å‹æ–‡ä»¶ (20+ ä¸ªæ–‡ä»¶)
- éœ€è¦è¿ç§»ç°æœ‰ SQLite æ•°æ®
- å¯èƒ½å½±å“ç°æœ‰åŠŸèƒ½
- å·¥ä½œé‡å¤§,é£é™©é«˜

**å·¥ä½œé‡**: é¢„è®¡ 2-3 å°æ—¶

### æ–¹æ¡ˆ B: ç»§ç»­ä½¿ç”¨ SQLite (æ¨è)

**ä¼˜ç‚¹**:
- æ— éœ€ä¿®æ”¹ä»£ç 
- ç°æœ‰åŠŸèƒ½ä¸å—å½±å“
- å¼€å‘ç¯å¢ƒå®Œå…¨å¤Ÿç”¨
- é›¶é£é™©

**ç¼ºç‚¹**:
- å¹¶å‘æ€§èƒ½è¾ƒä½
- ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ

**é€‚ç”¨åœºæ™¯**: å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ

### æ–¹æ¡ˆ C: ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ MySQL,å¼€å‘ç¯å¢ƒä½¿ç”¨ SQLite (æœ€ä½³)

**ä¼˜ç‚¹**:
- å¼€å‘ç¯å¢ƒç®€å•å¿«é€Ÿ
- ç”Ÿäº§ç¯å¢ƒæ€§èƒ½å¥½
- åˆ†ç¦»å…³æ³¨ç‚¹

**ç¼ºç‚¹**:
- éœ€è¦ç»´æŠ¤ä¸¤å¥—é…ç½®
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ—¶éœ€è¦ä¿®å¤å¤–é”®é—®é¢˜

**å®æ–½æ–¹æ¡ˆ**:
1. å¼€å‘ç¯å¢ƒç»§ç»­ä½¿ç”¨ SQLite
2. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ç»Ÿä¸€ä¿®å¤å¤–é”®ç±»å‹
3. ä½¿ç”¨ Alembic ç®¡ç†æ•°æ®åº“è¿ç§»

## ğŸ¯ å½“å‰å»ºè®®

### ç«‹å³æ“ä½œ: å›æ»šåˆ° SQLite

```bash
cd /Users/zhangyang/Documents/GitHub/CollectionONE/backend

# ä¿®æ”¹ .env æ–‡ä»¶
echo "DATABASE_URL=sqlite:///./cco_test.db" > .env

# é‡å¯åç«¯æœåŠ¡
bash restart_backend.sh
```

### é•¿æœŸè®¡åˆ’

1. **çŸ­æœŸ (å¼€å‘é˜¶æ®µ)**:
   - ç»§ç»­ä½¿ç”¨ SQLite
   - åŠŸèƒ½å¼€å‘å’Œæµ‹è¯•

2. **ä¸­æœŸ (å‡†å¤‡ä¸Šçº¿)**:
   - ç»Ÿä¸€ä¿®å¤æ‰€æœ‰å¤–é”®ç±»å‹ä¸º `BigInteger`
   - åˆ›å»º Alembic è¿ç§»è„šæœ¬
   - åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ MySQL

3. **é•¿æœŸ (ç”Ÿäº§ç¯å¢ƒ)**:
   - ä½¿ç”¨ MySQL
   - é…ç½®ä¸»ä»å¤åˆ¶
   - å®æ–½å¤‡ä»½ç­–ç•¥

## ğŸ”§ å¦‚æœå¿…é¡»ä½¿ç”¨ MySQL

### ä¸´æ—¶è§£å†³æ–¹æ¡ˆ: ç¦ç”¨å¤–é”®æ£€æŸ¥

åœ¨åˆ›å»ºè¡¨ä¹‹å‰ç¦ç”¨å¤–é”®æ£€æŸ¥:

```python
# åœ¨ create_mysql_tables.py ä¸­
from sqlalchemy import text

with engine.connect() as conn:
    conn.execute(text("SET FOREIGN_KEY_CHECKS=0"))
    Base.metadata.create_all(bind=engine)
    conn.execute(text("SET FOREIGN_KEY_CHECKS=1"))
    conn.commit()
```

**è­¦å‘Š**: è¿™ä¼šé™ä½æ•°æ®å®Œæ•´æ€§ä¿è¯!

### æ°¸ä¹…è§£å†³æ–¹æ¡ˆ: ç»Ÿä¸€ç±»å‹

éœ€è¦ä¿®æ”¹æ‰€æœ‰æ¨¡å‹,å°†å¤–é”®ç»Ÿä¸€ä¸º `BigInteger`:

```python
# ä¿®æ”¹å‰
id = Column(Integer, primary_key=True)
field_group_id = Column(BigInteger, ForeignKey('field_groups.id'))

# ä¿®æ”¹å  
id = Column(BigInteger, primary_key=True)
field_group_id = Column(BigInteger, ForeignKey('field_groups.id'))
```

## ğŸ“ æ€»ç»“

**å½“å‰çŠ¶æ€**:
- âœ… MySQL å·²å®‰è£…å¹¶è¿è¡Œ
- âœ… æ•°æ®åº“å’Œç”¨æˆ·å·²åˆ›å»º
- âœ… Python é©±åŠ¨å·²å®‰è£…
- âŒ è¡¨ç»“æ„æ— æ³•åˆ›å»º (å¤–é”®ç±»å‹ä¸åŒ¹é…)

**å»ºè®®æ“ä½œ**:
1. å›æ»šåˆ° SQLite (ç«‹å³)
2. ç»§ç»­åŠŸèƒ½å¼€å‘
3. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰å†å¤„ç† MySQL è¿ç§»

**é¢„è®¡å½±å“**:
- å¼€å‘ç¯å¢ƒ: æ— å½±å“
- åŠŸèƒ½å¼€å‘: æ— å½±å“
- æ€§èƒ½: å¼€å‘ç¯å¢ƒå¤Ÿç”¨

---

**ç»“è®º**: å»ºè®®æš‚æ—¶å›æ»šåˆ° SQLite,ä¸“æ³¨äºåŠŸèƒ½å¼€å‘ã€‚MySQL è¿ç§»ç•™å¾…ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ç»Ÿä¸€å¤„ç†ã€‚

