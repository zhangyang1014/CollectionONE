# 字段数据更新说明

## 📋 更新日期
2024-11-11

## 🎯 更新目标

明确"标准字段管理"的定义和边界：
- **标准字段** = 系统级通用字段，所有甲方自动继承，用于规则判断、展示、排序等
- **拓展字段** = 移至"甲方自定义字段管理"，由各甲方根据自身业务需求自行管理

## ✅ 已完成的变更

### 1. 标准字段精简（移除拓展字段）

**变更前：**
- 总字段数：112个
- 标准字段：88个
- 拓展字段：24个

**变更后：**
- 总字段数：84个（仅标准字段）
- 移除字段：28个（拓展字段）

### 2. 被移除的拓展字段列表

以下字段已从"标准字段管理"中移除，应作为"甲方自定义字段"管理：

#### 客户基础信息相关（2个）
1. `nationality` - 国籍
2. `income_proof_files` - 收入证明文件

#### 贷款详情相关（9个）
3. `contract_no` - 合同编号
4. `disbursement_channel` - 放款渠道
5. `collection_entry_time` - 入催时间
6. `overdue_days_loan` - 当前逾期天数
7. `next_collection_time` - 下次催收时间
8. `collection_status` - 催收状态
9. `collection_stage` - 催收阶段
10. `repayment_method` - 还款方式
11. `last_payment_date` - 最近还款日期

#### 借款记录相关（6个）
12. `merchant_name` - 贷超商户
13. `system_name` - 所属系统
14. `app_download_url` - App下载链接
15. `reborrow_flag` - 是否复借
16. `auto_reloan` - 自动复借
17. `first_term_days` - 首期期限
18. `remark` - 备注
19. `principal_due_borrow` - 应还本金

#### 还款记录相关（7个）
20. `bill_id` - 对应账单ID
21. `transaction_id` - 交易流水号
22. `transaction_time` - 交易时间
23. `transaction_fee` - 手续费
24. `received_amount` - 实收金额
25. `waived_amount_repay` - 减免金额
26. `repayment_remark` - 还款备注

#### 分期详情相关（2个）
27. `waived_amount_install` - 减免金额
28. `installment_channel` - 分期还款渠道

### 3. 前端菜单更新

**变更前：** "自定义字段管理"  
**变更后：** "甲方自定义字段管理"

**影响文件：**
- `frontend/src/router/index.ts`
- `frontend/src/views/field-config/CustomFields.vue`
- `frontend/src/i18n/locales/zh-CN.ts`

### 4. 后端数据文件更新

**变更文件：**
- `backend/mock_field_data.py` - 仅保留84个标准字段
- `backend/mock_field_data_with_extended.py.bak` - 原始数据备份（包含112个字段）

## 📊 当前标准字段统计

### 按分组统计

| 分组 | 字段数 | 说明 |
|-----|-------|------|
| 基础身份信息 | 10 | 用户编号、姓名、性别、证件等核心身份信息 |
| 教育信息 | 3 | 教育程度、学校、专业 |
| 职业信息 | 11 | 工作状态、公司、职位、收入等 |
| 用户行为与信用 | 10 | App使用行为、借款历史、信用评分 |
| 贷款详情 | 14 | 贷款编号、金额、状态等核心贷款信息 |
| 借款记录 | 19 | 借款申请、审批、处理信息 |
| 还款记录 | 6 | 还款时间、金额、渠道等核心还款信息 |
| 分期详情 | 11 | 分期编号、状态、应还金额等 |
| **总计** | **84** | |

### 按字段类型统计

- **必填字段**：6个
  - user_id, user_name (客户基础)
  - loan_id, outstanding_amount (贷款详情)
  - loan_id_borrow, mobile_number (借款记录)
  
- **非必填字段**：78个

### 按数据类型统计

- String: 30个
- Integer: 11个
- Decimal: 16个
- Datetime: 8个
- Date: 3个
- Enum: 15个
- Boolean: 1个

## 💡 设计理念

### 标准字段 (Standard Fields)
- **定位**：系统级通用字段
- **特征**：
  - 所有甲方自动继承
  - 用于系统规则判断、展示、排序
  - 不可由甲方删除，但可配置映射关系
  - SaaS服务统一维护和升级
- **管理**：由系统管理员统一管理

### 甲方自定义字段 (Tenant Custom Fields)
- **定位**：甲方特定业务字段
- **特征**：
  - 由各甲方根据自身需求创建
  - 支持字段映射（甲方字段名 -> 系统字段名）
  - 可随时新增、修改、删除
  - 仅对创建甲方可见
- **管理**：由各甲方管理员自行管理

### 字段映射机制
无论是标准字段还是自定义字段，都支持字段映射功能：
- **系统字段标识** (field_key) - SaaS内部统一标识
- **甲方字段标识** (tenant_field_key) - 甲方系统中的字段名
- **映射关系** - 在甲方配置中建立，实现数据自动转换

## 🔄 数据迁移说明

### 对现有数据的影响
1. **Mock服务器**：
   - 已更新为84个标准字段
   - 移除的28个字段仍在备份文件中

2. **前端界面**：
   - "标准字段管理"页面现在只显示84个字段
   - "甲方自定义字段管理"菜单名称已更新

3. **数据库**：
   - 本次为Mock数据更新，不影响实际数据库
   - 生产环境迁移时需要：
     - 将拓展字段（is_extended=true）迁移到自定义字段表
     - 更新甲方字段配置关联关系

### 验证方法
```bash
# 1. 启动Mock服务器
cd backend
python3 simple_server.py

# 2. 验证字段数量
curl http://localhost:8000/api/v1/standard-fields | python3 -c "import sys, json; data=json.load(sys.stdin); print(f'标准字段数: {len(data[\"data\"])}')"

# 3. 访问前端
open http://localhost:5173
# 进入"字段配置" -> "标准字段管理"，应显示84个字段
# 菜单中应显示"甲方自定义字段管理"
```

## 📚 相关文档

- `CCO字段配置系统设计.md` - 系统设计文档
- `backend/mock_field_data.py` - 标准字段数据文件
- `backend/字段数据导入说明.md` - 原始导入说明（已过时）
- `backend/字段数据更新说明.md` - 本文档（最新）

## ⚠️ 注意事项

1. **字段ID变更**：移除拓展字段后，标准字段ID已重新编号（1-84）
2. **备份文件**：原始数据已备份到 `mock_field_data_with_extended.py.bak`
3. **兼容性**：现有使用拓展字段的代码需要调整为使用自定义字段
4. **生产迁移**：生产环境需要制定完整的数据迁移方案

---

**更新人员**: AI Assistant  
**更新日期**: 2024-11-11  
**审核状态**: 待审核

