| 版本 | 日期 | 变更内容 | 变更人 |
| --- | --- | --- | --- |
| V1.0 | 2025-12-09 | 初稿 | 大象 |

## 1. 背景与目标
- 甲方在上传案件后，可能多次更新案件信息（状态、字段等），需要在控台端留痕、可追溯、可筛查。
- 目标：在控台端提供“案件更新日志”能力，便于运营、质检、合规快速查看案件的历史变更。

## 2. 范围
- 本次仅覆盖前端 UI/交互层：展示、筛选、排序、详情查看。
- 后端接口、存储、审计策略不在本次范围，但前端会依赖接口返回数据；若接口未就绪，需提供占位提示。

## 3. 角色与场景
- 运营/质检/合规人员：需要追溯指定案件在某时间段内的状态或字段变更。
- 管理员：需要对某批次上传案件的变更情况做抽查或导出。

## 4. 功能需求
### 4.1 入口与导航
- 在控台侧边栏“日志记录”下新增“案件更新日志”入口。
- 页面默认按更新时间倒序展示。

### 4.2 列表展示
- 必备字段：案件ID（可点击跳转案件详情新标签页）、案件名称/编号（若有）、更新时间、操作人/来源（系统任务、甲方同步、人工）、变更类型（状态变更/字段变更/批量变更）、变更概述（简述关键差异）。
- 变更概述规则：
  - 状态变更：显示“状态：旧值 → 新值”。
  - 字段变更：显示“字段X：旧值 → 新值”；多个字段时显示前1条 + “…共N项”。
  - 批量或多字段变更时支持点击“查看详情”。
- 支持分页，分页大小默认20，可切换10/20/50。

### 4.3 筛选与搜索
- 关键词搜索：支持案件ID、案件名称模糊。
- 时间筛选：按更新时间范围（必备）。
- 变更类型筛选：状态变更、字段变更、批量变更（多选）。
- 操作来源筛选：甲方同步、系统任务、人工操作（多选）。
- 状态筛选：针对状态变更记录，可按新状态筛选。
- 筛选条件在同一行集中展示，可重置。

### 4.4 排序
- 默认按更新时间倒序。
- 允许切换：更新时间正序/倒序。

### 4.5 详情查看
- 列表行提供“查看详情”按钮/链接，打开右侧抽屉或弹窗。
- 详情内容：
  - 基础信息：案件ID、案件名称/编号、批次号（如有）、操作时间、操作人/来源。
  - 变更明细：逐项列出字段名、旧值、新值；状态变更需明确“旧状态/新状态”。
  - 若字段值为长文本/JSON，采用折叠展开显示。
- 支持在详情中复制单项字段值。

### 4.6 空态与异常
- 无数据：展示空态提示“暂无更新记录”，提供“重置筛选”按钮。
- 接口失败：展示错误提示与“刷新重试”。
- 加载中：显示骨架屏或加载动画，不阻塞筛选区域。

### 4.7 权限与可见性
- 页面需受登录与角色权限控制；无权限时隐藏入口或提示“无权限查看”。
- 操作人/来源字段在 UI 显示时需脱敏规则可配置（如仅显示姓名首字、或“甲方系统”）。

### 4.8 性能与体验
- 支持列表懒加载/分页，避免一次性加载过大。
- 筛选切换应保留当前查询条件，刷新后可通过 URL query 还原（如 ?caseId=xxx&dateFrom=...）。

## 5. 数据展示与接口依赖（前端预期）
- 前端预期接口返回字段（示意，供联调对齐；后端非本次范围）：
```json
{
  "records": [
    {
      "caseId": "C123",
      "caseName": "张三-20241001",
      "batchId": "BATCH-01",
      "updatedAt": "2025-12-01T12:00:00Z",
      "actor": "甲方同步",
      "changeType": "status", 
      "summary": "状态：待分配 → 已分配",
      "diffItems": [
        { "field": "status", "oldValue": "待分配", "newValue": "已分配" },
        { "field": "collector", "oldValue": "", "newValue": "李四" }
      ]
    }
  ],
  "total": 123
}
```
- 前端字段映射：
  - `changeType` 枚举映射为“状态变更/字段变更/批量变更”。
  - `diffItems` 用于详情明细；`summary` 用于列表概述。
  - `actor` 可能为用户姓名、岗位、或“甲方系统/自动任务”。

## 6. 交互流程（简版）
- 用户进入“案件更新日志”页 → 查看默认列表 → 可输入案件ID或名称搜索 → 选择时间范围、变更类型、操作来源筛选 → 点击某行“查看详情” → 在详情抽屉中查看字段级差异，必要时复制字段值。
- 用户也可以从案件列表里，点击“更新日志”进入此页

## 7. 验收标准
- 能按更新时间倒序展示案件更新记录，字段完整且对齐预期。
- 能基于案件ID/名称、时间范围、变更类型、操作来源进行组合筛选，结果正确。
- 详情可展开查看字段级旧值/新值，长文本可折叠，复制正常。
- 无数据、接口失败、加载中的状态表现符合预期。
- 权限不足时入口隐藏或提示无权限。

## 8. 依赖与风险
- 依赖后端提供稳定的案件更新日志接口；若接口字段缺失需前后端对齐。
- 若变更字段数量过多，需要后端分页或前端懒加载以避免详情渲染卡顿。
- 需确认操作人脱敏策略与展示口径，避免泄露敏感信息。
