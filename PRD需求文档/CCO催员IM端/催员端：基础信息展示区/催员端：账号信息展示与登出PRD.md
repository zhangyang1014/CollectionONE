# 催员端：账号信息展示与登出 PRD

## 📋 文档信息

| 项目 | 内容 |
|------|------|
| **产品名称** | CCO催员IM端 |
| **功能模块** | 账号信息展示与登出 |
| **PRD版本** | V1.0 |
| **文档作者** | 产品团队 |
| **创建日期** | 2024-12-04 |
| **最后更新** | 2024-12-04 |

---

## 1. 功能概述

### 1.1 功能简介
在催员工作台页面的右上角，提供账号信息展示入口，催员可以通过悬浮查看账号基本信息，并执行退出登录操作。

### 1.2 应用场景
- 催员需要快速查看自己的账号信息（ID、企业、机构）
- 催员需要切换账号或下班时退出登录
- 系统管理员需要帮助催员确认当前登录账号

### 1.3 用户价值
- **信息透明**：随时查看当前登录的账号信息
- **操作便捷**：快速退出登录，支持多账号切换
- **界面简洁**：信息精简，重点突出

---

## 2. 需求背景

### 2.1 业务背景
- 催员可能管理多个账号，需要清晰知道当前登录的是哪个账号
- 不同催员可能属于不同的企业（甲方）和机构（催收公司），需要明确展示
- 催员下班或切换账号时需要安全退出

### 2.2 优化原因
- **去除冗余信息**：移除催员姓名显示（账号ID已足够标识）
- **简化交互**：移除WhatsApp相关功能，聚焦核心信息
- **提升体验**：统一信息层级，添加明确的字段标签

---

## 3. 功能详情

### 3.1 功能入口

**位置**：催员工作台页面右上角

**展示内容**：
```
┌──────────────────┐
│  [B]  BTQ001  ▼  │  ← 头像 + 催员ID + 下拉箭头
└──────────────────┘
```

**说明**：
- 头像显示催员ID的首字母（如：BTQ001 显示 "B"）
- 催员ID明确显示完整编号
- 下拉箭头提示可以点击查看更多

---

### 3.2 悬浮展示信息

**触发方式**：鼠标悬浮在账号信息区域

**展示内容**：

```
┌─────────────────────────┐
│ 催员ID: BTQ001          │
│ 企业名: 百腾企业        │
│ 机构名: 墨西哥催收部    │
├─────────────────────────┤
│ 🔄 登出催收账号         │
└─────────────────────────┘
```

**字段说明**：

| 字段名 | 说明 | 示例 | 是否必填 |
|--------|------|------|----------|
| **催员ID** | 催员的唯一标识编号 | BTQ001 | 是 |
| **企业名** | 催员服务的甲方企业名称 | 百腾企业 | 是 |
| **机构名** | 催员所属的催收机构/团队 | 墨西哥催收部 | 是 |

---

### 3.3 退出登录功能

**触发方式**：点击"登出催收账号"

**交互流程**：

```
用户点击"登出催收账号"
    ↓
弹出确认对话框
"确定要退出登录吗？"
    ↓
用户点击"确定"
    ↓
清除登录状态（token、用户信息）
    ↓
跳转到登录页
    ↓
提示"已退出登录"
```

**确认对话框**：
- **标题**：提示
- **内容**：确定要退出登录吗？
- **按钮**：
  - 确定（红色）
  - 取消（灰色）

---

## 4. 界面设计

### 4.1 视觉规范

**账号信息入口**：
- 头像：32px 圆形，浅绿色背景
- 催员ID：14px 字体，常规色
- 下拉箭头：图标

**悬浮面板**：
- 背景：白色
- 圆角：4px
- 阴影：0 2px 12px 0 rgba(0,0,0,.1)
- 最小宽度：200px

**字段样式**：
- 字段标签：灰色（#909399）
- 字段值：深色（#303133）
- 行高：28px
- 字号：14px

**退出按钮**：
- 图标：红色（#F56C6C）
- 文字：红色（#F56C6C）
- 悬浮效果：背景淡红色

---

### 4.2 响应式设计

| 屏幕尺寸 | 适配方案 |
|----------|----------|
| **桌面端** | 完整显示，最小宽度200px |
| **平板** | 完整显示，自适应宽度 |
| **移动端** | 固定右上角，悬浮面板居中显示 |

---

## 5. 交互规范

### 5.1 悬浮交互

| 操作 | 响应 |
|------|------|
| 鼠标悬浮 | 显示下拉菜单 |
| 鼠标移开 | 自动隐藏菜单 |
| 点击账号信息 | 显示/隐藏菜单（切换） |
| 点击菜单外部 | 自动关闭菜单 |

### 5.2 退出登录交互

| 步骤 | 用户操作 | 系统响应 |
|------|----------|----------|
| 1 | 点击"登出催收账号" | 弹出确认对话框 |
| 2 | 点击"确定" | 清除登录状态，跳转登录页 |
| 3 | 点击"取消" | 关闭对话框，留在当前页 |

### 5.3 异常处理

| 异常场景 | 处理方案 |
|----------|----------|
| 用户信息为空 | 显示占位符 "-" |
| 退出登录失败 | 提示错误信息，不跳转页面 |
| 网络断开 | 本地清除状态，直接跳转登录页 |

---

## 6. 数据字段

### 6.1 用户信息对象

```typescript
interface ImUser {
  id: string                    // 用户ID
  collectorId: string           // 催员ID（必填）
  collectorName: string         // 催员姓名
  tenantId: string              // 甲方企业ID
  tenantName: string            // 甲方企业名称（必填）
  team: string                  // 机构/团队名称（必填）
  role: string                  // 角色
  permissions: string[]         // 权限列表
  token: string                 // 登录凭证
}
```

### 6.2 显示字段映射

| 界面显示 | 字段名 | 数据类型 | 备注 |
|----------|--------|----------|------|
| 催员ID | `collectorId` | string | 必填 |
| 企业名 | `tenantName` | string | 必填 |
| 机构名 | `team` | string | 必填 |

---

## 7. 技术实现

### 7.1 前端组件

**文件位置**：`frontend/src/views/im/CollectorWorkspace.vue`

**核心代码**：

```vue
<!-- 账号信息入口 -->
<el-dropdown @command="handleAccountCommand" trigger="hover">
  <div class="account-info">
    <el-avatar :size="32">{{ user?.collectorId?.[0] }}</el-avatar>
    <span class="collector-id">{{ user?.collectorId }}</span>
    <el-icon><ArrowDown /></el-icon>
  </div>
  
  <!-- 悬浮面板 -->
  <template #dropdown>
    <el-dropdown-menu>
      <el-dropdown-item disabled>
        <div class="account-details">
          <div class="text-secondary">催员ID: {{ user?.collectorId }}</div>
          <div class="text-secondary">企业名: {{ user?.tenantName }}</div>
          <div class="text-secondary">机构名: {{ user?.team }}</div>
        </div>
      </el-dropdown-item>
      
      <!-- 退出登录 -->
      <el-dropdown-item divided command="logout-all">
        <el-icon style="color: #F56C6C"><SwitchButton /></el-icon>
        <span style="color: #F56C6C">登出催收账号</span>
      </el-dropdown-item>
    </el-dropdown-menu>
  </template>
</el-dropdown>
```

### 7.2 退出登录逻辑

```typescript
const handleAccountCommand = async (command: string) => {
  if (command === 'logout-all') {
    await ElMessageBox.confirm(
      '确定要退出登录吗？',
      '提示',
      {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }
    )
    await imUserStore.logout()
    router.push('/im/login')
    ElMessage.success('已退出登录')
  }
}
```

### 7.3 数据来源

- **用户状态管理**：`stores/imUser.ts`
- **数据持久化**：localStorage（`im_token`、`im_user`）
- **API接口**：`/api/im/logout`

---

## 8. 验收标准

### 8.1 功能验收

- [ ] **账号信息展示**
  - [ ] 头像显示催员ID首字母
  - [ ] 催员ID完整显示
  - [ ] 下拉箭头正常显示

- [ ] **悬浮面板**
  - [ ] 鼠标悬浮正常展开
  - [ ] 催员ID正确显示
  - [ ] 企业名正确显示
  - [ ] 机构名正确显示
  - [ ] 移开鼠标自动收起

- [ ] **退出登录**
  - [ ] 点击弹出确认对话框
  - [ ] 对话框文案正确
  - [ ] 点击"确定"成功退出
  - [ ] 点击"取消"保持登录
  - [ ] 退出后跳转登录页
  - [ ] 退出后清除本地状态

### 8.2 界面验收

- [ ] **样式符合设计稿**
  - [ ] 字体大小、颜色正确
  - [ ] 间距、对齐规范
  - [ ] 圆角、阴影效果正确

- [ ] **交互流畅**
  - [ ] 悬浮响应灵敏
  - [ ] 无闪烁或卡顿
  - [ ] 动画自然

### 8.3 兼容性验收

- [ ] **浏览器兼容**
  - [ ] Chrome 最新版
  - [ ] Safari 最新版
  - [ ] Firefox 最新版
  - [ ] Edge 最新版

- [ ] **分辨率适配**
  - [ ] 1920x1080
  - [ ] 1366x768
  - [ ] 移动端（375x667）

### 8.4 异常场景验收

- [ ] 用户信息缺失时显示"-"
- [ ] 网络断开时可以退出登录
- [ ] 退出失败时有错误提示

---

## 9. 测试用例

### 9.1 正常流程测试

| 测试步骤 | 预期结果 |
|----------|----------|
| 1. 登录催员账号 | 右上角显示催员ID |
| 2. 鼠标悬浮账号信息 | 展开悬浮面板 |
| 3. 查看面板内容 | 显示催员ID、企业名、机构名 |
| 4. 点击"登出催收账号" | 弹出确认对话框 |
| 5. 点击"确定" | 跳转登录页，显示"已退出登录" |

### 9.2 边界条件测试

| 测试场景 | 输入数据 | 预期结果 |
|----------|----------|----------|
| 催员ID为空 | `collectorId: ""` | 显示 "-" |
| 企业名为空 | `tenantName: ""` | 显示 "企业名: -" |
| 机构名为空 | `team: ""` | 显示 "机构名: -" |
| 催员ID超长 | `collectorId: "VERYLONG..."` | 自动换行或截断 |

### 9.3 异常场景测试

| 测试场景 | 操作步骤 | 预期结果 |
|----------|----------|----------|
| 退出登录API失败 | 点击退出，模拟API错误 | 提示错误，不跳转 |
| 本地状态清除失败 | 点击退出，localStorage异常 | 仍然跳转登录页 |
| 网络断开 | 断网后点击退出 | 清除本地状态，跳转登录页 |

---

## 10. 上线计划

### 10.1 开发排期

| 阶段 | 负责人 | 工期 | 产出 |
|------|--------|------|------|
| **需求评审** | 产品 | 0.5天 | PRD定稿 |
| **UI设计** | 设计师 | 1天 | 设计稿 |
| **前端开发** | 前端工程师 | 1天 | 功能代码 |
| **联调测试** | 测试工程师 | 1天 | 测试报告 |
| **上线发布** | 运维 | 0.5天 | 线上版本 |

**总工期**：4天

### 10.2 上线检查清单

- [ ] 代码review完成
- [ ] 单元测试通过
- [ ] 集成测试通过
- [ ] UI还原度达标
- [ ] 性能指标达标
- [ ] 安全审查通过
- [ ] 文档更新完成

### 10.3 回滚方案

如果上线后出现严重问题：
1. **快速回滚**：恢复到上一版本代码
2. **降级方案**：仅显示催员ID，隐藏其他信息
3. **紧急修复**：修复bug后重新发布

---

## 11. FAQ

### Q1: 为什么不显示催员姓名？
**A**: 催员ID已经是唯一标识，姓名显示属于冗余信息。简化显示可以让信息更聚焦，界面更简洁。

### Q2: 为什么移除了WhatsApp相关功能？
**A**: WhatsApp连接状态管理已迁移到其他模块，账号信息面板专注于展示基础身份信息和退出登录功能。

### Q3: 如果用户信息缺失怎么办？
**A**: 系统会显示"-"作为占位符，不影响正常使用。建议在登录时确保用户信息完整。

### Q4: 退出登录后会清除哪些数据？
**A**: 会清除以下数据：
- localStorage 中的 `im_token`
- localStorage 中的 `im_user`
- Pinia store 中的用户状态

### Q5: 支持快捷键退出登录吗？
**A**: 当前版本不支持，未来可以考虑添加快捷键支持。

---

## 12. 附录

### 12.1 相关文档

- [催员登录功能PRD](./催员IM端登录功能PRD.md)
- [催员工作台PRD](./催员工作台PRD.md)
- [系统架构文档](../../文档/系统架构图.md)

### 12.2 技术实现文档

- [催员账号信息显示优化说明](../../说明文档/前端/催员账号信息显示优化.md)
- [用户状态管理](../../frontend/src/stores/imUser.ts)

### 12.3 设计规范

- Element Plus Dropdown 组件：https://element-plus.org/zh-CN/component/dropdown.html
- Element Plus MessageBox 组件：https://element-plus.org/zh-CN/component/message-box.html

---

## 13. 变更记录

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|----------|
| V1.0 | 2024-12-04 | 产品团队 | 初始版本，定义账号信息展示与退出登录功能 |

---

**文档状态**：✅ 已完成  
**评审状态**：⏳ 待评审  
**开发状态**：✅ 已开发  
**测试状态**：⏳ 待测试

