# 基于队列的案件重新自动分案配置PRD

## 变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|---------|--------|
| v1.0 | 2025-12-09 | 初始版本，完整PRD | 大象 |

---

## 一、产品需求（Product Requirements）

### 1. 项目背景与目标（Background & Goals）

在催收业务中，案件长期停留在单个催员手中会导致催收效率下降、回款率降低。本需求旨在建立**基于队列的案件重新自动分案机制**，当案件在催员手中停留超过配置天数后，自动重新分配给其他催员，激活案件催收、提高案件流转效率。通过队列维度的精细化配置，预期实现：

- **催收覆盖率提升30%**：案件定期重新分配，避免催员"养案"
- **回款率提升15%**：新催员介入带来新的催收策略和沟通角度
- **案件平均处理时长缩短20%**：案件流转加快，催员更积极处理
- **催员绩效公平性提升**：避免案件长期分配不均，保证催员工作饱和度

### 2. 业务场景与用户画像（Business Scenario & User）

**主要使用场景：**

1. **队列级别配置重新分案策略**
   - **场景**：运营经理为不同队列配置不同的重新分案天数
   - **入口**：案件管理 → 案件重新分案配置
   - **操作**：查看所有队列，为每个队列添加重新分案策略（针对不同小组可设置不同天数）
   - **频率**：中低频（约2-5次/月，根据业务调整）

2. **查看队列分案策略**
   - **场景**：查看某个队列下所有生效的重新分案策略
   - **入口**：案件管理 → 案件重新分案配置 → 展开队列
   - **操作**：展开队列查看该队列下所有策略（针对不同小组的配置）
   - **频率**：中频（约5-15次/周）

3. **为队列添加策略**
   - **场景**：为某个队列新增重新分案策略
   - **入口**：案件管理 → 案件重新分案配置 → 队列行操作列 → 添加策略
   - **操作**：
     1. 选择生效小组（可多选，不选表示针对所有小组）
     2. 设置重新分案天数（1-365天）
     3. 设置是否启用
   - **频率**：中频（约3-10次/周）

4. **编辑/删除策略**
   - **场景**：调整或删除已有的重新分案策略
   - **入口**：案件管理 → 案件重新分案配置 → 策略行操作列 → 编辑/删除
   - **操作**：修改天数、生效小组或删除策略
   - **频率**：低频（约1-5次/周）

5. **系统自动执行重新分案**
   - **场景**：定时任务每日检查并执行重新分案
   - **入口**：后台定时任务（每日02:00执行）
   - **操作**：系统自动扫描符合条件的案件，重新分配给同队列其他催员
   - **频率**：每日自动执行

**用户画像：**

| 用户类型 | 核心诉求 | 使用功能 | 使用频率 |
|---------|---------|---------|---------|
| **运营经理** | 优化重新分案策略提升回款率 | 查看队列策略、添加/编辑策略 | 中频（5-15次/周） |
| **系统管理员** | 为新队列配置默认重新分案策略 | 添加策略、启用/禁用策略 | 低频（2-5次/月） |
| **数据分析师** | 分析重新分案效果 | 查看队列策略、查看执行日志 | 低频（2-4次/月） |
| **系统（定时任务）** | 自动执行重新分案 | 后台定时任务 | 每日自动执行 |

### 3. 关键业务流程（Business Flow）

#### 3.1 配置重新分案策略流程

```
开始
  ↓
[运营经理] 进入案件重新分案配置页面
  ↓
[系统] 展示所有队列（树形结构）
  ├─ 有策略的队列：展示策略列表（子行）
  └─ 无策略的队列：展示占位行（生效小组=全部，天数=-，状态=停用）
  ↓
[运营经理] 点击队列行的"添加策略"按钮
  ↓
[系统] 弹出添加策略对话框
  ├─ 队列已确定（队列名称显示在标题）
  ├─ 选择生效小组（下拉多选，可选）
  ├─ 设置重新分案天数（1-365天）
  └─ 设置是否启用
  ↓
[运营经理] 填写表单并提交
  ↓
[系统] 验证配置
  ├─ 检查队列是否有小组（无小组则拒绝）
  ├─ 检查小组在该队列是否已有策略（有则提示冲突）
  └─ 验证天数范围（1-365）
  ↓
[系统] 保存策略配置
  ├─ 设置生效日期为 T+1（明天生效）
  └─ 刷新列表，新策略显示为子行
  ↓
结束
```

#### 3.2 自动重新分案执行流程

```
开始（每日02:00触发）
  ↓
[定时任务] 查询所有已生效的重新分案配置
  ├─ 条件1：is_active = true
  ├─ 条件2：effective_date <= 今天
  └─ 条件3：按队列+小组分组
  ↓
[定时任务] 遍历每个配置
  ↓
[定时任务] 查询符合条件的案件
  ├─ 案件队列 = 配置的队列
  ├─ 案件状态 = 未结清
  ├─ 当前催员所属小组 = 配置的小组（如果配置了小组）
  ├─ 案件在当前催员手中天数 >= 配置的天数
  └─ 案件未被标记为"停留"（不自动重新分案）
  ↓
[定时任务] 为每个案件重新分配催员
  ├─ 从同队列其他催员中选择（负载均衡）
  ├─ 优先分配给案件量少的催员
  ├─ 记录重新分案日志
  └─ 发送通知给新催员
  ↓
[定时任务] 生成执行报告
  ├─ 执行的配置数
  ├─ 重新分案的案件数
  ├─ 成功数/失败数
  └─ 发送报告给运营经理
  ↓
结束
```

### 4. 业务规则与边界（Business Rules & Scope）

#### 4.1 配置规则

**队列小组规则：**
- **队列必须有小组**：如果队列下没有小组，不允许创建重新分案配置
- **小组选择规则**：
  - 不选择任何小组：配置针对该队列下**所有小组**生效
  - 选择具体小组：配置只针对**选中的小组**生效
- **小组唯一性规则**：同一个队列下，同一个小组不能有多个配置
  - 如果配置针对"所有小组"，则与该队列下任何配置都冲突
  - 如果配置针对具体小组，则检查是否与现有配置的小组有交集

**重新分案天数规则：**
- **范围**：1-365天（整数）
- **含义**：案件在催员手中停留超过此天数后，自动重新分配
- **建议值**：
  - C队列（未逾期）：不建议配置（或配置较大天数如30天）
  - S0/S1队列（轻度逾期）：7-15天
  - L1队列（中度逾期）：5-10天
  - M1队列（重度逾期）：3-7天

**生效时间规则：**
- **T+1生效**：配置创建后，将在**明天生效**（effective_date = 今天 + 1天）
- **定时执行**：每天**02:00**执行重新分案定时任务
- **首次执行**：配置生效当天的02:00开始计算案件停留天数

**启用/禁用规则：**
- **启用（is_active=true）**：参与自动重新分案
- **禁用（is_active=false）**：不参与自动重新分案，已配置保留
- **禁用后**：已经按此配置重新分案的案件不受影响

#### 4.2 重新分案执行规则

**案件筛选条件：**
- ✅ 案件队列 = 配置的队列
- ✅ 案件状态 = 未结清（case_status != 'normal_settlement' && != 'extension_settlement'）
- ✅ 案件在当前催员手中天数 >= 配置的天数
  - 计算方式：今天 - 案件最后分配时间（assigned_at）
- ✅ 如果配置了小组：当前催员所属小组 = 配置的小组
- ✅ 如果配置为"所有小组"：不限制催员小组
- ❌ 案件未被标记为"停留"（is_stay != true）

**催员选择规则：**
- **同队列**：只能重新分配给同队列的催员
- **同小组**：优先分配给同小组的其他催员
- **跨小组**：如果配置针对"所有小组"且同小组无可用催员，可分配给同队列其他小组催员
- **负载均衡**：优先分配给案件量少的催员
- **排除原催员**：不能分配回原催员

**冲突处理：**
- **案件停留**：如果案件被手动标记为"停留"，不自动重新分案
- **催员满案**：如果所有催员都已满案（达到max_case_count），不重新分案，记录警告
- **无可用催员**：如果队列下无其他催员，不重新分案，记录警告

#### 4.3 本次需求范围

**范围内（In Scope）：**
- ✅ 队列重新分案配置管理（创建/查询/更新/删除）
- ✅ 基于队列的树形展示（队列作为父行，策略作为子行）
- ✅ 队列-小组维度配置（一个队列可针对不同小组配置不同天数）
- ✅ 配置冲突检测（同一队列同一小组不能有多个配置）
- ✅ 前端树形表格展示
- ✅ 定时任务自动执行重新分案（后端实现）
- ✅ 重新分案执行日志记录
- ✅ 重新分案通知（通知新催员）

**范围外（Out of Scope）：**
- ❌ 手动触发重新分案（后续迭代）
- ❌ 重新分案效果分析报表（后续迭代）
- ❌ 重新分案规则更复杂配置（如按案件金额、逾期天数等维度）
- ❌ 重新分案策略A/B测试（后续迭代）
- ❌ 催员维度的重新分案配置（本次仅支持队列维度）

### 5. 合规与风控要求（Compliance & Risk Control）

#### 5.1 合规要求

**催收合规：**
- **案件连续性**：重新分案后，新催员能查看案件的完整催收历史
- **客户体验**：避免频繁更换催员，建议重新分案天数不低于3天
- **操作留痕**：所有重新分案配置变更记录操作人、时间、变更内容
- **权限控制**：配置管理仅允许运营经理和系统管理员操作

**数据合规：**
- **数据隔离**：不同甲方的配置完全隔离
- **敏感信息保护**：重新分案日志不包含客户敏感信息
- **审计日志**：记录所有配置变更和重新分案执行，保留至少6个月

#### 5.2 风控要求

**业务风控：**
- **小组唯一性检查**：防止同一队列同一小组有重复配置
- **天数合理性检查**：警告重新分案天数过小（<3天）或过大（>90天）
- **执行频率控制**：每日仅执行一次，避免频繁重新分案

**系统风控：**
- **并发控制**：配置变更时加锁，避免并发修改冲突
- **事务完整性**：配置创建/更新/删除作为一个事务执行
- **数据一致性**：配置删除前检查是否在使用中

### 6. 资金路径与结算规则（Funding Flow & Settlement）

本功能不涉及资金流转，跳过此节。

### 7. 数据字段与口径（Data Definition）

#### 7.1 核心数据实体

**案件重新分案配置表（case_reassign_configs）**

| 字段名 | 数据类型 | 必填 | 说明 | 示例值 |
|-------|---------|-----|------|--------|
| id | BIGINT | ✅ | 主键ID | 1001 |
| tenant_id | BIGINT | ✅ | 所属甲方ID | 1 |
| config_type | VARCHAR(50) | ✅ | 配置类型（固定为'queue'） | "queue" |
| target_id | BIGINT | ✅ | 队列ID | 101 |
| team_ids | TEXT | ⬜ | 生效小组ID列表（JSON数组，NULL表示所有小组） | "[1,2,3]" 或 NULL |
| reassign_days | INT | ✅ | 重新分案天数（1-365） | 7 |
| is_active | BOOLEAN | ✅ | 是否启用 | true |
| effective_date | DATE | ✅ | 生效日期（T+1） | "2025-12-10" |
| created_at | DATETIME | ✅ | 创建时间 | "2025-12-09 14:30:00" |
| updated_at | DATETIME | ✅ | 更新时间 | "2025-12-09 14:30:00" |

**关联字段（案件表cases）**

| 字段名 | 数据类型 | 必填 | 说明 | 更新时机 |
|-------|---------|-----|------|---------|
| queue_id | BIGINT | ⬜ | 所属队列ID | 案件导入/队列归属变更 |
| assigned_at | DATETIME | ⬜ | 最后分配时间 | 案件分配/重新分案时 |
| is_stay | BOOLEAN | ⬜ | 是否标记为停留（不自动重新分案） | 手动标记停留时 |

**关联字段（催收小组表collection_teams）**

| 字段名 | 数据类型 | 必填 | 说明 | 更新时机 |
|-------|---------|-----|------|---------|
| queue_id | BIGINT | ⬜ | 负责队列ID | 小组创建/队列分配调整 |

#### 7.2 统计口径

**重新分案配置统计：**
- **口径**：统计每个队列下的配置数量
- **更新频率**：实时（查询时计算）
- **统计维度**：甲方维度、队列维度

**重新分案执行统计：**
- **口径**：统计每日重新分案的案件数量
- **更新频率**：每日（定时任务执行后）
- **统计维度**：甲方+队列+日期

### 8. 交互与信息展示（UX & UI Brief）

#### 8.1 树形表格页面

**页面入口**：案件管理 → 案件重新分案配置

**核心元素：**
- 甲方选择器（下拉框，联动加载队列数据）
- 功能说明提示（配置用途、生效规则）
- 树形表格（队列作为父行，策略作为子行）
- 刷新按钮

**表格结构：**

**父行（队列行）：**

| 列名 | 宽度 | 说明 |
|------|------|------|
| 队列名称 | 180px | 显示队列名称，带展开/收起图标 |
| 生效小组 | 200px | 显示"-"（父行不显示） |
| 重新分案天数 | 130px | 显示"-"（父行不显示） |
| 生效日期 | 110px | 显示"-"（父行不显示） |
| 状态 | 80px | 显示"-"（父行不显示） |
| 创建时间 | 160px | 显示"-"（父行不显示） |
| 操作 | 150px | 显示"添加策略"按钮 |

**子行（策略行）：**

| 列名 | 宽度 | 说明 |
|------|------|------|
| 队列名称 | 180px | 空白或缩进 |
| 生效小组 | 200px | 显示小组名称标签（多个），如果为空显示"-" |
| 重新分案天数 | 130px | 显示"X 天"标签 |
| 生效日期 | 110px | 显示日期，今天生效的标绿 |
| 状态 | 80px | 启用/禁用标签 |
| 创建时间 | 160px | 显示创建时间 |
| 操作 | 150px | 显示"编辑"和"删除"按钮 |

**占位行（队列无策略时）：**

| 列名 | 显示内容 |
|------|---------|
| 队列名称 | 空白或"(无策略)" |
| 生效小组 | "-" |
| 重新分案天数 | "-" |
| 生效日期 | "-" |
| 状态 | "停用"（灰色标签） |
| 创建时间 | "-" |
| 操作 | 空白（添加策略按钮在父行） |

#### 8.2 添加/编辑策略对话框

**对话框标题：**
- 添加：`添加策略 - {队列名称}`
- 编辑：`编辑策略 - {队列名称}`

**表单字段：**
1. **生效小组**（下拉多选，可选）
   - 占位符：`请选择小组（不选则针对该队列下所有小组）`
   - 禁用条件：队列下没有小组时禁用
   - 说明文字：`选择针对哪些小组生效，不选择则针对该队列下所有小组`
   - 错误提示：如果队列没有小组，显示红色警告："该队列下没有小组，无法创建重新分案配置"

2. **重新分案天数**（数字输入框，必填）
   - 范围：1-365天
   - 占位符：`请输入天数`
   - 说明文字：`案件在催员手中超过此天数后，将自动重新分配给其他催员`

3. **是否启用**（开关，默认开启）
   - 说明文字：`禁用后，该配置将不会生效`

4. **生效时间说明**（仅创建时显示）
   - 提示框：
     ```
     配置创建后，将在 T+1日 生效（即明天生效）
     定时任务将在每天 02:00 执行重新分案
     ```

**验证提示：**
- 小组冲突错误：`选择的小组在当前队列已有策略，请选择其他小组`
- 天数范围错误：`天数必须在1-365之间`
- 队列无小组错误：`该队列下没有小组，无法创建重新分案配置`

#### 8.3 删除确认对话框

**提示内容：**
```
确定要删除该配置吗？
删除后该配置将不再生效，已经按此配置重新分案的案件不受影响。
```

**按钮：**取消（灰色）、确定（红色）

### 9. 配置项与运营开关（Config & Operation Switches）

#### 9.1 系统配置项

| 配置项 | 默认值 | 说明 | 配置入口 | 变更流程 |
|-------|-------|------|---------|---------|
| reassign_task_enabled | true | 是否启用重新分案定时任务 | 系统配置管理 | 需开发变更 |
| reassign_task_cron | 0 0 2 * * ? | 定时任务执行时间（每日02:00） | 系统配置管理 | 需开发变更 |
| reassign_min_days | 1 | 重新分案最小天数 | 系统配置管理 | 需开发变更 |
| reassign_max_days | 365 | 重新分案最大天数 | 系统配置管理 | 需开发变更 |

#### 9.2 运营开关

| 开关名称 | 默认状态 | 说明 | 配置入口 | 影响范围 |
|---------|---------|------|---------|---------|
| 重新分案功能开关 | 开启 | 是否启用整个重新分案功能 | 系统配置 | 全局 |
| 队列配置校验 | 开启 | 是否启用队列小组唯一性校验 | 系统配置 | 全局 |

#### 9.3 灰度策略

本功能采用**按甲方维度**的灰度发布策略：

**阶段1（内测，1周）：**
- 灰度范围：1-2个测试甲方
- 验证内容：功能完整性、配置准确性、定时任务执行

**阶段2（小范围，2周）：**
- 灰度范围：5-10个甲方
- 验证内容：重新分案效果、用户反馈、业务指标

**阶段3（全量，1周）：**
- 灰度范围：所有甲方
- 监控指标：配置变更频率、重新分案案件数、回款率变化

---

## 二、数据需求（Data Requirements）

### 1. 埋点需求（Tracking Requirements）

| 触发时间点 | 埋点说明 | 埋点ID | 关键属性 |
|-----------|---------|--------|---------|
| 进入重新分案配置页面 | 页面访问 | `reassign_config_page_view` | user_id, tenant_id, queue_count, timestamp |
| 点击"添加策略"按钮 | 添加策略入口点击 | `reassign_add_strategy_click` | user_id, tenant_id, queue_id, queue_name, timestamp |
| 提交添加策略表单 | 策略创建提交 | `reassign_create_submit` | user_id, tenant_id, queue_id, team_ids, reassign_days, result, error_msg, timestamp |
| 点击"编辑"按钮 | 策略编辑入口点击 | `reassign_edit_click` | user_id, tenant_id, config_id, queue_id, timestamp |
| 提交编辑策略表单 | 策略编辑提交 | `reassign_edit_submit` | user_id, tenant_id, config_id, changed_fields, result, error_msg, timestamp |
| 点击"删除"按钮 | 策略删除入口点击 | `reassign_delete_click` | user_id, tenant_id, config_id, queue_id, timestamp |
| 确认删除策略 | 策略删除确认 | `reassign_delete_confirm` | user_id, tenant_id, config_id, result, timestamp |
| 展开/收起队列 | 队列展开/收起 | `reassign_queue_toggle` | user_id, tenant_id, queue_id, action(expand/collapse), timestamp |
| 配置冲突检测触发 | 小组冲突检测 | `reassign_conflict_check` | user_id, tenant_id, queue_id, team_ids, has_conflict, timestamp |
| 定时任务执行开始 | 重新分案任务开始 | `reassign_task_start` | tenant_id, config_count, timestamp |
| 定时任务执行完成 | 重新分案任务完成 | `reassign_task_complete` | tenant_id, config_count, case_count, success_count, failure_count, duration, timestamp |
| 单个案件重新分案 | 案件重新分配 | `reassign_case_execute` | tenant_id, case_id, config_id, old_collector_id, new_collector_id, result, timestamp |

---

## 三、技术部分描述（Technical Requirements / TRD）

### 1. 系统架构与模块划分（System Architecture & Modules）

#### 1.1 高层架构图

```
┌─────────────────────────────────────────────────────────────┐
│                    前端层（Frontend）                         │
│  ┌──────────────────────────────────────┐                   │
│  │  重新分案配置页面                     │                   │
│  │  CaseReassignConfig.vue              │                   │
│  └────────┬─────────────────────────────┘                   │
│           │                                                   │
│           ▼                                                   │
│  ┌──────────────────────────────────────┐                   │
│  │      API请求层(request.ts)           │                   │
│  └─────────────────┬────────────────────┘                   │
└────────────────────┼──────────────────────────────────────┘
                     │ HTTP/JSON
┌────────────────────┼──────────────────────────────────────┐
│                    ▼      后端层（Backend - Java）          │
│  ┌──────────────────────────────────────┐                   │
│  │       控制器层（Controller）         │                   │
│  │  CaseReassignConfigController        │                   │
│  └─────────────────┬────────────────────┘                   │
│                    │                                          │
│                    ▼                                          │
│  ┌──────────────────────────────────────┐                   │
│  │       业务层（Service）              │                   │
│  │  CaseReassignConfigService           │                   │
│  │  CaseReassignTaskService (新增)     │                   │
│  └─────────────────┬────────────────────┘                   │
│                    │                                          │
│                    ▼                                          │
│  ┌──────────────────────────────────────┐                   │
│  │       数据层（Mapper）               │                   │
│  │  CaseReassignConfigMapper            │                   │
│  └─────────────────┬────────────────────┘                   │
└────────────────────┼──────────────────────────────────────┘
                     │ MyBatis-Plus
┌────────────────────┼──────────────────────────────────────┐
│                    ▼      数据层（MySQL）                   │
│  ┌──────────────────────────────────────┐                  │
│  │  case_reassign_configs表             │                  │
│  └──────────────────────────────────────┘                  │
└─────────────────────────────────────────────────────────────┘
```

#### 1.2 模块职责

**前端模块：**
- `CaseReassignConfig.vue`：重新分案配置页面，树形展示队列和策略，支持添加/编辑/删除策略

**后端模块（已有）：**
- `CaseReassignConfigController`：配置管理API控制器（✅已创建）
- `CaseReassignConfigService`：配置业务逻辑服务（✅已创建）
- `CaseReassignConfigMapper`：配置数据访问层（✅已创建）

**后端模块（新增）：**
- `CaseReassignTaskService`：重新分案定时任务服务（➕新增）
- `CaseReassignScheduler`：定时任务调度器（➕新增）

### 2. 接口设计与系统依赖（API Design & Dependencies）

#### 2.1 内部接口

所有接口已在现有代码中实现，无需新增。主要接口包括：

**2.1.1 获取重新分案配置列表**
```
GET /api/v1/case-reassign-configs?tenant_id={tenant_id}&config_type=queue
```

**2.1.2 创建重新分案配置**
```
POST /api/v1/case-reassign-configs
```

**2.1.3 更新重新分案配置**
```
PUT /api/v1/case-reassign-configs/{id}
```

**2.1.4 删除重新分案配置**
```
DELETE /api/v1/case-reassign-configs/{id}
```

**2.1.5 检查配置冲突**
```
GET /api/v1/case-reassign-configs/check-conflict?tenant_id={tenant_id}&queue_id={queue_id}&team_ids={team_ids}
```

#### 2.2 外部依赖

**队列管理API：**
- `GET /api/v1/queues?tenant_id={tenant_id}` - 获取所有队列

**机构和小组API：**
- `GET /api/v1/agencies?tenant_id={tenant_id}` - 获取所有机构
- `GET /api/v1/agencies/{agency_id}/teams` - 获取机构下的小组

### 3. 数据存储与模型依赖（Data Storage & Model Dependencies）

#### 3.1 数据库表结构

**案件重新分案配置表（case_reassign_configs）**

已在现有代码中创建，无需修改。

### 4. 非功能性要求（Non-Functional Requirements）

#### 4.1 性能要求

| 接口 | QPS目标 | 响应时间（P99） | 峰值容量 |
|------|---------|----------------|---------|
| GET /api/v1/case-reassign-configs | 50 | <200ms | 200 QPS |
| POST /api/v1/case-reassign-configs | 10 | <500ms | 50 QPS |
| PUT /api/v1/case-reassign-configs/{id} | 10 | <500ms | 50 QPS |
| DELETE /api/v1/case-reassign-configs/{id} | 5 | <500ms | 20 QPS |

### 5. 日志埋点与监控告警（Logging, Metrics & Alerting）

#### 5.1 关键日志

**配置管理日志：**
```
[INFO] ========== 创建重新分案配置，tenant_id={}, queue_id={}, team_ids={}, reassign_days={} ==========
[INFO] ========== 配置创建成功，id={}, effective_date={} ==========
[WARN] ========== 配置冲突检测，queue_id={}, team_ids={}, conflicts={} ==========
```

**定时任务日志：**
```
[INFO] ========== 重新分案任务开始，tenant_id={}, config_count={} ==========
[INFO] ========== 处理配置，config_id={}, queue_id={}, team_ids={}, reassign_days={} ==========
[INFO] ========== 重新分案，case_id={}, old_collector={}, new_collector={} ==========
[INFO] ========== 重新分案任务完成，case_count={}, success_count={}, failure_count={}, duration={}ms ==========
```

### 6. 测试策略与验收标准（Test Plan & Acceptance Criteria）

#### 6.1 验收标准

**关键验收标准（必须通过）：**

1. ✅ **树形展示完整性**
   - 所有队列都在列表中展示
   - 有策略的队列显示子行（策略列表）
   - 无策略的队列显示占位行

2. ✅ **配置功能完整性**
   - 可以为队列添加策略（选择小组、设置天数）
   - 可以编辑已有策略
   - 可以删除策略

3. ✅ **小组唯一性校验**
   - 同一队列同一小组不能有多个配置
   - 冲突时给出明确提示

4. ✅ **队列小组验证**
   - 队列没有小组时不能创建配置
   - 给出明确错误提示

### 7. 发布计划与回滚预案（Release Plan & Rollback）

#### 7.1 发布策略

**阶段1（灰度发布，1周）：**
- 灰度范围：1-2个测试甲方
- 验证内容：功能完整性、性能表现

**阶段2（小范围，2周）：**
- 灰度范围：5-10个甲方
- 验证内容：业务效果、用户反馈

**阶段3（全量，1周）：**
- 灰度范围：所有甲方

#### 7.2 回滚预案

**触发回滚条件：**
- 接口错误率>5%
- 接口响应时间>1秒
- 出现数据一致性问题

**回滚方案：**
1. 关闭功能开关
2. 如需要，回滚代码

---

## 附录

### 附录A：术语表

| 术语 | 英文 | 说明 |
|------|------|------|
| 重新分案 | Reassign | 将案件从当前催员重新分配给其他催员 |
| 队列 | Queue | 根据逾期天数划分的案件分组 |
| 策略 | Strategy/Policy | 针对某个队列或小组的重新分案配置 |
| 生效小组 | Effective Teams | 策略针对哪些小组生效 |
| 停留天数 | Stay Days | 案件在当前催员手中的天数 |
| T+1生效 | T+1 Effective | 配置创建后第二天生效 |

### 附录B：参考文档

1. **需求文档：**
   - 甲方案件队列管理PRD.md
   - 案件列表功能PRD.md
   - 案件分配功能PRD.md

2. **技术文档：**
   - 案件重新分案配置-优化说明.md

### 附录C：变更历史

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|---------|--------|
| v1.0 | 2025-12-09 | 初始版本，完整PRD | 大象 |

---

**文档状态：**✅ 已完成  
**最后更新：**2025-12-09  
**版本：**v1.0.0
