# æ§å°ç«¯:ç”²æ–¹æ¡ˆä»¶é˜Ÿåˆ—ç®¡ç†PRD

## ä¸€ã€äº§å“éœ€æ±‚(Product Requirements)

### 1. é¡¹ç›®èƒŒæ™¯ä¸ç›®æ ‡(Background & Goals)

å‚¬æ”¶ä¸šåŠ¡ä¸­,ä¸åŒé€¾æœŸé˜¶æ®µçš„æ¡ˆä»¶éœ€è¦é‡‡å–ä¸åŒçš„å‚¬æ”¶ç­–ç•¥å’Œå‚¬æ”¶å¼ºåº¦ã€‚æœ¬éœ€æ±‚æ—¨åœ¨å»ºç«‹**åŸºäºé€¾æœŸå¤©æ•°çš„æ¡ˆä»¶é˜Ÿåˆ—ç®¡ç†ä½“ç³»**,å®ç°æ¡ˆä»¶çš„è‡ªåŠ¨åˆ†çº§å½’ç±»,æé«˜å‚¬æ”¶æ•ˆç‡å’Œå›æ¬¾ç‡ã€‚é€šè¿‡ç²¾ç»†åŒ–çš„é˜Ÿåˆ—é…ç½®,é¢„æœŸå®ç°:
- **å‚¬æ”¶æ•ˆç‡æå‡20%**:åˆç†åˆ†é…ä¸åŒé€¾æœŸé˜¶æ®µçš„æ¡ˆä»¶ç»™ç›¸åº”å‚¬å‘˜
- **å›æ¬¾ç‡æå‡15%**:é’ˆå¯¹æ€§çš„å‚¬æ”¶ç­–ç•¥æé«˜å‚¬å›æˆåŠŸç‡
- **è¿è¥æˆæœ¬é™ä½30%**:è‡ªåŠ¨åŒ–é˜Ÿåˆ—åˆ†é…å‡å°‘äººå·¥åˆ†æ¡ˆå·¥ä½œé‡
- **å‚¬æ”¶åˆè§„æ€§æå‡**:ä¸åŒé˜Ÿåˆ—æ‰§è¡Œä¸åŒåˆè§„æ ‡å‡†,é™ä½æŠ•è¯‰ç‡

### 2. ä¸šåŠ¡åœºæ™¯ä¸ç”¨æˆ·ç”»åƒ(Business Scenario & User)

**ä¸»è¦ä½¿ç”¨åœºæ™¯:**

1. **ç”²æ–¹å¯¹æ¥åˆå§‹åŒ–**
   - **åœºæ™¯**:æ–°ç”²æ–¹æ¥å…¥ç³»ç»Ÿæ—¶
   - **å…¥å£**:ç”²æ–¹ç®¡ç† â†’ æ¡ˆä»¶é˜Ÿåˆ—ç®¡ç†
   - **æ“ä½œ**:ç³»ç»Ÿç®¡ç†å‘˜ä¸ºç”²æ–¹é…ç½®é»˜è®¤é˜Ÿåˆ—(C/S0/S1/L1/M1)æˆ–è‡ªå®šä¹‰é˜Ÿåˆ—
   - **é¢‘ç‡**:æ¯æ¬¡æ–°ç”²æ–¹æ¥å…¥(çº¦1-2æ¬¡/æœˆ)

2. **é˜Ÿåˆ—ç­–ç•¥è°ƒæ•´**
   - **åœºæ™¯**:æ ¹æ®ä¸šåŠ¡æ•°æ®è°ƒæ•´é˜Ÿåˆ—é€¾æœŸå¤©æ•°è¾¹ç•Œ
   - **å…¥å£**:ç”²æ–¹ç®¡ç† â†’ æ¡ˆä»¶é˜Ÿåˆ—ç®¡ç† â†’ ç¼–è¾‘é˜Ÿåˆ—
   - **æ“ä½œ**:è¿è¥äººå‘˜è°ƒæ•´é˜Ÿåˆ—èŒƒå›´,ä¼˜åŒ–å‚¬æ”¶ç­–ç•¥
   - **é¢‘ç‡**:å­£åº¦æˆ–æœˆåº¦ä¼˜åŒ–(çº¦2-4æ¬¡/å­£åº¦)

2.5. **æŸ¥çœ‹é˜Ÿåˆ—æ¡ˆä»¶**
   - **åœºæ™¯**:æŸ¥çœ‹æŸä¸ªé˜Ÿåˆ—ä¸‹çš„å…·ä½“æ¡ˆä»¶åˆ—è¡¨
   - **å…¥å£**:ç”²æ–¹ç®¡ç† â†’ æ¡ˆä»¶é˜Ÿåˆ—ç®¡ç† â†’ æŸ¥çœ‹æ¡ˆä»¶æŒ‰é’®
   - **æ“ä½œ**:ç‚¹å‡»"æŸ¥çœ‹æ¡ˆä»¶"æŒ‰é’®,è·³è½¬åˆ°æ¡ˆä»¶åˆ—è¡¨é¡µå¹¶è‡ªåŠ¨ç­›é€‰è¯¥é˜Ÿåˆ—çš„æ¡ˆä»¶
   - **é¢‘ç‡**:ä¸­é«˜é¢‘(çº¦5-20æ¬¡/æ—¥)

3. **æ¡ˆä»¶æ‰¹é‡åˆ†é…**
   - **åœºæ™¯**:å°†æ¡ˆä»¶åˆ†é…ç»™å‚¬å‘˜æ—¶æ£€æŸ¥é˜Ÿåˆ—é™åˆ¶
   - **å…¥å£**:æ¡ˆä»¶åˆ—è¡¨ â†’ æ‰¹é‡åˆ†é… â†’ é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥
   - **æ“ä½œ**:ç³»ç»Ÿè‡ªåŠ¨æ£€æŸ¥æ¡ˆä»¶é˜Ÿåˆ—ä¸å‚¬å‘˜å°ç»„é˜Ÿåˆ—æ˜¯å¦åŒ¹é…
   - **é¢‘ç‡**:æ¯æ—¥å¤šæ¬¡(çº¦10-50æ¬¡/æ—¥)

4. **é˜Ÿåˆ—æ•ˆæœåˆ†æ**
   - **åœºæ™¯**:åˆ†æå„é˜Ÿåˆ—çš„å‚¬å›æ•ˆæœ
   - **å…¥å£**:æ•°æ®çœ‹æ¿ â†’ é˜Ÿåˆ—åˆ†æ
   - **æ“ä½œ**:æŸ¥çœ‹å„é˜Ÿåˆ—çš„æ¡ˆä»¶é‡ã€å›æ¬¾ç‡ã€å‚¬å›å‘¨æœŸç­‰æŒ‡æ ‡
   - **é¢‘ç‡**:æ¯å‘¨/æ¯æœˆ(çº¦4-8æ¬¡/æœˆ)

**ç”¨æˆ·ç”»åƒ:**

| ç”¨æˆ·ç±»å‹ | æ ¸å¿ƒè¯‰æ±‚ | ä½¿ç”¨åŠŸèƒ½ | ä½¿ç”¨é¢‘ç‡ |
|---------|---------|---------|---------|
| **ç³»ç»Ÿç®¡ç†å‘˜** | ä¸ºæ–°ç”²æ–¹å¿«é€Ÿé…ç½®æ ‡å‡†é˜Ÿåˆ— | é˜Ÿåˆ—åˆ›å»ºã€é»˜è®¤é…ç½® | ä½é¢‘(1-2æ¬¡/æœˆ) |
| **è¿è¥ç»ç†** | ä¼˜åŒ–é˜Ÿåˆ—ç­–ç•¥æå‡å›æ¬¾ç‡ | é˜Ÿåˆ—ç¼–è¾‘ã€èŒƒå›´è°ƒæ•´ã€æŸ¥çœ‹é˜Ÿåˆ—æ¡ˆä»¶ | ä¸­é¢‘(2-4æ¬¡/å­£åº¦) |
| **åˆ†æ¡ˆä¸“å‘˜** | å‡†ç¡®åˆ†é…æ¡ˆä»¶é¿å…é˜Ÿåˆ—é”™é… | é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥ã€æ‰¹é‡åˆ†é…ã€æŸ¥çœ‹é˜Ÿåˆ—æ¡ˆä»¶ã€æ‰‹åŠ¨æ ‡è®°åœç•™ | é«˜é¢‘(10-50æ¬¡/æ—¥) |
| **æ•°æ®åˆ†æå¸ˆ** | åˆ†æé˜Ÿåˆ—æ•ˆæœä¼˜åŒ–ç­–ç•¥ | é˜Ÿåˆ—ç»Ÿè®¡ã€æ•ˆæœåˆ†æã€æŸ¥çœ‹é˜Ÿåˆ—æ¡ˆä»¶ | ä¸­é¢‘(4-8æ¬¡/æœˆ) |

### 3. å…³é”®ä¸šåŠ¡æµç¨‹(Business Flow)

#### 3.1 æ–°ç”²æ–¹é˜Ÿåˆ—åˆå§‹åŒ–æµç¨‹

```
å¼€å§‹
  â†“
[ç³»ç»Ÿç®¡ç†å‘˜] åˆ›å»ºæ–°ç”²æ–¹
  â†“
[ç³»ç»Ÿ] è‡ªåŠ¨ç”Ÿæˆ5ä¸ªé»˜è®¤é˜Ÿåˆ—
  â”œâ”€ Cé˜Ÿåˆ—: -âˆ ~ -1å¤©(æœªé€¾æœŸ)
  â”œâ”€ S0é˜Ÿåˆ—: 0å¤©(åˆ°æœŸæ—¥)
  â”œâ”€ S1é˜Ÿåˆ—: 1 ~ 5å¤©(è½»åº¦é€¾æœŸ)
  â”œâ”€ L1é˜Ÿåˆ—: 6 ~ 90å¤©(ä¸­åº¦é€¾æœŸ)
  â””â”€ M1é˜Ÿåˆ—: 91 ~ +âˆå¤©(é‡åº¦é€¾æœŸ)
  â†“
[è¿è¥ç»ç†] å¯é€‰:è°ƒæ•´é˜Ÿåˆ—èŒƒå›´æˆ–æ·»åŠ è‡ªå®šä¹‰é˜Ÿåˆ—
  â†“
[ç³»ç»Ÿ] éªŒè¯é˜Ÿåˆ—èŒƒå›´ä¸é‡åˆ
  â†“
[ç³»ç»Ÿ] ä¿å­˜é˜Ÿåˆ—é…ç½®
  â†“
ç»“æŸ
```

### 4. ä¸šåŠ¡è§„åˆ™ä¸è¾¹ç•Œ(Business Rules & Scope)

#### 4.1 é˜Ÿåˆ—é…ç½®è§„åˆ™

**é˜Ÿåˆ—ç¼–ç è§„åˆ™:**
- æ ¼å¼:å¤§å†™å­—æ¯+æ•°å­—ç»„åˆ,å¦‚Cã€S0ã€S1ã€L1ã€M1ã€M2ã€M3+ã€LEGAL
- é•¿åº¦:1-50ä¸ªå­—ç¬¦
- å”¯ä¸€æ€§:åŒä¸€ç”²æ–¹ä¸‹é˜Ÿåˆ—ç¼–ç å”¯ä¸€
- å»ºè®®è§„èŒƒ:
  - Cå¼€å¤´:Current(æœªé€¾æœŸ)
  - Så¼€å¤´:Short(çŸ­æœŸé€¾æœŸ,1-30å¤©)
  - Lå¼€å¤´:Long(é•¿æœŸé€¾æœŸ,31-90å¤©)
  - Må¼€å¤´:Medium(ä¸­é•¿æœŸé€¾æœŸ,91å¤©ä»¥ä¸Š)
  - LEGAL:æ³•å¾‹è¯‰è®¼é˜Ÿåˆ—

**é€¾æœŸå¤©æ•°èŒƒå›´è§„åˆ™:**
- **ä¸å¯é‡åˆ**:åŒä¸€ç”²æ–¹ä¸‹æ‰€æœ‰é˜Ÿåˆ—çš„é€¾æœŸå¤©æ•°èŒƒå›´ä¸èƒ½æœ‰äº¤é›†
- **æ— ç©·å¤§è¡¨ç¤º**:
  - å¼€å§‹å¤©æ•°ä¸ºNULL â†’ è´Ÿæ— ç©·(-âˆ)
  - ç»“æŸå¤©æ•°ä¸ºNULL â†’ æ­£æ— ç©·(+âˆ)
  - ä¸å…è®¸ä¸¤ä¸ªè¾¹ç•ŒåŒæ—¶ä¸ºNULL
- **èŒƒå›´åˆæ³•æ€§**:å¼€å§‹å¤©æ•° â‰¤ ç»“æŸå¤©æ•°
- **å»ºè®®å®Œæ•´è¦†ç›–**:æ‰€æœ‰é˜Ÿåˆ—åˆè®¡åº”è¦†ç›–(-âˆ, +âˆ)åŒºé—´,é¿å…æ¡ˆä»¶æ— æ³•å½’é˜Ÿ

**é˜Ÿåˆ—æ’åºè§„åˆ™:**
- æ•°å€¼è¶Šå°,æ˜¾ç¤ºè¶Šé å‰
- å»ºè®®æŒ‰é€¾æœŸå¤©æ•°ä»å°åˆ°å¤§æ’åº
- é»˜è®¤æ’åºå€¼:åˆ›å»ºé¡ºåº Ã— 10(é¢„ç•™è°ƒæ•´ç©ºé—´)

**é˜Ÿåˆ—çŠ¶æ€è§„åˆ™:**
- å¯ç”¨(is_active=true):å‚ä¸æ¡ˆä»¶è‡ªåŠ¨å½’é˜Ÿå’Œé˜Ÿåˆ—é™åˆ¶æ£€æŸ¥
- ç¦ç”¨(is_active=false):ä¸å‚ä¸è‡ªåŠ¨å½’é˜Ÿ,å·²å½’å±æ¡ˆä»¶ä¿æŒä¸å˜

#### 4.2 é»˜è®¤é˜Ÿåˆ—é…ç½®

**æ ‡å‡†5é˜Ÿåˆ—é…ç½®:**

| é˜Ÿåˆ—ç¼–ç  | é˜Ÿåˆ—åç§° | é€¾æœŸå¤©æ•°èŒƒå›´ | æ’åº | è¯´æ˜ | å‚¬æ”¶ç­–ç•¥ |
|---------|---------|------------|------|------|---------|
| C | Cé˜Ÿåˆ— | -âˆ ~ -1 | 1 | æœªé€¾æœŸ,æå‰è¿˜æ¬¾å®¢æˆ· | æ¸©å’Œæé†’,ç»´æŠ¤å®¢æˆ·å…³ç³» |
| S0 | S0é˜Ÿåˆ— | 0 ~ 0 | 2 | åˆ°æœŸæ—¥å½“å¤© | å‹å¥½æé†’,ç¡®è®¤è¿˜æ¬¾æ„æ„¿ |
| S1 | S1é˜Ÿåˆ— | 1 ~ 5 | 3 | è½»åº¦é€¾æœŸ | ç”µè¯/çŸ­ä¿¡æé†’,äº†è§£åŸå›  |
| L1 | L1é˜Ÿåˆ— | 6 ~ 90 | 4 | ä¸­åº¦é€¾æœŸ | åŠ å¼ºå‚¬æ”¶,åå•†è¿˜æ¬¾è®¡åˆ’ |
| M1 | M1é˜Ÿåˆ— | 91 ~ +âˆ | 5 | é‡åº¦é€¾æœŸ | ä¸“é¡¹å‚¬æ”¶,æ³•å¾‹è­¦å‘Š |

**å¯é€‰æ‰©å±•é˜Ÿåˆ—é…ç½®:**

| é˜Ÿåˆ—ç¼–ç  | é˜Ÿåˆ—åç§° | é€¾æœŸå¤©æ•°èŒƒå›´ | è¯´æ˜ |
|---------|---------|------------|------|
| S2 | S2é˜Ÿåˆ— | 6 ~ 15 | ç»†åˆ†è½»åº¦é€¾æœŸ |
| S3 | S3é˜Ÿåˆ— | 16 ~ 30 | ç»†åˆ†è½»åº¦é€¾æœŸ |
| M2 | M2é˜Ÿåˆ— | 31 ~ 60 | ç»†åˆ†ä¸­åº¦é€¾æœŸ |
| M3 | M3é˜Ÿåˆ— | 61 ~ 90 | ç»†åˆ†ä¸­åº¦é€¾æœŸ |
| M3+ | M3+é˜Ÿåˆ— | 91 ~ 180 | é•¿æœŸé€¾æœŸ |
| LEGAL | æ³•å¾‹é˜Ÿåˆ— | 181 ~ +âˆ | æ³•å¾‹è¯‰è®¼æ¡ˆä»¶ |

#### 4.3 é˜Ÿåˆ—é™åˆ¶è§„åˆ™

**æ¡ˆä»¶åˆ†é…é˜Ÿåˆ—é™åˆ¶:**
- **è§„åˆ™**:æ¡ˆä»¶åªèƒ½åˆ†é…ç»™é˜Ÿåˆ—åŒ¹é…çš„å‚¬å‘˜å°ç»„
- **åŒ¹é…æ¡ä»¶**:æ¡ˆä»¶çš„queue_id = å‚¬å‘˜å°ç»„çš„queue_id
- **é™åˆ¶æ£€æŸ¥æ—¶æœº**:æ‰¹é‡åˆ†é…æ¡ˆä»¶æäº¤å‰
- **ä¸åŒ¹é…å¤„ç†**:
  1. æ˜¾ç¤ºä¸åŒ¹é…é¡¹åˆ—è¡¨(æ¡ˆä»¶ç¼–å·ã€æ¡ˆä»¶é˜Ÿåˆ—ã€å‚¬å‘˜å§“åã€å‚¬å‘˜é˜Ÿåˆ—)
  2. æä¾›"å¿½ç•¥é™åˆ¶ç»§ç»­åˆ†é…"é€‰é¡¹(è®°å½•è­¦å‘Šæ—¥å¿—)
  3. æä¾›"å–æ¶ˆåˆ†é…"é€‰é¡¹
  4. æä¾›"é‡æ–°é€‰æ‹©å‚¬å‘˜"é€‰é¡¹

**é˜Ÿåˆ—é™åˆ¶è±å…åœºæ™¯:**
- ç³»ç»Ÿç®¡ç†å‘˜è§’è‰²:å¯å¿½ç•¥é˜Ÿåˆ—é™åˆ¶
- ç´§æ€¥å‚¬æ”¶æ¡ˆä»¶:æ ‡è®°ä¸º"ç´§æ€¥"çš„æ¡ˆä»¶å¯è·¨é˜Ÿåˆ—åˆ†é…
- ä¸“é¡¹å‚¬æ”¶æ´»åŠ¨:ç‰¹å®šæ´»åŠ¨æœŸé—´å¯ä¸´æ—¶æ”¾å®½é™åˆ¶

#### 4.4 æœ¬æ¬¡éœ€æ±‚èŒƒå›´

**èŒƒå›´å†…(In Scope):**
- âœ… é˜Ÿåˆ—CRUDç®¡ç†(åˆ›å»º/æŸ¥è¯¢/æ›´æ–°/åˆ é™¤)
- âœ… é˜Ÿåˆ—èŒƒå›´éªŒè¯(å”¯ä¸€æ€§/åˆæ³•æ€§/é‡åˆæ£€æµ‹)
- âœ… é»˜è®¤é˜Ÿåˆ—è‡ªåŠ¨ç”Ÿæˆ(æ–°ç”²æ–¹æ¥å…¥æ—¶)
- âœ… é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥API(æ¡ˆä»¶åˆ†é…æ—¶)
- âœ… å‰ç«¯é˜Ÿåˆ—ç®¡ç†é¡µé¢
- âœ… é˜Ÿåˆ—çŠ¶æ€å¯ç”¨/ç¦ç”¨
- âœ… é˜Ÿåˆ—æ’åºç®¡ç†
- âœ… **ä»Šæ—¥æ¡ˆä»¶æ•°ç»Ÿè®¡æ˜¾ç¤º**
- âœ… **æŸ¥çœ‹é˜Ÿåˆ—æ¡ˆä»¶åŠŸèƒ½(è·³è½¬åˆ°æ¡ˆä»¶åˆ—è¡¨å¹¶ç­›é€‰)**

**èŒƒå›´å¤–(Out of Scope):**
- âŒ æ¡ˆä»¶è‡ªåŠ¨å½’é˜Ÿå®šæ—¶ä»»åŠ¡(åç»­è¿­ä»£)
- âŒ é˜Ÿåˆ—æ•ˆæœåˆ†ææŠ¥è¡¨(åç»­è¿­ä»£)
- âŒ é˜Ÿåˆ—é—´æ¡ˆä»¶è½¬ç§»(åç»­è¿­ä»£)
- âŒ é˜Ÿåˆ—çº§åˆ«çš„å‚¬æ”¶ç­–ç•¥é…ç½®(åç»­è¿­ä»£)
- âŒ é˜Ÿåˆ—çº§åˆ«çš„å‚¬å‘˜ç»©æ•ˆç»Ÿè®¡(åç»­è¿­ä»£)
- âŒ é˜Ÿåˆ—çº§åˆ«çš„å¤–å‘¼é™åˆ¶é…ç½®(åç»­è¿­ä»£)

### 5. åˆè§„ä¸é£æ§è¦æ±‚(Compliance & Risk Control)

#### 5.1 åˆè§„è¦æ±‚

**å‚¬æ”¶åˆè§„:**
- **åˆ†çº§å‚¬æ”¶**:ä¸åŒé˜Ÿåˆ—æ‰§è¡Œä¸åŒå¼ºåº¦çš„å‚¬æ”¶ç­–ç•¥,ç¬¦åˆç›‘ç®¡è¦æ±‚
- **æ“ä½œç•™ç—•**:æ‰€æœ‰é˜Ÿåˆ—é…ç½®å˜æ›´è®°å½•æ“ä½œäººã€æ—¶é—´ã€å˜æ›´å†…å®¹
- **æƒé™æ§åˆ¶**:é˜Ÿåˆ—é…ç½®ä»…å…è®¸ç³»ç»Ÿç®¡ç†å‘˜å’Œè¿è¥ç»ç†æ“ä½œ
- **åˆ é™¤ä¿æŠ¤**:åˆ é™¤é˜Ÿåˆ—å‰éœ€ç¡®è®¤è¯¥é˜Ÿåˆ—ä¸‹æ— æœªç»“æ¡ˆä»¶

**æ•°æ®åˆè§„:**
- **æ•°æ®éš”ç¦»**:ä¸åŒç”²æ–¹çš„é˜Ÿåˆ—é…ç½®å®Œå…¨éš”ç¦»
- **æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**:é˜Ÿåˆ—é…ç½®ä¸åŒ…å«å®¢æˆ·æ•æ„Ÿä¿¡æ¯
- **å®¡è®¡æ—¥å¿—**:è®°å½•æ‰€æœ‰é˜Ÿåˆ—é…ç½®å˜æ›´,ä¿ç•™è‡³å°‘6ä¸ªæœˆ

#### 5.2 é£æ§è¦æ±‚

**ä¸šåŠ¡é£æ§:**
- **èŒƒå›´å®Œæ•´æ€§æ£€æŸ¥**:è­¦å‘Šé˜Ÿåˆ—èŒƒå›´æœªè¦†ç›–å…¨åŒºé—´çš„æƒ…å†µ
- **é˜Ÿåˆ—å¹³è¡¡æ€§æ£€æŸ¥**:è­¦å‘ŠæŸé˜Ÿåˆ—æ¡ˆä»¶é‡è¿‡å¤§(>æ€»æ¡ˆä»¶50%)çš„æƒ…å†µ
- **åˆ†é…é£æ§**:è·¨é˜Ÿåˆ—åˆ†é…è®°å½•è­¦å‘Šæ—¥å¿—,ä¾¿äºåç»­å®¡è®¡

**ç³»ç»Ÿé£æ§:**
- **å¹¶å‘æ§åˆ¶**:é˜Ÿåˆ—é…ç½®å˜æ›´æ—¶åŠ é”,é¿å…å¹¶å‘ä¿®æ”¹å†²çª
- **äº‹åŠ¡å®Œæ•´æ€§**:é˜Ÿåˆ—åˆ›å»º/æ›´æ–°/åˆ é™¤ä½œä¸ºä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œ
- **æ•°æ®ä¸€è‡´æ€§**:é˜Ÿåˆ—åˆ é™¤å‰æ£€æŸ¥å…³è”æ¡ˆä»¶,é˜²æ­¢æ•°æ®å­¤å²›

### 6. èµ„é‡‘è·¯å¾„ä¸ç»“ç®—è§„åˆ™(Funding Flow & Settlement)

æœ¬åŠŸèƒ½ä¸æ¶‰åŠèµ„é‡‘æµè½¬,è·³è¿‡æ­¤èŠ‚ã€‚

### 7. æ•°æ®å­—æ®µä¸å£å¾„(Data Definition)

#### 7.1 æ ¸å¿ƒæ•°æ®å®ä½“

**æ¡ˆä»¶é˜Ÿåˆ—è¡¨(case_queues)**

| å­—æ®µå | æ•°æ®ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|---------|-----|------|--------|
| id | BIGINT | âœ… | ä¸»é”®ID | 101 |
| tenant_id | BIGINT | âœ… | æ‰€å±ç”²æ–¹ID | 1 |
| queue_code | VARCHAR(100) | âœ… | é˜Ÿåˆ—ç¼–ç  | "M1" |
| queue_name | VARCHAR(200) | âœ… | é˜Ÿåˆ—åç§° | "M1é˜Ÿåˆ—" |
| queue_name_en | VARCHAR(200) | â¬œ | é˜Ÿåˆ—åç§°(è‹±æ–‡) | "M1 Queue" |
| queue_description | TEXT | â¬œ | é˜Ÿåˆ—æè¿° | "é‡åº¦é€¾æœŸæ¡ˆä»¶" |
| overdue_days_start | INT | â¬œ | é€¾æœŸå¤©æ•°èµ·å§‹(NULL=è´Ÿæ— ç©·) | 91 |
| overdue_days_end | INT | â¬œ | é€¾æœŸå¤©æ•°ç»“æŸ(NULL=æ­£æ— ç©·) | NULL |
| sort_order | INT | âœ… | æ’åºé¡ºåº | 5 |
| is_active | BOOLEAN | âœ… | æ˜¯å¦å¯ç”¨ | true |
| created_at | DATETIME | âœ… | åˆ›å»ºæ—¶é—´ | "2025-01-01 10:00:00" |
| updated_at | DATETIME | âœ… | æ›´æ–°æ—¶é—´ | "2025-01-15 14:30:00" |

**å…³è”å­—æ®µ(æ¡ˆä»¶è¡¨cases)**

| å­—æ®µå | æ•°æ®ç±»å‹ | å¿…å¡« | è¯´æ˜ | æ›´æ–°æ—¶æœº |
|-------|---------|-----|------|---------|
| queue_id | BIGINT | â¬œ | æ‰€å±é˜Ÿåˆ—ID | æ¡ˆä»¶å¯¼å…¥/é€¾æœŸå¤©æ•°å˜æ›´/é˜Ÿåˆ—é…ç½®å˜æ›´ |
| overdue_days | INT | âœ… | é€¾æœŸå¤©æ•° | æ¯æ—¥å®šæ—¶è®¡ç®— |

**å…³è”å­—æ®µ(å‚¬æ”¶å°ç»„è¡¨collection_teams)**

| å­—æ®µå | æ•°æ®ç±»å‹ | å¿…å¡« | è¯´æ˜ | æ›´æ–°æ—¶æœº |
|-------|---------|-----|------|---------|
| queue_id | BIGINT | â¬œ | è´Ÿè´£é˜Ÿåˆ—ID | å°ç»„åˆ›å»º/é˜Ÿåˆ—åˆ†é…è°ƒæ•´ |

#### 7.2 ç»Ÿè®¡å£å¾„

**é˜Ÿåˆ—æ¡ˆä»¶é‡ç»Ÿè®¡:**
- **å£å¾„**:ç»Ÿè®¡queue_id = é˜Ÿåˆ—ID ä¸” case_status != 'normal_settlement' ä¸” case_status != 'extension_settlement' çš„æ¡ˆä»¶æ•°
- **æ›´æ–°é¢‘ç‡**:å®æ—¶(æŸ¥è¯¢æ—¶è®¡ç®—)æˆ–T+1(å®šæ—¶ç»Ÿè®¡)
- **ç»Ÿè®¡ç»´åº¦**:ç”²æ–¹ç»´åº¦ã€é˜Ÿåˆ—ç»´åº¦ã€æ—¶é—´ç»´åº¦

**ä»Šæ—¥æ¡ˆä»¶æ•°ç»Ÿè®¡:**
- **å£å¾„**:ç»Ÿè®¡queue_id = é˜Ÿåˆ—ID ä¸” DATE(created_at) = å½“å¤©æ—¥æœŸ ä¸” case_status != 'normal_settlement' ä¸” case_status != 'extension_settlement' çš„æ¡ˆä»¶æ•°
- **æ›´æ–°é¢‘ç‡**:å®æ—¶(æŸ¥è¯¢æ—¶è®¡ç®—)
- **ç»Ÿè®¡ç»´åº¦**:ç”²æ–¹+é˜Ÿåˆ—+æ—¥æœŸ
- **è¯´æ˜**:å±•ç¤ºä»Šæ—¥æ–°å¢åˆ°è¯¥é˜Ÿåˆ—çš„æ¡ˆä»¶æ•°é‡,å¸®åŠ©è¿è¥äººå‘˜äº†è§£å„é˜Ÿåˆ—çš„æ¡ˆä»¶æµå…¥æƒ…å†µ

**é˜Ÿåˆ—å›æ¬¾ç‡ç»Ÿè®¡:**
- **å£å¾„**:(é˜Ÿåˆ—å·²å›æ¬¾é‡‘é¢ / é˜Ÿåˆ—æ€»é€¾æœŸé‡‘é¢) Ã— 100%
- **æ›´æ–°é¢‘ç‡**:T+1(æ¯æ—¥å‡Œæ™¨ç»Ÿè®¡)
- **ç»Ÿè®¡ç»´åº¦**:ç”²æ–¹+é˜Ÿåˆ—+æ—¥æœŸ

**é˜Ÿåˆ—å‚¬å›å‘¨æœŸç»Ÿè®¡:**
- **å£å¾„**:é˜Ÿåˆ—ä¸‹å·²ç»“æ¸…æ¡ˆä»¶çš„å¹³å‡å‚¬å›å¤©æ•°(settlement_date - assigned_at)
- **æ›´æ–°é¢‘ç‡**:T+1(æ¯æ—¥å‡Œæ™¨ç»Ÿè®¡)
- **ç»Ÿè®¡ç»´åº¦**:ç”²æ–¹+é˜Ÿåˆ—+æœˆä»½

### 8. äº¤äº’ä¸ä¿¡æ¯å±•ç¤º(UX & UI Brief)

æœ¬é¡¹ç›®å‰ç«¯äº¤äº’å·²ç”±Webå›¢é˜Ÿå®ç°,å…³é”®ç•Œé¢è¯´æ˜å¦‚ä¸‹:

#### 8.1 é˜Ÿåˆ—åˆ—è¡¨é¡µ

**é¡µé¢å…¥å£:**ç”²æ–¹ç®¡ç† â†’ æ¡ˆä»¶é˜Ÿåˆ—ç®¡ç†

**æ ¸å¿ƒå…ƒç´ :**
- ç”²æ–¹é€‰æ‹©å™¨(ä¸‹æ‹‰æ¡†,è”åŠ¨åŠ è½½é˜Ÿåˆ—æ•°æ®)
- åŠŸèƒ½è¯´æ˜æç¤º(é˜Ÿåˆ—ç”¨é€”ã€èŒƒå›´è§„åˆ™)
- é˜Ÿåˆ—åˆ—è¡¨è¡¨æ ¼(é˜Ÿåˆ—ç¼–ç ã€åç§°ã€é€¾æœŸå¤©æ•°èŒƒå›´ã€æ¡ˆä»¶æ•°ã€ä»Šæ—¥æ¡ˆä»¶æ•°ã€æ’åºã€çŠ¶æ€ã€æ“ä½œ)
- æ·»åŠ é˜Ÿåˆ—æŒ‰é’®(å³ä¸Šè§’)

**è¡¨æ ¼åˆ—å®šä¹‰:**

| åˆ—å | å®½åº¦ | å¯¹é½æ–¹å¼ | è¯´æ˜ |
|------|------|---------|------|
| é˜Ÿåˆ—ç¼–ç  | 100px | å·¦å¯¹é½ | æ˜¾ç¤ºé˜Ÿåˆ—ç¼–ç ,å¦‚"M1"ã€"S1" |
| é˜Ÿåˆ—åç§° | 150px | å·¦å¯¹é½ | æ˜¾ç¤ºé˜Ÿåˆ—åç§°,å¦‚"M1é˜Ÿåˆ—" |
| é€¾æœŸå¤©æ•°èŒƒå›´ | 180px | å·¦å¯¹é½ | æ ¼å¼åŒ–æ˜¾ç¤º,å¦‚"-âˆ ~ -1å¤©"ã€"1 ~ 5å¤©" |
| æ¡ˆä»¶æ•° | 100px | å³å¯¹é½ | æ˜¾ç¤ºè¯¥é˜Ÿåˆ—å½“å‰çš„æ¡ˆä»¶æ€»æ•° |
| **ä»Šæ—¥æ¡ˆä»¶æ•°** | 120px | å³å¯¹é½ | **ã€æ–°å¢ã€‘**æ˜¾ç¤ºä»Šæ—¥æ–°å¢åˆ°è¯¥é˜Ÿåˆ—çš„æ¡ˆä»¶æ•°,çº¢è‰²é«˜äº®æ˜¾ç¤º |
| æ’åº | 80px | å±…ä¸­ | æ˜¾ç¤ºæ’åºå€¼ |
| çŠ¶æ€ | 80px | å±…ä¸­ | å¯ç”¨/ç¦ç”¨æ ‡ç­¾ |
| æ“ä½œ | 200px | å·¦å¯¹é½ | **æŸ¥çœ‹æ¡ˆä»¶**ã€ç¼–è¾‘ã€åˆ é™¤æŒ‰é’® |

**äº¤äº’ç»†èŠ‚:**
- é€¾æœŸå¤©æ•°èŒƒå›´æ ¼å¼åŒ–æ˜¾ç¤º:"-âˆ ~ -1å¤©"ã€"1 ~ 5å¤©"ã€"91 ~ +âˆå¤©"
- çŠ¶æ€æ ‡ç­¾é¢œè‰²:å¯ç”¨=ç»¿è‰²ã€ç¦ç”¨=ç°è‰²
- æ¡ˆä»¶æ•°æ˜¾ç¤º:è“è‰²å¯ç‚¹å‡»æ–‡å­—,ç‚¹å‡»ååŒ"æŸ¥çœ‹æ¡ˆä»¶"åŠŸèƒ½
- **ä»Šæ—¥æ¡ˆä»¶æ•°æ˜¾ç¤º:**
  - çº¢è‰²åŠ ç²—å­—ä½“,æ›´é†’ç›®
  - æ ¼å¼:"XX ä»¶"
  - å¦‚æœä»Šæ—¥æ¡ˆä»¶æ•°ä¸º0,æ˜¾ç¤ºä¸ºç°è‰²"-"
  - ä»Šæ—¥æ¡ˆä»¶æ•°>100æ—¶,åŠ ä¸Šâš ï¸å›¾æ ‡æç¤º
- æ“ä½œæŒ‰é’®:
  - **ã€æ–°å¢ã€‘æŸ¥çœ‹æ¡ˆä»¶**(è“è‰²æŒ‰é’®,å›¾æ ‡:ğŸ‘ï¸ æˆ– icon-view)
  - ç¼–è¾‘(è“è‰²é“¾æ¥,å›¾æ ‡:âœï¸ æˆ– icon-edit)
  - åˆ é™¤(çº¢è‰²é“¾æ¥,å›¾æ ‡:ğŸ—‘ï¸ æˆ– icon-delete)

**"æŸ¥çœ‹æ¡ˆä»¶"æŒ‰é’®äº¤äº’:**
1. **ç‚¹å‡»è§¦å‘:**ç‚¹å‡»"æŸ¥çœ‹æ¡ˆä»¶"æŒ‰é’®æˆ–"æ¡ˆä»¶æ•°"æ–‡å­—
2. **è·³è½¬é€»è¾‘:**
   - è·¯ç”±è·³è½¬åˆ°æ¡ˆä»¶åˆ—è¡¨é¡µé¢(`/cases`)
   - æºå¸¦URLå‚æ•°:`?queue_id={é˜Ÿåˆ—ID}&queue_name={é˜Ÿåˆ—åç§°}`
   - ç¤ºä¾‹:`/cases?queue_id=101&queue_name=M1é˜Ÿåˆ—`
3. **æ¡ˆä»¶åˆ—è¡¨é¡µæ¥æ”¶å‚æ•°:**
   - è‡ªåŠ¨åœ¨ç­›é€‰å™¨ä¸­é€‰ä¸­è¯¥é˜Ÿåˆ—
   - è‡ªåŠ¨è§¦å‘æœç´¢,æ˜¾ç¤ºè¯¥é˜Ÿåˆ—çš„æ¡ˆä»¶åˆ—è¡¨
   - åœ¨é¢åŒ…å±‘ä¸­æ˜¾ç¤º:"æ¡ˆä»¶åˆ—è¡¨ > M1é˜Ÿåˆ—"
4. **ç”¨æˆ·ä½“éªŒ:**
   - æ–°æ ‡ç­¾é¡µæ‰“å¼€(å¯é€‰,æ ¹æ®ç”¨æˆ·åå¥½é…ç½®)
   - è·³è½¬åå¯é€šè¿‡æµè§ˆå™¨åé€€è¿”å›é˜Ÿåˆ—ç®¡ç†é¡µ

#### 8.2 æ·»åŠ /ç¼–è¾‘é˜Ÿåˆ—å¯¹è¯æ¡†

**è¡¨å•å­—æ®µ:**
1. é˜Ÿåˆ—ç¼–ç (å¿…å¡«,æœ€å¤§50å­—ç¬¦)
2. é˜Ÿåˆ—åç§°(å¿…å¡«,æœ€å¤§100å­—ç¬¦)
3. é€¾æœŸå¤©æ•°èŒƒå›´(å¿…å¡«)
   - å¼€å§‹å¤©æ•°(æ•°å­—è¾“å…¥æ¡†,å¯ç¦ç”¨)
   - è´Ÿæ— ç©·å‹¾é€‰æ¡†(å‹¾é€‰åç¦ç”¨å¼€å§‹å¤©æ•°è¾“å…¥æ¡†)
   - æ³¢æµªçº¿åˆ†éš”ç¬¦(~)
   - ç»“æŸå¤©æ•°(æ•°å­—è¾“å…¥æ¡†,å¯ç¦ç”¨)
   - æ­£æ— ç©·å‹¾é€‰æ¡†(å‹¾é€‰åç¦ç”¨ç»“æŸå¤©æ•°è¾“å…¥æ¡†)
   - ç¤ºä¾‹è¯´æ˜æ–‡å­—
4. æ’åº(å¿…å¡«,æ•°å­—è¾“å…¥æ¡†,é»˜è®¤=ç°æœ‰é˜Ÿåˆ—æ•°+1)
5. æ˜¯å¦å¯ç”¨(å¼€å…³,é»˜è®¤å¼€å¯)

**éªŒè¯æç¤º:**
- èŒƒå›´åˆæ³•æ€§é”™è¯¯:"å¼€å§‹å¤©æ•°ä¸èƒ½å¤§äºç»“æŸå¤©æ•°"
- èŒƒå›´å®Œæ•´æ€§é”™è¯¯:"å¼€å§‹å¤©æ•°å’Œç»“æŸå¤©æ•°ä¸èƒ½éƒ½ä¸ºæ— ç©·å¤§"
- èŒƒå›´é‡åˆé”™è¯¯:"é€¾æœŸå¤©æ•°èŒƒå›´ä¸é˜Ÿåˆ—'XXX'é‡åˆ,è¯·è°ƒæ•´èŒƒå›´"
- ç¼–ç é‡å¤é”™è¯¯:"é˜Ÿåˆ—ç¼–ç å·²å­˜åœ¨:XXX"

#### 8.3 åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†

**æç¤ºå†…å®¹:**
```
ç¡®å®šè¦åˆ é™¤é˜Ÿåˆ—"XXX"å—?
åˆ é™¤åè¯¥é˜Ÿåˆ—ä¸‹çš„æ¡ˆä»¶å°†æ— æ³•å½’ç±»ã€‚
```

**æŒ‰é’®:**å–æ¶ˆ(ç°è‰²)ã€ç¡®å®š(çº¢è‰²)

### 9. é…ç½®é¡¹ä¸è¿è¥å¼€å…³(Config & Operation Switches)

#### 9.1 ç³»ç»Ÿé…ç½®é¡¹

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ | é…ç½®å…¥å£ | å˜æ›´æµç¨‹ |
|-------|-------|------|---------|---------|
| enable_queue_limit_check | true | æ˜¯å¦å¯ç”¨é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥ | ç³»ç»Ÿé…ç½®ç®¡ç† | éœ€å¼€å‘å˜æ›´ |
| default_queue_config | 5é˜Ÿåˆ—æ¨¡æ¿ | é»˜è®¤é˜Ÿåˆ—é…ç½®æ¨¡æ¿ | ç³»ç»Ÿé…ç½®ç®¡ç† | éœ€å¼€å‘å˜æ›´ |
| allow_queue_overlap_warning | true | èŒƒå›´é‡åˆæ—¶æ˜¯å¦å…è®¸è­¦å‘Šç»§ç»­ | ç³»ç»Ÿé…ç½®ç®¡ç† | éœ€å¼€å‘å˜æ›´ |
| queue_auto_assign_enable | false | æ˜¯å¦å¯ç”¨é˜Ÿåˆ—è‡ªåŠ¨å½’é˜Ÿ | ç³»ç»Ÿé…ç½®ç®¡ç† | åç»­ç‰ˆæœ¬æ”¯æŒ |

#### 9.2 è¿è¥å¼€å…³

| å¼€å…³åç§° | é»˜è®¤çŠ¶æ€ | è¯´æ˜ | é…ç½®å…¥å£ | å½±å“èŒƒå›´ |
|---------|---------|------|---------|---------|
| é˜Ÿåˆ—é™åˆ¶è±å… | å…³é—­ | å…è®¸å¿½ç•¥é˜Ÿåˆ—é™åˆ¶åˆ†é…æ¡ˆä»¶ | æ‰¹é‡åˆ†é…é¡µé¢ | å•æ¬¡åˆ†é…æ“ä½œ |
| é˜Ÿåˆ—åˆ é™¤ä¿æŠ¤ | å¼€å¯ | åˆ é™¤å‰æ£€æŸ¥å…³è”æ¡ˆä»¶ | ç³»ç»Ÿé…ç½® | å…¨å±€ |
| é˜Ÿåˆ—èŒƒå›´å®Œæ•´æ€§æ£€æŸ¥ | å¼€å¯ | æ£€æŸ¥é˜Ÿåˆ—èŒƒå›´æ˜¯å¦è¦†ç›–å…¨åŒºé—´ | ç³»ç»Ÿé…ç½® | å…¨å±€ |

#### 9.3 ç°åº¦ç­–ç•¥

æœ¬åŠŸèƒ½é‡‡ç”¨**æŒ‰ç”²æ–¹ç»´åº¦**çš„ç°åº¦å‘å¸ƒç­–ç•¥:

**é˜¶æ®µ1(å†…æµ‹,1å‘¨):**
- ç°åº¦èŒƒå›´:æµ‹è¯•ç”²æ–¹(1-2ä¸ª)
- éªŒè¯å†…å®¹:åŠŸèƒ½å®Œæ•´æ€§ã€æ€§èƒ½è¡¨ç°ã€æ•°æ®å‡†ç¡®æ€§

**é˜¶æ®µ2(å°èŒƒå›´,2å‘¨):**
- ç°åº¦èŒƒå›´:5-10ä¸ªç”²æ–¹(é€‰æ‹©æ¡ˆä»¶é‡è¾ƒå°çš„)
- éªŒè¯å†…å®¹:ä¸šåŠ¡æµç¨‹ã€ç”¨æˆ·åé¦ˆã€è¾¹ç•Œåœºæ™¯

**é˜¶æ®µ3(å…¨é‡,1å‘¨):**
- ç°åº¦èŒƒå›´:æ‰€æœ‰ç”²æ–¹
- ç›‘æ§æŒ‡æ ‡:æ¥å£å“åº”æ—¶é—´ã€é”™è¯¯ç‡ã€é˜Ÿåˆ—é…ç½®å˜æ›´é¢‘ç‡

---

## äºŒã€æ•°æ®éœ€æ±‚(Data Requirements)

### 1. åŸ‹ç‚¹éœ€æ±‚(Tracking Requirements)

| è§¦å‘æ—¶é—´ç‚¹ | åŸ‹ç‚¹è¯´æ˜ | åŸ‹ç‚¹ID | å…³é”®å±æ€§ |
|-----------|---------|--------|---------|
| ç‚¹å‡»"æ·»åŠ é˜Ÿåˆ—"æŒ‰é’® | é˜Ÿåˆ—åˆ›å»ºå…¥å£ç‚¹å‡» | `queue_create_click` | user_id, tenant_id, timestamp |
| æäº¤åˆ›å»ºé˜Ÿåˆ—è¡¨å• | é˜Ÿåˆ—åˆ›å»ºæäº¤ | `queue_create_submit` | user_id, tenant_id, queue_code, queue_name, overdue_days_start, overdue_days_end, result(success/fail), error_msg, timestamp |
| ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’® | é˜Ÿåˆ—ç¼–è¾‘å…¥å£ç‚¹å‡» | `queue_edit_click` | user_id, tenant_id, queue_id, queue_code, timestamp |
| æäº¤ç¼–è¾‘é˜Ÿåˆ—è¡¨å• | é˜Ÿåˆ—ç¼–è¾‘æäº¤ | `queue_edit_submit` | user_id, tenant_id, queue_id, changed_fields, result, error_msg, timestamp |
| ç‚¹å‡»"åˆ é™¤"æŒ‰é’® | é˜Ÿåˆ—åˆ é™¤å…¥å£ç‚¹å‡» | `queue_delete_click` | user_id, tenant_id, queue_id, queue_code, timestamp |
| ç¡®è®¤åˆ é™¤é˜Ÿåˆ— | é˜Ÿåˆ—åˆ é™¤ç¡®è®¤ | `queue_delete_confirm` | user_id, tenant_id, queue_id, queue_code, result, timestamp |
| åˆ‡æ¢ç”²æ–¹é€‰æ‹©å™¨ | åˆ‡æ¢æŸ¥çœ‹ç”²æ–¹é˜Ÿåˆ— | `queue_tenant_switch` | user_id, old_tenant_id, new_tenant_id, timestamp |
| é˜Ÿåˆ—èŒƒå›´éªŒè¯å¤±è´¥ | èŒƒå›´é‡åˆ/éæ³•æ£€æµ‹ | `queue_range_validation_fail` | user_id, tenant_id, validation_type(overlap/invalid), conflicted_queue_id, timestamp |
| é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥è§¦å‘ | æ‰¹é‡åˆ†é…æ—¶é˜Ÿåˆ—æ£€æŸ¥ | `queue_limit_check` | user_id, tenant_id, case_count, collector_count, has_limit, unmatched_count, timestamp |
| å¿½ç•¥é˜Ÿåˆ—é™åˆ¶åˆ†é… | è·¨é˜Ÿåˆ—åˆ†é…æ“ä½œ | `queue_limit_ignore` | user_id, tenant_id, case_ids, collector_ids, unmatched_count, timestamp |
| é˜Ÿåˆ—ç®¡ç†é¡µé¢åŠ è½½ | é¡µé¢è®¿é—® | `queue_page_view` | user_id, tenant_id, queue_count, timestamp |
| ç‚¹å‡»"æŸ¥çœ‹æ¡ˆä»¶"æŒ‰é’® | æŸ¥çœ‹é˜Ÿåˆ—æ¡ˆä»¶å…¥å£ç‚¹å‡» | `queue_view_cases_click` | user_id, tenant_id, queue_id, queue_code, queue_name, case_count, today_case_count, timestamp |

---

## ä¸‰ã€æŠ€æœ¯éƒ¨åˆ†æè¿°(Technical Requirements / TRD)

### 1. ç³»ç»Ÿæ¶æ„ä¸æ¨¡å—åˆ’åˆ†(System Architecture & Modules)

#### 1.1 é«˜å±‚æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯å±‚(Frontend)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  é˜Ÿåˆ—ç®¡ç†é¡µé¢    â”‚  â”‚  æ¡ˆä»¶åˆ†é…é¡µé¢    â”‚                 â”‚
â”‚  â”‚  QueueManagement â”‚  â”‚  CaseAssignment  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚           â”‚                     â”‚                            â”‚
â”‚           â–¼                     â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚      APIè¯·æ±‚å±‚(request.ts)           â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTP/JSON
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â–¼      åç«¯å±‚(Backend - Java)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚       æ§åˆ¶å™¨å±‚(Controller)           â”‚                   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                   â”‚
â”‚  â”‚  â”‚QueueControllerâ”‚ â”‚CaseControllerâ”‚   â”‚                   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚            â”‚                â”‚                                â”‚
â”‚            â–¼                â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚       ä¸šåŠ¡å±‚(Service)                â”‚                   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                   â”‚
â”‚  â”‚  â”‚QueueServiceâ”‚  â”‚CaseService   â”‚   â”‚                   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚            â”‚                â”‚                                â”‚
â”‚            â–¼                â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚       æ•°æ®å±‚(Mapper)                 â”‚                   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                   â”‚
â”‚  â”‚  â”‚CaseQueueMapper â”‚  â”‚CaseMapper   â”‚ â”‚                   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ MyBatis-Plus     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â–¼                  â–¼   æ•°æ®å±‚(MySQL)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  case_queuesè¡¨   â”‚  â”‚    casesè¡¨       â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚collection_teamsè¡¨â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.2 æ¨¡å—èŒè´£

**å‰ç«¯æ¨¡å—:**
- `QueueManagement.vue`:é˜Ÿåˆ—ç®¡ç†é¡µé¢,è´Ÿè´£é˜Ÿåˆ—çš„CRUDæ“ä½œå’Œå‰ç«¯éªŒè¯
- `CaseAssignment.vue`:æ¡ˆä»¶åˆ†é…é¡µé¢,é›†æˆé˜Ÿåˆ—é™åˆ¶æ£€æŸ¥åŠŸèƒ½

**åç«¯æ¨¡å—(æ–°å¢/æ”¹åŠ¨):**
- `QueueController`:é˜Ÿåˆ—ç®¡ç†APIæ§åˆ¶å™¨(âœ…å·²åˆ›å»º)
- `QueueService`:é˜Ÿåˆ—ä¸šåŠ¡é€»è¾‘æœåŠ¡(âœ…å·²åˆ›å»º)
- `CaseQueueMapper`:é˜Ÿåˆ—æ•°æ®è®¿é—®å±‚(âœ…å·²åˆ›å»º)
- `CaseController`:æ¡ˆä»¶æ§åˆ¶å™¨(â•æ–°å¢é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥æ¥å£)
- `CaseService`:æ¡ˆä»¶æœåŠ¡(â•æ–°å¢é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥é€»è¾‘)

**æ•°æ®åº“æ¨¡å—:**
- `case_queues`:æ¡ˆä»¶é˜Ÿåˆ—è¡¨(âœ…å·²åˆ›å»º)
- `cases`:æ¡ˆä»¶è¡¨(â•æ–°å¢queue_idå­—æ®µå…³è”)
- `collection_teams`:å‚¬æ”¶å°ç»„è¡¨(â•æ–°å¢queue_idå­—æ®µå…³è”)

### 2. æ¥å£è®¾è®¡ä¸ç³»ç»Ÿä¾èµ–(API Design & Dependencies)

#### 2.1 å†…éƒ¨æ¥å£

**2.1.1 è·å–é˜Ÿåˆ—åˆ—è¡¨**

```
GET /api/v1/queues?tenant_id={tenant_id}&is_active={is_active}
```

**è¯·æ±‚å‚æ•°:**
- tenant_id(å¯é€‰):ç”²æ–¹ID,ä¸ä¼ åˆ™è¿”å›æ‰€æœ‰ç”²æ–¹çš„é˜Ÿåˆ—
- is_active(å¯é€‰):æ˜¯å¦å¯ç”¨,true=ä»…å¯ç”¨,false=ä»…ç¦ç”¨,ä¸ä¼ =å…¨éƒ¨

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 101,
      "tenant_id": 1,
      "queue_code": "C",
      "queue_name": "Cé˜Ÿåˆ—",
      "queue_name_en": "C Queue",
      "queue_description": "æœªé€¾æœŸå®¢æˆ·",
      "overdue_days_start": null,
      "overdue_days_end": -1,
      "sort_order": 1,
      "is_active": true,
      "case_count": 120,
      "today_case_count": 15,
      "created_at": "2025-01-01T00:00:00",
      "updated_at": "2025-01-01T00:00:00"
    }
  ]
}
```

**å­—æ®µè¯´æ˜:**
- `case_count`: è¯¥é˜Ÿåˆ—å½“å‰çš„æ¡ˆä»¶æ€»æ•°(æœªç»“æ¸…)
- `today_case_count`: **ã€æ–°å¢ã€‘**ä»Šæ—¥æ–°å¢åˆ°è¯¥é˜Ÿåˆ—çš„æ¡ˆä»¶æ•°

**è¶…æ—¶ç­–ç•¥:**3ç§’è¶…æ—¶,æ— é‡è¯•

**å¤±è´¥é™çº§:**è¿”å›ç©ºåˆ—è¡¨,å‰ç«¯æ˜¾ç¤º"æš‚æ— é˜Ÿåˆ—æ•°æ®"

---

**2.1.2 è·å–é˜Ÿåˆ—è¯¦æƒ…**

```
GET /api/v1/queues/{id}
```

**è·¯å¾„å‚æ•°:**
- id:é˜Ÿåˆ—ID

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 101,
    "tenant_id": 1,
    "queue_code": "M1",
    "queue_name": "M1é˜Ÿåˆ—",
    "overdue_days_start": 91,
    "overdue_days_end": null,
    "sort_order": 5,
    "is_active": true,
    "case_count": 320,
    "today_case_count": 28
  }
}
```

**è¶…æ—¶ç­–ç•¥:**3ç§’è¶…æ—¶,æ— é‡è¯•

---

**2.1.3 åˆ›å»ºé˜Ÿåˆ—**

```
POST /api/v1/queues
```

**è¯·æ±‚ä½“:**
```json
{
  "tenant_id": 1,
  "queue_code": "M2",
  "queue_name": "M2é˜Ÿåˆ—",
  "queue_name_en": "M2 Queue",
  "queue_description": "ä¸­é•¿æœŸé€¾æœŸæ¡ˆä»¶",
  "overdue_days_start": 31,
  "overdue_days_end": 60,
  "sort_order": 6,
  "is_active": true
}
```

**å“åº”ç¤ºä¾‹(æˆåŠŸ):**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 106,
    "tenant_id": 1,
    "queue_code": "M2",
    "queue_name": "M2é˜Ÿåˆ—",
    "overdue_days_start": 31,
    "overdue_days_end": 60,
    "sort_order": 6,
    "is_active": true
  }
}
```

**å“åº”ç¤ºä¾‹(å¤±è´¥-èŒƒå›´é‡åˆ):**
```json
{
  "code": 400,
  "message": "é€¾æœŸå¤©æ•°èŒƒå›´ä¸å…¶ä»–é˜Ÿåˆ—é‡åˆ",
  "data": null
}
```

**å“åº”ç¤ºä¾‹(å¤±è´¥-ç¼–ç é‡å¤):**
```json
{
  "code": 400,
  "message": "é˜Ÿåˆ—ç¼–ç å·²å­˜åœ¨:M2",
  "data": null
}
```

**è¶…æ—¶ç­–ç•¥:**5ç§’è¶…æ—¶,æ— é‡è¯•(å†™æ“ä½œ)

**å¹‚ç­‰è¦æ±‚:**æ ¹æ®tenant_id+queue_codeåˆ¤æ–­æ˜¯å¦é‡å¤åˆ›å»º

---

**2.1.4 æ›´æ–°é˜Ÿåˆ—**

```
PUT /api/v1/queues/{id}
```

**è·¯å¾„å‚æ•°:**
- id:é˜Ÿåˆ—ID

**è¯·æ±‚ä½“:**
```json
{
  "queue_name": "M2é˜Ÿåˆ—(ä¿®æ”¹)",
  "overdue_days_start": 31,
  "overdue_days_end": 90,
  "is_active": false
}
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 106,
    "queue_name": "M2é˜Ÿåˆ—(ä¿®æ”¹)",
    "overdue_days_start": 31,
    "overdue_days_end": 90,
    "is_active": false
  }
}
```

**è¶…æ—¶ç­–ç•¥:**5ç§’è¶…æ—¶,æ— é‡è¯•

**å¹‚ç­‰è¦æ±‚:**ç›¸åŒå‚æ•°å¤šæ¬¡è°ƒç”¨ç»“æœä¸€è‡´

---

**2.1.5 åˆ é™¤é˜Ÿåˆ—**

```
DELETE /api/v1/queues/{id}
```

**è·¯å¾„å‚æ•°:**
- id:é˜Ÿåˆ—ID

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 200,
  "message": "åˆ é™¤æˆåŠŸ",
  "data": null
}
```

**å“åº”ç¤ºä¾‹(å¤±è´¥-å…³è”æ¡ˆä»¶):**
```json
{
  "code": 400,
  "message": "è¯¥é˜Ÿåˆ—ä¸‹æœ‰å…³è”æ¡ˆä»¶,æ— æ³•åˆ é™¤",
  "data": {
    "case_count": 120
  }
}
```

**è¶…æ—¶ç­–ç•¥:**5ç§’è¶…æ—¶,æ— é‡è¯•

**å¹‚ç­‰è¦æ±‚:**é‡å¤åˆ é™¤ä¸æŠ¥é”™,è¿”å›æˆåŠŸ

---

**2.1.6 æ£€æŸ¥é˜Ÿåˆ—é™åˆ¶**

```
POST /api/v1/cases/check-queue-limit
```

**è¯·æ±‚ä½“:**
```json
{
  "case_ids": [1001, 1002, 1003],
  "collector_ids": [201, 202]
}
```

**å“åº”ç¤ºä¾‹(æ— é™åˆ¶):**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "has_limit": false,
    "unmatched_items": []
  }
}
```

**å“åº”ç¤ºä¾‹(æœ‰é™åˆ¶):**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "has_limit": true,
    "unmatched_items": [
      {
        "case_id": 1001,
        "case_code": "CASE20250101001",
        "case_queue_id": 101,
        "case_queue_name": "M1é˜Ÿåˆ—",
        "collector_id": 201,
        "collector_name": "å¼ ä¸‰",
        "collector_team_queue_id": 102,
        "collector_team_queue_name": "S1é˜Ÿåˆ—"
      }
    ]
  }
}
```

**è¶…æ—¶ç­–ç•¥:**3ç§’è¶…æ—¶,æ— é‡è¯•

**å¤±è´¥é™çº§:**è¿”å›has_limit=false,å…è®¸åˆ†é…(è®°å½•è­¦å‘Šæ—¥å¿—)

---

**2.1.7 æ‰¹é‡åˆ†é…æ¡ˆä»¶(å«é˜Ÿåˆ—é™åˆ¶å‚æ•°)**

```
POST /api/v1/cases/batch-assign
```

**è¯·æ±‚ä½“:**
```json
{
  "case_ids": [1001, 1002, 1003],
  "collector_ids": [201, 202],
  "ignore_queue_limit": false
}
```

**è¯·æ±‚å‚æ•°è¯´æ˜:**
- case_ids:æ¡ˆä»¶IDåˆ—è¡¨
- collector_ids:å‚¬å‘˜IDåˆ—è¡¨
- ignore_queue_limit:æ˜¯å¦å¿½ç•¥é˜Ÿåˆ—é™åˆ¶(é»˜è®¤false)

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "success_count": 5,
    "failure_count": 1,
    "details": [
      {
        "case_id": 1001,
        "collector_id": 201,
        "status": "success"
      },
      {
        "case_id": 1002,
        "collector_id": 201,
        "status": "failed",
        "error": "é˜Ÿåˆ—ä¸åŒ¹é…"
      }
    ]
  }
}
```

**è¶…æ—¶ç­–ç•¥:**10ç§’è¶…æ—¶(æ‰¹é‡æ“ä½œ),æ— é‡è¯•

**å¹‚ç­‰è¦æ±‚:**æ ¹æ®æ¡ˆä»¶ID+å‚¬å‘˜IDå»é‡,é‡å¤åˆ†é…æ›´æ–°åˆ†é…æ—¶é—´

#### 2.2 å¤–éƒ¨ä¾èµ–

æœ¬åŠŸèƒ½æ— å¤–éƒ¨ç³»ç»Ÿä¾èµ–ã€‚

### 3. æ•°æ®å­˜å‚¨ä¸æ¨¡å‹ä¾èµ–(Data Storage & Model Dependencies)

#### 3.1 æ•°æ®åº“è¡¨ç»“æ„

**æ–°å¢è¡¨:case_queues(æ¡ˆä»¶é˜Ÿåˆ—è¡¨)**

```sql
CREATE TABLE IF NOT EXISTS `case_queues` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `tenant_id` BIGINT NOT NULL COMMENT 'æ‰€å±ç”²æ–¹ID',
    `queue_code` VARCHAR(100) NOT NULL COMMENT 'é˜Ÿåˆ—ç¼–ç (å¦‚:M1, M2, M3+, LEGAL)',
    `queue_name` VARCHAR(200) NOT NULL COMMENT 'é˜Ÿåˆ—åç§°',
    `queue_name_en` VARCHAR(200) COMMENT 'é˜Ÿåˆ—åç§°(è‹±æ–‡)',
    `queue_description` TEXT COMMENT 'é˜Ÿåˆ—æè¿°',
    `overdue_days_start` INT COMMENT 'é€¾æœŸå¤©æ•°èµ·å§‹å€¼(nullè¡¨ç¤ºè´Ÿæ— ç©·)',
    `overdue_days_end` INT COMMENT 'é€¾æœŸå¤©æ•°ç»“æŸå€¼(nullè¡¨ç¤ºæ­£æ— ç©·)',
    `sort_order` INT DEFAULT 0 COMMENT 'æ’åºé¡ºåº',
    `is_active` TINYINT(1) DEFAULT 1 COMMENT 'æ˜¯å¦å¯ç”¨',
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    KEY `idx_tenant_id` (`tenant_id`),
    KEY `idx_sort_order` (`sort_order`),
    UNIQUE KEY `uk_tenant_code` (`tenant_id`, `queue_code`),
    CONSTRAINT `fk_queue_tenant` FOREIGN KEY (`tenant_id`) REFERENCES `tenants` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ¡ˆä»¶é˜Ÿåˆ—è¡¨';
```

**ç´¢å¼•è¯´æ˜:**
- PRIMARY KEY:id(ä¸»é”®)
- idx_tenant_id:æŒ‰ç”²æ–¹æŸ¥è¯¢é˜Ÿåˆ—(é«˜é¢‘æŸ¥è¯¢)
- idx_sort_order:é˜Ÿåˆ—æ’åº
- uk_tenant_code:ä¿è¯åŒä¸€ç”²æ–¹ä¸‹é˜Ÿåˆ—ç¼–ç å”¯ä¸€

---

**å˜æ›´è¡¨:cases(æ¡ˆä»¶è¡¨)**

```sql
-- æ–°å¢å­—æ®µ
ALTER TABLE `cases` ADD COLUMN `queue_id` BIGINT COMMENT 'æ‰€å±é˜Ÿåˆ—ID';

-- æ–°å¢ç´¢å¼•
ALTER TABLE `cases` ADD KEY `idx_queue_id` (`queue_id`);

-- æ–°å¢å¤–é”®(å¯é€‰,æ€§èƒ½è€ƒè™‘å¯ä¸åŠ )
ALTER TABLE `cases` ADD CONSTRAINT `fk_case_queue` 
  FOREIGN KEY (`queue_id`) REFERENCES `case_queues` (`id`);
```

---

**å˜æ›´è¡¨:collection_teams(å‚¬æ”¶å°ç»„è¡¨)**

```sql
-- æ–°å¢å­—æ®µ
ALTER TABLE `collection_teams` ADD COLUMN `queue_id` BIGINT COMMENT 'è´Ÿè´£é˜Ÿåˆ—ID';

-- æ–°å¢ç´¢å¼•
ALTER TABLE `collection_teams` ADD KEY `idx_queue_id` (`queue_id`);

-- æ–°å¢å¤–é”®(å¯é€‰)
ALTER TABLE `collection_teams` ADD CONSTRAINT `fk_team_queue` 
  FOREIGN KEY (`queue_id`) REFERENCES `case_queues` (`id`);
```

#### 3.2 ç®—æ³•æ¨¡å‹ä¾èµ–

**èŒƒå›´é‡åˆæ£€æµ‹ç®—æ³•:**

```java
/**
 * æ£€æŸ¥ä¸¤ä¸ªåŒºé—´æ˜¯å¦é‡åˆ
 * 
 * @param start1 åŒºé—´1èµ·å§‹å€¼(nullè¡¨ç¤ºè´Ÿæ— ç©·)
 * @param end1 åŒºé—´1ç»“æŸå€¼(nullè¡¨ç¤ºæ­£æ— ç©·)
 * @param start2 åŒºé—´2èµ·å§‹å€¼(nullè¡¨ç¤ºè´Ÿæ— ç©·)
 * @param end2 åŒºé—´2ç»“æŸå€¼(nullè¡¨ç¤ºæ­£æ— ç©·)
 * @return æ˜¯å¦é‡åˆ
 */
private boolean rangesOverlap(Integer start1, Integer end1, Integer start2, Integer end2) {
    // è½¬æ¢ä¸ºå¯æ¯”è¾ƒçš„å€¼
    int s1 = start1 == null ? Integer.MIN_VALUE : start1;
    int e1 = end1 == null ? Integer.MAX_VALUE : end1;
    int s2 = start2 == null ? Integer.MIN_VALUE : start2;
    int e2 = end2 == null ? Integer.MAX_VALUE : end2;
    
    // ä¸¤ä¸ªåŒºé—´é‡åˆçš„æ¡ä»¶:s1 <= e2 && s2 <= e1
    return s1 <= e2 && s2 <= e1;
}
```

**æ¡ˆä»¶è‡ªåŠ¨å½’é˜Ÿç®—æ³•(åç»­è¿­ä»£):**

```java
/**
 * æ ¹æ®é€¾æœŸå¤©æ•°è‡ªåŠ¨åŒ¹é…é˜Ÿåˆ—
 * 
 * @param tenantId ç”²æ–¹ID
 * @param overdueDays é€¾æœŸå¤©æ•°
 * @return åŒ¹é…çš„é˜Ÿåˆ—ID,æ— åŒ¹é…è¿”å›null
 */
public Long matchQueue(Long tenantId, Integer overdueDays) {
    // æŸ¥è¯¢è¯¥ç”²æ–¹æ‰€æœ‰å¯ç”¨çš„é˜Ÿåˆ—
    List<CaseQueue> queues = queueService.listByTenantId(tenantId, true);
    
    // éå†é˜Ÿåˆ—,æ‰¾åˆ°åŒ…å«è¯¥é€¾æœŸå¤©æ•°çš„é˜Ÿåˆ—
    for (CaseQueue queue : queues) {
        int start = queue.getOverdueDaysStart() == null 
                    ? Integer.MIN_VALUE 
                    : queue.getOverdueDaysStart();
        int end = queue.getOverdueDaysEnd() == null 
                  ? Integer.MAX_VALUE 
                  : queue.getOverdueDaysEnd();
        
        if (overdueDays >= start && overdueDays <= end) {
            return queue.getId();
        }
    }
    
    return null; // æ— åŒ¹é…é˜Ÿåˆ—
}
```

#### 3.3 ç‰ˆæœ¬ç®¡ç†ä¸å›æ»šæ–¹æ¡ˆ

**æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†:**
- ä½¿ç”¨Flywayæˆ–Liquibaseè¿›è¡Œæ•°æ®åº“ç‰ˆæœ¬æ§åˆ¶
- è¿ç§»è„šæœ¬å‘½åè§„èŒƒ:`V{ç‰ˆæœ¬å·}__{æè¿°}.sql`
  - ç¤ºä¾‹:`V1.0.0__create_case_queues_table.sql`

**å›æ»šæ–¹æ¡ˆ:**

1. **ä»£ç å›æ»š:**
   - Gitå›é€€åˆ°ä¸Šä¸€ç¨³å®šç‰ˆæœ¬
   - é‡æ–°ç¼–è¯‘éƒ¨ç½²

2. **æ•°æ®åº“å›æ»š:**
   ```sql
   -- å›æ»šé˜Ÿåˆ—è¡¨(æ…ç”¨,ä¼šä¸¢å¤±æ•°æ®)
   DROP TABLE IF EXISTS `case_queues`;
   
   -- å›æ»šæ¡ˆä»¶è¡¨å­—æ®µ
   ALTER TABLE `cases` DROP COLUMN `queue_id`;
   
   -- å›æ»šå°ç»„è¡¨å­—æ®µ
   ALTER TABLE `collection_teams` DROP COLUMN `queue_id`;
   ```

3. **æ•°æ®å¤‡ä»½ç­–ç•¥:**
   - ä¸Šçº¿å‰å®Œæ•´å¤‡ä»½æ•°æ®åº“
   - ä¿ç•™å¤‡ä»½è‡³å°‘7å¤©
   - é‡å¤§å˜æ›´å‰å•ç‹¬å¤‡ä»½case_queuesè¡¨

### 4. éåŠŸèƒ½æ€§è¦æ±‚(Non-Functional Requirements)

#### 4.1 æ€§èƒ½è¦æ±‚

| æ¥å£ | QPSç›®æ ‡ | å“åº”æ—¶é—´(P99) | å³°å€¼å®¹é‡ |
|------|---------|--------------|---------|
| GET /api/v1/queues | 100 | <200ms | 500 QPS |
| POST /api/v1/queues | 10 | <500ms | 50 QPS |
| PUT /api/v1/queues/{id} | 10 | <500ms | 50 QPS |
| DELETE /api/v1/queues/{id} | 5 | <500ms | 20 QPS |
| POST /api/v1/cases/check-queue-limit | 50 | <300ms | 200 QPS |
| POST /api/v1/cases/batch-assign | 20 | <1000ms | 100 QPS |

**æ€§èƒ½ä¼˜åŒ–ç­–ç•¥:**
- é˜Ÿåˆ—åˆ—è¡¨æŸ¥è¯¢ç»“æœç¼“å­˜(Redis,5åˆ†é’Ÿè¿‡æœŸ)
- é˜Ÿåˆ—èŒƒå›´æ£€æŸ¥ä½¿ç”¨å†…å­˜è®¡ç®—,é¿å…å¤šæ¬¡æ•°æ®åº“æŸ¥è¯¢
- æ‰¹é‡åˆ†é…é‡‡ç”¨å¼‚æ­¥å¤„ç†,å¤§æ‰¹é‡(>1000æ¡ˆä»¶)è½¬åå°ä»»åŠ¡

#### 4.2 å¯ç”¨æ€§è¦æ±‚

**SLAç›®æ ‡:**
- æœˆåº¦å¯ç”¨æ€§:99.9%(å…è®¸43.2åˆ†é’Ÿ/æœˆä¸å¯ç”¨)
- æ•…éšœæ¢å¤æ—¶é—´(MTTR):<30åˆ†é’Ÿ

**é™çº§ç­–ç•¥:**
1. **é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥é™çº§:**
   - é˜Ÿåˆ—æœåŠ¡ä¸å¯ç”¨æ—¶,è·³è¿‡é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥,å…è®¸åˆ†é…
   - è®°å½•é™çº§æ—¥å¿—,äº‹åäººå·¥å®¡æ ¸

2. **é˜Ÿåˆ—åˆ—è¡¨æŸ¥è¯¢é™çº§:**
   - æ•°æ®åº“ä¸å¯ç”¨æ—¶,è¿”å›Redisç¼“å­˜çš„é˜Ÿåˆ—æ•°æ®
   - ç¼“å­˜ä¸å¯ç”¨æ—¶,è¿”å›ç¡¬ç¼–ç çš„é»˜è®¤5é˜Ÿåˆ—é…ç½®

3. **é˜Ÿåˆ—é…ç½®å˜æ›´é™çº§:**
   - æ•°æ®åº“ä¸å¯ç”¨æ—¶,æ‹’ç»é˜Ÿåˆ—é…ç½®å˜æ›´,è¿”å›å‹å¥½æç¤º
   - ä¸å…è®¸é™çº§ä¸ºå…è®¸å˜æ›´(é¿å…æ•°æ®ä¸ä¸€è‡´)

#### 4.3 å®‰å…¨è¦æ±‚

**æ¥å£é‰´æƒ:**
- æ‰€æœ‰é˜Ÿåˆ—ç®¡ç†æ¥å£éœ€éªŒè¯JWT Token
- Tokenä¸­åŒ…å«user_idã€roleã€permissionså­—æ®µ
- é˜Ÿåˆ—é…ç½®å˜æ›´æ¥å£éœ€éªŒè¯è§’è‰²æƒé™(ADMINæˆ–OPERATOR)

**æ•°æ®è„±æ•:**
- é˜Ÿåˆ—é…ç½®ä¸æ¶‰åŠæ•æ„Ÿä¿¡æ¯,æ— éœ€è„±æ•
- é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥è¿”å›çš„æ¡ˆä»¶ä¿¡æ¯è„±æ•æ˜¾ç¤º(ä»…æ˜¾ç¤ºæ¡ˆä»¶ç¼–å·,ä¸æ˜¾ç¤ºå§“å/æ‰‹æœºå·)

**SQLæ³¨å…¥é˜²æŠ¤:**
- ä½¿ç”¨MyBatis-Plusçš„å‚æ•°åŒ–æŸ¥è¯¢,é¿å…SQLæ‹¼æ¥
- å‰ç«¯è¾“å…¥éªŒè¯:é˜Ÿåˆ—ç¼–ç ä»…å…è®¸å­—æ¯æ•°å­—ä¸‹åˆ’çº¿,é˜Ÿåˆ—åç§°é™åˆ¶é•¿åº¦

**åŠ å¯†å­˜å‚¨:**
- é˜Ÿåˆ—é…ç½®æ•°æ®æ˜æ–‡å­˜å‚¨(éæ•æ„Ÿä¿¡æ¯)
- é˜Ÿåˆ—é…ç½®å˜æ›´æ—¥å¿—åŠ å¯†å­˜å‚¨(åŒ…å«æ“ä½œäººä¿¡æ¯)

#### 4.4 æ‰©å±•æ€§è¦æ±‚

**æ°´å¹³æ‰©å±•:**
- åº”ç”¨æœåŠ¡å™¨æ— çŠ¶æ€è®¾è®¡,æ”¯æŒæ°´å¹³æ‰©å±•(è´Ÿè½½å‡è¡¡)
- æ•°æ®åº“è¯»å†™åˆ†ç¦»,è¯»æ“ä½œè·¯ç”±åˆ°åªè¯»ä»åº“

**å¤šæœºæˆ¿éƒ¨ç½²:**
- æ•°æ®åº“ä¸»ä»è·¨æœºæˆ¿éƒ¨ç½²,ä»åº“å»¶è¿Ÿ<1ç§’
- Redisç¼“å­˜è·¨æœºæˆ¿åŒæ­¥,ä¿è¯æ•°æ®ä¸€è‡´æ€§

**å®¹é‡è§„åˆ’:**
- å•ç”²æ–¹é˜Ÿåˆ—æ•°ä¸Šé™:50ä¸ª(è½¯é™åˆ¶,å¯é…ç½®)
- ç³»ç»Ÿæ€»é˜Ÿåˆ—æ•°ä¸Šé™:5000ä¸ª(æ”¯æŒ100ä¸ªç”²æ–¹,æ¯ä¸ª50é˜Ÿåˆ—)
- å•æ¬¡æ‰¹é‡åˆ†é…æ¡ˆä»¶æ•°ä¸Šé™:1000ä¸ª

### 5. æ—¥å¿—åŸ‹ç‚¹ä¸ç›‘æ§å‘Šè­¦(Logging, Metrics & Alerting)

#### 5.1 å…³é”®æ—¥å¿—

**æ—¥å¿—çº§åˆ«è§„èŒƒ:**
- INFO:æ­£å¸¸ä¸šåŠ¡æ“ä½œ(åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤é˜Ÿåˆ—)
- WARN:ä¸šåŠ¡å¼‚å¸¸ä½†å¯ç»§ç»­(èŒƒå›´é‡åˆã€é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥å¤±è´¥)
- ERROR:ç³»ç»Ÿå¼‚å¸¸(æ•°æ®åº“è¿æ¥å¤±è´¥ã€å‚æ•°éªŒè¯å¼‚å¸¸)

**å¿…é¡»è®°å½•çš„æ—¥å¿—:**

1. **é˜Ÿåˆ—åˆ›å»ºæ—¥å¿—**
```
[INFO] ========== åˆ›å»ºé˜Ÿåˆ—,request={tenant_id=1, queue_code=M2, queue_name=M2é˜Ÿåˆ—, ...} ==========
[INFO] ========== é˜Ÿåˆ—åˆ›å»ºæˆåŠŸ,id=106 ==========
```

2. **é˜Ÿåˆ—èŒƒå›´é‡åˆæ—¥å¿—**
```
[WARN] ========== é˜Ÿåˆ—èŒƒå›´é‡åˆæ£€æµ‹,tenant_id=1, new_range=[31,60], conflicted_queue={id=105, code=L1, range=[6,90]} ==========
```

3. **é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥æ—¥å¿—**
```
[INFO] ========== æ£€æŸ¥é˜Ÿåˆ—é™åˆ¶,caseIds=[1001,1002], collectorIds=[201,202] ==========
[WARN] ========== é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥å‘ç°ä¸åŒ¹é…,case_id=1001, case_queue=M1, collector_queue=S1 ==========
[INFO] ========== é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥å®Œæˆ,hasLimit=true, unmatchedCount=1 ==========
```

4. **è·¨é˜Ÿåˆ—åˆ†é…æ—¥å¿—**
```
[WARN] ========== å¿½ç•¥é˜Ÿåˆ—é™åˆ¶åˆ†é…æ¡ˆä»¶,operator_id=1001, case_ids=[1001,1002], collector_ids=[201], unmatched_count=2 ==========
```

5. **é˜Ÿåˆ—åˆ é™¤æ—¥å¿—**
```
[INFO] ========== åˆ é™¤é˜Ÿåˆ—,id=106, queue_code=M2 ==========
[WARN] ========== åˆ é™¤é˜Ÿåˆ—å¤±è´¥,queueä¸‹æœ‰å…³è”æ¡ˆä»¶,queue_id=106, case_count=120 ==========
```

#### 5.2 ç›‘æ§æŒ‡æ ‡

| æŒ‡æ ‡åç§° | æŒ‡æ ‡ç±»å‹ | é‡‡é›†ç»´åº¦ | å‘Šè­¦é˜ˆå€¼ |
|---------|---------|---------|---------|
| queue_api_qps | Counter | æ¥å£+æ–¹æ³• | >500 QPS |
| queue_api_response_time | Histogram | æ¥å£+æ–¹æ³• | P99 > 1s |
| queue_api_error_rate | Gauge | æ¥å£+æ–¹æ³• | >5% |
| queue_range_overlap_count | Counter | ç”²æ–¹ | >10æ¬¡/å°æ—¶ |
| queue_limit_check_fail_count | Counter | ç”²æ–¹ | >50æ¬¡/å°æ—¶ |
| queue_cross_assign_count | Counter | ç”²æ–¹+æ“ä½œäºº | >20æ¬¡/æ—¥ |
| queue_delete_fail_count | Counter | ç”²æ–¹ | >5æ¬¡/å°æ—¶ |
| queue_config_change_count | Counter | ç”²æ–¹+æ“ä½œäºº | >10æ¬¡/å°æ—¶ |
| active_queue_count | Gauge | ç”²æ–¹ | >50ä¸ª |
| queue_case_distribution_skew | Gauge | ç”²æ–¹ | >0.7(åŸºå°¼ç³»æ•°) |
| queue_view_cases_click_count | Counter | ç”²æ–¹+é˜Ÿåˆ— | ç›‘æ§å€¼,æ— å‘Šè­¦ |
| today_case_count_per_queue | Gauge | ç”²æ–¹+é˜Ÿåˆ— | >500/é˜Ÿåˆ— |

#### 5.3 å‘Šè­¦è§„åˆ™

| å‘Šè­¦åç§° | è§¦å‘æ¡ä»¶ | å‘Šè­¦çº§åˆ« | é€šçŸ¥æ–¹å¼ | å¤„ç†SLA |
|---------|---------|---------|---------|---------|
| é˜Ÿåˆ—APIå“åº”æ…¢ | P99å“åº”æ—¶é—´>1ç§’,æŒç»­5åˆ†é’Ÿ | P2(ç´§æ€¥) | çŸ­ä¿¡+é’‰é’‰ | 30åˆ†é’Ÿ |
| é˜Ÿåˆ—APIé”™è¯¯ç‡é«˜ | é”™è¯¯ç‡>5%,æŒç»­3åˆ†é’Ÿ | P1(ä¸¥é‡) | ç”µè¯+çŸ­ä¿¡ | 15åˆ†é’Ÿ |
| èŒƒå›´é‡åˆé¢‘ç¹ | 1å°æ—¶å†…é‡åˆæ£€æµ‹>10æ¬¡(åŒä¸€ç”²æ–¹) | P3(è­¦å‘Š) | é’‰é’‰ | 2å°æ—¶ |
| è·¨é˜Ÿåˆ—åˆ†é…é¢‘ç¹ | 1å¤©å†…è·¨é˜Ÿåˆ—åˆ†é…>20æ¬¡(åŒä¸€æ“ä½œäºº) | P3(è­¦å‘Š) | é‚®ä»¶ | 1å¤© |
| é˜Ÿåˆ—é…ç½®å˜æ›´é¢‘ç¹ | 1å°æ—¶å†…é…ç½®å˜æ›´>10æ¬¡(åŒä¸€ç”²æ–¹) | P3(è­¦å‘Š) | é’‰é’‰ | 2å°æ—¶ |
| é˜Ÿåˆ—åˆ†å¸ƒä¸å‡ | æŸé˜Ÿåˆ—æ¡ˆä»¶é‡>æ€»æ¡ˆä»¶50% | P4(æç¤º) | é‚®ä»¶ | 3å¤© |
| é˜Ÿåˆ—æ•°é‡è¿‡å¤š | æŸç”²æ–¹é˜Ÿåˆ—æ•°>50ä¸ª | P4(æç¤º) | é‚®ä»¶ | 3å¤© |

### 6. æµ‹è¯•ç­–ç•¥ä¸éªŒæ”¶æ ‡å‡†(Test Plan & Acceptance Criteria)

#### 6.1 æµ‹è¯•ç±»å‹

**å•å…ƒæµ‹è¯•(è¦†ç›–ç‡>80%):**
- QueueService.hasOverlappingRange() èŒƒå›´é‡åˆæ£€æµ‹é€»è¾‘
- QueueService.existsByQueueCode() ç¼–ç å”¯ä¸€æ€§æ£€æŸ¥
- CaseService.checkQueueLimit() é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥é€»è¾‘
- è¾¹ç•Œå€¼æµ‹è¯•:NULLå€¼å¤„ç†ã€Integer.MIN_VALUE/MAX_VALUE

**é›†æˆæµ‹è¯•:**
- é˜Ÿåˆ—CRUDæ¥å£ç«¯åˆ°ç«¯æµ‹è¯•
- é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥+æ‰¹é‡åˆ†é…è”åˆæµ‹è¯•
- æ•°æ®åº“äº‹åŠ¡ä¸€è‡´æ€§æµ‹è¯•

**æ€§èƒ½æµ‹è¯•:**
- é˜Ÿåˆ—åˆ—è¡¨æŸ¥è¯¢:100å¹¶å‘,å“åº”æ—¶é—´<200ms
- é˜Ÿåˆ—åˆ›å»º:10å¹¶å‘,å“åº”æ—¶é—´<500ms
- é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥:50å¹¶å‘(100æ¡ˆä»¶+10å‚¬å‘˜),å“åº”æ—¶é—´<300ms
- æ‰¹é‡åˆ†é…:20å¹¶å‘(100æ¡ˆä»¶/æ‰¹),å“åº”æ—¶é—´<1000ms

**é£æ§ç­–ç•¥éªŒè¯:**
- èŒƒå›´é‡åˆé˜»æ­¢:åˆ›å»ºé‡åˆèŒƒå›´é˜Ÿåˆ—åº”å¤±è´¥
- ç¼–ç é‡å¤é˜»æ­¢:åˆ›å»ºé‡å¤ç¼–ç é˜Ÿåˆ—åº”å¤±è´¥
- é˜Ÿåˆ—åˆ é™¤ä¿æŠ¤:åˆ é™¤æœ‰å…³è”æ¡ˆä»¶çš„é˜Ÿåˆ—åº”å¤±è´¥

**å›å½’æµ‹è¯•:**
- åŸæœ‰æ¡ˆä»¶åˆ—è¡¨æŸ¥è¯¢åŠŸèƒ½ä¸å—å½±å“
- åŸæœ‰æ¡ˆä»¶åˆ†é…åŠŸèƒ½ä¸å—å½±å“
- åŸæœ‰ç”²æ–¹ç®¡ç†åŠŸèƒ½ä¸å—å½±å“

#### 6.2 éªŒæ”¶æ ‡å‡†

**å…³é”®éªŒæ”¶æ ‡å‡†(å¿…é¡»é€šè¿‡):**

1. âœ… **é˜Ÿåˆ—é…ç½®å®Œæ•´æ€§**
   - æ–°ç”²æ–¹æ¥å…¥æ—¶è‡ªåŠ¨ç”Ÿæˆ5ä¸ªé»˜è®¤é˜Ÿåˆ—(C/S0/S1/L1/M1)
   - é»˜è®¤é˜Ÿåˆ—è¦†ç›–(-âˆ, +âˆ)åŒºé—´,æ— é—æ¼
   - é»˜è®¤é˜Ÿåˆ—æ— èŒƒå›´é‡åˆ

2. âœ… **èŒƒå›´é‡åˆæ£€æµ‹æœ‰æ•ˆæ€§**
   - åˆ›å»ºèŒƒå›´é‡åˆçš„é˜Ÿåˆ—è¢«é˜»æ­¢,è¿”å›æ˜ç¡®é”™è¯¯æç¤º
   - ç¼–è¾‘é˜Ÿåˆ—èŒƒå›´å¯¼è‡´é‡åˆæ—¶è¢«é˜»æ­¢
   - å‰åç«¯åŒé‡éªŒè¯,é¿å…ç»•è¿‡

3. âœ… **é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥å‡†ç¡®æ€§**
   - æ¡ˆä»¶é˜Ÿåˆ—ä¸å‚¬å‘˜é˜Ÿåˆ—ä¸åŒ¹é…æ—¶æ­£ç¡®è¯†åˆ«
   - ä¸åŒ¹é…é¡¹åˆ—è¡¨ä¿¡æ¯å®Œæ•´(æ¡ˆä»¶ç¼–å·ã€é˜Ÿåˆ—åç§°ã€å‚¬å‘˜å§“å)
   - å¿½ç•¥é™åˆ¶åˆ†é…è®°å½•è­¦å‘Šæ—¥å¿—

4. âœ… **æ•°æ®ä¸€è‡´æ€§**
   - é˜Ÿåˆ—é…ç½®å˜æ›´äº‹åŠ¡å®Œæ•´,æ— è„æ•°æ®
   - é˜Ÿåˆ—åˆ é™¤æ—¶å…³è”æ¡ˆä»¶æ£€æŸ¥æœ‰æ•ˆ
   - å¹¶å‘åˆ›å»ºé˜Ÿåˆ—ç¼–ç å”¯ä¸€æ€§ä¿è¯

5. âœ… **æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡**
   - é˜Ÿåˆ—åˆ—è¡¨æŸ¥è¯¢P99<200ms
   - é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥P99<300ms
   - æ‰¹é‡åˆ†é…P99<1000ms
   - é”™è¯¯ç‡<1%

6. âœ… **ä»Šæ—¥æ¡ˆä»¶æ•°ç»Ÿè®¡å‡†ç¡®æ€§**
   - ä»Šæ—¥æ¡ˆä»¶æ•°ç»Ÿè®¡å£å¾„æ­£ç¡®(ä»…ç»Ÿè®¡å½“å¤©æ–°å¢æ¡ˆä»¶)
   - æ•°æ®å®æ—¶æ›´æ–°,åˆ·æ–°é¡µé¢åæ˜¾ç¤ºæœ€æ–°æ•°æ®
   - ä»Šæ—¥æ¡ˆä»¶æ•°ä¸º0æ—¶æ­£ç¡®æ˜¾ç¤ºä¸º"-"

7. âœ… **æŸ¥çœ‹æ¡ˆä»¶åŠŸèƒ½å®Œæ•´æ€§**
   - ç‚¹å‡»"æŸ¥çœ‹æ¡ˆä»¶"æŒ‰é’®æ­£ç¡®è·³è½¬åˆ°æ¡ˆä»¶åˆ—è¡¨é¡µ
   - æ¡ˆä»¶åˆ—è¡¨é¡µè‡ªåŠ¨ç­›é€‰è¯¥é˜Ÿåˆ—çš„æ¡ˆä»¶
   - URLå‚æ•°æ­£ç¡®ä¼ é€’(queue_idå’Œqueue_name)
   - é¢åŒ…å±‘å¯¼èˆªæ­£ç¡®æ˜¾ç¤º
   - ç‚¹å‡»æ¡ˆä»¶æ•°å­—åŒæ ·è§¦å‘è·³è½¬

**æ¬¡è¦éªŒæ”¶æ ‡å‡†(å»ºè®®é€šè¿‡):**

- â¬œ é˜Ÿåˆ—ç®¡ç†é¡µé¢äº¤äº’æµç•…,æ— å¡é¡¿
- â¬œ èŒƒå›´è¾“å…¥æ”¯æŒè´Ÿæ— ç©·/æ­£æ— ç©·å‹¾é€‰æ¡†
- â¬œ é˜Ÿåˆ—åˆ—è¡¨æ”¯æŒæŒ‰æ’åºæ˜¾ç¤º
- â¬œ åˆ é™¤é˜Ÿåˆ—æœ‰äºŒæ¬¡ç¡®è®¤æç¤º
- â¬œ é˜Ÿåˆ—é…ç½®å˜æ›´æœ‰æ“ä½œæ—¥å¿—è®°å½•
- â¬œ ä»Šæ—¥æ¡ˆä»¶æ•°>100æ—¶æ˜¾ç¤ºè­¦å‘Šå›¾æ ‡
- â¬œ æŸ¥çœ‹æ¡ˆä»¶æ”¯æŒæ–°æ ‡ç­¾é¡µæ‰“å¼€(å¯é…ç½®)

### 7. å‘å¸ƒè®¡åˆ’ä¸å›æ»šé¢„æ¡ˆ(Release Plan & Rollback)

#### 7.1 å‘å¸ƒç­–ç•¥

**é˜¶æ®µ1:ç°åº¦å‘å¸ƒ(1å‘¨)**

- **ç°åº¦å¯¹è±¡:**2ä¸ªæµ‹è¯•ç”²æ–¹(æ¡ˆä»¶é‡<1000)
- **å¼€å…³æ§åˆ¶:**
  ```java
  @Value("${feature.queue.management.enabled:false}")
  private boolean queueManagementEnabled;
  
  @Value("${feature.queue.limit.check.enabled:false}")
  private boolean queueLimitCheckEnabled;
  ```
- **ç°åº¦æ­¥éª¤:**
  1. Day 1-2:ç°åº¦ç”²æ–¹1,å¯ç”¨é˜Ÿåˆ—ç®¡ç†åŠŸèƒ½,å…³é—­é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥
  2. Day 3-4:è§‚å¯Ÿæ•°æ®,æ— å¼‚å¸¸åå¯ç”¨é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥
  3. Day 5-6:ç°åº¦ç”²æ–¹2,é‡å¤æ­¥éª¤1-2
  4. Day 7:è¯„ä¼°ç°åº¦æ•ˆæœ,å†³å®šæ˜¯å¦æ‰©å¤§èŒƒå›´

**é˜¶æ®µ2:å°èŒƒå›´å‘å¸ƒ(2å‘¨)**

- **ç°åº¦å¯¹è±¡:**10ä¸ªç”²æ–¹(æ¡ˆä»¶é‡1000-5000)
- **ç›‘æ§é‡ç‚¹:**
  - é˜Ÿåˆ—APIå“åº”æ—¶é—´
  - é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥å¤±è´¥ç‡
  - è·¨é˜Ÿåˆ—åˆ†é…é¢‘ç‡
- **å‘å¸ƒæ­¥éª¤:**
  1. Week 1:ç°åº¦5ä¸ªç”²æ–¹
  2. Week 2:è§‚å¯Ÿæ•°æ®,æ— å¼‚å¸¸åç°åº¦å‰©ä½™5ä¸ªç”²æ–¹

**é˜¶æ®µ3:å…¨é‡å‘å¸ƒ(1å‘¨)**

- **ç°åº¦å¯¹è±¡:**æ‰€æœ‰ç”²æ–¹
- **å‘å¸ƒæ­¥éª¤:**
  1. Day 1-2:ç°åº¦50%ç”²æ–¹
  2. Day 3-4:è§‚å¯Ÿæ•°æ®,æ— å¼‚å¸¸åç°åº¦è‡³100%
  3. Day 5-7:å…¨é‡ç›‘æ§,æ”¶é›†ç”¨æˆ·åé¦ˆ

#### 7.2 é…ç½®/å¼€å…³åˆ‡æ¢æ­¥éª¤

**å¼€å…³é…ç½®æ–‡ä»¶:**`application-prod.yml`

```yaml
feature:
  queue:
    management:
      enabled: true  # é˜Ÿåˆ—ç®¡ç†åŠŸèƒ½æ€»å¼€å…³
    limit:
      check:
        enabled: true  # é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥å¼€å…³
        enforce: true  # æ˜¯å¦å¼ºåˆ¶æ‰§è¡Œé™åˆ¶(false=ä»…è­¦å‘Š)
    auto:
      assign:
        enabled: false  # è‡ªåŠ¨å½’é˜Ÿå¼€å…³(åç»­ç‰ˆæœ¬)
```

**å¼€å…³åˆ‡æ¢æµç¨‹:**
1. ä¿®æ”¹é…ç½®ä¸­å¿ƒé…ç½®(Apollo/Nacos)
2. é…ç½®å®æ—¶ç”Ÿæ•ˆ,æ— éœ€é‡å¯æœåŠ¡
3. éªŒè¯å¼€å…³ç”Ÿæ•ˆ(è°ƒç”¨å¥åº·æ£€æŸ¥æ¥å£)

**ç°åº¦åˆ‡æ¢æ­¥éª¤:**
1. é…ç½®ç°åº¦ç”²æ–¹ç™½åå•
   ```yaml
   feature:
     queue:
       management:
         whitelist:
           tenant_ids: [1, 2, 3]  # ç°åº¦ç”²æ–¹IDåˆ—è¡¨
   ```
2. ä»£ç ä¸­åˆ¤æ–­æ˜¯å¦åœ¨ç™½åå•
   ```java
   if (queueManagementEnabled && isInWhitelist(tenantId)) {
       // æ‰§è¡Œæ–°é€»è¾‘
   } else {
       // æ‰§è¡Œæ—§é€»è¾‘
   }
   ```

#### 7.3 å›æ»šé¢„æ¡ˆ

**è§¦å‘å›æ»šæ¡ä»¶:**
- é˜Ÿåˆ—APIé”™è¯¯ç‡>5%,æŒç»­10åˆ†é’Ÿ
- é˜Ÿåˆ—API P99å“åº”æ—¶é—´>2ç§’,æŒç»­10åˆ†é’Ÿ
- é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥å¯¼è‡´åˆ†é…å¤±è´¥ç‡>30%
- å‡ºç°æ•°æ®ä¸€è‡´æ€§é—®é¢˜(é˜Ÿåˆ—é…ç½®ä¸¢å¤±/é”™ä¹±)
- ç”¨æˆ·æŠ•è¯‰é‡æ¿€å¢(>10ä¸ª/å°æ—¶)

**å›æ»šæ–¹æ¡ˆ:**

**æ–¹æ¡ˆ1:é…ç½®å›æ»š(ä¼˜å…ˆ,5åˆ†é’Ÿå†…å®Œæˆ)**
1. å…³é—­é˜Ÿåˆ—ç®¡ç†åŠŸèƒ½å¼€å…³
   ```yaml
   feature.queue.management.enabled: false
   feature.queue.limit.check.enabled: false
   ```
2. éªŒè¯åŠŸèƒ½å…³é—­(å‰ç«¯ä¸æ˜¾ç¤ºé˜Ÿåˆ—ç®¡ç†èœå•)
3. é€šçŸ¥ç›¸å…³äººå‘˜å›æ»šå®Œæˆ

**æ–¹æ¡ˆ2:ä»£ç å›æ»š(é…ç½®å›æ»šæ— æ•ˆæ—¶,30åˆ†é’Ÿå†…å®Œæˆ)**
1. Gitå›é€€åˆ°ä¸Šä¸€ç¨³å®šTag
   ```bash
   git checkout v1.0.0-stable
   ```
2. Mavené‡æ–°ç¼–è¯‘æ‰“åŒ…
   ```bash
   mvn clean package -Dmaven.test.skip=true
   ```
3. æ›¿æ¢çº¿ä¸ŠJARåŒ…,é‡å¯æœåŠ¡
4. éªŒè¯åŠŸèƒ½æ¢å¤

**æ–¹æ¡ˆ3:æ•°æ®åº“å›æ»š(ä»£ç å›æ»šæ— æ•ˆæ—¶,60åˆ†é’Ÿå†…å®Œæˆ)**
1. åœæ­¢åº”ç”¨æœåŠ¡(é¿å…æ•°æ®å†™å…¥)
2. æ¢å¤æ•°æ®åº“å¤‡ä»½
   ```bash
   mysql -u root -p < backup_before_release.sql
   ```
3. æ‰§è¡Œå›æ»šSQLè„šæœ¬
   ```sql
   -- åˆ é™¤queue_idå­—æ®µ
   ALTER TABLE cases DROP COLUMN queue_id;
   ALTER TABLE collection_teams DROP COLUMN queue_id;
   
   -- åˆ é™¤é˜Ÿåˆ—è¡¨
   DROP TABLE IF EXISTS case_queues;
   ```
4. é‡å¯åº”ç”¨æœåŠ¡
5. éªŒè¯åŠŸèƒ½æ¢å¤

**å›æ»šéªŒè¯æ¸…å•:**
- [ ] é˜Ÿåˆ—ç®¡ç†é¡µé¢æ— æ³•è®¿é—®(404æˆ–éšè—)
- [ ] æ¡ˆä»¶åˆ—è¡¨æŸ¥è¯¢åŠŸèƒ½æ­£å¸¸
- [ ] æ¡ˆä»¶åˆ†é…åŠŸèƒ½æ­£å¸¸(æ— é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥)
- [ ] æ— æ–°å¢é”™è¯¯æ—¥å¿—
- [ ] ç›‘æ§æŒ‡æ ‡æ¢å¤æ­£å¸¸

**å›æ»šåå¤„ç†:**
- ä¿ç•™ç”Ÿäº§ç¯å¢ƒæ—¥å¿—è‡³å°‘7å¤©,ä¾›é—®é¢˜åˆ†æ
- ç»„ç»‡å¤ç›˜ä¼šè®®,åˆ†æå›æ»šåŸå› 
- ä¿®å¤é—®é¢˜åé‡æ–°ç°åº¦å‘å¸ƒ

#### 7.4 åº”æ€¥è”ç³»äºº

| è§’è‰² | å§“å | ç”µè¯ | èŒè´£ |
|------|------|------|------|
| æŠ€æœ¯è´Ÿè´£äºº | å¼ ä¸‰ | 138xxxx1001 | å†³ç­–å›æ»š,åè°ƒèµ„æº |
| åç«¯å¼€å‘ | æå›› | 138xxxx1002 | æ‰§è¡Œä»£ç å›æ»š,é—®é¢˜æ’æŸ¥ |
| å‰ç«¯å¼€å‘ | ç‹äº” | 138xxxx1003 | å‰ç«¯é—®é¢˜æ’æŸ¥,é…ç½®è°ƒæ•´ |
| DBA | èµµå…­ | 138xxxx1004 | æ•°æ®åº“å›æ»š,æ•°æ®æ¢å¤ |
| è¿ç»´ | é’±ä¸ƒ | 138xxxx1005 | æœåŠ¡é‡å¯,ç›‘æ§å‘Šè­¦ |
| äº§å“ç»ç† | å­™å…« | 138xxxx1006 | ç”¨æˆ·æ²Ÿé€š,éœ€æ±‚è°ƒæ•´ |

---

## é™„å½•

### é™„å½•A:æœ¯è¯­è¡¨

| æœ¯è¯­ | è‹±æ–‡ | è¯´æ˜ |
|------|------|------|
| é˜Ÿåˆ— | Queue | æ ¹æ®é€¾æœŸå¤©æ•°åˆ’åˆ†çš„æ¡ˆä»¶åˆ†ç»„ |
| é€¾æœŸå¤©æ•° | Overdue Days | å½“å‰æ—¥æœŸ - åˆ°æœŸæ—¥æœŸ |
| é˜Ÿåˆ—ç¼–ç  | Queue Code | é˜Ÿåˆ—çš„å”¯ä¸€æ ‡è¯†,å¦‚M1ã€S1 |
| é˜Ÿåˆ—é™åˆ¶ | Queue Limit | æ¡ˆä»¶åªèƒ½åˆ†é…ç»™é˜Ÿåˆ—åŒ¹é…çš„å‚¬å‘˜ |
| èŒƒå›´é‡åˆ | Range Overlap | ä¸¤ä¸ªé˜Ÿåˆ—çš„é€¾æœŸå¤©æ•°èŒƒå›´æœ‰äº¤é›† |
| è´Ÿæ— ç©· | Negative Infinity | é€¾æœŸå¤©æ•°èµ·å§‹å€¼ä¸ºNULL,è¡¨ç¤º-âˆ |
| æ­£æ— ç©· | Positive Infinity | é€¾æœŸå¤©æ•°ç»“æŸå€¼ä¸ºNULL,è¡¨ç¤º+âˆ |
| è‡ªåŠ¨å½’é˜Ÿ | Auto Queue Assignment | æ ¹æ®é€¾æœŸå¤©æ•°è‡ªåŠ¨åˆ†é…æ¡ˆä»¶åˆ°é˜Ÿåˆ— |
| è·¨é˜Ÿåˆ—åˆ†é… | Cross-Queue Assignment | å°†æ¡ˆä»¶åˆ†é…ç»™é˜Ÿåˆ—ä¸åŒ¹é…çš„å‚¬å‘˜ |

### é™„å½•B:å‚è€ƒæ–‡æ¡£

1. **éœ€æ±‚æ–‡æ¡£:**
   - æ¡ˆä»¶åˆ—è¡¨åŠŸèƒ½PRD.md
   - æ¡ˆä»¶åˆ†é…åŠŸèƒ½PRD.md
   - ç”²æ–¹ç®¡ç†åŠŸèƒ½PRD.md

2. **æŠ€æœ¯æ–‡æ¡£:**
   - åç«¯APIæ¥å£æ–‡æ¡£.md
   - æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md
   - å‰ç«¯ç»„ä»¶å¼€å‘è§„èŒƒ.md

3. **å®ç°æ–‡æ¡£:**
   - ç”²æ–¹æ¡ˆä»¶é˜Ÿåˆ—ç®¡ç†åŠŸèƒ½å®ç°è¯´æ˜.md
   - é˜Ÿåˆ—é™åˆ¶æ£€æŸ¥å®ç°è¯´æ˜.md
   - æ•°æ®åº“è¿ç§»è„šæœ¬.sql

### é™„å½•C:å˜æ›´å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | å˜æ›´äºº |
|------|------|---------|--------|
| v1.0 | 2025-12-04 | åˆå§‹ç‰ˆæœ¬,å®Œæ•´PRD | AIåŠ©æ‰‹ |
| v1.1 | 2025-12-05 | **æ–°å¢åŠŸèƒ½:**<br/>1. é˜Ÿåˆ—åˆ—è¡¨é¡µæ–°å¢"ä»Šæ—¥æ¡ˆä»¶æ•°"åˆ—,å±•ç¤ºä»Šæ—¥æ–°å¢æ¡ˆä»¶æ•°<br/>2. æ–°å¢"æŸ¥çœ‹æ¡ˆä»¶"åŠŸèƒ½,ç‚¹å‡»åè·³è½¬åˆ°æ¡ˆä»¶åˆ—è¡¨å¹¶è‡ªåŠ¨ç­›é€‰è¯¥é˜Ÿåˆ— | AIåŠ©æ‰‹ |

---

**æ–‡æ¡£çŠ¶æ€:**âœ… å·²å®Œæˆ  
**æœ€åæ›´æ–°:**2025-12-05  
**ç‰ˆæœ¬:**v1.1.0

