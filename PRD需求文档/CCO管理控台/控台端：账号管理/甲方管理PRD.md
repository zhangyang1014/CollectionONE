# 甲方管理PRD

| 版本 | 日期 | 作者 | 说明 |
|------|------|------|------|
| v1.0 | 2025-12-04 | 产品团队 | 增加默认语言 |

---

**文档状态：** ✅ 已完成  
**最后更新：** 2025-12-04  
**审核状态：** 待审核
## 一、产品需求（Product Requirements）

### 1. 项目背景与目标（Background & Goals）

随着催收业务规模的扩大和复杂度的提升，需要建立清晰、灵活的组织架构管理体系，以支持多甲方、多机构、多小组的催收业务场景。本需求旨在构建甲方管理功能，作为五级管理体系的顶层，支持甲方的创建、编辑、启用/禁用等全生命周期管理，并为后续的机构管理、案件分配、业绩统计等核心功能提供基础支撑。预期通过本功能提升组织管理效率30%以上，减少因组织架构不清晰导致的案件分配错误率，并为精细化运营提供数据基础。

### 2. 业务场景与用户画像（Business Scenario & User）

**典型使用场景：**

1. **系统初始化场景**：系统超级管理员（SuperAdmin）创建甲方，并创建甲方管理员账号。

2. **日常管理场景**：系统超级管理员查看和管理所有甲方；甲方管理员查看和管理本甲方信息。

3. **业务配置场景**：系统超级管理员配置甲方的基本信息（国家、时区、货币、默认语言），为后续的业务规则提供基础。

4. **组织调整场景**：因业务调整需要禁用某个甲方，系统会级联影响其下所有机构、小组群、小组和催员。

**主要用户类型：**

- **系统超级管理员（SuperAdmin）**：系统级管理员，负责创建甲方和甲方管理员账号，拥有最高权限。
- **甲方管理员（TenantAdmin）**：甲方级别的管理员，负责管理本甲方的所有催收机构、小组群、小组、小组管理员和催员，配置本甲方的业务规则。

**核心诉求：**

- 能够清晰地查看和管理所有甲方
- 能够快速创建和配置甲方
- 能够灵活调整甲方状态（启用/禁用）
- 能够配置甲方的默认语言，影响该甲方下所有催员的默认界面语言

### 3. 关键业务流程（Business Flow）

#### 3.1 甲方创建流程

```mermaid
[系统超级管理员]
    ↓ 创建甲方
[甲方] + [甲方管理员账号]
    ↓ 甲方管理员登录
[管理本甲方下的组织架构]
```

**详细步骤：**

1. **创建甲方**（SuperAdmin操作）
   - 输入甲方基本信息：名称、编码、国家、时区、货币、**默认语言**（从国际化配置中选择）
   - 输入甲方管理员信息：账号名、登录ID、邮箱、密码、确认密码（必填）
   - 系统同时创建甲方记录和甲方管理员账号
   - 甲方管理员收到账号信息
   - **该甲方下所有催员登录IM端时，默认使用此语言**

#### 3.2 甲方查询流程

```
[系统超级管理员登录]
    ↓
[查看甲方列表]
    ├── 筛选：按国家、状态筛选
    └── 搜索：按名称、编码搜索
    ↓
[展示列表]
    ├── 基本信息（编码、名称、国家、时区、货币）
    ├── 状态信息（启用/禁用）
    └── 操作按钮（编辑、启用/禁用）
```

#### 3.3 甲方调整流程

```
[选择目标甲方]
    ↓
[执行操作]
    ├── 编辑：修改基本信息
    └── 启用/禁用：改变状态
    ↓
[系统验证]
    ├── 检查是否有下级组织单元（机构、小组等）
    └── 检查权限是否允许
    ↓
[执行操作并级联影响]
    └── 禁用甲方 → 禁用其下所有机构、小组群、小组、催员
```

### 4. 业务规则与边界（Business Rules & Scope）

#### 4.1 甲方基本规则

- **唯一性规则**：
  - 甲方编码在系统内唯一
- **必填字段**：
  - 甲方：名称、编码、国家、时区、货币、**默认语言**、管理员密码、管理员确认密码

#### 4.2 启用/禁用规则

- **禁用甲方**：会级联禁用其下所有机构、小组群、小组和催员，但不会删除数据
- **启用规则**：启用甲方时，不会自动启用下级组织单元，需要手动启用

#### 4.3 删除规则

- **甲方**：不支持删除操作，只能通过启用/禁用来控制状态
- **软删除**：系统采用软删除机制，禁用而非物理删除

#### 4.4 权限规则

- **SuperAdmin**：可以管理所有甲方
- **甲方管理员**：只能管理本甲方下的组织架构
- **数据隔离**：不同甲方的数据完全隔离，无法跨甲方查看或操作

#### 4.5 账号管理规则

- **账号创建**：
  - 创建甲方时，必须同时创建甲方管理员账号，密码和确认密码为必填项
- **密码规则**：
  - 最少6位字符
  - 密码和确认密码必须一致
  - 建议包含字母和数字
  - 支持管理员重置密码
- **账号唯一性**：登录账号在系统内唯一，不能重复
- **手机号字段**：所有管理员和催员角色均不包含手机号字段

#### 4.6 编码规范

**编码前缀规则**

- **甲方编码**：无前缀要求，建议使用有意义的简称（如：`TENA`、`CLIENT01`）
- **甲方管理员登录ID**：必须以"甲方编码-"开头（如：`TENA-admin01`）

**编码优势**

- **快速识别**：通过编码前缀立即识别数据归属的甲方
- **避免冲突**：不同甲方的编码不会重复，便于数据合并和迁移
- **数据追溯**：在日志和报表中快速定位问题数据的来源
- **批量操作**：支持按前缀批量查询和处理数据

**系统实现**

- **前端自动填充**：在创建表单中，管理员登录ID字段默认自动填入"甲方编码-"前缀
- **后端验证**：创建时验证编码格式是否符合规范，不符合则拒绝创建
- **编码唯一性**：在符合前缀规范的基础上，确保编码在对应范围内唯一

**特殊说明**

- 甲方编码一旦创建不可修改，因为会影响所有下级组织的编码
- 如需修改甲方编码，需要通过数据迁移工具批量更新所有关联数据
- 建议甲方编码使用2-6位大写字母或字母数字组合，简洁易识别

#### 4.7 范围边界

**本次需求范围内：**
- 甲方的创建、编辑、查询、启用/禁用
- 甲方管理员账号的同步创建
- 基本的权限控制（基于角色的数据隔离）
- 编码规范的系统实现和验证

**本次需求范围外：**
- 甲方的批量导入/导出（后续需求）
- 甲方的历史记录和审计日志（后续需求）
- 编码的批量修改工具（后续需求）

### 5. 合规与风控要求（Compliance & Risk Control）

#### 5.1 数据隐私保护

- **敏感信息加密**：密码必须加密存储，使用安全的哈希算法（如BCrypt）
- **数据脱敏**：在日志和监控中，敏感信息（如密码）需要脱敏处理
- **访问控制**：只有授权用户才能查看和管理甲方信息

#### 5.2 账号安全

- **密码策略**：强制要求密码符合安全策略，支持密码强度验证
- **登录审计**：记录所有账号的登录时间、IP地址等信息
- **账号锁定**：支持账号锁定机制，防止暴力破解

#### 5.3 操作审计

- **操作日志**：记录所有甲方的创建、编辑、启用/禁用操作
- **操作人记录**：记录每次操作的执行人、时间、操作内容
- **数据变更历史**：保留关键字段的变更历史（如甲方名称、默认语言）

#### 5.4 数据备份与恢复

- **数据备份**：定期备份甲方数据，确保数据安全
- **数据恢复**：支持从备份恢复数据，支持误操作的快速回滚

### 6. 资金路径与结算规则（Funding Flow & Settlement）

**无**：甲方管理功能不涉及资金流转，本节不适用。

### 7. 数据字段与口径（Data Definition）

#### 7.1 甲方（Tenant）核心字段

| 字段名 | 类型 | 说明 | 来源 | 更新频率 |
|--------|------|------|------|----------|
| tenant_id | BigInteger | 甲方ID（主键） | 系统生成 | 不变 |
| tenant_code | String(100) | 甲方编码（唯一） | 用户输入 | 创建时设置，不可修改 |
| tenant_name | String(200) | 甲方名称 | 用户输入 | 可编辑 |
| tenant_name_en | String(200) | 甲方名称（英文） | 用户输入 | 可编辑 |
| country_code | String(50) | 国家代码 | 用户选择 | 可编辑 |
| timezone | Integer | 时区偏移量（UTC±小时） | 用户选择 | 可编辑 |
| currency_code | String(10) | 货币代码 | 用户选择 | 可编辑 |
| **default_language** | **String(10)** | **默认语言（Locale）** | **从国际化配置中选择** | **可编辑** |
| is_active | Boolean | 是否启用 | 系统设置 | 可编辑 |
| created_at | DateTime | 创建时间 | 系统生成 | 自动 |
| updated_at | DateTime | 更新时间 | 系统生成 | 自动 |

**说明**：
- **default_language**：甲方的默认语言设置，从国际化配置管理中的"已启用语言"列表中选择
- **业务规则**：
  - 创建甲方时必须选择默认语言（必填项）
  - 该语言将作为该甲方下所有催员的默认界面语言
  - 催员登录IM端时，默认使用所属甲方的语言
  - 催员可在个人设置中切换为其他可用语言，但优先显示甲方默认语言

#### 7.2 甲方管理员（TenantAdmin）核心字段

| 字段名 | 类型 | 说明 | 来源 | 更新频率 |
|--------|------|------|------|----------|
| id | BigInteger | 主键ID | 系统生成 | 不变 |
| tenant_id | BigInteger | 所属甲方ID | 关联选择 | 创建时设置 |
| account_code | String(100) | 账号编码（唯一） | 系统生成 | 创建时设置，不可修改 |
| account_name | String(200) | 账号名称（管理员姓名） | 用户输入 | 可编辑 |
| login_id | String(100) | 登录ID（唯一） | 用户输入 | 创建时设置，不可修改 |
| password_hash | String(255) | 密码哈希（BCrypt加密） | 系统生成 | 可编辑（重置密码） |
| email | String(100) | 邮箱 | 用户输入 | 可编辑 |
| is_active | Boolean | 是否启用 | 系统设置 | 可编辑 |
| last_login_at | DateTime | 最近登录时间 | 系统更新 | 登录时更新 |
| created_at | DateTime | 创建时间 | 系统生成 | 自动 |
| updated_at | DateTime | 更新时间 | 系统生成 | 自动 |

**说明**：甲方管理员在创建甲方时同时创建，密码和确认密码为必填项。

### 8. 交互与信息展示（UX & UI Brief）

本项目前端交互已由 Web 团队实现，本节仅补充关键信息展示要求：

#### 8.1 甲方管理页面

- **列表展示**：甲方编码、名称、国家、时区、货币、默认语言、状态、创建时间
- **操作按钮**：创建甲方、编辑、启用/禁用（不支持删除）
- **筛选功能**：按国家、状态筛选
- **创建表单**：必须同时填写甲方信息和管理员信息（包括密码和确认密码）
- **默认语言选择**：从国际化配置管理中已启用的语言列表中选择

#### 8.2 通用交互要求

- **状态提示**：启用/禁用操作前显示确认提示，说明级联影响
- **表单验证**：实时验证输入格式，提示错误信息

### 9. 配置项与运营开关（Config & Operation Switches）

#### 9.1 系统级配置

| 配置项 | 说明 | 默认值 | 配置入口 | 变更流程 |
|--------|------|--------|----------|----------|
| 密码最小长度 | 账号密码的最小长度要求 | 6 | 系统配置 | 系统管理员修改 |

#### 9.2 功能开关

| 开关名称 | 说明 | 默认状态 | 影响范围 |
|--------|------|----------|----------|
| 甲方管理编辑开关 | 是否允许编辑甲方 | 开启 | 全局 |

---

## 二、数据需求（Data Requirements）

### 1. 埋点需求（Tracking Requirements）

| 触发时间点/条件 | 埋点中文说明 | 埋点英文ID | 关键属性 |
|----------------|------------|-----------|---------|
| 创建甲方时 | 甲方创建埋点 | tenant_created | user_id（操作人ID）、tenant_id（甲方ID）、tenant_code（甲方编码） |
| 编辑甲方时 | 甲方编辑埋点 | tenant_updated | user_id、tenant_id、changed_fields（变更字段列表） |
| 启用/禁用甲方时 | 甲方状态变更埋点 | tenant_status_changed | user_id、tenant_id、old_status（原状态）、new_status（新状态） |
| 查看甲方列表时 | 甲方列表查看埋点 | tenant_list_viewed | user_id、filter_params（筛选参数） |

---

## 三、技术部分描述（Technical Requirements / TRD）

### 1. 系统架构与模块划分（System Architecture & Modules）

#### 1.1 架构图

```
┌─────────────────────────────────────────────────────────────┐
│                     前端管理控台                              │
│  ┌──────────┐                                               │
│  │ 甲方管理  │                                               │
│  └──────────┘                                               │
└─────────────────────────────────────────────────────────────┘
                            │
                            │ HTTP/HTTPS
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                    Java后端服务 (Spring Boot)                 │
│  ┌──────────────────────────────────────────────────────┐  │
│  │           甲方管理模块 (Tenant Module)                │  │
│  │  ┌──────────┐                                       │  │
│  │  │ 甲方服务  │                                       │  │
│  │  └──────────┘                                       │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │           权限管理模块 (Permission Module)            │  │
│  │  - 角色权限验证                                        │  │
│  │  - 数据隔离（基于tenant_id）                          │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                            │
                            │ MyBatis-Plus
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                      MySQL数据库                              │
│  ┌──────────┐                                               │
│  │ tenants  │                                               │
│  └──────────┘                                               │
└─────────────────────────────────────────────────────────────┘
```

#### 1.2 模块职责边界

**前端模块：**
- **甲方管理页面**：提供用户界面，处理用户交互，调用后端API
- **权限控制**：根据用户角色显示/隐藏功能按钮，控制页面访问权限

**后端模块：**
- **甲方服务层**：处理业务逻辑，包括创建、编辑、查询、启用/禁用等操作
- **数据访问层**：使用MyBatis-Plus进行数据库操作
- **权限验证层**：验证用户权限，实现数据隔离

**数据库层：**
- **甲方表**：存储甲方数据
- **账号表**：存储甲方管理员账号信息

### 2. 接口设计与系统依赖（API Design & Dependencies）

#### 2.1 甲方管理接口

**基础路径**: `/api/v1/tenants`

| 方法 | 路径 | 说明 | 主要入参 | 主要出参 | 超时/重试 | 幂等性 |
|------|------|------|---------|---------|----------|--------|
| GET | `/` | 获取甲方列表 | tenant_id（可选）、is_active（可选）、skip、limit | 甲方列表 | 3s/不重试 | 是 |
| POST | `/` | 创建甲方（同时创建管理员） | tenant_code、tenant_name、country、timezone、currency、default_language、admin_info（包含password、confirm_password） | 创建的甲方信息 | 5s/不重试 | 是（基于tenant_code） |
| GET | `/{tenant_id}` | 获取甲方详情 | tenant_id | 甲方详情 | 3s/不重试 | 是 |
| PUT | `/{tenant_id}` | 更新甲方 | tenant_id、更新字段 | 更新后的甲方信息 | 5s/不重试 | 是 |
| PUT | `/{tenant_id}/status` | 启用/禁用甲方 | tenant_id、is_active | 操作结果 | 3s/不重试 | 是 |

**请求示例（创建甲方）：**
```json
{
  "tenant_code": "TENANT001",
  "tenant_name": "示例甲方",
  "country": "CN",
  "timezone": "Asia/Shanghai",
  "currency": "CNY",
  "default_language": "zh-CN",
  "admin_info": {
    "username": "TENANT001-admin001",
    "name": "管理员",
    "email": "admin@example.com",
    "password": "password123",
    "confirm_password": "password123"
  }
}
```

**响应示例：**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "tenant_id": 1,
    "tenant_code": "TENANT001",
    "tenant_name": "示例甲方",
    "country": "CN",
    "timezone": "Asia/Shanghai",
    "currency": "CNY",
    "default_language": "zh-CN",
    "is_active": true,
    "created_at": "2025-01-11T10:00:00",
    "updated_at": "2025-01-11T10:00:00"
  }
}
```

#### 2.2 接口通用规范

**请求头：**
- `Content-Type: application/json`
- `Authorization: Bearer {token}`（需要认证的接口）

**响应格式：**
```json
{
  "code": 200,
  "message": "success",
  "data": { ... }
}
```

**错误响应：**
```json
{
  "code": 400,
  "message": "错误描述",
  "data": null
}
```

**超时与重试策略：**
- 查询接口：超时3秒，不重试
- 创建/更新接口：超时5秒，不重试

**幂等性要求：**
- 所有接口都要求幂等性
- 创建接口基于唯一字段（tenant_code）实现幂等
- 更新接口基于ID实现幂等

#### 2.3 系统依赖

**内部依赖：**
- 权限管理模块：验证用户权限，实现数据隔离
- 账号管理模块：管理甲方管理员账号
- 国际化配置模块：提供可选语言列表

**外部依赖：**
- 无外部系统依赖

### 3. 数据存储与模型依赖（Data Storage & Model Dependencies）

#### 3.1 数据库表结构

**3.1.1 tenants表（甲方表）**

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| tenant_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 甲方ID |
| tenant_code | VARCHAR(100) | UNIQUE, NOT NULL | 甲方编码（唯一） |
| tenant_name | VARCHAR(200) | NOT NULL | 甲方名称 |
| country | VARCHAR(50) | NOT NULL | 国家 |
| timezone | VARCHAR(50) | NOT NULL | 时区 |
| currency | VARCHAR(10) | NOT NULL | 货币 |
| **default_language** | **VARCHAR(10)** | **NOT NULL** | **默认语言（Locale，如zh-CN）** |
| is_active | BOOLEAN | DEFAULT TRUE | 是否启用 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY: `tenant_id`
- UNIQUE KEY: `uk_tenant_code` (`tenant_code`)
- KEY: `idx_is_active` (`is_active`)

**建表SQL：**
```sql
CREATE TABLE tenants (
  tenant_id BIGINT PRIMARY KEY AUTO_INCREMENT,
  tenant_code VARCHAR(100) UNIQUE NOT NULL,
  tenant_name VARCHAR(200) NOT NULL,
  country VARCHAR(50) NOT NULL,
  timezone VARCHAR(50) NOT NULL,
  currency VARCHAR(10) NOT NULL,
  default_language VARCHAR(10) NOT NULL,
  is_active BOOLEAN DEFAULT TRUE,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_is_active (is_active)
);
```

#### 3.2 数据模型依赖

**版本管理：**
- 使用数据库迁移工具（Flyway）管理表结构变更
- 每个迁移脚本包含版本号和描述
- 支持回滚到指定版本

**回滚方案：**
- 数据库迁移支持向下迁移（rollback）
- 代码回滚：通过Git版本控制回滚到上一个稳定版本
- 数据回滚：通过数据库备份恢复数据

### 4. 非功能性要求（Non-Functional Requirements）

#### 4.1 性能目标

| 指标 | 目标值 | 说明 |
|------|--------|------|
| QPS | 1000+ | 单个接口的每秒查询数 |
| 响应时间 | < 200ms（查询）< 500ms（创建/更新） | P95响应时间 |
| 数据库查询 | < 100ms | 单次数据库查询时间 |

#### 4.2 可用性要求

| 指标 | 目标值 | 说明 |
|------|--------|------|
| SLA | 99.9% | 系统可用性目标 |
| 降级策略 | 查询接口降级为缓存数据 | 当数据库不可用时 |
| 故障恢复时间 | < 5分钟 | 从故障发生到恢复的时间 |

#### 4.3 安全要求

| 要求 | 说明 |
|------|------|
| 加密存储 | 密码使用BCrypt加密存储，盐值随机生成 |
| 接口鉴权 | 所有接口需要JWT Token认证 |
| 数据隔离 | 基于tenant_id实现数据隔离，不同甲方数据完全隔离 |
| 脱敏展示 | 在日志和监控中，敏感信息（密码）需要脱敏 |
| SQL注入防护 | 使用参数化查询，防止SQL注入 |
| XSS防护 | 前端对用户输入进行转义，防止XSS攻击 |

### 5. 日志埋点与监控告警（Logging, Metrics & Alerting）

#### 5.1 关键日志

| 日志类型 | 记录内容 | 日志级别 |
|---------|---------|---------|
| 请求日志 | 请求URL、方法、参数、响应时间、响应状态 | INFO |
| 操作日志 | 操作类型、操作人、操作对象、操作结果 | INFO |
| 错误日志 | 错误类型、错误信息、堆栈信息、请求参数 | ERROR |
| 安全日志 | 登录失败、权限拒绝、异常访问 | WARN |

**日志格式示例：**
```
[2025-01-11 10:00:00] [INFO] [TenantService] 创建甲方成功: tenant_id=1, tenant_code=TENANT001, operator=superadmin
[2025-01-11 10:00:01] [ERROR] [TenantService] 创建甲方失败: tenant_code=TENANT001, error=甲方编码已存在, operator=superadmin
```

#### 5.2 监控指标

| 指标名称 | 指标类型 | 告警阈值 | 说明 |
|---------|---------|---------|------|
| 接口成功率 | 成功率 | < 99% | 接口调用成功率 |
| 接口响应时间 | 响应时间 | P95 > 500ms | 接口响应时间 |
| 错误率 | 错误率 | > 1% | 接口错误率 |
| 创建/更新操作失败率 | 失败率 | > 0.5% | 创建/更新操作失败率 |

#### 5.3 告警规则

| 告警规则 | 触发条件 | 告警级别 | 处理方式 |
|---------|---------|---------|---------|
| 接口成功率告警 | 成功率 < 99% 持续5分钟 | 严重 | 立即通知运维团队 |
| 响应时间告警 | P95响应时间 > 500ms 持续5分钟 | 警告 | 通知开发团队排查 |
| 错误率告警 | 错误率 > 1% 持续5分钟 | 严重 | 立即通知开发团队 |
| 创建/更新失败告警 | 失败率 > 0.5% 持续5分钟 | 严重 | 立即通知开发团队 |

### 6. 测试策略与验收标准（Test Plan & Acceptance Criteria）

#### 6.1 测试类型

| 测试类型 | 说明 | 覆盖范围 |
|---------|------|---------|
| 单元测试 | 测试Service层和工具类 | 覆盖率 > 80% |
| 集成测试 | 测试Controller、Service、Mapper的集成 | 核心业务流程 |
| 接口测试 | 测试所有API接口 | 所有接口 |
| 性能测试 | 测试系统在高负载下的表现 | 关键接口 |
| 安全测试 | 测试权限控制、数据隔离、SQL注入防护 | 安全相关功能 |

#### 6.2 关键验收标准

1. **功能完整性**
   - ✅ 能够创建、编辑、查询、启用/禁用甲方
   - ✅ 创建甲方时能同时创建甲方管理员账号

2. **数据一致性**
   - ✅ 甲方编码唯一性验证正确
   - ✅ 启用/禁用操作能够正确级联影响下级组织单元

3. **权限控制**
   - ✅ SuperAdmin能够管理所有甲方
   - ✅ 数据隔离正确，不同甲方的数据完全隔离

4. **性能要求**
   - ✅ 查询接口响应时间 < 200ms（P95）
   - ✅ 创建/更新接口响应时间 < 500ms（P95）

5. **安全性**
   - ✅ 密码加密存储，无法明文查看
   - ✅ 敏感信息在日志中脱敏
   - ✅ 接口需要认证，未授权访问被拒绝

### 7. 发布计划与回滚预案（Release Plan & Rollback）

#### 7.1 发布策略

**发布方式：** 灰度发布，分批上线

**发布步骤：**

1. **预发布环境验证**（1天）
   - 在预发布环境部署新版本
   - 执行完整的功能测试和性能测试
   - 验证数据迁移脚本正确性

2. **灰度发布**（3天）
   - 第1天：流量比例10%
   - 第2天：如果无问题，流量比例30%
   - 第3天：如果无问题，流量比例100%

3. **全量发布**（1天）
   - 所有流量切换到新版本
   - 监控系统指标，确保无异常

#### 7.2 回滚方案

**回滚触发条件：**
- 接口成功率 < 95%
- 出现严重bug影响业务
- 性能严重下降
- 数据丢失或损坏

**回滚步骤：**

1. **立即回滚**（< 5分钟）
   - 关闭功能开关，禁用新功能
   - 如果代码问题，回滚到上一个稳定版本
   - 重启服务

2. **数据回滚**（如需要）
   - 如果数据库结构变更，执行回滚脚本
   - 从备份恢复数据（如需要）

3. **验证回滚结果**
   - 验证系统功能正常
   - 验证数据完整性
   - 监控系统指标

---

## 附录

### A. 术语表

| 术语 | 英文 | 说明 |
|------|------|------|
| 甲方 | Tenant | 使用系统的客户，是组织架构的顶层 |
| 甲方管理员 | TenantAdmin | 甲方级别的管理员账号 |
| 默认语言 | Default Language | 甲方下所有催员的默认界面语言 |

### B. 参考文档

- [组织架构管理PRD](./组织架构管理PRD.md)
- [国际化配置管理PRD](../多语言配置管理PRD.md)
















