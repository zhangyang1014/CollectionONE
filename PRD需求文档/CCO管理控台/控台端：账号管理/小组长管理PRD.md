# 小组长管理PRD

## 一、产品需求（Product Requirements）

### 1. 项目背景与目标（Background & Goals）

小组长（小组管理员）是催收组织架构中重要的管理角色，包括小组组长（Team Leader）、质检员（Quality Inspector）、统计员（Statistician）等。他们负责管理小组下的催员，分配案件，查看小组业绩。本需求旨在构建小组长管理功能，支持小组长账号的创建、编辑、重置密码、启用/禁用等全生命周期管理。

### 2. 业务场景与用户画像（Business Scenario & User）

**典型使用场景：**

1. **小组长创建场景**：机构管理员或小组管理员创建小组长账号。

2. **日常管理场景**：机构管理员查看和管理本机构下的所有小组长；小组管理员管理本小组下的小组长。

3. **密码管理场景**：小组长忘记密码，管理员重置密码。

4. **角色调整场景**：调整小组长的角色（组长、质检员、统计员）或小组归属。

**主要用户类型：**

- **机构管理员（AgencyAdmin）**：机构级别的管理员，负责管理本机构下的所有小组长。
- **小组管理员（TeamAdmin）**：小组级别的管理员，可以是组长、质检员或统计员。

**核心诉求：**

- 能够清晰地查看和管理小组长账号
- 能够快速创建和配置小组长账号
- 能够灵活调整小组长状态（启用/禁用）
- 能够重置小组长密码

### 3. 关键业务流程（Business Flow）

#### 3.1 小组长创建流程

```mermaid
[机构管理员/小组管理员]
    ↓ 创建小组长
[小组长账号]
    ↓ 小组长登录
[管理本小组催员/执行特定职责]
```

**详细步骤：**

1. **创建小组长**（机构管理员或小组管理员操作）
   - 选择所属甲方、机构、小组
   - 输入管理员信息：登录ID（自动填充"甲方编码-"前缀）、账号名、邮箱、密码
   - 选择角色：组长（team_leader）/质检员（quality_inspector）/统计员（statistician）
   - 系统创建小组长账号

#### 3.2 小组长查询流程

```
[用户登录]
    ↓ 根据角色权限
[查看小组长列表]
    ├── 机构管理员：查看本机构下所有小组长
    └── 小组管理员：查看本小组下所有小组长
    ↓ 筛选和搜索
[展示列表]
    ├── 基本信息（登录ID、姓名、所属小组、角色）
    ├── 状态信息（启用/禁用）
    └── 操作按钮（编辑、重置密码、启用/禁用）
```

#### 3.3 密码重置流程

```
[选择目标小组长]
    ↓
[点击重置密码]
    ↓
[输入新密码]
    ↓
[系统更新密码]
    ↓
[通知小组长新密码]
```

### 4. 业务规则与边界（Business Rules & Scope）

#### 4.1 小组长基本规则

- **角色类型**：
  - 组长（team_leader）：管理小组，分配案件
  - 质检员（quality_inspector）：负责质检工作
  - 统计员（statistician）：负责数据统计
- **必填字段**：
  - 小组长：登录ID（含甲方前缀）、账号名、所属甲方、所属机构、所属小组、密码、角色

#### 4.2 启用/禁用规则

- **禁用小组长**：小组长无法登录系统，但历史数据保留
- **启用规则**：可以随时启用已禁用的小组长

#### 4.3 删除规则

- **小组长**：不支持删除操作，只能通过启用/禁用来管理

#### 4.4 权限规则

- **机构管理员**：可以管理本机构下的所有小组长
- **小组管理员**：只能管理本小组下的小组长（如果有权限）
- **数据隔离**：不同甲方的数据完全隔离，无法跨甲方查看或操作

#### 4.5 账号管理规则

- **账号创建**：
  - 创建小组长时，必须设置初始密码
- **密码规则**：
  - 最少6位字符
  - 建议包含字母和数字
  - 支持管理员重置密码
- **账号唯一性**：登录ID在系统内唯一，不能重复
- **手机号字段**：小组长角色不包含手机号字段
- **账号标识**：login_id既是登录账号也是账号的唯一标识，不需要单独的account_code字段

#### 4.6 编码规范

**编码前缀规则**

- **小组长登录ID**：必须以"甲方编码-"开头（如：`TENA-teamadmin01`）

**编码示例**

假设甲方编码为 `ABC`，则小组长登录ID示例：

```
甲方: ABC
  └── 机构: ABC-AG001
      └── 小组: ABC-TM001
          ├── 组长: ABC-leader001
          ├── 质检员: ABC-qc001
          └── 统计员: ABC-stat001
```

**系统实现**

- **前端自动填充**：在创建表单中，登录ID字段默认自动填入"甲方编码-"前缀
- **后端验证**：创建时验证编码格式是否符合规范，不符合则拒绝创建
- **编码唯一性**：在符合前缀规范的基础上，确保登录ID在系统内唯一

#### 4.7 范围边界

**本次需求范围内：**
- 小组长的创建、编辑、查询、重置密码、启用/禁用
- 基本的权限控制（基于角色的数据隔离）
- 编码规范的系统实现和验证

**本次需求范围外：**
- 小组长的批量导入/导出（后续需求）
- 小组长的历史记录和审计日志（后续需求）
- 小组长的绩效考核（后续需求）

### 5. 合规与风控要求（Compliance & Risk Control）

#### 5.1 数据隐私保护

- **敏感信息加密**：密码必须加密存储，使用安全的哈希算法（如BCrypt）
- **数据脱敏**：在日志和监控中，敏感信息（如密码）需要脱敏处理
- **访问控制**：只有授权用户才能查看和管理小组长信息

#### 5.2 账号安全

- **密码策略**：强制要求密码符合安全策略，支持密码强度验证
- **登录审计**：记录所有账号的登录时间、IP地址等信息
- **账号锁定**：支持账号锁定机制，防止暴力破解

#### 5.3 操作审计

- **操作日志**：记录所有小组长的创建、编辑、重置密码、启用/禁用操作
- **操作人记录**：记录每次操作的执行人、时间、操作内容
- **数据变更历史**：保留关键字段的变更历史（如小组归属、角色）

#### 5.4 数据备份与恢复

- **数据备份**：定期备份小组长数据，确保数据安全
- **数据恢复**：支持从备份恢复数据，支持误操作的快速回滚

### 6. 资金路径与结算规则（Funding Flow & Settlement）

**无**：小组长管理功能不涉及资金流转，本节不适用。

### 7. 数据字段与口径（Data Definition）

#### 7.1 小组管理员（TeamAdmin）核心字段

| 字段名 | 类型 | 说明 | 来源 | 更新频率 |
|--------|------|------|------|----------|
| id | BigInteger | 主键ID | 系统生成 | 不变 |
| tenant_id | BigInteger | 所属甲方ID | 关联选择 | 创建时设置 |
| agency_id | BigInteger | 所属机构ID | 关联选择 | 创建时设置 |
| team_group_id | BigInteger | 所属小组群ID（可选） | 关联选择 | 可编辑 |
| team_id | BigInteger | 所属小组ID（可选） | 关联选择 | 创建时设置，可编辑 |
| login_id | String(100) | 登录ID（唯一，用作账号标识） | 用户输入 | 创建时设置，不可修改 |
| account_name | String(200) | 账号名称（管理员姓名） | 用户输入 | 可编辑 |
| password_hash | String(255) | 密码哈希（BCrypt加密） | 系统生成 | 可编辑（重置密码） |
| role | String(50) | 角色（team_leader/quality_inspector/statistician） | 用户选择 | 可编辑 |
| email | String(100) | 邮箱 | 用户输入 | 可编辑 |
| remark | Text | 备注 | 用户输入 | 可编辑 |
| is_active | Boolean | 是否启用 | 系统设置 | 可编辑 |
| last_login_at | DateTime | 最近登录时间 | 系统更新 | 登录时更新 |
| created_at | DateTime | 创建时间 | 系统生成 | 自动 |
| updated_at | DateTime | 更新时间 | 系统生成 | 自动 |

**说明**：
- 小组管理员不支持删除操作，只能通过启用/禁用来管理
- 不包含手机号字段
- login_id既是登录账号也是账号的唯一标识，不需要单独的account_code字段

### 8. 交互与信息展示（UX & UI Brief）

本项目前端交互已由 Web 团队实现，本节仅补充关键信息展示要求：

#### 8.1 小组管理员管理页面

- **列表展示**：登录ID、姓名、所属小组、角色、邮箱、最近登录时间、状态、操作
- **筛选功能**：按甲方、机构、小组筛选（三级联动）
- **操作按钮**：创建小组管理员、编辑、重置密码、启用/禁用（不支持删除）
- **创建表单**：登录ID自动填充"甲方编码-"前缀，用户补充后续部分
- **字段说明**：不包含手机号字段，login_id即为账号标识

#### 8.2 通用交互要求

- **级联筛选**：上级筛选条件变化时，自动更新下级筛选选项
- **密码重置**：重置密码前显示确认提示
- **状态提示**：启用/禁用操作前显示确认提示

### 9. 配置项与运营开关（Config & Operation Switches）

#### 9.1 系统级配置

| 配置项 | 说明 | 默认值 | 配置入口 | 变更流程 |
|--------|------|--------|----------|----------|
| 密码最小长度 | 账号密码的最小长度要求 | 6 | 系统配置 | 系统管理员修改 |

---

## 二、数据需求（Data Requirements）

### 1. 埋点需求（Tracking Requirements）

| 触发时间点/条件 | 埋点中文说明 | 埋点英文ID | 关键属性 |
|----------------|------------|-----------|---------|
| 创建小组管理员时 | 小组管理员创建埋点 | team_admin_created | user_id、admin_id（管理员ID）、team_id、username（登录账号） |
| 编辑小组管理员时 | 小组管理员编辑埋点 | team_admin_updated | user_id、admin_id、changed_fields |
| 重置小组管理员密码时 | 小组管理员密码重置埋点 | team_admin_password_reset | user_id、admin_id |
| 启用/禁用小组管理员时 | 小组管理员状态变更埋点 | team_admin_status_changed | user_id、admin_id、old_status、new_status |
| 查看小组管理员列表时 | 小组管理员列表查看埋点 | team_admin_list_viewed | user_id、filter_params（筛选参数） |

---

## 三、技术部分描述（Technical Requirements / TRD）

### 1. 系统架构与模块划分（System Architecture & Modules）

#### 1.1 架构图

```
┌─────────────────────────────────────────────────────────────┐
│                     前端管理控台                              │
│  ┌──────────┐                                               │
│  │小组长管理 │                                               │
│  └──────────┘                                               │
└─────────────────────────────────────────────────────────────┘
                            │
                            │ HTTP/HTTPS
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                    Java后端服务 (Spring Boot)                 │
│  ┌──────────────────────────────────────────────────────┐  │
│  │           小组长管理模块 (TeamAdmin Module)           │  │
│  │  ┌──────────┐                                       │  │
│  │  │小组长服务 │                                       │  │
│  │  └──────────┘                                       │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                            │
                            │ MyBatis-Plus
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                      MySQL数据库                              │
│  ┌──────────┐                                               │
│  │team_admins│                                               │
│  └──────────┘                                               │
└─────────────────────────────────────────────────────────────┘
```

#### 1.2 模块职责边界

**前端模块：**
- **小组长管理页面**：提供用户界面，处理用户交互，调用后端API
- **权限控制**：根据用户角色显示/隐藏功能按钮

**后端模块：**
- **小组长服务层**：处理业务逻辑，包括创建、编辑、查询、重置密码、启用/禁用等操作
- **数据访问层**：使用MyBatis-Plus进行数据库操作

**数据库层：**
- **小组长表**：存储小组长数据

### 2. 接口设计与系统依赖（API Design & Dependencies）

#### 2.1 小组管理员管理接口

**基础路径**: `/api/v1/team-admins`

| 方法 | 路径 | 说明 | 主要入参 | 主要出参 | 超时/重试 | 幂等性 |
|------|------|------|---------|---------|----------|--------|
| GET | `/` | 获取小组管理员列表 | tenant_id（必填）、agency_id（可选）、team_id（可选）、is_active（可选）、skip、limit | 小组管理员列表 | 3s/不重试 | 是 |
| POST | `/` | 创建小组管理员 | tenant_id、agency_id、team_id、login_id、account_name、email、password、role | 创建的小组管理员信息 | 5s/不重试 | 是（基于login_id） |
| GET | `/{admin_id}` | 获取小组管理员详情 | admin_id | 小组管理员详情 | 3s/不重试 | 是 |
| PUT | `/{admin_id}` | 更新小组管理员 | admin_id、更新字段 | 更新后的小组管理员信息 | 5s/不重试 | 是 |
| PUT | `/{admin_id}/password` | 重置密码 | admin_id、new_password | 操作结果 | 3s/不重试 | 是 |
| PUT | `/{admin_id}/status` | 启用/禁用小组管理员 | admin_id、is_active | 操作结果 | 3s/不重试 | 是 |

**请求示例（创建小组管理员）：**
```json
{
  "tenant_id": 1,
  "agency_id": 1001,
  "team_id": 1,
  "login_id": "ABC-leader001",
  "account_name": "张三",
  "email": "leader001@example.com",
  "password": "password123",
  "role": "team_leader"
}
```

**响应示例：**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "tenant_id": 1,
    "agency_id": 1001,
    "team_id": 1,
    "login_id": "ABC-leader001",
    "account_name": "张三",
    "email": "leader001@example.com",
    "role": "team_leader",
    "is_active": true,
    "created_at": "2025-01-11T10:00:00",
    "updated_at": "2025-01-11T10:00:00"
  }
}
```

**请求示例（重置密码）：**
```json
{
  "new_password": "newpassword123"
}
```

#### 2.2 接口通用规范

**请求头：**
- `Content-Type: application/json`
- `Authorization: Bearer {token}`（需要认证的接口）

**响应格式：**
```json
{
  "code": 200,
  "message": "success",
  "data": { ... }
}
```

**错误响应：**
```json
{
  "code": 400,
  "message": "错误描述",
  "data": null
}
```

#### 2.3 系统依赖

**内部依赖：**
- 权限管理模块：验证用户权限，实现数据隔离
- 机构管理模块：获取机构信息
- 小组管理模块：获取小组信息

**外部依赖：**
- 无外部系统依赖

### 3. 数据存储与模型依赖（Data Storage & Model Dependencies）

#### 3.1 数据库表结构

**3.1.1 team_admins表（小组管理员表）**

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 主键ID |
| tenant_id | BIGINT | NOT NULL, FOREIGN KEY | 所属甲方ID |
| agency_id | BIGINT | NOT NULL, FOREIGN KEY | 所属机构ID |
| team_id | BIGINT | NOT NULL, FOREIGN KEY | 所属小组ID |
| login_id | VARCHAR(100) | UNIQUE, NOT NULL | 登录ID（唯一） |
| account_name | VARCHAR(200) | NOT NULL | 管理员姓名 |
| email | VARCHAR(100) | NULL | 邮箱 |
| password_hash | VARCHAR(255) | NOT NULL | 密码哈希 |
| role | VARCHAR(50) | NOT NULL | 角色 |
| is_active | BOOLEAN | DEFAULT TRUE | 是否启用 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| last_login_at | DATETIME | NULL | 最近登录时间 |

**索引：**
- PRIMARY KEY: `id`
- UNIQUE KEY: `uk_login_id` (`login_id`)
- KEY: `idx_tenant_id` (`tenant_id`)
- KEY: `idx_agency_id` (`agency_id`)
- KEY: `idx_team_id` (`team_id`)
- KEY: `idx_is_active` (`is_active`)
- FOREIGN KEY: `fk_team_admin_tenant` (`tenant_id`) REFERENCES `tenants` (`tenant_id`)
- FOREIGN KEY: `fk_team_admin_agency` (`agency_id`) REFERENCES `collection_agencies` (`agency_id`)
- FOREIGN KEY: `fk_team_admin_team` (`team_id`) REFERENCES `collection_teams` (`team_id`)

### 4. 非功能性要求（Non-Functional Requirements）

#### 4.1 性能目标

| 指标 | 目标值 | 说明 |
|------|--------|------|
| QPS | 1000+ | 单个接口的每秒查询数 |
| 响应时间 | < 200ms（查询）< 500ms（创建/更新） | P95响应时间 |

#### 4.2 可用性要求

| 指标 | 目标值 | 说明 |
|------|--------|------|
| SLA | 99.9% | 系统可用性目标 |

#### 4.3 安全要求

| 要求 | 说明 |
|------|------|
| 加密存储 | 密码使用BCrypt加密存储 |
| 接口鉴权 | 所有接口需要JWT Token认证 |
| 数据隔离 | 基于tenant_id实现数据隔离 |

### 5. 日志埋点与监控告警（Logging, Metrics & Alerting）

#### 5.1 关键日志

| 日志类型 | 记录内容 | 日志级别 |
|---------|---------|---------|
| 请求日志 | 请求URL、方法、参数、响应时间、响应状态 | INFO |
| 操作日志 | 操作类型、操作人、操作对象、操作结果 | INFO |
| 错误日志 | 错误类型、错误信息、堆栈信息、请求参数 | ERROR |
| 安全日志 | 登录失败、密码重置、权限拒绝 | WARN |

**日志格式示例：**
```
[2025-01-11 10:00:00] [INFO] [TeamAdminService] 创建小组管理员成功: admin_id=1, team_id=1, operator=agadmin001
[2025-01-11 10:00:01] [ERROR] [TeamAdminService] 创建小组管理员失败: team_id=1, error=登录ID已存在, operator=agadmin001
[2025-01-11 10:00:02] [WARN] [TeamAdminService] 重置密码: admin_id=1, operator=agadmin001
```

### 6. 测试策略与验收标准（Test Plan & Acceptance Criteria）

#### 6.1 关键验收标准

1. **功能完整性**
   - ✅ 能够创建、编辑、查询、重置密码、启用/禁用小组长
   - ✅ 不支持删除小组长，只能禁用

2. **数据一致性**
   - ✅ 登录ID唯一性验证正确
   - ✅ 密码重置功能正常

3. **权限控制**
   - ✅ 机构管理员只能管理本机构下的小组长
   - ✅ 数据隔离正确，不同甲方的数据完全隔离

4. **性能要求**
   - ✅ 查询接口响应时间 < 200ms（P95）
   - ✅ 创建/更新接口响应时间 < 500ms（P95）

5. **安全性**
   - ✅ 密码加密存储，无法明文查看
   - ✅ 敏感信息在日志中脱敏
   - ✅ 接口需要认证，未授权访问被拒绝

---

## 附录

### A. 术语表

| 术语 | 英文 | 说明 |
|------|------|------|
| 小组长 | Team Leader | 小组的管理者，包括组长、质检员、统计员等 |
| 小组管理员 | TeamAdmin | 小组级别的管理员账号 |
| 质检员 | Quality Inspector | 负责质检工作的管理员 |
| 统计员 | Statistician | 负责数据统计的管理员 |

### B. 参考文档

- [组织架构管理PRD](./组织架构管理PRD.md)
- [机构管理PRD](./机构管理PRD.md)
- [小组管理PRD](./小组管理PRD.md)

### C. 版本历史

| 版本 | 日期 | 作者 | 说明 |
|------|------|------|------|
| v1.0 | 2025-12-04 | 产品团队 | 从组织架构管理PRD拆分 |

---

**文档状态：** ✅ 已完成  
**最后更新：** 2025-12-04  
**审核状态：** 待审核



















