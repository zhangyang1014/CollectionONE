| 版本 | 日期 | 变更内容 | 变更人（大象） |
| --- | --- | --- | --- |
| 1.0.0 | 2025-12-09 | 初版 | 大象 |

# AI质检：人脸比对 PRD

## 1. 目标与范围
- 目标：面向管理端提供“AI质检-人脸比对”能力，用于查看催员每日登录的人脸照片及比对结果，支持禁用/启用操作的人工决策展示。
- 范围：
  - 展示：最近三天（当日、昨日、前日）登录照片，若同一天多次登录，需展示所有照片及对应人脸ID。
  - 比对：展示当日、昨日、前日照片之间的一致性结果（仅展示，不触发自动禁用）。
  - 操作：批量/单选禁用、启用；筛选与分页。
  - 不做：自动化禁用或阈值触发；超三日历史归档。

## 2. 角色与权限
- 管理端登录用户（有权限访问AI质检模块）可使用。
- 与催员端无直接交互；仅消费登录照片与人脸ID数据。

## 3. 名词与数据
- 登录照片：催员当次登录采集的人脸照片，可能一天多次登录 -> 需要多张。
- 人脸ID：与登录照片关联的唯一标识（由采集服务或后端生成）。
- 比对结果：对最近三日（当日/昨日/前日）照片进行一致性判定，用于展示。

## 4. 页面与交互
### 4.1 列表筛选
- 所属机构（下拉）
- 小组群（下拉，随机构过滤）
- 小组（下拉，随小组群过滤）
- 催员（下拉，随小组过滤）
- 比对结果（匹配 / 不匹配 / 未知）
- 是否禁用（禁用 / 启用）
- 查询、清空、批量禁用、批量启用

### 4.2 列表字段
- 催员ID
- 所属机构
- 小组群
- 小组
- 比对结果
- 首次照片（含人脸ID）
- 当日照片（含人脸ID，若多次登录展示多张/多ID）
- 昨日照片（含人脸ID）
- 前日照片（含人脸ID）
- 是否禁用（标签：禁用/启用）

### 4.3 照片展示规则
- 每列（当日/昨日/前日/首次）支持多张：以缩略图列表或叠加方式呈现，点击可预览大图。
- 每张照片下方展示对应人脸ID（若无则显示“-”）。
- 排序：同一列按登录时间倒序。

### 4.4 比对结果展示
- 仅用于展示，不触发自动禁用。
- 取最近三日照片进行一致性判断：
  - 若当日与昨日/前日任一存在且相似度达阈值 -> 匹配
  - 若均存在且均不达阈值 -> 不匹配
  - 若缺少可比对照片 -> 未知
- 相似度阈值由后端或算法侧提供，前端仅展示结果枚举。

### 4.5 禁用/启用
- 操作按钮文案：禁用 / 启用。
- 批量/单行均需二次确认弹窗。
- 状态展示列对应“是否禁用”，标签文案为“禁用/启用”。

## 5. 数据与接口要求（建议）
> 注：当前前端存在mock兜底，正式上线需提供真实接口。

### 5.1 列表查询（GET）
- Path：`/ai-quality/face-compare/list`
- 入参建议：
  - `agencyId`，`teamGroupId`，`teamId`，`collectorId`
  - `compareResult` in [match, mismatch, unknown]
  - `locked` (true=禁用, false=启用)
  - `pageNum`，`pageSize`
- 出参示例：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "items": [
      {
        "collectorId": 180,
        "organizationName": "CLOUDUN",
        "teamGroupName": "一组群",
        "teamName": "一小组",
        "compareResult": "match",
        "locked": false,
        "firstPhotos": [
          { "url": "https://...", "faceId": "FACE-001", "ts": "2025-12-09T08:00:00Z" }
        ],
        "todayPhotos": [
          { "url": "https://...", "faceId": "FACE-002", "ts": "2025-12-09T10:01:00Z" },
          { "url": "https://...", "faceId": "FACE-003", "ts": "2025-12-09T15:20:00Z" }
        ],
        "yesterdayPhotos": [
          { "url": "https://...", "faceId": "FACE-004", "ts": "2025-12-08T09:00:00Z" }
        ],
        "beforeYesterdayPhotos": [
          { "url": "https://...", "faceId": "FACE-005", "ts": "2025-12-07T09:00:00Z" }
        ]
      }
    ],
    "total": 123
  }
}
```

### 5.2 禁用/启用（POST）
- Path：`/ai-quality/face-compare/lock`
- 入参：`collectorId`, `lock` (true=禁用, false=启用)
- 出参：`{ code:200, message:"success" }`

## 6. 业务规则
- 展示维度：以催员为粒度，聚合最近三天登录照片，按登录时间倒序。
- 多次登录：同一天内所有登录照片均需展示，并保留各自人脸ID。
- 比对结果：仅前端展示，禁用/启用需人工点击；不自动触发状态。
- 数据缺失：无照片则显示“-”占位；比对结果为“未知”。

## 7. 交互与状态
- 空数据：显示“暂无数据”。
- 加载态：表格 loading。
- 失败：toast 错误提示，数据保持上次成功状态。
- 批量操作：未选择时提示“请选择需要操作的催员”。

## 8. 验收标准
- 能根据筛选条件查询并分页展示。
- 同一天多次登录，列表对应列可看到多张照片及各自人脸ID。
- 比对结果枚举正确渲染；无自动禁用行为。
- 禁用/启用操作有确认弹窗，状态更新后列表可刷新。
- 列展示包含：催员ID、机构、小组群、小组、比对结果、首次/当日/昨日/前日照片+faceId、是否禁用。

## 9. 未来扩展
- 支持自定义时间范围的历史照片调取。
- 支持按相似度阈值或算法版本筛选。
- 支持导出（含照片URL与faceId列表）。
