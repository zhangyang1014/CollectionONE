# å°ç»„åˆ—è¡¨æ˜¾ç¤ºä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

åœ¨å°ç»„ç®¡ç†é¡µé¢ä¸­ï¼Œ"æ‰€å±ç”²æ–¹"å’Œ"æ‰€å±å°ç»„ç¾¤"ä¸¤åˆ—æ˜¾ç¤ºä¸ºç©ºç™½ã€‚

## ğŸ” é—®é¢˜åŸå› 

åç«¯API (`/api/v1/agencies/{agency_id}/teams`) åªæ˜¯ç®€å•è¿”å›äº† ORM å¯¹è±¡ï¼Œæ²¡æœ‰æ„é€ åŒ…å«å…³è”æ•°æ®çš„å®Œæ•´å“åº”ï¼š

1. **ç¼ºå°‘å­—æ®µ**ï¼š
   - `tenant_name` - ç”²æ–¹åç§°
   - `team_group_name` - å°ç»„ç¾¤åç§°
   - `queue_name` - å‚¬æ”¶é˜Ÿåˆ—åç§°

2. **Schemaä¸å®Œæ•´**ï¼š
   - `CollectionTeam` å“åº”Schemaä¸­æ²¡æœ‰å®šä¹‰ `tenant_name` å’Œ `tenant_id` å­—æ®µ

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. æ›´æ–°å“åº”Schema

**æ–‡ä»¶**: `backend/app/schemas/organization.py`

åœ¨ `CollectionTeam` å“åº”ç±»ä¸­æ·»åŠ äº†ç¼ºå¤±çš„å­—æ®µï¼š

```python
class CollectionTeam(CollectionTeamBase):
    """å‚¬æ”¶å°ç»„å“åº”"""
    id: int
    tenant_id: int  # æ–°å¢
    tenant_name: Optional[str] = Field(None, description="ç”²æ–¹åç§°")  # æ–°å¢
    agency_name: Optional[str] = Field(None, description="æœºæ„åç§°")
    team_group_name: Optional[str] = Field(None, description="å°ç»„ç¾¤åç§°")
    queue_name: Optional[str] = Field(None, description="å‚¬æ”¶é˜Ÿåˆ—åç§°")
    team_leader_name: Optional[str] = Field(None, description="ç»„é•¿å§“å")
    collector_count: int = Field(0, description="å‚¬å‘˜æ•°é‡")
    case_count: int = Field(0, description="æ¡ˆä»¶æ•°é‡")
    created_at: datetime
    updated_at: datetime
```

### 2. ä¿®æ”¹APIè¿”å›æ•°æ®

**æ–‡ä»¶**: `backend/app/api/agencies.py`

ä¿®æ”¹ `get_agency_teams` å‡½æ•°ï¼Œæ„é€ åŒ…å«æ‰€æœ‰å…³è”ä¿¡æ¯çš„å®Œæ•´å“åº”ï¼š

```python
@router.get("/{agency_id}/teams")
async def get_agency_teams(agency_id: int, db: Session = Depends(get_db)):
    """è·å–æœºæ„ä¸‹çš„å°ç»„åˆ—è¡¨"""
    # ... æŸ¥è¯¢å°ç»„ ...
    
    # æ„é€ è¿”å›æ•°æ®ï¼ŒåŒ…å«å…³è”ä¿¡æ¯
    result = []
    for team in teams:
        # è·å–ç”²æ–¹åç§°
        tenant_name = team.tenant.tenant_name if team.tenant else None
        
        # è·å–æœºæ„åç§°
        agency_name = team.agency.agency_name if team.agency else None
        
        # è·å–å°ç»„ç¾¤åç§°
        team_group_name = None
        if team.team_group_id:
            team_group = db.query(TeamGroup).filter(
                TeamGroup.id == team.team_group_id
            ).first()
            if team_group:
                team_group_name = team_group.group_name
        
        # è·å–é˜Ÿåˆ—åç§°
        queue_name = None
        if team.queue_id:
            queue = db.query(CaseQueue).filter(
                CaseQueue.id == team.queue_id
            ).first()
            if queue:
                queue_name = queue.queue_name
        
        # è·å–å‚¬å‘˜æ•°é‡
        collector_count = db.query(func.count(Collector.id)).filter(
            Collector.team_id == team.id
        ).scalar() or 0
        
        team_dict = {
            "id": team.id,
            "tenant_id": team.tenant_id,
            "tenant_name": tenant_name,
            "agency_id": team.agency_id,
            "agency_name": agency_name,
            "team_group_id": team.team_group_id,
            "team_group_name": team_group_name,
            "queue_id": team.queue_id,
            "queue_name": queue_name,
            "team_code": team.team_code,
            "team_name": team.team_name,
            # ... å…¶ä»–å­—æ®µ ...
        }
        result.append(team_dict)
    
    return result
```

## ğŸ“Š APIå“åº”ç¤ºä¾‹

ä¿®å¤åçš„APIå“åº”ï¼ˆ`GET /api/v1/agencies/1/teams`ï¼‰ï¼š

```json
[
  {
    "id": 1,
    "tenant_id": 1,
    "tenant_name": "ç™¾è…¾ä¼ä¸š",
    "agency_id": 1,
    "agency_name": "ç™¾è…¾ä¼ä¸š-æœºæ„1",
    "team_group_id": 1,
    "team_group_name": "é«˜é¢æ¡ˆä»¶ç»„",
    "queue_id": 1,
    "queue_name": "Cé˜Ÿåˆ—",
    "team_code": "AG101T1",
    "team_name": "ç™¾è…¾ä¼ä¸š-æœºæ„1-å°ç»„1",
    "team_name_en": "BTQ Enterprise Agency 1 Team 1",
    "team_leader_id": null,
    "team_type": null,
    "description": null,
    "max_case_count": 0,
    "sort_order": 0,
    "is_active": true,
    "collector_count": 6,
    "case_count": 0,
    "created_at": "2025-11-19T17:36:39",
    "updated_at": "2025-11-20T09:37:23"
  },
  {
    "id": 2,
    "tenant_id": 1,
    "tenant_name": "ç™¾è…¾ä¼ä¸š",
    "agency_id": 1,
    "agency_name": "ç™¾è…¾ä¼ä¸š-æœºæ„1",
    "team_group_id": 2,
    "team_group_name": "æ™®é€šæ¡ˆä»¶ç»„",
    "queue_id": 1,
    "queue_name": "Cé˜Ÿåˆ—",
    "team_code": "AG101T2",
    "team_name": "ç™¾è…¾ä¼ä¸š-æœºæ„1-å°ç»„2",
    "collector_count": 3,
    "is_active": true
  }
]
```

## ğŸ¯ ä¿®å¤æ•ˆæœ

å‰ç«¯å°ç»„åˆ—è¡¨ç°åœ¨å¯ä»¥æ­£ç¡®æ˜¾ç¤ºï¼š

| åˆ—å | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| æ‰€å±ç”²æ–¹ | âŒ ç©ºç™½ | âœ… ç™¾è…¾ä¼ä¸š |
| æ‰€å±æœºæ„ | âœ… æ˜¾ç¤º | âœ… æ˜¾ç¤º |
| æ‰€å±å°ç»„ç¾¤ | âŒ ç©ºç™½ | âœ… é«˜é¢æ¡ˆä»¶ç»„/æ™®é€šæ¡ˆä»¶ç»„ |
| å‚¬æ”¶é˜Ÿåˆ— | âŒ ç©ºç™½ | âœ… Cé˜Ÿåˆ— |
| å‚¬å‘˜è´¦å·æ•°é‡ | âŒ 0 | âœ… å®é™…æ•°é‡ |

## ğŸ“ å‰ç«¯ä»£ç 

å‰ç«¯ä»£ç ï¼ˆ`frontend/src/views/organization/TeamManagement.vue`ï¼‰ä¸éœ€è¦ä¿®æ”¹ï¼Œå› ä¸ºï¼š

1. è¡¨æ ¼åˆ—å®šä¹‰å·²ç»æ­£ç¡®ï¼š
```vue
<el-table-column prop="tenant_name" label="æ‰€å±ç”²æ–¹" width="150" />
<el-table-column prop="agency_name" label="æ‰€å±æœºæ„" width="150" />
<el-table-column prop="team_group_name" label="æ‰€å±å°ç»„ç¾¤" width="150" />
<el-table-column prop="queue_name" label="å‚¬æ”¶é˜Ÿåˆ—" width="150" />
```

2. APIå“åº”ç°åœ¨åŒ…å«äº†æ‰€æœ‰è¿™äº›å­—æ®µï¼Œå‰ç«¯å¯ä»¥ç›´æ¥ç»‘å®šæ˜¾ç¤º

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ€§èƒ½è€ƒè™‘**: å½“å‰å®ç°ä¸ºæ¯ä¸ªå°ç»„éƒ½æ‰§è¡Œäº†é¢å¤–çš„æŸ¥è¯¢æ¥è·å–å…³è”ä¿¡æ¯ã€‚å¦‚æœå°ç»„æ•°é‡å¾ˆå¤šï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ JOIN æˆ–è€…é¢„åŠ è½½æ¥ä¼˜åŒ–æ€§èƒ½ã€‚

2. **å‚¬å‘˜æ•°é‡**: å·²ç»æ·»åŠ äº†å®æ—¶è®¡ç®—å‚¬å‘˜æ•°é‡çš„åŠŸèƒ½ã€‚

3. **æ¡ˆä»¶æ•°é‡**: ç›®å‰è®¾ç½®ä¸º0ï¼Œéœ€è¦åç»­å®ç°æ¡ˆä»¶æ•°é‡çš„è®¡ç®—ã€‚

## ğŸ”„ éƒ¨ç½²æ­¥éª¤

1. âœ… ä¿®æ”¹åç«¯ä»£ç 
2. âœ… é‡å¯åç«¯æœåŠ¡
3. âœ… å‰ç«¯åˆ·æ–°é¡µé¢å³å¯çœ‹åˆ°æ•ˆæœï¼ˆæ— éœ€ä¿®æ”¹å‰ç«¯ä»£ç ï¼‰

## ğŸ“… ä¿®å¤æ—¥æœŸ
2025å¹´11æœˆ20æ—¥

## ğŸ”— ç›¸å…³æ–‡æ¡£
- [å°ç»„ç¾¤Mockæ•°æ®è¯´æ˜.md](./å°ç»„ç¾¤Mockæ•°æ®è¯´æ˜.md)
- [å°ç»„ç®¡ç†å‘˜Mockæ•°æ®è¯´æ˜.md](./å°ç»„ç®¡ç†å‘˜Mockæ•°æ®è¯´æ˜.md)

