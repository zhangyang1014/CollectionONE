# 系统角色体系说明

## 版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2025-01-11 | 初始版本，定义系统核心角色体系 |

---

## 一、角色层级架构

```
系统角色层级
│
├── SuperAdmin（超级管理员）
│   └── 管理甲方
│
└── 甲方（Tenant）
    ├── 甲方管理员（TenantAdmin）
    │   └── 管理机构、小组、账号
    │
    └── 催收机构（Collection Agency）
        └── 催收小组（Collection Team）
            ├── 小组管理账号
            │   ├── 小组长（Team Leader）
            │   ├── 质检员（Quality Inspector）
            │   └── 统计员（Statistician）
            │
            └── 催员（Collector）
```

---

## 二、角色详细说明

### 2.1 SuperAdmin（超级管理员）

**定义：** 系统最高权限角色，用于系统初始化和甲方管理。

**特点：**
- 系统创建，无界面编辑
- 由系统部署时自动创建，账号信息通过环境变量或配置文件管理
- 不在数据库的常规用户表中存储

**权限：**
- 创建、编辑、删除甲方
- 创建甲方时，同时创建该甲方的管理员账号
- 查看系统全局配置
- 管理标准字段（系统级字段）

**无法操作：**
- 不能登录甲方系统进行业务操作
- 不能直接管理催收机构、小组、催员等

---

### 2.2 甲方管理员（TenantAdmin）

**定义：** 每个甲方的最高权限管理员，负责该甲方内的所有配置和管理。

**创建方式：**
- 由 SuperAdmin 在创建甲方时同时创建
- 创建时必须提供：
  - 账号名（admin_name）
  - 登录ID（admin_login_id）
  - 邮箱（admin_email）
  - 初始密码（admin_password）

**可编辑性：**
- 账号信息可由 SuperAdmin 编辑
- 甲方管理员自己可以修改密码和邮箱

**权限：**
- 管理本甲方的所有催收机构
- 管理本甲方的所有催收小组
- 管理本甲方的所有小组管理账号（小组长、质检员、统计员）
- 管理本甲方的所有催员账号
- 配置本甲方的自定义字段
- 配置本甲方的案件队列
- 查看本甲方的所有数据和报表

**无法操作：**
- 不能创建或管理其他甲方
- 不能修改系统级标准字段
- 不能访问其他甲方的数据

---

### 2.3 小组管理账号

**定义：** 在催收小组内承担特定管理职责的账号。

**类型：**

#### 2.3.1 小组长（Team Leader）
- 管理小组内催员的日常工作
- 分配案件给催员
- 审核催员的催收记录
- 查看小组业绩和统计

#### 2.3.2 质检员（Quality Inspector）
- 质检催员的催收录音和记录
- 评分和反馈
- 生成质检报告

#### 2.3.3 统计员（Statistician）
- 统计小组和催员的业绩数据
- 生成各类报表
- 数据分析

**创建方式：**
- 由甲方管理员创建
- 创建时必须提供：账号名、登录ID、邮箱、角色、所属机构、所属小组

**权限范围：**
- 仅限于所属小组内的数据和操作
- 不能跨小组或跨机构操作

---

### 2.4 催员（Collector）

**定义：** 实际执行催收工作的一线人员。

**创建方式：**
- 由甲方管理员创建
- 必须归属于某个催收小组

**权限：**
- 查看分配给自己的案件
- 记录催收活动（电话、短信、现场等）
- 更新案件状态
- 查看自己的业绩统计

**无法操作：**
- 不能查看或操作其他催员的案件
- 不能进行系统配置
- 不能查看小组或机构级别的数据

---

## 三、角色创建流程

### 3.1 SuperAdmin 创建甲方流程

```
1. SuperAdmin 登录系统
   ↓
2. 进入"甲方列表"页面，点击"添加甲方"
   ↓
3. 填写甲方基础信息
   - 甲方名称
   - 甲方编码
   - 国家代码
   - 时区
   - 货币
   ↓
4. 填写甲方管理员账号信息
   - 管理员账号名
   - 管理员登录ID
   - 管理员邮箱
   - 管理员密码
   - 确认密码
   ↓
5. 点击"保存"
   ↓
6. 系统自动完成：
   - 创建甲方记录
   - 创建甲方管理员账号
   - 初始化标准字段配置（100%继承系统标准字段）
   - 创建默认案件队列（C, S0, S1, L1, M1）
   ↓
7. 返回甲方列表，显示新创建的甲方
```

### 3.2 甲方管理员创建组织架构流程

```
1. 甲方管理员登录
   ↓
2. 创建催收机构
   - 机构名称
   - 机构编码
   ↓
3. 在机构下创建催收小组
   - 小组名称
   - 小组编码
   - 所属机构
   ↓
4. 创建小组管理账号
   - 选择角色（小组长/质检员/统计员）
   - 填写账号信息
   - 指定所属小组
   ↓
5. 创建催员账号
   - 填写催员信息
   - 指定所属小组
```

---

## 四、数据库设计

### 4.1 SuperAdmin

SuperAdmin 不存储在数据库中，通过环境变量或配置文件管理：

```env
# .env
SUPERADMIN_USERNAME=superadmin
SUPERADMIN_PASSWORD=<加密后的密码>
SUPERADMIN_EMAIL=admin@system.com
```

### 4.2 甲方管理员（tenant_admins 表）

```sql
CREATE TABLE tenant_admins (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tenant_id BIGINT NOT NULL COMMENT '所属甲方ID',
    admin_name VARCHAR(50) NOT NULL COMMENT '管理员账号名',
    login_id VARCHAR(50) NOT NULL UNIQUE COMMENT '登录ID',
    email VARCHAR(100) NOT NULL COMMENT '邮箱',
    password_hash VARCHAR(255) NOT NULL COMMENT '密码哈希',
    is_active BOOLEAN DEFAULT TRUE COMMENT '是否启用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    last_login_at TIMESTAMP NULL COMMENT '最近登录时间',
    
    FOREIGN KEY (tenant_id) REFERENCES tenants(id) ON DELETE CASCADE,
    INDEX idx_tenant_id (tenant_id),
    INDEX idx_login_id (login_id)
) COMMENT '甲方管理员表';
```

### 4.3 小组管理账号（team_admin_accounts 表）

```sql
CREATE TABLE team_admin_accounts (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tenant_id BIGINT NOT NULL COMMENT '所属甲方ID',
    agency_id BIGINT NOT NULL COMMENT '所属机构ID',
    team_id BIGINT NOT NULL COMMENT '所属小组ID',
    account_name VARCHAR(50) NOT NULL COMMENT '账号名',
    login_id VARCHAR(50) NOT NULL UNIQUE COMMENT '登录ID',
    email VARCHAR(100) NOT NULL COMMENT '邮箱',
    mobile VARCHAR(20) NULL COMMENT '手机号（可选）',
    password_hash VARCHAR(255) NOT NULL COMMENT '密码哈希',
    role ENUM('小组长', '质检员', '统计员') NOT NULL COMMENT '角色',
    is_active BOOLEAN DEFAULT TRUE COMMENT '是否启用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    last_login_at TIMESTAMP NULL COMMENT '最近登录时间',
    
    FOREIGN KEY (tenant_id) REFERENCES tenants(id) ON DELETE CASCADE,
    FOREIGN KEY (agency_id) REFERENCES collection_agencies(id) ON DELETE CASCADE,
    FOREIGN KEY (team_id) REFERENCES collection_teams(id) ON DELETE CASCADE,
    INDEX idx_tenant_id (tenant_id),
    INDEX idx_agency_id (agency_id),
    INDEX idx_team_id (team_id),
    INDEX idx_login_id (login_id),
    INDEX idx_role (role)
) COMMENT '小组管理账号表';
```

### 4.4 催员（collectors 表）

表结构已在 `CCO字段配置系统设计.md` 中定义。

---

## 五、前端界面说明

### 5.1 SuperAdmin 界面

**路由：** `/admin`

**菜单：**
- 甲方列表
  - 添加甲方（含甲方管理员信息）
  - 编辑甲方
  - 删除甲方
- 标准字段管理
- 字段分组管理

### 5.2 甲方管理员界面

**路由：** `/tenant`

**菜单：**
- 工作台
- 案件管理
  - 案件列表
- 字段配置
  - 标准字段管理（只读，查看系统标准字段）
  - 甲方自定义字段管理（配置映射和自定义字段）
  - 字段分组管理
  - 字段联动配置
- 甲方管理
  - ~~甲方列表~~（不显示，因为只能管理自己）
  - 案件队列管理
  - 机构管理
  - 小组管理
  - 小组管理账号
  - 催员管理
- 渠道配置

---

## 六、实现说明

### 6.1 前端实现

#### 6.1.1 已完成

✅ 甲方列表页面 (`frontend/src/views/tenant-management/TenantList.vue`)
  - 移除"字段配置"按钮
  - 添加创建甲方对话框，包含：
    - 甲方基础信息（名称、编码、国家、时区、货币）
    - 甲方管理员账号信息（账号名、登录ID、邮箱、密码）
  - 实现表单验证（密码确认、邮箱格式等）

✅ 小组管理页面 (`frontend/src/views/organization/TeamManagement.vue`)
  - 移除"小组组长"字段
  - 移除"目标业绩"字段

#### 6.1.2 待实现

- [ ] 实际的 API 调用（创建甲方时同时创建管理员）
- [ ] SuperAdmin 登录界面
- [ ] 甲方管理员登录界面
- [ ] 角色权限中间件
- [ ] 根据登录角色显示不同菜单

### 6.2 后端实现

#### 6.2.1 待实现

- [ ] `tenant_admins` 表创建
- [ ] 创建甲方 API（`POST /api/v1/tenants`）
  - 同时创建甲方管理员
  - 初始化标准字段配置
  - 创建默认案件队列
- [ ] SuperAdmin 认证（环境变量验证）
- [ ] 甲方管理员认证（JWT Token）
- [ ] 角色权限中间件
- [ ] 数据权限过滤（确保甲方管理员只能访问自己的数据）

---

## 七、安全考虑

### 7.1 密码安全

- 所有密码使用 bcrypt 或 Argon2 进行哈希存储
- 最小密码长度：6位
- 支持密码强度验证（建议包含大小写字母、数字、特殊字符）

### 7.2 权限隔离

- SuperAdmin 和甲方管理员使用不同的认证机制
- 甲方管理员无法访问其他甲方的数据
- 小组管理账号和催员只能访问所属小组的数据

### 7.3 审计日志

- 记录所有重要操作（创建、编辑、删除账号）
- 记录登录日志（时间、IP、设备）

---

## 八、FAQ

### Q1：SuperAdmin 如何登录？

A：SuperAdmin 使用独立的登录入口（如 `/admin/login`），账号密码存储在环境变量中，不在数据库。

### Q2：甲方管理员忘记密码怎么办？

A：SuperAdmin 可以在甲方列表中编辑该甲方，重置管理员密码。

### Q3：一个甲方可以有多个管理员吗？

A：当前设计是一个甲方一个管理员。如果需要多个管理员，需要扩展 `tenant_admins` 表设计，允许多条记录关联同一个 `tenant_id`。

### Q4：小组管理账号和催员的区别是什么？

A：
- **小组管理账号**：承担管理职责（小组长、质检员、统计员），可以查看和管理小组内的数据。
- **催员**：一线催收人员，只能查看和操作分配给自己的案件。

### Q5：SuperAdmin 可以直接创建催员吗？

A：不可以。SuperAdmin 只能创建甲方和甲方管理员，其他组织架构（机构、小组、催员）由甲方管理员创建。

---

## 九、总结

本系统采用清晰的三层角色架构：

1. **SuperAdmin**：系统级管理，管理甲方
2. **甲方管理员**：甲方级管理，管理组织架构和配置
3. **小组管理账号 + 催员**：业务级操作，执行催收工作

这种设计确保了：
- ✅ 权限清晰，职责分明
- ✅ 数据隔离，安全可靠
- ✅ 易于扩展，支持多租户
- ✅ 操作简便，符合业务流程

