# âœ… åç«¯æœåŠ¡é‡å¯è¯´æ˜

## ğŸ“‹ é—®é¢˜

IMç™»å½•åä»ç„¶å‡ºç° `collector_id=NaN` çš„é—®é¢˜ï¼ŒåŸå› æ˜¯**åç«¯æœåŠ¡æ²¡æœ‰é‡æ–°ç¼–è¯‘/é‡å¯**ï¼Œå¯¼è‡´æ–°çš„ä»£ç ï¼ˆåŒ…å« `collectorIdNumeric` å­—æ®µï¼‰æ²¡æœ‰ç”Ÿæ•ˆã€‚

---

## âœ… å·²æ‰§è¡Œçš„æ“ä½œ

### 1. åœæ­¢ç°æœ‰åç«¯æœåŠ¡

```bash
lsof -ti :8080 | xargs kill -9
```

### 2. é‡æ–°å¯åŠ¨åç«¯æœåŠ¡

```bash
cd backend-java
JAVA_HOME=/opt/homebrew/opt/openjdk@17 \
PATH=/opt/homebrew/opt/openjdk@17/bin:$PATH \
mvn spring-boot:run -Dspring-boot.run.profiles=dev
```

---

## ğŸ§ª éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨

```bash
lsof -i :8080
```

åº”è¯¥çœ‹åˆ° Java è¿›ç¨‹åœ¨ç›‘å¬ 8080 ç«¯å£ã€‚

### 2. æµ‹è¯•ç™»å½•API

```bash
curl -X POST http://localhost:8080/api/v1/im/auth/login \
  -H "Content-Type: application/json" \
  -d '{"tenantId":"1","collectorId":"BTQ001","password":"123456"}'
```

**é¢„æœŸå“åº”**åº”è¯¥åŒ…å« `collectorIdNumeric` å­—æ®µï¼š

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "MOCK_IM_TOKEN_...",
    "user": {
      "id": "BTQ001",
      "collectorId": "BTQ001",
      "collectorIdNumeric": 1,  // âœ… è¿™ä¸ªå­—æ®µåº”è¯¥å­˜åœ¨
      "tenantId": "1",
      "username": "å‚¬å‘˜BTQ001",
      "role": "collector",
      "whatsappConnected": true
    }
  }
}
```

### 3. æµ‹è¯•å‰ç«¯ç™»å½•

1. åˆ·æ–°å‰ç«¯é¡µé¢
2. é‡æ–°ç™»å½•ï¼š
   - æœºæ„ID: `1`
   - å‚¬å‘˜ID: `BTQ001`
   - å¯†ç : `123456`
3. æ£€æŸ¥ Network é¢æ¿ï¼š
   - ç™»å½•è¯·æ±‚åº”è¯¥è¿”å› `collectorIdNumeric: 1`
   - æ¡ˆä»¶è¯·æ±‚åº”è¯¥æ˜¯ `collector_id=1`ï¼ˆä¸å†æ˜¯ `NaN`ï¼‰

---

## ğŸ” å¦‚æœä»ç„¶æœ‰é—®é¢˜

### æ£€æŸ¥1: åç«¯æ—¥å¿—

æŸ¥çœ‹åç«¯å¯åŠ¨æ—¥å¿—ï¼š

```bash
tail -f backend-java/backend-restart.log
```

æˆ–

```bash
tail -f backend-java/backend.log
```

### æ£€æŸ¥2: å‰ç«¯æ§åˆ¶å°

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹ Console é¢æ¿ï¼š

- åº”è¯¥çœ‹åˆ° `[IM Store] ç™»å½•æˆåŠŸï¼ŒçŠ¶æ€å·²æ›´æ–°`
- åº”è¯¥çœ‹åˆ° `ä½¿ç”¨æ•°å­—æ ¼å¼çš„collectorId: 1`
- ä¸åº”è¯¥çœ‹åˆ° `collector_id=NaN`

### æ£€æŸ¥3: Network é¢æ¿

æ£€æŸ¥ç™»å½•APIçš„å“åº”ï¼š

- ç‚¹å‡» `/api/v1/im/auth/login` è¯·æ±‚
- æŸ¥çœ‹ Response æ ‡ç­¾
- ç¡®è®¤ `user.collectorIdNumeric` å­˜åœ¨

---

## ğŸ“ é‡è¦æç¤º

**æ¯æ¬¡ä¿®æ”¹åç«¯ä»£ç åï¼Œéƒ½éœ€è¦é‡æ–°ç¼–è¯‘å’Œé‡å¯æœåŠ¡ï¼**

### å¿«é€Ÿé‡å¯å‘½ä»¤

```bash
# åœæ­¢æœåŠ¡
lsof -ti :8080 | xargs kill -9

# å¯åŠ¨æœåŠ¡ï¼ˆä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼‰
cd backend-java
./start.sh

# æˆ–æ‰‹åŠ¨å¯åŠ¨
JAVA_HOME=/opt/homebrew/opt/openjdk@17 \
PATH=/opt/homebrew/opt/openjdk@17/bin:$PATH \
mvn spring-boot:run -Dspring-boot.run.profiles=dev
```

---

**åˆ›å»ºæ—¶é—´**: 2025-11-22  
**çŠ¶æ€**: âœ… åç«¯æœåŠ¡å·²é‡å¯

---

**è¯·ç­‰å¾…åç«¯æœåŠ¡å®Œå…¨å¯åŠ¨åï¼ˆçº¦15-30ç§’ï¼‰ï¼Œå†æµ‹è¯•ç™»å½•åŠŸèƒ½ï¼** ğŸš€


